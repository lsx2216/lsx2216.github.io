<!doctype html><html lang=en><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>JB2-3-MySQL</title>
<meta name=description content="[!NOTE] Java道经第2卷 - 第3阶 - MySQL v2-3-web-mysql(JAR) - MySQL
CH01. 关系型数据库 EP01. MySQL相关概念 心法: 数据库 database
相关概念 中文 描述 database 数据库 一个可以持久化存储数据以及简单分析数据的应用软件 RDMS  …"><meta name=keywords content='blog,lsx2216,hugo'><meta property="og:url" content="https://lsx2216.netlify.app/%E7%AC%AC2%E9%98%B6%E6%AE%B5-WEB/JB2-3-MySQL/JB2-3-MySQL/"><meta property="og:type" content="website"><meta property="og:title" content="JB2-3-MySQL"><meta property="og:description" content="[!NOTE] Java道经第2卷 - 第3阶 - MySQL v2-3-web-mysql(JAR) - MySQL
CH01. 关系型数据库 EP01. MySQL相关概念 心法: 数据库 database
相关概念 中文 描述 database 数据库 一个可以持久化存储数据以及简单分析数据的应用软件 RDMS  …"><meta property="og:image" content="https://lsx2216.netlify.app/assets/images/user.jpg"><meta property="og:image:secure_url" content="https://lsx2216.netlify.app/assets/images/user.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="JB2-3-MySQL"><meta name=twitter:description content="[!NOTE] Java道经第2卷 - 第3阶 - MySQL v2-3-web-mysql(JAR) - MySQL
CH01. 关系型数据库 EP01. MySQL相关概念 心法: 数据库 database
相关概念 中文 描述 database 数据库 一个可以持久化存储数据以及简单分析数据的应用软件 RDMS  …"><meta property="twitter:domain" content="https://lsx2216.netlify.app/%E7%AC%AC2%E9%98%B6%E6%AE%B5-WEB/JB2-3-MySQL/JB2-3-MySQL/"><meta property="twitter:url" content="https://lsx2216.netlify.app/%E7%AC%AC2%E9%98%B6%E6%AE%B5-WEB/JB2-3-MySQL/JB2-3-MySQL/"><meta name=twitter:image content="https://lsx2216.netlify.app/assets/images/user.jpg"><link rel=canonical href=https://lsx2216.netlify.app/%E7%AC%AC2%E9%98%B6%E6%AE%B5-WEB/JB2-3-MySQL/JB2-3-MySQL/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.3eb19cb61dde9e37b9522867f3e024aeb68e26ab8e03252e46e365abcb19acf7.js integrity="sha256-PrGcth3enje5Uihn8+AkrraOJquOAyUuRuNlq8sZrPc="></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css integrity=sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js integrity=sha384-X/XCfMm41VSsqRNQgDerQczD69XqmjOOOwYQvr/uuC+j4OPoNhVgjdGFwhvN02Ja crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script>    <link rel="shortcut icon" href="/assets/images/user.jpg" type="image/x-icon">
</head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://lsx2216.netlify.app/><img src=/assets/images/user.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://lsx2216.netlify.app/>lsx2216</a></div><div class=nav-links><div class=nav-link><a href=https://lsx2216.netlify.app/ aria-label><span data-feather=home></span> Home</a></div><div class=nav-link><a href=https://lsx2216.netlify.app/projects/ aria-label><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://github.com aria-label=github><span data-feather=github></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://lsx2216.netlify.app/><span data-feather=home></span> Home</a></li><li class=nav-item><a href=https://lsx2216.netlify.app/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://github.com><span data-feather=github></span></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>JB2-3-MySQL</h1></div><div class=post-content><blockquote><p>[!NOTE] Java道经第2卷 - 第3阶 - MySQL
v2-3-web-mysql(JAR) - MySQL</p></blockquote><h1 id=ch01-关系型数据库>CH01. 关系型数据库</h1><h2 id=ep01-mysql相关概念>EP01. MySQL相关概念</h2><blockquote><p>心法: 数据库 <code>database</code></p></blockquote><table><thead><tr><th>相关概念</th><th>中文</th><th>描述</th></tr></thead><tbody><tr><td><code>database</code></td><td>数据库</td><td>一个可以持久化存储数据以及简单分析数据的应用软件</td></tr><tr><td><code>RDMS</code></td><td>关系型数据库</td><td>由二维表组成，格式一致，易于维护，支持事务，不灵活，如MySQL，Oracle等</td></tr><tr><td><code>NRDMS</code></td><td>非关系型数据库</td><td>由文档，键值对，图片等组成，使用灵活，但不支持事务，如Redis，MongoDB等</td></tr><tr><td><code>SQL</code></td><td>结构化查询语言</td><td>操作关系型数据库的标准语言，目前数据库厂商实现的都是SQL92或SQL99标准</td></tr></tbody></table><blockquote><p>心法: MySQL数据库</p></blockquote><ul><li>MySQL是一款优秀的RDMS关系型数据库，由瑞典mysql-ab公司开发，目前属于Oracle旗下产品。</li><li>MySQL软件采用了双授权政策，分为社区版（开源免费，支持定制）和商业版，体积小，速度快。</li><li>MySQL支持5000万条记录的数据仓库，32位系统表文件最大可支持4GB，64位系统支持最大的表文件为8TB。</li><li>MySQL使用标准的SQL数据语言形式，跨平台，支持多种语言，如 <code>C/C++/Python/Java/PHP/Ruby</code> 等。</li><li>MySQL在5版本之前使用 <code>MyISAM</code> 引擎，在5版本之后使用 <code>InnoDB</code> 引擎，额外支持了ACID事务。</li><li>MySQL服务端中支持多个 <code>DB实例</code>，<code>DB实例</code> 中支持多个 <code>DB表</code>。</li><li>MySQL用户共享MySQL服务端中的所有 <code>DB实例</code> 和 <code>DB表</code>。</li></ul><p><img src=/%E7%AC%AC2%E9%98%B6%E6%AE%B5-WEB/JB2-3-MySQL/image/0ea65538e831bbe74a828bbb3fcdb416.png alt=MySQL架构></p><h2 id=ep02-mysql服务搭建>EP02. MySQL服务搭建</h2><blockquote><p>武技: 在Docker中搭建MySQL单机容器</p></blockquote><h3 id=1-准备相关目录>1. 准备相关目录</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 创建MySQL相关目录</span>
</span></span><span style=display:flex><span>mkdir -p /opt/mysql/single/conf;
</span></span><span style=display:flex><span>mkdir -p /opt/mysql/single/data;
</span></span><span style=display:flex><span>mkdir -p /opt/mysql/single/log;
</span></span><span style=display:flex><span>chmod -R <span style=color:#ae81ff>777</span> /opt/mysql;
</span></span></code></pre></div><h3 id=2-开发配置文件>2. 开发配置文件</h3><ol><li>开发配置文件 <code>my.cnf</code>：</li></ol><p><code>touch /opt/mysql/single/conf/my.cnf</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>[client]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>default-character-set</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>utf8mb4</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>[mysql]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>default-character-set</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>utf8mb4</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>[mysqld]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>character-set-client-handshake</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>FALSE</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>character-set-server</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>utf8mb4</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>collation-server</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>utf8mb4_unicode_ci</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>default-time-zone</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Asia/Shanghai&#39;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>default_authentication_plugin</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>mysql_native_password</span>
</span></span></code></pre></div><ol start=2><li>降低配置文件权限：否则系统上任何用户都可以修改该文件，存在安全风险：</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 降低 my.cnf 文件的权限，否则系统上任何用户都可以修改该文件，存在安全风险</span>
</span></span><span style=display:flex><span>chmod <span style=color:#ae81ff>644</span> /opt/mysql/single/conf/my.cnf;
</span></span></code></pre></div><h3 id=3-创建运行容器>3. 创建运行容器</h3><ol><li>搭建MySQL单机容器:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 拉取镜像（二选一）</span>
</span></span><span style=display:flex><span>docker pull mysql:8;
</span></span><span style=display:flex><span>docker pull registry.cn-hangzhou.aliyuncs.com/lsx/mysql:8;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 创建并运行容器</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 参数 `--network my-net`: 使用自定义桥接网络</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 参数 `-e MYSQL_ROOT_PASSWORD=root`: 设置root用户的密码</span>
</span></span><span style=display:flex><span>docker run -it --name mysql -dp 3306:3306 --network my-net <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e MYSQL_ROOT_PASSWORD<span style=color:#f92672>=</span>root <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -v /opt/mysql/single/conf:/etc/mysql/conf.d <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -v /opt/mysql/single/data:/var/lib/mysql <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -v /opt/mysql/single/log:/var/log/mysql <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  registry.cn-hangzhou.aliyuncs.com/lsx/mysql:8;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查看容器</span>
</span></span><span style=display:flex><span>docker ps -a --format <span style=color:#e6db74>&#34;table {{.ID}}\t{{.Names}}\t{{.Ports}}&#34;</span>
</span></span><span style=display:flex><span>docker logs mysql --tail <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 永久开放3306端口</span>
</span></span><span style=display:flex><span>firewall-cmd --add-port<span style=color:#f92672>=</span>3306/tcp --permanent
</span></span><span style=display:flex><span>firewall-cmd --reload
</span></span></code></pre></div><ol start=2><li>查看MySQL版本:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 进入容器的内部: 可用 `exit` 命令退出容器</span>
</span></span><span style=display:flex><span>docker exec -it mysql bash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查看MySQL版本</span>
</span></span><span style=display:flex><span>mysqladmin --version
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 登录MySQL数据库</span>
</span></span><span style=display:flex><span>mysql -uroot -p
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查看当前登录的用户名</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> user<span style=color:#f92672>()</span>;
</span></span></code></pre></div><h2 id=ep03-mysql可视工具>EP03. MySQL可视工具</h2><blockquote><p>心法: MySQL可视化工具</p></blockquote><table><thead><tr><th>MySQL可视化工具</th><th>描述</th></tr></thead><tbody><tr><td><code>MySQL Workbench</code></td><td>MySQL官方推出的一个开源的可视化工具，支持数据库设计，SQL 开发。服务器管理等功能。</td></tr><tr><td><code>Navicat for MySQL</code></td><td>一款商业化的MySQL可视化工具，提供了完整的数据库管理功能，推荐使用。</td></tr><tr><td><code>phpMyAdmin</code></td><td>一款基于Web的MySQL可视化工具，可以通过浏览器访问和管理MySQL数据库。</td></tr><tr><td><code>HeidiSQL</code></td><td>一款免费开源的MySQL可视化工具，支持多种数据库管理操作。</td></tr><tr><td><code>DBeaver</code></td><td>一款跨平台的数据库管理工具，支持多种数据库管理操作。</td></tr></tbody></table><blockquote><p>武技: 使用IDEA作为MySQL可视工具</p></blockquote><ol><li>点击 <code>Database -> 加号 -> Data Source -> MySQL</code> 进入MySQL配置页面:</li></ol><p><img src=/%E7%AC%AC2%E9%98%B6%E6%AE%B5-WEB/JB2-3-MySQL/image/f50eb80cc79b3e387f28e973ecb46681.png alt></p><pre><code>																																																			1. 在 General 选项卡中添加MySQL本地1驱动jar包:
</code></pre><ul><li>点击 <code>Driver:MySQL -> Go to Driver -> 加号 -> Custom Jars -> 选择驱动jar包</code></li><li>res: <a href=../v3-ssm/resources/mysql-connector-java-8.0.16.jar>mysql-connector-java-8.0.16.jar</a></li></ul><p><img src=/%E7%AC%AC2%E9%98%B6%E6%AE%B5-WEB/JB2-3-MySQL/image/a322945dcd71205d8de3f9c2b443ea84.png alt>
<img src=/%E7%AC%AC2%E9%98%B6%E6%AE%B5-WEB/JB2-3-MySQL/image/7c3056c39a4faa04b72fab1d0b221ae8.png alt></p><ol start=3><li>在 <code>General</code> 选项卡中填写MySQL连接的基本信息:</li></ol><p><img src=/%E7%AC%AC2%E9%98%B6%E6%AE%B5-WEB/JB2-3-MySQL/image/e251b1b74a336f91fbb04dc70dcc0512.png alt></p><ol start=4><li>在 <code>SSH/SSL</code> 选项卡中选择SSH配置，若MySQL未安装到虚拟机则略过此步骤:</li></ol><p><img src=/%E7%AC%AC2%E9%98%B6%E6%AE%B5-WEB/JB2-3-MySQL/image/c766d27b8b97a13fdea1865cd4d4a980.png alt></p><h1 id=ch02-数据定义语言>CH02. 数据定义语言</h1><blockquote><p>心法: 数据定义语言 <code>Data Definition Language</code>，简称DDL</p></blockquote><ul><li>DDL用于对DB元数据如表，用户，列，索引等进行 <code>create/drop/set</code> 等操作。</li></ul><h2 id=ep01-mysql实例操作>EP01. MySQL实例操作</h2><blockquote><p>武技: 创建数据库实例 <code>test</code></p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 展示MySQL服务端中的全部数据库实例
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>show</span> databases;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 删除指定数据库实例
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>drop</span> <span style=color:#66d9ef>database</span> <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>exists</span> test;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 创建数据库实例: 数据库实例名为 `test`
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>database</span> test character <span style=color:#66d9ef>set</span> utf8mb4;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 切换当前数据库: 切换为 `test`
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>use test;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查看当前数据库版本和名称
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#66d9ef>version</span>(), <span style=color:#66d9ef>database</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查看当前数据库的全局变量 - 时区: 支持直接使用like进行模糊筛选
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>show</span> variables <span style=color:#66d9ef>like</span> <span style=color:#e6db74>&#39;%time_zone%&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 将时区修改为Asia/Shanghai
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>set</span> time_zone <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Asia/Shanghai&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查看当前数据库的编码
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>@@</span>character_set_database;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 修改指定数据库的编码
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>alter</span> <span style=color:#66d9ef>database</span> test character <span style=color:#66d9ef>set</span> utf8mb4;
</span></span></code></pre></div><h2 id=ep02-mysql用户操作>EP02. MySQL用户操作</h2><blockquote><p>心法: 数据控制语言 <code>Data Control Language</code>，简称DCL</p></blockquote><ul><li>DCL用于对DB用户进行 <code>grant</code> 赋予权限和 <code>revoke</code> 回收权限操作。</li></ul><blockquote><p>武技: 创建 <code>lsx</code> 用户并赋予全部权限</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 查看当前用户 [root]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#66d9ef>user</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查看全部用户 [root]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#66d9ef>user</span>, <span style=color:#66d9ef>host</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> mysql.<span style=color:#66d9ef>user</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 删除指定用户 [root]: 删除用户的时候必须指定IP地址
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>drop</span> <span style=color:#66d9ef>user</span> <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>exists</span> <span style=color:#e6db74>&#39;lsx&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;%&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 创建新用户 [root]
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 参数 `%` 表示允许该用户访问远程库，可替换为 `localhost` 或具体IP地址
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 参数 `identified by &#39;123&#39;` 若整体省略表示不设置密码
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>user</span> <span style=color:#e6db74>&#39;lsx&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;%&#39;</span> identified <span style=color:#66d9ef>by</span> <span style=color:#e6db74>&#39;123&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 修改用户密码 [root]: 将密码修改为 lsx
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>alter</span> <span style=color:#66d9ef>user</span> <span style=color:#e6db74>&#39;lsx&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;%&#39;</span> identified <span style=color:#66d9ef>with</span> MYSQL_NATIVE_PASSWORD <span style=color:#66d9ef>by</span> <span style=color:#e6db74>&#39;lsx&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询用户权限 [root]: USAGE表示无权限
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>show</span> grants <span style=color:#66d9ef>for</span> <span style=color:#e6db74>&#39;lsx&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;%&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 回收权限 [root]: all表示回收全部权限，可替换为具体权限列表，逗号分隔
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>revoke</span> <span style=color:#66d9ef>all</span> <span style=color:#66d9ef>on</span> <span style=color:#f92672>*</span>.<span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;lsx&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;%&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 为用户赋权 [root]
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 参数 `all privileges`: 表示赋予该用户全部权限，可替换为具体权限列表，逗号分隔
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 参数 `on *.*`: 表示用户对全部库的全部表开启权限，可替换为具体库或具体表
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 参数 `with grant option`: 表示该用户可以为其他用户授权，可选
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>grant</span> <span style=color:#66d9ef>all</span> <span style=color:#66d9ef>privileges</span> <span style=color:#66d9ef>on</span> <span style=color:#f92672>*</span>.<span style=color:#f92672>*</span> <span style=color:#66d9ef>to</span> <span style=color:#e6db74>&#39;lsx&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;%&#39;</span> <span style=color:#66d9ef>with</span> <span style=color:#66d9ef>grant</span> <span style=color:#66d9ef>option</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 刷新权限 [root]: 用户赋权之后，要立刻执行一次刷新权限命令，否则可能导致赋权失败
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>flush <span style=color:#66d9ef>privileges</span>;
</span></span></code></pre></div><h2 id=ep03-mysql表格操作>EP03. MySQL表格操作</h2><blockquote><p>心法: 数据库表</p></blockquote><ul><li>MySQL的数据最终都存放在表中，每个表最多存储4096列数据，每张表的大小不能超过65535字节，行数建议控制在500万以内。</li></ul><blockquote><p>心法: 数据库表设计规范</p></blockquote><ul><li>MySQL每张表都强烈建议设置以下三个字段:<ul><li><code>id int unsigned auto_increment</code>: 主键，对应 <code>java.lang.Long</code> 型属性。</li><li><code>created datetime</code>: 首次创建时间，对应 <code>java.util.Date</code> 型属性。</li><li><code>updated datetime</code>: 最后修改时间，对应 <code>java.util.Date</code> 型属性。</li></ul></li><li>MySQL表名和字段名可由字母，数字，下划线组成，建议使用 <code>全小写 + 下划线</code> 格式，且禁止使用复数单词和缩写。</li><li>表名允许使用以下前缀作为业务说明:<ul><li><code>ums_XXX</code>: 用户管理模块，如用户表，角色表，权限表，菜单表等。</li><li><code>pms_XXX</code>: 商品管理模块，如商品表，商品分类表等。</li><li><code>oms_XXX</code>: 订单管理模块，如订单表，订单明细表，购物车表等。</li><li><code>cms_XXX</code>: 内容管理模块，如评论表，举报表等。</li><li><code>sms_XXX</code>: 营销管理模块，如广告轮播图表，活动表等。</li></ul></li></ul><blockquote><p>心法: 数据库表字段的数据类型</p></blockquote><ul><li>选型原则01: 能用小的就别用大的，能用固定的就别用变化的。</li><li>选型原则02: 任何字段如果为非负数，必须由 <code>unsigned</code> 标记。</li><li>选型原则03: 小数类型统一使用 <code>decimal</code>，禁止使用 <code>float/double</code>，规避丢失精度的问题。</li></ul><table><thead><tr><th>数据类型</th><th>中文</th><th>类型大小</th><th>描述</th></tr></thead><tbody><tr><td><code>tinyint</code></td><td>小整数</td><td>1字节</td><td>有符号范围 <code>-128 ~ 127</code>，无符号范围 <code>0 ~ 255</code></td></tr><tr><td><code>int / integer</code></td><td>整数</td><td>4字节</td><td>有符号范围 <code>-2^32 ~ 2^32-1</code>，无符号范围 <code>0 ~ 约42.9亿</code></td></tr><tr><td><code>bigint</code></td><td>大整数</td><td>8字节</td><td>有符号范围 <code>-2^63</code> 到 <code>2^63-1</code>, 无符号范围 <code>0 ~ 约10的19次方</code></td></tr><tr><td><code>decimal(n, m)</code></td><td>浮点数</td><td>取决于精度和规模</td><td><code>m</code> 表示小数位数，小数位数超出m则四舍五入，不足m则补0<code>m + 整数位数 + 1(小数点)</code> 的总和必须不超出 <code>n</code>，超出报错</td></tr><tr><td><code>char(n)</code></td><td>定长字符串</td><td>一个U8中文占3个字节</td><td>固定长度为 <code>n</code>，实际内容不足时使用空格补充至 <code>n</code></td></tr><tr><td><code>varchar(n)</code></td><td>变长字符串</td><td>一个U8中文占3个字节</td><td>最大长度为 <code>n</code>，相比 <code>char</code>，空间利用率提高但查询效率降低长度尽量保持在5000字节以内。</td></tr><tr><td><code>date</code></td><td>日期</td><td>3字节</td><td>范围 <code>1000-01-01 ~ 9999-12-31</code></td></tr><tr><td><code>datetime</code></td><td>日期 + 时间</td><td>8字节</td><td>范围 <code>1000-01-01 00:00:00 ~ 9999-12-31 23:59:59</code></td></tr></tbody></table><blockquote><p>武技: 在 <code>test</code> 数据库中创建 <code>user</code> 表</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 查看当前数据库中的表: 此命令无法看到临时表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>show</span> tables;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 删除表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>drop</span> <span style=color:#66d9ef>table</span> <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>exists</span> test.<span style=color:#66d9ef>user</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 创建表 `user`
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 字段可用 `unsigned` 标记为无符号，默认有符号，在不需要存储负数时使用无符号可使容量翻倍
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 字段可用 `auto_increment` 标记为该列自增，只能用于数字列
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 字段可用 `primary key` 标记为主键，每个Innodb表都建议设计一个主键以提升查询效率
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 表可用 `engine innodb charset utf8mb4` 指定引擎和字符集，默认追随数据库实例的配置
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 表和字段均建议使用 `comment &#39;&#39;` 指定注释
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>exists</span> test.<span style=color:#66d9ef>user</span>
</span></span><span style=display:flex><span>(
</span></span><span style=display:flex><span>    user_id     int unsigned  auto_increment      <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;用户主键&#39;</span>,
</span></span><span style=display:flex><span>    username    varchar(<span style=color:#ae81ff>64</span>)   <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span> <span style=color:#66d9ef>default</span> <span style=color:#e6db74>&#39;&#39;</span> <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;登录账号&#39;</span>,
</span></span><span style=display:flex><span>    password    varchar(<span style=color:#ae81ff>64</span>)   <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span> <span style=color:#66d9ef>default</span> <span style=color:#e6db74>&#39;&#39;</span> <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;登录密码&#39;</span>,
</span></span><span style=display:flex><span>    realname    char(<span style=color:#ae81ff>4</span>)       <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span> <span style=color:#66d9ef>default</span> <span style=color:#e6db74>&#39;&#39;</span> <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;用户真实姓名&#39;</span>,
</span></span><span style=display:flex><span>    age         tinyint       <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span> <span style=color:#66d9ef>default</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;用户年龄&#39;</span>,
</span></span><span style=display:flex><span>    gender      tinyint       <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span> <span style=color:#66d9ef>default</span> <span style=color:#ae81ff>3</span> <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;用户性别，0男1女2保密&#39;</span>,
</span></span><span style=display:flex><span>    weight      decimal(<span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>2</span>) <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span> <span style=color:#66d9ef>default</span> <span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span> <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;用户体重，单位斤&#39;</span>,
</span></span><span style=display:flex><span>    create_time datetime      <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span> <span style=color:#66d9ef>default</span> now() <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;创建日期&#39;</span>,
</span></span><span style=display:flex><span>    modify_time datetime      <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span> <span style=color:#66d9ef>default</span> now() <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;修改日期&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>primary</span> <span style=color:#66d9ef>key</span> (user_id)
</span></span><span style=display:flex><span>) <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;用户表&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查看表 `user` 的建表语句
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>show</span> <span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> test.<span style=color:#66d9ef>user</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查看表 `user` 的表结构
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>desc</span> test.<span style=color:#66d9ef>user</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查看表 `user` 的详细表结构
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#66d9ef>table_name</span> <span style=color:#960050;background-color:#1e0010>表名</span>, <span style=color:#66d9ef>column_name</span> <span style=color:#960050;background-color:#1e0010>字段名称</span>, column_type <span style=color:#960050;background-color:#1e0010>字段类型</span>, character_maximum_length <span style=color:#960050;background-color:#1e0010>字段长度</span>,
</span></span><span style=display:flex><span>       is_nullable <span style=color:#960050;background-color:#1e0010>是否必填</span>, column_default <span style=color:#960050;background-color:#1e0010>默认值</span>, column_comment <span style=color:#960050;background-color:#1e0010>备注</span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> information_schema.columns
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> table_schema <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;user&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 增加一列: 为表 `user` 增加一列 `test`
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>alter</span> <span style=color:#66d9ef>table</span> test.<span style=color:#66d9ef>user</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>add</span> test varchar(<span style=color:#ae81ff>512</span>) <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span> <span style=color:#66d9ef>default</span> <span style=color:#e6db74>&#39;&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 修改列类型: 修改 `user` 表中 `test` 列的类型为 `varchar(1024)`
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>alter</span> <span style=color:#66d9ef>table</span> test.<span style=color:#66d9ef>user</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>modify</span> test varchar(<span style=color:#ae81ff>1024</span>) <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span> <span style=color:#66d9ef>default</span> <span style=color:#e6db74>&#39;&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 修改列名称: 修改 `user` 表中 `test` 列的名称为 `test02`
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>alter</span> <span style=color:#66d9ef>table</span> test.<span style=color:#66d9ef>user</span>
</span></span><span style=display:flex><span>    change test test02 varchar(<span style=color:#ae81ff>1024</span>) <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span> <span style=color:#66d9ef>default</span> <span style=color:#e6db74>&#39;&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 删除列: 删除 `user` 表的 `test02` 列
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>alter</span> <span style=color:#66d9ef>table</span> test.<span style=color:#66d9ef>user</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>drop</span> <span style=color:#66d9ef>column</span> test02;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 快速复制 `user` 表为 `user_backups` 表: 包括表结构和表数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> test.user_backups (<span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>                                <span style=color:#66d9ef>from</span> test.<span style=color:#66d9ef>user</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 重命名表: 将表 `user_backups` 重命名为 `user_bak`
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>rename</span> <span style=color:#66d9ef>table</span> test.user_backups <span style=color:#66d9ef>to</span> user_bak;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 删除表: 删除表 `user_bak`
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>drop</span> <span style=color:#66d9ef>table</span> <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>exists</span> test.user_bak;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 创建临时表 `tmp_test_20240225`: 使用 `temporary` 关键字
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 临时表用于保存临时数据，仅当前连接可用，关闭连接时自动销毁并释放资源
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 临时表的表名建议以 `tmp_` 为前缀并以日期为后缀
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 临时表在Idea的Database面板中不可见，但支持正常的CRUD和drop操作，不支持重命名等操作
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>drop</span> <span style=color:#66d9ef>table</span> <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>exists</span> tmp_test_20240225;
</span></span><span style=display:flex><span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>temporary</span> <span style=color:#66d9ef>table</span> <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>exists</span> tmp_test_20240225
</span></span><span style=display:flex><span>(
</span></span><span style=display:flex><span>    test_id int unsigned auto_increment <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;临时表主键&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>primary</span> <span style=color:#66d9ef>key</span> (test_id)
</span></span><span style=display:flex><span>) <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;用户临时表&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查看临时表结构
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>desc</span> tmp_test_20240225;
</span></span></code></pre></div><h2 id=ep04-mysql约束操作>EP04. MySQL约束操作</h2><blockquote><p>心法: 约束</p></blockquote><ul><li>约束就是对column添加一些强制校验规则以保证数据的正确性，添加约束前尽量保持表中无数据或者无错误数据。</li></ul><blockquote><p>心法: 非空约束 <code>not null</code></p></blockquote><ul><li>非空约束规定在字段插入null值时报错。</li><li>非空列可以提高查询效率，建议配合 <code>default</code> 一起使用，但不要对外键字段设置非空约束。</li></ul><table><thead><tr><th>操作</th><th>代码模板</th></tr></thead><tbody><tr><td>造表时</td><td>在某个字段末尾添加 <code>not null default 默认值</code></td></tr><tr><td>造表后</td><td><code>alter table 表名 modify 字段 类型 not null default 默认值</code></td></tr><tr><td>删除它</td><td><code>alter table 表名 modify 字段 类型 null</code></td></tr></tbody></table><blockquote><p>武技: 测试非空约束的操作</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 创建非空约束测试表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> null_test
</span></span><span style=display:flex><span>(
</span></span><span style=display:flex><span>    id   int,
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- 造表时，直接添加非空约束
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    name varchar(<span style=color:#ae81ff>50</span>) <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span> <span style=color:#66d9ef>default</span> <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>) <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;非空约束测试表&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 造表后，为指定字段添加非空约束
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>alter</span> <span style=color:#66d9ef>table</span> test.null_test
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>modify</span> id int <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span> <span style=color:#66d9ef>default</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 删除指定字段上的非空约束
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>alter</span> <span style=color:#66d9ef>table</span> test.null_test
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>modify</span> id int <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查看 null_test 表的非空约束
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>desc</span> test.null_test;
</span></span></code></pre></div><blockquote><p>心法: 唯一约束 <code>unique key</code></p></blockquote><ul><li>唯一约束规定在字段插入重复值时报错:</li></ul><table><thead><tr><th>操作</th><th>代码模板</th></tr></thead><tbody><tr><td>造表时</td><td>在某个字段末尾添加 <code>unique</code></td></tr><tr><td>造表时</td><td>在字段列表整体末尾添加 <code>unique (字段)</code></td></tr><tr><td>造表后</td><td><code>alter table 表名 add constraint 唯一约束名 unique (字段)</code><code>constraint 唯一约束名</code> 缺省时表示使用字段名作为唯一约束名</td></tr><tr><td>删除它</td><td><code>alter table 表名 drop constraint 唯一约束名</code></td></tr></tbody></table><blockquote><p>武技: 测试唯一约束的操作</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 创建唯一约束测试表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> unique_test
</span></span><span style=display:flex><span>(
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- 造表时，直接添加唯一约束（方式一）
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    id     int <span style=color:#66d9ef>unique</span>,
</span></span><span style=display:flex><span>    name   varchar(<span style=color:#ae81ff>50</span>),
</span></span><span style=display:flex><span>    gender tinyint,
</span></span><span style=display:flex><span>    age    int,
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- 造表时，直接添加唯一约束（方式二）
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>unique</span> (name)
</span></span><span style=display:flex><span>) <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;唯一约束测试表&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 造表后，为指定字段添加唯一约束，指定约束名为 uk_gender
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>alter</span> <span style=color:#66d9ef>table</span> test.unique_test
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>add</span> <span style=color:#66d9ef>constraint</span> uk_gender <span style=color:#66d9ef>unique</span> (gender);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 造表后，为指定字段添加唯一约束，默认唯一约束名为字段名
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>alter</span> <span style=color:#66d9ef>table</span> test.unique_test
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>add</span> <span style=color:#66d9ef>unique</span> (age);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 删除指定字段上的唯一约束，通过约束名称删除
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>alter</span> <span style=color:#66d9ef>table</span> test.unique_test
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>drop</span> <span style=color:#66d9ef>constraint</span> uk_gender;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查看 unique_test 表的的唯一约束
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#66d9ef>table_name</span>, <span style=color:#66d9ef>constraint_name</span>, constraint_type, table_schema
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> information_schema.table_constraints
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> <span style=color:#66d9ef>table_name</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;unique_test&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>and</span> TABLE_SCHEMA <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;test&#39;</span>;
</span></span></code></pre></div><blockquote><p>心法: 主键约束 <code>primary key</code></p></blockquote><ul><li>主键约束规定该列唯一且非空，一张表只能存在一个主键约束列。</li><li>表中必须为唯一的自增列指定为主键。</li></ul><table><thead><tr><th>操作</th><th>代码模板</th></tr></thead><tbody><tr><td>造表时</td><td>在某个字段末尾添加 <code>primary key</code></td></tr><tr><td>造表时</td><td>在字段列表整体末尾添加 <code>primary key (字段)</code></td></tr><tr><td>造表后</td><td><code>alter table 表名 add primary key (字段)</code>: 约束名默认为 <code>PRIMARY</code></td></tr><tr><td>删除它</td><td><code>alter table 表名 drop primary key</code></td></tr></tbody></table><blockquote><p>武技: 测试主键约束的操作</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 创建主键约束测试表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> primary_test
</span></span><span style=display:flex><span>(
</span></span><span style=display:flex><span>    id int,
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- 造表时，直接指定主键约束
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>primary</span> <span style=color:#66d9ef>key</span> (id)
</span></span><span style=display:flex><span>) <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;主键约束测试表&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 删除指定字段的主键约束
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>alter</span> <span style=color:#66d9ef>table</span> test.primary_test
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>drop</span> <span style=color:#66d9ef>primary</span> <span style=color:#66d9ef>key</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查看 primary_test 表的的主键约束
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#66d9ef>table_name</span>, <span style=color:#66d9ef>constraint_name</span>, constraint_type, table_schema
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> information_schema.table_constraints
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> <span style=color:#66d9ef>table_name</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;primary_test&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>and</span> TABLE_SCHEMA <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;test&#39;</span>;
</span></span></code></pre></div><blockquote><p>心法: 外键约束 <code>foreign key</code></p></blockquote><ul><li>外键约束就是用主表的某字段连接从表的主键或唯一约束字段，二者必须同类型，同长度，同符号。</li><li>建议尽量避免使用外键约束，虽提高了安全性，但影响效率，但一定要在关联字段上建立索引。</li></ul><table><thead><tr><th>操作</th><th>代码模板</th></tr></thead><tbody><tr><td>造表时</td><td>在字段列表整体末尾添加 <code>foreign key (外键字段) references 从表(从表主键)</code></td></tr><tr><td>造表后</td><td><code>alter table 表名 add constraint 外键约束名 foreign key (字段) references 从表(主键)</code><code>constraint 外键约束名</code> 缺省时表示使用随机名作为外键约束名</td></tr><tr><td>删除它</td><td><code>alter table 表名 drop foreign key 外键约束名</code></td></tr></tbody></table><blockquote><p>武技: 测试外键约束的操作</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 创建班级表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> test.<span style=color:#f92672>`</span><span style=color:#66d9ef>class</span><span style=color:#f92672>`</span>
</span></span><span style=display:flex><span>(
</span></span><span style=display:flex><span>    class_id   int unsigned auto_increment,
</span></span><span style=display:flex><span>    class_name varchar(<span style=color:#ae81ff>20</span>),
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>primary</span> <span style=color:#66d9ef>key</span> (class_id)
</span></span><span style=display:flex><span>) <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;班级表&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 添加两条部门信息
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> test.<span style=color:#f92672>`</span><span style=color:#66d9ef>class</span><span style=color:#f92672>`</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>values</span> (<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#39;J2303&#39;</span>),
</span></span><span style=display:flex><span>       (<span style=color:#ae81ff>2</span>, <span style=color:#e6db74>&#39;J2304&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 创建学生表
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> test.student
</span></span><span style=display:flex><span>(
</span></span><span style=display:flex><span>    student_id   int unsigned auto_increment,
</span></span><span style=display:flex><span>    student_name varchar(<span style=color:#ae81ff>20</span>),
</span></span><span style=display:flex><span>    class_id     int unsigned,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>primary</span> <span style=color:#66d9ef>key</span> (student_id)
</span></span><span style=display:flex><span>) <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;学生表&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 主表的某字段，连接从表的主键（唯一约束字段）
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>alter</span> <span style=color:#66d9ef>table</span> test.student
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>add</span> <span style=color:#66d9ef>constraint</span> fk_class_id <span style=color:#66d9ef>foreign</span> <span style=color:#66d9ef>key</span> (class_id) <span style=color:#66d9ef>references</span> test.<span style=color:#f92672>`</span><span style=color:#66d9ef>class</span><span style=color:#f92672>`</span> (class_id);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查看 student 表的的外键约束
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#66d9ef>table_name</span>, <span style=color:#66d9ef>constraint_name</span>, constraint_type, table_schema
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> information_schema.table_constraints
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> <span style=color:#66d9ef>table_name</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;student&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>and</span> TABLE_SCHEMA <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;test&#39;</span>;
</span></span></code></pre></div><h2 id=ep05-mysql索引操作>EP05. MySQL索引操作</h2><blockquote><p>心法: MySQL表中的数据是如何存储在硬盘的？</p></blockquote><ul><li>MySQL每张表的数据都是存放在硬盘的一个 <code>表名.ibd</code> 文件中，即 <code>innodb data</code> 文件，也叫表空间。</li><li>idb文件实际上会被划分成很多小的 <code>数据页</code>，每个 <code>数据页</code> 的大小为16KB，以双链表形式关联:<ul><li>每次DQL操作，都至少读取一整页的数据到内存。</li><li>每次DML操作，都至少刷新一整页的数据到磁盘。</li></ul></li></ul><p><img src=/%E7%AC%AC2%E9%98%B6%E6%AE%B5-WEB/JB2-3-MySQL/image/da869c7c9d0e94844cbfabad45c901f1.png alt></p><blockquote><p>心法: 索引</p></blockquote><ul><li>索引的优点:<ul><li>底层使用B+Tree结构，大部分情况下，比线性结构查询快，即DQL操作变快。</li></ul></li><li>索引的缺点:<ul><li>索引随着表中记录而变化，意味着每次的DML操作将额外付出5次左右的磁盘I/O，DML操作变慢。</li><li>占用物理空间: 建立索引时需要额外创建一张索引结构表，耗时长，占空间，需要定期维护。</li></ul></li><li>索引使用建议:<ul><li>尽量只在经常被查询的字段上建立索引。</li><li>单张表索引不建议超过5个。</li></ul></li></ul><p><img src=/%E7%AC%AC2%E9%98%B6%E6%AE%B5-WEB/JB2-3-MySQL/image/928100dddd8e018248ee65eeff571906.png alt></p><blockquote><p>武技: 测试索引操作</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 查看索引: 为字段添加唯一/主键/外键约束时，会自动为其创建索引
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>show</span> <span style=color:#66d9ef>index</span> <span style=color:#66d9ef>from</span> test.<span style=color:#66d9ef>user</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 建立索引: 索引名必须指定且不能重复
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>index</span> idx_user_realname <span style=color:#66d9ef>on</span> test.<span style=color:#66d9ef>user</span> (realname);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 删除索引
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>drop</span> <span style=color:#66d9ef>index</span> idx_user_realname <span style=color:#66d9ef>on</span> test.<span style=color:#66d9ef>user</span>;
</span></span></code></pre></div><h3 id=联合索引>联合索引</h3><ul><li>联合索引又叫复合索引。两个或更多个列上的索引被称作复合索引。</li><li>对于复合索引：Mysql从左到右的使用索引中的字段，一个查询可以只使用索引中的一部份，但只能是最左侧部分。例如索引是 <code>key index (a,b,c)</code>。 可以支持 <code>a | a,b | a,b,c</code> 3种组合进行查找，但不支持 <code>b,c</code> 进行查找</li><li>当最左侧字段是常量引用时，索引就十分有效。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 假如
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> emp ( 
</span></span><span style=display:flex><span>	a int, b int, <span style=color:#66d9ef>c</span> int,
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>KEY</span> i(a,b,<span style=color:#66d9ef>c</span>)
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- abc三个索引都在where条件里面用到了，而且都发挥了作用
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> a,b,<span style=color:#66d9ef>c</span> <span style=color:#66d9ef>from</span> emp <span style=color:#66d9ef>where</span> a<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> <span style=color:#66d9ef>and</span> b<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> <span style=color:#66d9ef>and</span> <span style=color:#66d9ef>c</span><span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>;   <span style=color:#75715e>----  abc顺序
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- where里面的条件顺序在查询之前会被mysql自动优化，效果跟上一句一样
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> a,b,<span style=color:#66d9ef>c</span> <span style=color:#66d9ef>from</span> emp <span style=color:#66d9ef>where</span> <span style=color:#66d9ef>c</span><span style=color:#f92672>=</span><span style=color:#ae81ff>4</span> <span style=color:#66d9ef>and</span> b<span style=color:#f92672>=</span><span style=color:#ae81ff>6</span> <span style=color:#66d9ef>and</span> a<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- a用到索引，b没有用，所以c是没有用到索引效果的
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> a,b,<span style=color:#66d9ef>c</span> <span style=color:#66d9ef>from</span> emp <span style=color:#66d9ef>where</span> a<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> <span style=color:#66d9ef>and</span> <span style=color:#66d9ef>c</span><span style=color:#f92672>=</span><span style=color:#ae81ff>7</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- a用到了，b也用到了，c没有用到，这个地方b是范围值，也算断点，只不过自身用到了索引
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> a,b,<span style=color:#66d9ef>c</span> <span style=color:#66d9ef>from</span> emp <span style=color:#66d9ef>where</span> a<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> <span style=color:#66d9ef>and</span> b<span style=color:#f92672>&gt;</span><span style=color:#ae81ff>7</span> <span style=color:#66d9ef>and</span> <span style=color:#66d9ef>c</span><span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 因为a索引没有使用，所以这里 bc都没有用上索引效果
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> a,b,<span style=color:#66d9ef>c</span> <span style=color:#66d9ef>from</span> emp <span style=color:#66d9ef>where</span> b<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> <span style=color:#66d9ef>and</span> <span style=color:#66d9ef>c</span><span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- a用到了  b没有使用，c没有使用
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> a,b,<span style=color:#66d9ef>c</span> <span style=color:#66d9ef>from</span> emp <span style=color:#66d9ef>where</span> a<span style=color:#f92672>&gt;</span><span style=color:#ae81ff>4</span> <span style=color:#66d9ef>and</span> b<span style=color:#f92672>=</span><span style=color:#ae81ff>7</span> <span style=color:#66d9ef>and</span> <span style=color:#66d9ef>c</span><span style=color:#f92672>=</span><span style=color:#ae81ff>9</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- a用到了索引，b在结果排序中也用到了索引的效果，a下面任意一段的b是排好序的
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> a,b,<span style=color:#66d9ef>c</span> <span style=color:#66d9ef>from</span> emp <span style=color:#66d9ef>where</span> a<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> <span style=color:#66d9ef>order</span> <span style=color:#66d9ef>by</span> b;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- a用到了索引，但是这个地方c没有发挥排序效果，因为中间断点了，使用 explain 可以看到 filesort
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> a,b,<span style=color:#66d9ef>c</span> <span style=color:#66d9ef>from</span> emp <span style=color:#66d9ef>where</span> a<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> <span style=color:#66d9ef>order</span> <span style=color:#66d9ef>by</span> <span style=color:#66d9ef>c</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- b没有用到索引，排序中a也没有发挥索引效果
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> a,b,<span style=color:#66d9ef>c</span> <span style=color:#66d9ef>from</span> emp <span style=color:#66d9ef>where</span> b<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> <span style=color:#66d9ef>order</span> <span style=color:#66d9ef>by</span> a;
</span></span></code></pre></div><h2 id=ep06-mysql视图操作>EP06. MySQL视图操作</h2><blockquote><p>心法: 视图</p></blockquote><ul><li>视图 <code>view</code> 用于保存一条查询SQL语句的结果集，除了本身的SQL之外不包含任何数据。</li></ul><blockquote><p>武技: 测试DDL视图常用操作</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 查看视图
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>show</span> tables;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 删除视图
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>drop</span> <span style=color:#66d9ef>view</span> <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>exists</span> v_user;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 创建/修改视图 v_user: 封装 user 表的全查语句
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>or</span> <span style=color:#66d9ef>replace</span> <span style=color:#66d9ef>view</span> v_user <span style=color:#66d9ef>as</span>
</span></span><span style=display:flex><span>(
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> user_id,
</span></span><span style=display:flex><span>       username,
</span></span><span style=display:flex><span>       password,
</span></span><span style=display:flex><span>       realname,
</span></span><span style=display:flex><span>       age,
</span></span><span style=display:flex><span>       gender,
</span></span><span style=display:flex><span>       weight,
</span></span><span style=display:flex><span>       create_time,
</span></span><span style=display:flex><span>       modify_time
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.<span style=color:#66d9ef>user</span>
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查看视图
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> v_user;
</span></span></code></pre></div><h1 id=ch03-数据操作语言>CH03. 数据操作语言</h1><blockquote><p>心法: 数据操作语言 <code>Data Manipulation Language</code>，简称DML</p></blockquote><ul><li>DML用于对DB表中的数据进行 <code>update/insert/delete</code> 等操作。</li></ul><h2 id=ep01-dml之增删改操作>EP01. DML之增删改操作</h2><blockquote><p>武技: 测试DML常用操作</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 单条增加表 `user` 记录
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 值列表必须和字段列表的个数，顺序，类型一一对应
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> test.<span style=color:#66d9ef>user</span> (user_id, username, password, realname, age, gender,
</span></span><span style=display:flex><span>                       weight, create_time, modify_time)
</span></span><span style=display:flex><span><span style=color:#66d9ef>values</span> (<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#39;zhaosi&#39;</span>, <span style=color:#e6db74>&#39;zhaosi&#39;</span>, <span style=color:#e6db74>&#39;赵国强&#39;</span>, <span style=color:#ae81ff>58</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>150</span>.<span style=color:#ae81ff>20</span>, <span style=color:#e6db74>&#39;2023-02-01&#39;</span>, <span style=color:#e6db74>&#39;2023-02-02&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>commit</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 批量增加表 `user` 记录
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> test.<span style=color:#66d9ef>user</span> (user_id, username, password, realname, age, gender,
</span></span><span style=display:flex><span>                       weight, create_time, modify_time)
</span></span><span style=display:flex><span><span style=color:#66d9ef>values</span> (<span style=color:#ae81ff>2</span>, <span style=color:#e6db74>&#39;liuneng&#39;</span>, <span style=color:#e6db74>&#39;liuneng&#39;</span>, <span style=color:#e6db74>&#39;刘能&#39;</span>, <span style=color:#ae81ff>59</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>152</span>.<span style=color:#ae81ff>20</span>, <span style=color:#e6db74>&#39;2023-02-02&#39;</span>, <span style=color:#e6db74>&#39;2023-02-03&#39;</span>),
</span></span><span style=display:flex><span>       (<span style=color:#ae81ff>3</span>, <span style=color:#e6db74>&#39;guangkun&#39;</span>, <span style=color:#e6db74>&#39;guangkun&#39;</span>, <span style=color:#e6db74>&#39;谢广坤&#39;</span>, <span style=color:#ae81ff>60</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>158</span>.<span style=color:#ae81ff>20</span>, <span style=color:#e6db74>&#39;2023-04-01&#39;</span>, <span style=color:#e6db74>&#39;2023-04-02&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>commit</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 全字段添加时的简写形式
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> test.<span style=color:#66d9ef>user</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>values</span> (<span style=color:#ae81ff>4</span>, <span style=color:#e6db74>&#39;wangyun&#39;</span>, <span style=color:#e6db74>&#39;wangyun&#39;</span>, <span style=color:#e6db74>&#39;王云&#39;</span>, <span style=color:#ae81ff>18</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>100</span>.<span style=color:#ae81ff>20</span>, <span style=color:#e6db74>&#39;2021-02-01&#39;</span>, <span style=color:#e6db74>&#39;2021-02-02&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>commit</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 修改 `user` 记录: 必须设置修改内容和修改条件，否则SQL语句报错
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>update</span> test.<span style=color:#66d9ef>user</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>set</span> realname<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;赵四&#39;</span>,
</span></span><span style=display:flex><span>    age<span style=color:#f92672>=</span><span style=color:#ae81ff>25</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> user_id <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 删除 `user` 记录: 必须设置删除条件
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>delete</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.<span style=color:#66d9ef>user</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> user_id <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;
</span></span></code></pre></div><h2 id=ep02-dml事务机制特点>EP02. DML事务机制特点</h2><blockquote><p>心法: DML事务机制概念</p></blockquote><ul><li>事务是一组不可分割的业务关系，在SQL中指的是一组不可拆分的DML语句，要么都成功，要么都失败。</li><li>事务主要用于处理操作量大，复杂度高的数据，用来维护数据库的完整性。</li><li>事务具有ACID特性:</li></ul><table><thead><tr><th>事务特性</th><th>中文</th><th>描述</th></tr></thead><tbody><tr><td><code>Atomicity</code></td><td>原子性</td><td>一组事务，要么都成功提交 <code>commit</code>，要么都失败回滚 <code>rollback</code></td></tr><tr><td><code>Consistency</code></td><td>稳定性</td><td>一个事务执行前后，数据库都必须处于一致性状态，一般由日志机制实现</td></tr><tr><td><code>Isolation</code></td><td>隔离性</td><td>一个事务在执行时，不会受到其它事务的影响，多个并发事务之间相互隔离</td></tr><tr><td><code>Durability</code></td><td>持久性</td><td>一个事务一旦提交，它对数据库所做的修改就是永久性的</td></tr></tbody></table><blockquote><p>武技: 测试DML事务机制</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 查看当前事务自动提交状态，1表示开启
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>@@</span>autocommit;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 永久关闭自动提交: 重置为1则可重新打开自动提交
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>set</span> autocommit <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 模拟事务: 添加一条 `user` 记录
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 开启事务: 此时会临时关闭自动提交
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>start</span> <span style=color:#66d9ef>transaction</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- SQL-1: 添加一条 `user` 记录，SQL进入缓存，不会真正执行
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> test.<span style=color:#66d9ef>user</span> (username)
</span></span><span style=display:flex><span><span style=color:#66d9ef>values</span> (<span style=color:#e6db74>&#39;事务01&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- SQL-2: 添加一条 `user` 记录，SQL进入缓存，不会真正执行
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> test.<span style=color:#66d9ef>user</span> (username)
</span></span><span style=display:flex><span><span style=color:#66d9ef>values</span> (<span style=color:#e6db74>&#39;事务02&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 当前事务中的SQL语句全都没有问题，提交缓存中的全部SQL
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>commit</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 永久恢复自动提交
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>set</span> autocommit <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span></code></pre></div><h2 id=ep03-dml事务隔离级别>EP03. DML事务隔离级别</h2><blockquote><p>心法: 事务隔离级别</p></blockquote><ul><li>事务隔离级别就是一个事务对数据库的修改与并行的另一个事务的隔离程度。</li><li>可以理解为当我操作数据库的时候，允许你做什么。</li><li>MySQL支持全部4种事务隔离级别，默认是可重复读隔离级别。</li></ul><table><thead><tr><th>隔离级别</th><th>描述</th><th>可能出现的问题</th></tr></thead><tbody><tr><td><code>read uncommitted</code>读未提交级别</td><td>允许其它事务读取我未提交的某行数据</td><td>脏读: 1. T1读取到T2已更新但未提交的某行数据2. T2回滚，此时T1读取到的数据就是无效的脏数据</td></tr><tr><td><code>read committed</code>读已提交级别</td><td>只允许其它事务读取我已提交的某行数据</td><td>重复读: 1. T1读取某行数据2. T2立刻删除了该数据3. T1再次读取该数据时发现丢失</td></tr><tr><td><code>repeatable read</code>可重复读级别</td><td>不允许其他事务对我正在读取的某行数据进行操作</td><td>幻读: 1. T1读取表数据2. T2插入了一些新的数据行3. T1再次读取该表，发现多出几行数据</td></tr><tr><td><code>serializable</code>串行读取级别</td><td>其他事务必须在我操作完毕后才能执行操作</td><td>可避免一切错误，但效率会极差</td></tr></tbody></table><blockquote><p>武技: 测试MySQL数据库的隔离级别</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 查询当前会话的隔离级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>@@</span>transaction_isolation;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 设置当前会话的隔离级别
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>set</span> <span style=color:#66d9ef>session</span> <span style=color:#66d9ef>transaction</span> <span style=color:#66d9ef>isolation</span> <span style=color:#66d9ef>level</span> <span style=color:#66d9ef>read</span> <span style=color:#66d9ef>uncommitted</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>set</span> <span style=color:#66d9ef>session</span> <span style=color:#66d9ef>transaction</span> <span style=color:#66d9ef>isolation</span> <span style=color:#66d9ef>level</span> <span style=color:#66d9ef>read</span> <span style=color:#66d9ef>committed</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>set</span> <span style=color:#66d9ef>session</span> <span style=color:#66d9ef>transaction</span> <span style=color:#66d9ef>isolation</span> <span style=color:#66d9ef>level</span> <span style=color:#66d9ef>repeatable</span> <span style=color:#66d9ef>read</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>set</span> <span style=color:#66d9ef>session</span> <span style=color:#66d9ef>transaction</span> <span style=color:#66d9ef>isolation</span> <span style=color:#66d9ef>level</span> <span style=color:#66d9ef>serializable</span>;
</span></span></code></pre></div><h2 id=ep04-dml数据导入导出>EP04. DML数据导入导出</h2><blockquote><p>武技: 利用IDEA导入/导出表</p></blockquote><ul><li>IDEA导出表: 在1或N张表上右键并选择 <code>Export data to file</code>:<ul><li>勾选 <code>Add table definition（DDL）</code>，否则只导出了数据，没有表结构。</li><li>选择 <code>SQL Insert</code>: 选择路径，导出SQL文件。</li></ul></li><li>IDEA导入表:<ul><li>在指定的 <code>数据库</code> 目录上右键，选择 <code>Run SQL Script</code>。</li><li>找到你要导入的SQL文件，点击OK，即可完成导入。</li></ul></li></ul><blockquote><p>武技: 利用CMD命令行导入/导出表</p></blockquote><ul><li>CMD导出表:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># CMD导出表: 导出v2-lesson-docs数据库中的module/method/param三张表</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 参数 `-p` 后面不能加密码，命令末尾不要添加分号</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 在库名前添加 `--default-character-set=utf8mb4` 可以指定编码</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 在库名前添加 `-d`，代表删除数据，只导出表结构</span>
</span></span><span style=display:flex><span>mysqldump -hlocalhost -uroot -p --default-character-set<span style=color:#f92672>=</span>utf8mb4 v2_lesson_docs module method param &gt; D:<span style=color:#ae81ff>\r</span>es.sql
</span></span></code></pre></div><ul><li>CMD导入表:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># 登录MySQL数据库</span>
</span></span><span style=display:flex><span>mysql -uroot -p
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 切换当前数据库</span>
</span></span><span style=display:flex><span>user v2_lesson_docs;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 导入sql文件</span>
</span></span><span style=display:flex><span>source D:\res.sql
</span></span></code></pre></div><h1 id=ch04-数据查询语言>CH04. 数据查询语言</h1><blockquote><p>心法: 数据查询语言，简称DQL</p></blockquote><ul><li>DQL用于对DB表中的数据进行 <code>select</code> 查询操作。</li></ul><h2 id=ep01-dql基本查询>EP01. DQL基本查询</h2><blockquote><p>心法: DQL <code>Data Query Language</code></p></blockquote><ul><li>基本查询格式: <code>select 字段列表 from 查询范围</code>。</li><li>全查不建议使用 <code>*</code>，更不建议将 <code>*</code> 和其它字段一起查询，影响查询效率。</li><li>代码语法不区分大小写，建议写成全大写有助于提高效率，且MySQL表中的值也不区分大小写。</li><li>字段可以起别名，用 <code>as</code> 标注，也可省略不写，别名不建议使用中文。</li><li>表名可以起别名，但不建议使用 <code>as</code> 标注，对表起别名可以提高查询效率。</li><li>字符类型数据用单/双引号标注，建议使用单引号。</li><li>数字类型数据可以直接进行计算。</li><li>null值和任何值进行计算结果都为null，判断时使用 <code>is null/is not null</code>。</li></ul><blockquote><p>武技: 测试DQL基本查询</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 全查不建议使用 `*`，更不建议将 `*` 和其它字段一起查询，影响查询效率
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> empno,
</span></span><span style=display:flex><span>       ename,
</span></span><span style=display:flex><span>       job,
</span></span><span style=display:flex><span>       mgr,
</span></span><span style=display:flex><span>       hiredate,
</span></span><span style=display:flex><span>       sal,
</span></span><span style=display:flex><span>       comm,
</span></span><span style=display:flex><span>       deptno
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 字段可以起别名，用 `as` 标注，也可省略不写，别名不建议使用中文
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 表名可以起别名，但不建议使用 `as` 标注，对表起别名可以提高查询效率
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.empno <span style=color:#66d9ef>as</span> emp_id, e.ename emp_name, e.job
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 数字类型数据可以直接进行计算，null值和任何值进行计算结果都为null
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- ifnull()函数可以处理null值: 将所有null变为0
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.ename, e.sal, e.comm, e.sal <span style=color:#f92672>+</span> ifnull(e.comm, <span style=color:#ae81ff>0</span>) total
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e;
</span></span></code></pre></div><h2 id=ep02-dql查询排序>EP02. DQL查询排序</h2><blockquote><p>心法: DQL查询排序</p></blockquote><ul><li>查询排序格式: <code>order by 排序字段列表 asc/desc</code></li><li>查询排序用于对结果集按指定字段进行升序/降序排序。</li><li>查询排序不参与任何计算，也不会改变任何一个值。</li><li>排序在查询最后一步执行，因此在 <code>order by</code> 后，可以使用字段的别名。</li></ul><blockquote><p>武技: 测试DQL查询排序</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 查询全部员工，要求按工资升排，若工资相同，再按主键降排
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.empno, e.ename, e.sal salary
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span><span style=color:#66d9ef>order</span> <span style=color:#66d9ef>by</span> salary, e.empno <span style=color:#66d9ef>desc</span>;
</span></span></code></pre></div><h2 id=ep03-dql条件查询>EP03. DQL条件查询</h2><blockquote><p>心法: DQL条件查询</p></blockquote><ul><li>条件查询格式: <code>where 条件</code> 用于在查询的过程中，逐条进行条件判断。</li><li>即使多个条件，<code>where</code> 关键字也只能有一个。</li><li>条件允许使用 <code>and/or/not/&lt;>/!=</code> 等符号，且 <code>and</code> 优先级高于 <code>or</code>:<ul><li>支持在字段上直接进行计算，但不建议。</li></ul></li><li>为了提高效率，筛选过程慢，即筛选量大的条件，要尽量往后放。</li></ul><blockquote><p>武技: 测试DQL条件查询</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 查询20部门中，除了smith之外的所有员工
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.ename
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> e.deptno <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>and</span> e.ename <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;smith&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询所有拥有奖金的员工
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.ename, e.comm
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> e.comm <span style=color:#66d9ef>is</span> <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>;
</span></span></code></pre></div><h2 id=ep04-dql模糊查询>EP04. DQL模糊查询</h2><blockquote><p>心法: DQL模糊查询</p></blockquote><ul><li>模糊查询格式: <code>like</code> 用于在查询的过程中，进行模糊匹配:<ul><li>占位符 <code>%</code> 表示随意个数占位，占位符 <code>_</code> 表示只占一位。</li></ul></li><li>MySQL使用 <code>\</code> 作为转义字符，也可使用 <code>escape</code> 单独指定。</li><li>MySQL可以直接转义单引号，也可以使用两个单引号表示一个单引号。</li><li>前模糊，如 <code>%赵</code> 的写法会让索引失效，尽量避免。</li></ul><blockquote><p>武技: 测试DQL模糊查询</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 查询所有姓名以M开头，或姓名第2位是U，或者姓名包含E的用户
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.ename
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> e.ename <span style=color:#66d9ef>like</span> <span style=color:#e6db74>&#39;M%&#39;</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>or</span> e.ename <span style=color:#66d9ef>like</span> <span style=color:#e6db74>&#39;_U%&#39;</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>or</span> e.ename <span style=color:#66d9ef>like</span> <span style=color:#e6db74>&#39;%E%&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询账号中带单引号或者带百分号的用户
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.ename
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> e.ename <span style=color:#66d9ef>like</span> <span style=color:#e6db74>&#39;%\&#39;</span><span style=color:#f92672>%</span><span style=color:#e6db74>&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   or e.ename like &#39;</span><span style=color:#f92672>%</span><span style=color:#960050;background-color:#1e0010>\</span><span style=color:#f92672>%%</span><span style=color:#e6db74>&#39;;
</span></span></span></code></pre></div><h2 id=ep05-dql范围查询>EP05. DQL范围查询</h2><blockquote><p>心法: DQL范围查询</p></blockquote><table><thead><tr><th>相关语句</th><th>描述</th></tr></thead><tbody><tr><td><code>.. where id in(字段列表)</code></td><td>字段的值只要出现在这个字段列表中就返回 <code>true</code></td></tr><tr><td><code>.. where id not in(字段列表)</code></td><td>字段的值只要没出现在这个字段列表中就返回 <code>true</code></td></tr><tr><td><code>.. where id between x and y</code></td><td>字段的值只要在 <code>x</code> 与 <code>y</code> 之间返回 <code>true</code>，包括 <code>x</code> 也包括 <code>y</code></td></tr><tr><td><code>.. where id not between x and y</code></td><td>字段的值只要不在 <code>x</code> 与 <code>y</code> 之间返回 <code>true</code>，不包括 <code>x</code> 也不包括 <code>y</code></td></tr><tr><td><code>select distinct(需要去重的字段) from ..</code></td><td>为字段去重复</td></tr></tbody></table><blockquote><p>武技: 测试DQL范围查询</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 查询主键为7369，7499，7521的员工
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.empno, e.ename
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> e.empno <span style=color:#66d9ef>in</span> (<span style=color:#ae81ff>7369</span>, <span style=color:#ae81ff>7499</span>, <span style=color:#ae81ff>7521</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询主键在7650到7900之间的所有员工，包括两端值
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.empno, e.ename
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> e.empno <span style=color:#66d9ef>between</span> <span style=color:#ae81ff>7650</span> <span style=color:#66d9ef>and</span> <span style=color:#ae81ff>7900</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 列出员工表中的所有职位
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#66d9ef>distinct</span>(e.job)
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> e.job <span style=color:#66d9ef>is</span> <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>;
</span></span></code></pre></div><h2 id=ep06-dql条件函数>EP06. DQL条件函数</h2><blockquote><p>心法: DQL条件函数</p></blockquote><table><thead><tr><th>相关语句</th><th>描述</th></tr></thead><tbody><tr><td><code>select case when 条件 then 返回值 end from ..</code></td><td>相当于Java中的Switch结构</td></tr><tr><td><code>select ifnull(字段, a) from ..</code></td><td>若字段为 <code>null</code>，返回 <code>a</code>，否则返回原字段</td></tr><tr><td><code>select if(字段, a, b) from ..</code></td><td>若字段为 <code>null</code>，则返回 <code>b</code>，否则返回 <code>a</code>，可嵌套</td></tr><tr><td><code>select if(条件, a, b) from ..</code></td><td>若条件成立，返回 <code>a</code>，否则返回 <code>b</code>，可嵌套</td></tr></tbody></table><blockquote><p>武技: 测试DQL条件函数</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 查询员工的姓名，工资以及工资信息
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 月薪在0~1000的视为穷人，月薪在1001~3000的视为普通人，月薪超过3000的视为富人，其他情况未知
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- case when 条件 then 返回值 end
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.ename,
</span></span><span style=display:flex><span>       e.sal,
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>case</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>when</span> e.sal <span style=color:#66d9ef>between</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>and</span> <span style=color:#ae81ff>1000</span> <span style=color:#66d9ef>then</span> <span style=color:#e6db74>&#39;穷人&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>when</span> e.sal <span style=color:#66d9ef>between</span> <span style=color:#ae81ff>1001</span> <span style=color:#66d9ef>and</span> <span style=color:#ae81ff>3000</span> <span style=color:#66d9ef>then</span> <span style=color:#e6db74>&#39;普通人&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>when</span> e.sal <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>3000</span> <span style=color:#66d9ef>then</span> <span style=color:#e6db74>&#39;富人&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span> <span style=color:#e6db74>&#39;未知&#39;</span>
</span></span><span style=display:flex><span>           <span style=color:#66d9ef>end</span>) sal_level
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询员工的姓名，工资以及工资信息
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 月薪在0~1000的视为穷人，月薪在1001~3000的视为普通人，月薪超过3000的视为富人，其他情况未知
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 若字段为null，则替换成第三个参数，否则替换成第二个参数，可嵌套
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.ename,
</span></span><span style=display:flex><span>       e.sal,
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>if</span>(e.sal <span style=color:#66d9ef>between</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>and</span> <span style=color:#ae81ff>1000</span>, <span style=color:#e6db74>&#39;穷人&#39;</span>,
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span>(e.sal <span style=color:#66d9ef>between</span> <span style=color:#ae81ff>1001</span> <span style=color:#66d9ef>and</span> <span style=color:#ae81ff>3000</span>, <span style=color:#e6db74>&#39;普通人&#39;</span>,
</span></span><span style=display:flex><span>             <span style=color:#66d9ef>if</span>(e.sal <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>3000</span>, <span style=color:#e6db74>&#39;富人&#39;</span>, <span style=color:#e6db74>&#39;未知&#39;</span>))) sal_level
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e;
</span></span></code></pre></div><h2 id=ep07-dql父子查询>EP07. DQL父子查询</h2><blockquote><p>心法: 子查询</p></blockquote><ul><li>利用A查询提供一个临时的结果集供B查询使用，则可以称A为B的子查询。</li><li>子查询的结果集无法使用索引，建议优化为后面的join操作。</li></ul><blockquote><p>心法: 单行子查询</p></blockquote><ul><li>单行子查询: 子查询先独立执行且只执行一次，结果返回一行数据，供父查询使用。</li></ul><blockquote><p>武技: 测试单行子查询</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 查询比CLARK工资值高的所有员工
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.ename, e.sal
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> e.sal <span style=color:#f92672>&gt;</span> (<span style=color:#66d9ef>select</span> e1.sal <span style=color:#66d9ef>from</span> test.emp e1 <span style=color:#66d9ef>where</span> ename <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;CLARK&#39;</span>);
</span></span></code></pre></div><blockquote><p>心法: 多行子查询</p></blockquote><ul><li>多行子查询: 子查询先独立执行且只执行一次，结果返回多行数据，供父查询使用。</li></ul><table><thead><tr><th>多行子查询语法格式</th><th>描述</th></tr></thead><tbody><tr><td><code>..where id > any(子查询)</code></td><td>子查询结果部分符合父查询条件就输出，结果集中是or的关系，不等式专用</td></tr><tr><td><code>..where id = some(子查询)</code></td><td>子查询结果部分符合父查询条件就输出，结果集中是or的关系，等式专用</td></tr><tr><td><code>..where id > all(子查询)</code></td><td>子查询结果全部符合父查询条件才会输出，结果集中是and的关系</td></tr></tbody></table><blockquote><p>武技: 测试多行子查询</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 查询比CLARK或ADAMS工资值高的所有员工
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.ename, e.sal
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> e.sal <span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>any</span> (<span style=color:#66d9ef>select</span> e1.sal <span style=color:#66d9ef>from</span> test.emp e1 <span style=color:#66d9ef>where</span> e1.ename <span style=color:#66d9ef>in</span> (<span style=color:#e6db74>&#39;CLARK&#39;</span>, <span style=color:#e6db74>&#39;ADAMS&#39;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询和WARD或MILLER职位相同的所有员工
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.ename, e.job
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> e.job <span style=color:#f92672>=</span> <span style=color:#66d9ef>some</span> (<span style=color:#66d9ef>select</span> e1.job <span style=color:#66d9ef>from</span> test.emp e1 <span style=color:#66d9ef>where</span> e1.ename <span style=color:#66d9ef>in</span> (<span style=color:#e6db74>&#39;WARD&#39;</span>, <span style=color:#e6db74>&#39;MILLER&#39;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询比CLARK和ADAMS工资值都高的所有员工
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.ename, e.sal
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> e.sal <span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>all</span> (<span style=color:#66d9ef>select</span> e1.sal <span style=color:#66d9ef>from</span> test.emp e1 <span style=color:#66d9ef>where</span> e1.ename <span style=color:#66d9ef>in</span> (<span style=color:#e6db74>&#39;CLARK&#39;</span>, <span style=color:#e6db74>&#39;ADAMS&#39;</span>));
</span></span></code></pre></div><blockquote><p>心法: 关联子查询</p></blockquote><ul><li>关联子查询中，父查询每查询一条数据都需要先进行一次子查询。</li></ul><table><thead><tr><th>关联子查询语法格式</th><th>描述</th></tr></thead><tbody><tr><td><code>..where exists(子查询)</code></td><td>当子查询有结果时（不在乎结果是什么），输出父查询结果，否则跳过</td></tr><tr><td><code>..where not exists(子查询)</code></td><td>当子查询无结果时（不在乎结果是什么），输出父查询结果，否则跳过</td></tr></tbody></table><blockquote><p>武技: 测试关联子查询</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 查询所有存在员工的部门和编号
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> d.deptno, d.dname
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.dept d
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> <span style=color:#66d9ef>exists</span>(<span style=color:#66d9ef>select</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>from</span> test.emp e <span style=color:#66d9ef>where</span> e.deptno <span style=color:#f92672>=</span> d.deptno);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询所有不存在员工的部门和编号
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> d.deptno, d.dname
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.dept d
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>exists</span>(<span style=color:#66d9ef>select</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>from</span> test.emp e <span style=color:#66d9ef>where</span> e.deptno <span style=color:#f92672>=</span> d.deptno);
</span></span></code></pre></div><h2 id=ep08-dql分页查询>EP08. DQL分页查询</h2><blockquote><p>心法: DQL分页查询</p></blockquote><ul><li>分页时机: 分页会在排序 <code>order by</code> 之后行:<ul><li>分页有可能导致排序错误，若有需要，建议和 <code>order by</code> 一起使用。</li></ul></li><li>分页格式: <code>limit M, N</code>:<ul><li><code>M = (page - 1) * size</code>: 表示从哪条记录开始输出（包含自己），为0时可省略。</li><li><code>N = size</code>: 表示输出多少条数据，不能省略。</li></ul></li><li>分页原理:<ul><li>从第1条记录开始扫描到 <code>M</code>，然后载取出 <code>N</code> 条数据进行输出，<code>M</code> 越大，分页查询的效率越低。</li></ul></li><li>分页优化:<ul><li><code>M</code> 值过大时，先用 <code>where</code> 将记录起始位置限定到 <code>M</code>，然后取出 <code>N</code> 条记录，以提升分页查询效率。</li></ul></li></ul><blockquote><p>武技: 测试DQL分页查询</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 分页查询员工记录，从第2条开始，查询5条数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.empno, e.ename
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span><span style=color:#66d9ef>order</span> <span style=color:#66d9ef>by</span> e.empno
</span></span><span style=display:flex><span><span style=color:#66d9ef>limit</span> <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- MySQL分页优化测试 - 从第1条记录开始扫描到第10W条数据，然后取出100条记录，效率低
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.empno, e.ename
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span><span style=color:#66d9ef>order</span> <span style=color:#66d9ef>by</span> e.empno
</span></span><span style=display:flex><span><span style=color:#66d9ef>limit</span> <span style=color:#ae81ff>100000</span>, <span style=color:#ae81ff>100</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- MySQL分页优化测试 - 直接从10W条数据开始取出100条记录，效率高
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.empno, e.ename
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> e.empno <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>100000</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>and</span> e.empno <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>100100</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>order</span> <span style=color:#66d9ef>by</span> e.empno
</span></span><span style=display:flex><span><span style=color:#66d9ef>limit</span> <span style=color:#ae81ff>100</span>
</span></span></code></pre></div><h2 id=ep09-dql联表查询>EP09. DQL联表查询</h2><blockquote><p>心法: DQL联表查询</p></blockquote><ul><li>当需要的信息来自于不同表时，就需要用到联表查询，但最多不建议超过5个。</li><li>联表后的重复列，可以使用表名前缀或别名加以区分。</li><li>表支持自己联自己，分别使用表的别名加以区分即可。</li></ul><table><thead><tr><th>连表格式</th><th>描述</th></tr></thead><tbody><tr><td><code>select * from 表A join 表B on 联合条件</code></td><td>仅输出满足联合条件的记录</td></tr><tr><td><code>select * from 表A left join 表B on 联合条件</code></td><td>额外输出左侧表A的完整记录，即使不满足联合条件也要输出</td></tr><tr><td><code>select * from 表A right join 表B on 联合条件</code></td><td>额外输出右侧表B的完整记录，即使不满足联合条件也要输出</td></tr></tbody></table><blockquote><p>武技: 测试DQL联表查询</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 查询所有员工名和部门名，不存在员工的部门和没分配部门的员工都不显示
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.ename, d.dname
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>join</span> test.dept d <span style=color:#66d9ef>on</span> d.deptno <span style=color:#f92672>=</span> e.deptno;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询所有员工名和部门名，不存在员工的部门也显示
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.ename, d.dname
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>right</span> <span style=color:#66d9ef>join</span> test.dept d <span style=color:#66d9ef>on</span> d.deptno <span style=color:#f92672>=</span> e.deptno;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询所有员工名和部门名，没分配部门的员工也显示
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.ename, d.dname
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>left</span> <span style=color:#66d9ef>join</span> test.dept d <span style=color:#66d9ef>on</span> d.deptno <span style=color:#f92672>=</span> e.deptno;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询所有员工名和他的上级领导的名字
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> xiao.ename, da.ename
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp xiao
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>join</span> test.emp da <span style=color:#66d9ef>on</span> xiao.mgr <span style=color:#f92672>=</span> da.empno
</span></span></code></pre></div><h2 id=ep10-dql分组查询>EP10. DQL分组查询</h2><blockquote><p>心法: DQL分组查询</p></blockquote><ul><li>MySQL使用 <code>group by</code> 对1或N个字段进行分组，默认仅返回一列数据:<ul><li>分组过程中不会忽略null值，需要自行处理。</li><li>分组查询的字段只建议是 <code>group by</code> 后出现的字段。</li></ul></li><li>分组时的条件关键字:<ul><li>分组查询在分组前进行条件筛选时使用 <code>where</code> 关键字。</li><li>分组查询在分组后进行条件筛选时使用 <code>having</code> 关键字。</li></ul></li><li>分组查询一般配合聚合函数一起使用，且聚合函数也不会忽略null值，需要自行处理:</li></ul><table><thead><tr><th>分组查询常用格式</th><th>描述</th></tr></thead><tbody><tr><td><code>select 分组字段 from 表 group by 分组字段</code></td><td>按照指定的分组字段进行分组，不忽略 <code>null</code> 值</td></tr><tr><td><code>select count(字段) from 表 group by 分组字段</code></td><td>分组后，求每组中指定字段的数量</td></tr><tr><td><code>select max(字段) from 表 group by 分组字段</code></td><td>分组后，求每组中指定字段的最大值</td></tr><tr><td><code>select min(字段) from 表 group by 分组字段</code></td><td>分组后，求每组中指定字段的最小值</td></tr><tr><td><code>select sum(字段) from 表 group by 分组字段</code></td><td>分组后，求每组中指定字段的总和</td></tr><tr><td><code>select avg(字段) from 表 group by 分组字段</code></td><td>分组后，求每组中指定字段的平均值</td></tr><tr><td><code>select group_concat(字段) from 表 group by 分组字段</code></td><td>分组后，求每组中指定字段的拼接值，逗号分隔</td></tr></tbody></table><blockquote><p>武技: 测试DQL分组查询</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 查询员工，先按照部门分组，再按姓名分组
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.deptno, e.ename
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> e.deptno <span style=color:#66d9ef>is</span> <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>group</span> <span style=color:#66d9ef>by</span> e.deptno, e.ename
</span></span><span style=display:flex><span><span style=color:#66d9ef>order</span> <span style=color:#66d9ef>by</span> e.deptno;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询每个部门中的员工数量，员工最高工资，员工最低工资，员工平均工资和员工总工资
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.deptno,
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>count</span>(e.deptno) <span style=color:#66d9ef>count</span>,
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>max</span>(e.sal)      max_sal,
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>min</span>(e.sal)      min_sal,
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>avg</span>(e.sal)      avg_sal,
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>sum</span>(e.sal)      sum_sal
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> e.deptno <span style=color:#66d9ef>is</span> <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>group</span> <span style=color:#66d9ef>by</span> e.deptno;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询平均工资超过2000的部门
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.deptno, <span style=color:#66d9ef>avg</span>(e.sal) avg_sal
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span><span style=color:#66d9ef>group</span> <span style=color:#66d9ef>by</span> e.deptno
</span></span><span style=display:flex><span><span style=color:#66d9ef>having</span> <span style=color:#66d9ef>avg</span>(e.sal) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>2000</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询每个职位中都有哪些员工
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.job, group_concat(ename) emps
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> e.job <span style=color:#66d9ef>is</span> <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>group</span> <span style=color:#66d9ef>by</span> e.job
</span></span></code></pre></div><h2 id=ep11-dql并集查询>EP11. DQL并集查询</h2><blockquote><p>心法: DQL并集查询</p></blockquote><ul><li>并集运算的集合必须有相同的列，若不相同用null补，而且列的类型必须对应。</li></ul><table><thead><tr><th>并集查询常用格式</th><th>描述</th></tr></thead><tbody><tr><td><code>A结果集 union B 结果集</code></td><td>返回两个结果集的并集并且去重，不忽略 <code>null</code> 值</td></tr><tr><td><code>A结果集 union all B结果集</code></td><td>返回两个结果集的并集但不去重，不忽略 <code>null</code> 值</td></tr></tbody></table><blockquote><p>武技: 测试DQL并集查询</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- union求并集的时候会去重
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.deptno
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span><span style=color:#66d9ef>union</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> d.deptno
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.dept d;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- union all求并集的时候不去重
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.deptno
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span><span style=color:#66d9ef>union</span> <span style=color:#66d9ef>all</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> d.deptno
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.dept d;
</span></span></code></pre></div><h2 id=ep12-dql正则查询>EP12. DQL正则查询</h2><blockquote><p>心法: DQL正则查询</p></blockquote><ul><li>MySQL使用 <code>regexp</code> 关键字进行正则查询。</li></ul><table><thead><tr><th>并集查询常用格式</th><th>描述</th></tr></thead><tbody><tr><td><code>..where ename regexp '^S'</code></td><td>返回姓名以 <code>S</code> 开头的全部记录</td></tr><tr><td><code>..where ename regexp 'H$'</code></td><td>返回姓名以 <code>H</code> 结尾的全部记录</td></tr><tr><td><code>..where ename regexp 'A'</code></td><td>返回姓名包含 <code>A</code> 的全部记录</td></tr><tr><td><code>..where ename regexp '^[aeiou]</code>|<code>H$'</code></td><td>返回姓名以元音字母开头，或者以 <code>H</code> 结尾的全部记录</td></tr></tbody></table><blockquote><p>武技: 测试DQL正则查询</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 返回姓名以 `S` 开头的全部员工
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.ename
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> e.ename regexp <span style=color:#e6db74>&#39;^S&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 返回姓名以 `H` 开头的全部员工
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.ename
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> e.ename regexp <span style=color:#e6db74>&#39;H$&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 返回姓名包含 `S` 的全部员工
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.ename
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> e.ename regexp <span style=color:#e6db74>&#39;S&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 以元音字母开头，或者以H结尾
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> e.ename
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> e.ename regexp <span style=color:#e6db74>&#39;^[aeiou]|H$&#39;</span>;
</span></span></code></pre></div><h1 id=ch05-常用操作函数>CH05. 常用操作函数</h1><blockquote><p>心法: 常用操作函数</p></blockquote><ul><li>直接在数据库中使用函数可以提升查询效率。</li><li>dual是一张虚拟表，可用于一些函数的基本测试，在mysql中可以省略不写。</li></ul><h2 id=ep01-mysql时间函数>EP01. MySQL时间函数</h2><blockquote><p>心法: 时间函数</p></blockquote><ul><li>MySQL时间函数中字符串可以自动转为date格式。</li><li>mysql时间函数中的单位可选值均为 <code>year/month/day/week/hour/second/minute/microsecond</code> 等。</li></ul><table><thead><tr><th>常用时间函数</th><th>描述</th></tr></thead><tbody><tr><td><code>select now(), curdate(), curtime()</code></td><td>查询当前 <code>年月日时分秒/年月日/时分秒</code> 格式的系统本地时间</td></tr><tr><td><code>select date_add(日期, interval 值 单位)</code></td><td>对指定日期添加指定的时间后返回</td></tr><tr><td><code>select date_sub(日期, interval 值 单位)</code></td><td>对指定日期减少指定的时间后返回</td></tr><tr><td><code>select datediff(日期, 日期)</code></td><td>查询两个日期之间相差多少天</td></tr><tr><td><code>select year(日期), month(日期), day(日期)</code></td><td>从指定日期中截取出年月日</td></tr><tr><td><code>select hour(日期), minute(日期), second(日期)</code></td><td>从指定日期中截取出时分秒</td></tr><tr><td><code>select dayofweek(日期)</code></td><td>从指定日期中截取出星期几老外视周日为一星期中的第一天，所以星期结果需要手动-1</td></tr><tr><td><code>select last_day(日期)</code></td><td>查询指定日期的最后一天是哪一天，一般用于判断大小月</td></tr><tr><td><code>select date_format(日期, 日期模板)</code></td><td>按照指定日期模板转换日期格式，常用模板符号见下图</td></tr></tbody></table><p><img src=/%E7%AC%AC2%E9%98%B6%E6%AE%B5-WEB/JB2-3-MySQL/image/a1c4298d4267efe6ec00c5d5f4eee872.png alt=MySQL日期格式化模板></p><blockquote><p>武技: 测试时间函数</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 查询当前系统年月日时分秒时间/年月日时间/时分秒时间
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> now(), curdate(), curtime()
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> dual;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询2018年8月8日，10天后的日期
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> date_add(<span style=color:#e6db74>&#39;2018-08-08&#39;</span>, interval <span style=color:#ae81ff>10</span> <span style=color:#66d9ef>day</span>) <span style=color:#66d9ef>result</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询2018年8月8日，2月前的日期
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> date_sub(<span style=color:#e6db74>&#39;2018-08-08&#39;</span>, interval <span style=color:#ae81ff>2</span> <span style=color:#66d9ef>month</span>) <span style=color:#66d9ef>result</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询2018-08-08和2008-08-08差了多少天
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> datediff(<span style=color:#e6db74>&#39;2018-08-08&#39;</span>, <span style=color:#e6db74>&#39;2008-08-08&#39;</span>) <span style=color:#66d9ef>result</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询指定日期中的年，月，日，时，分，秒和星期
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#66d9ef>year</span>(now())          yyyy,
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>month</span>(now())         mm,
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>day</span>(now())           dd,
</span></span><span style=display:flex><span>       hour(now())          hh,
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>minute</span>(now())        mm,
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>second</span>(now())        ss,
</span></span><span style=display:flex><span>       dayofweek(now()) <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span> week;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询本月的最后一天
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> last_day(curdate()) <span style=color:#66d9ef>result</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 对日期进行格式化
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> now(), date_format(now(), <span style=color:#e6db74>&#39;%Y年%m月%d日 %T&#39;</span>) <span style=color:#66d9ef>result</span>;
</span></span></code></pre></div><h2 id=ep02-mysql字符函数>EP02. MySQL字符函数</h2><blockquote><p>心法: MySQL字符函数</p></blockquote><ul><li>表格中的 <code>A, B, C</code> 等均为字符串，<code>N, M</code> 等，均为从0开始的整数:</li></ul><table><thead><tr><th>常用字符函数</th><th>描述</th></tr></thead><tbody><tr><td><code>select length(A)</code></td><td>返回A的字节数，一个U8中文占3个字节</td></tr><tr><td><code>select lower(A), upper(A)</code></td><td>返回A的全小写/全大写形式</td></tr><tr><td><code>select trim(A), ltrim(A), rtrim(A)</code></td><td>对A两端/左端/右端去空格后返回</td></tr><tr><td><code>select trim(A from B)</code></td><td>对B两端删除A后返回</td></tr><tr><td><code>select lpad(A, N, B), rpad(A, N, B)</code></td><td>对A左补/右补B，直到N个字符，超出截取</td></tr><tr><td><code>select ascii(A)</code></td><td>查询A首字母的ascii码，null值的ascii码为null</td></tr><tr><td><code>select char(ascii码列表)</code></td><td>查询ascii码值对应的字符，null会被忽略</td></tr><tr><td><code>select replace(A, B, C)</code></td><td>将A中的全部B替换为C</td></tr><tr><td><code>select concat(A, B)</code></td><td>拼接A和B并返回，null拼接任何值都为null</td></tr><tr><td><code>select concat_ws(A, B, C)</code></td><td>使用A作为连接符拼接A和B并返回，null拼接任何值都为null</td></tr><tr><td><code>select repeat(A, N)</code></td><td>将A重复拼接N次后返回，null拼接任何值都为null</td></tr><tr><td><code>select position(A in B)</code></td><td>返回A在B中的位置，不存在返回0</td></tr><tr><td><code>select left(A, N), right(A, N)</code></td><td>返回A最左边/左右边的N个字符</td></tr><tr><td><code>select substring(A, N)</code></td><td>将A从N位置开始截取到最后并返回</td></tr><tr><td><code>select substring(A, N, M)</code></td><td>将A从N位置开始截取M个字符并返回</td></tr><tr><td><code>select space(N)</code></td><td>返回N个空格字符</td></tr><tr><td><code>select reverse(A)</code></td><td>返回A的反转形式</td></tr><tr><td><code>select insert(A, N, M, B)</code></td><td>从A的N号位置，删除M个字符，然后插入B</td></tr><tr><td><code>select elt(N, 字符串列表)</code></td><td>返回字符串列表中N号位上的元素，没找到返回null</td></tr><tr><td><code>select field(A, 字符串列表)</code></td><td>返回A在字符串列表中的位置，不存在返回0</td></tr></tbody></table><blockquote><p>武技: 测试字符函数</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 返回字符串的字节数，一个U8中文占3个字节
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#66d9ef>length</span>(<span style=color:#e6db74>&#39;hello&#39;</span>), <span style=color:#66d9ef>length</span>(<span style=color:#e6db74>&#39;你好&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 返回字符串的全小写/全大写形式
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#66d9ef>lower</span>(<span style=color:#e6db74>&#39;HELLO&#39;</span>), <span style=color:#66d9ef>upper</span>(<span style=color:#e6db74>&#39;hello&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 对字符串两端/左端/右端去空格后返回
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#66d9ef>trim</span>(<span style=color:#e6db74>&#39; hi world &#39;</span>), ltrim(<span style=color:#e6db74>&#39; hi world &#39;</span>), rtrim(<span style=color:#e6db74>&#39; hi world &#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 对字符串两端删除字符串 &#39;h&#39; 后返回
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#66d9ef>trim</span>(<span style=color:#e6db74>&#39;h&#39;</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;hi world&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 对字符串A左补/右补字符串 &#39;-&#39;，直到4个字符，超出截取
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> lpad(<span style=color:#e6db74>&#39;hi&#39;</span>, <span style=color:#ae81ff>4</span>, <span style=color:#e6db74>&#39;-&#39;</span>), rpad(<span style=color:#e6db74>&#39;hi&#39;</span>, <span style=color:#ae81ff>4</span>, <span style=color:#e6db74>&#39;-&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询字符串首字母的ascii码，null值的ascii码为null
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> ascii(<span style=color:#e6db74>&#39;a&#39;</span>), ascii(<span style=color:#e6db74>&#39;banana&#39;</span>), ascii(<span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询ascii码值对应的字符，null会被忽略
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> char(<span style=color:#ae81ff>97</span>, <span style=color:#66d9ef>null</span>, <span style=color:#ae81ff>98</span>, <span style=color:#ae81ff>99</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 将字符串 &#39;hello&#39; 中的 &#39;l&#39; 替换为 &#39;o&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#66d9ef>replace</span>(<span style=color:#e6db74>&#39;hello&#39;</span>, <span style=color:#e6db74>&#39;hello&#39;</span>, <span style=color:#e6db74>&#39;o&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 将两个字符串拼接在一起后返回，null拼接任何值都为null
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> concat(<span style=color:#e6db74>&#39;a&#39;</span>, <span style=color:#ae81ff>22</span>), concat(<span style=color:#e6db74>&#39;a&#39;</span>, <span style=color:#66d9ef>null</span>), concat(<span style=color:#e6db74>&#39;a&#39;</span>, <span style=color:#e6db74>&#39;b&#39;</span>, <span style=color:#e6db74>&#39;c&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 将字符串列表按照 `-` 分隔符拼接在一起，null拼接任何值都为null
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> concat_ws(<span style=color:#e6db74>&#39;-&#39;</span>, <span style=color:#e6db74>&#39;a&#39;</span>, <span style=color:#e6db74>&#39;b&#39;</span>, <span style=color:#e6db74>&#39;c&#39;</span>), concat_ws(<span style=color:#66d9ef>null</span>, <span style=color:#e6db74>&#39;a&#39;</span>, <span style=color:#e6db74>&#39;b&#39;</span>, <span style=color:#e6db74>&#39;c&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 将字符串重复拼接5遍后返回，null拼接任何值都为null
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> repeat(<span style=color:#e6db74>&#39;love&#39;</span>, <span style=color:#ae81ff>5</span>), repeat(<span style=color:#66d9ef>null</span>, <span style=color:#ae81ff>5</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 返回 &#34;o&#34; 在 &#34;com.lsx&#34; 中的位置，不存在返回0
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#66d9ef>position</span>(<span style=color:#e6db74>&#39;o&#39;</span> <span style=color:#66d9ef>in</span> <span style=color:#e6db74>&#39;com.lsx&#39;</span>), <span style=color:#66d9ef>position</span>(<span style=color:#e6db74>&#39;k&#39;</span> <span style=color:#66d9ef>in</span> <span style=color:#e6db74>&#39;com.lsx&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 返回字符串左边/右边5个字符
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#66d9ef>left</span>(<span style=color:#e6db74>&#39;perfect&#39;</span>, <span style=color:#ae81ff>5</span>), <span style=color:#66d9ef>right</span>(<span style=color:#e6db74>&#39;perfect&#39;</span>, <span style=color:#ae81ff>5</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 从3号位置截取字符串，一直截取到最后
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#66d9ef>substring</span>(<span style=color:#e6db74>&#39;perfect&#39;</span>, <span style=color:#ae81ff>3</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 从3号位置截取字符串，截取两个
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#66d9ef>substring</span>(<span style=color:#e6db74>&#39;perfect&#39;</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 返回6个空格
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#66d9ef>space</span>(<span style=color:#ae81ff>6</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 将字符串反转
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> reverse(<span style=color:#e6db74>&#39;banana&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 在字符串的3号位置，删除0个字符，并插入另一个字符串
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#66d9ef>insert</span>(<span style=color:#e6db74>&#39;hiva&#39;</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>0</span>, <span style=color:#e6db74>&#39;ja&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#66d9ef>insert</span>(<span style=color:#e6db74>&#39;hijava&#39;</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>4</span>, <span style=color:#e6db74>&#39;mysql&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 返回字符串列表中1号位上的元素，没找到返回null
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> elt(<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#39;a&#39;</span>, <span style=color:#e6db74>&#39;b&#39;</span>, <span style=color:#e6db74>&#39;c&#39;</span>, <span style=color:#e6db74>&#39;d&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 返回字符串 &#39;a&#39; 在字符串列表中的位置，不存在返回0
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> field(<span style=color:#e6db74>&#39;a&#39;</span>, <span style=color:#e6db74>&#39;a&#39;</span>, <span style=color:#e6db74>&#39;b&#39;</span>, <span style=color:#e6db74>&#39;c&#39;</span>, <span style=color:#e6db74>&#39;d&#39;</span>);
</span></span></code></pre></div><h2 id=ep03-mysql数学函数>EP03. MySQL数学函数</h2><blockquote><p>心法: MySQL数学函数</p></blockquote><ul><li>表格中的 <code>N, M, K</code> 等，均为从0开始的整数，<code>D, F</code> 等均为浮点数:</li></ul><table><thead><tr><th>常用字符函数</th><th>描述</th></tr></thead><tbody><tr><td><code>select abs(N)</code></td><td>返回N的绝对值</td></tr><tr><td><code>select ceil(D), floor(D)</code></td><td>返回D的向上取整值/向下取整值</td></tr><tr><td><code>select power(N, M), sqrt(K)</code></td><td>返回N的M次方值/返回K的平方根</td></tr><tr><td><code>select mod(N, M)</code></td><td>返回N对M取余的值</td></tr><tr><td><code>select rand()</code></td><td>返回一个0~1之间的随机数</td></tr><tr><td><code>select round(D, N)</code></td><td>返回D的四舍五入值，保留N为小数MySQL中四舍五入原理: 先对绝对值进行四舍五入后再拼接原值符号</td></tr><tr><td><code>select greatest(值列表), least(值列表)</code></td><td>从值列表中返回一个最大的值/最小的值</td></tr></tbody></table><blockquote><p>武技: 测试数学函数</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 计算向上取整，向下取整，幂次方，平方根，取余，随机数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#66d9ef>abs</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>10</span>), ceil(<span style=color:#ae81ff>1</span>.<span style=color:#ae81ff>1</span>), floor(<span style=color:#ae81ff>1</span>.<span style=color:#ae81ff>9</span>), power(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>), sqrt(<span style=color:#ae81ff>4</span>), <span style=color:#66d9ef>mod</span>(<span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>3</span>), rand();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 返回-11.5555的四舍五入，保留1为小数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> round(<span style=color:#f92672>-</span><span style=color:#ae81ff>11</span>.<span style=color:#ae81ff>5555</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 从列表中返回一个最大/最小的
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> greatest(<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>20</span>, <span style=color:#ae81ff>30</span>, <span style=color:#ae81ff>40</span>), least(<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>20</span>, <span style=color:#ae81ff>30</span>, <span style=color:#ae81ff>40</span>);
</span></span></code></pre></div><h2 id=ep04-mysql自建函数>EP04. MySQL自建函数</h2><blockquote><p>心法: 自定义函数</p></blockquote><ul><li>MySQL函数使用 <code>function</code> 关键字声明，一般用于返回SQL计算结果。</li><li>MySQL函数必须返回一个结果。</li><li>MySQL函数必须作为SQL的一部分进行调用，不能独立执行。</li></ul><blockquote><p>武技: 测试自定义函数</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 如果函数存在，则删除: 函数名称不带小括号
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>drop</span> <span style=color:#66d9ef>function</span> <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>exists</span> f1;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 创建函数: 参数中的in可以省略
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>function</span> f1(a int, b int)
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- 函数中必须在第一行声明返回值类型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>returns</span> varchar(<span style=color:#ae81ff>50</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>begin</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> a <span style=color:#f92672>&gt;</span> b <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>-- 返回类型必须和声明的返回类型一致
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;第1个参数大&#39;</span>;
</span></span><span style=display:flex><span>    elseif a <span style=color:#f92672>&lt;</span> b <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;第2个参数大&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;两个参数一样大&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span> <span style=color:#66d9ef>if</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 调用这个函数: IDEA爆红不影响
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> f1(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>),f1(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>2</span>),f1(<span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>2</span>);
</span></span></code></pre></div><h1 id=ch06-存储过程专题>CH06. 存储过程专题</h1><blockquote><p>心法: 存储过程专题</p></blockquote><ul><li>存储过程相当于Java语言中的方法，可以封装多条SQL语句，并随时随处进行调用。</li><li>存储过程一般用于执行SQL动作，可以不返回结果，且存储过程的调用只能独立执行。</li></ul><h2 id=ep01-无参存储过程>EP01. 无参存储过程</h2><blockquote><p>武技: 测试设计无参存储过程: 调用时可以求出user表中的总条目数</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 如果存储过程存在，则删除: 过程名称不带小括号
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>drop</span> <span style=color:#66d9ef>procedure</span> <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>exists</span> p1;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 创建无参存储过程p1: 过程名称需要小括号
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>procedure</span> p1()
</span></span><span style=display:flex><span><span style=color:#66d9ef>begin</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>select</span> <span style=color:#66d9ef>count</span>(<span style=color:#f92672>*</span>) <span style=color:#66d9ef>from</span> test.emp;
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 执行存储过程
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>call</span> p1();
</span></span></code></pre></div><h2 id=ep02-带参存储过程>EP02. 带参存储过程</h2><blockquote><p>武技: 设计带参存储过程: 输入员工主键，可以得到员工姓名</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 如果存储过程存在，则删除: 过程名称不带小括号
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>drop</span> <span style=color:#66d9ef>procedure</span> <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>exists</span> p2;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 创建存储过程p2: 输入变量为empNo，输出变量为empName
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 输入参数 `in`: 可以直接在存储过程中的SQL语句中使用，in关键字可以省略。
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 输出参数 `out`: 用于接收存储过程的结果，需要配合 `into` 关键字进行赋值。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>procedure</span> p2(<span style=color:#66d9ef>in</span> empNo int, <span style=color:#66d9ef>out</span> empName varchar(<span style=color:#ae81ff>128</span>))
</span></span><span style=display:flex><span><span style=color:#75715e>-- 设置存储过程体，相当于Java中的方法体
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>begin</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- 将编号为empNo的员工的姓名赋值给empName变量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>select</span> e.ename
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>into</span> empName
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>where</span> e.empno <span style=color:#f92672>=</span> empNo;
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 定义变量result的值为空字符串
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>set</span> <span style=color:#f92672>@</span><span style=color:#66d9ef>result</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 执行存储过程，需要同时传入in和out变量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>call</span> p2(<span style=color:#ae81ff>1</span>, <span style=color:#f92672>@</span><span style=color:#66d9ef>result</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查看存储过程的结果
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>@</span><span style=color:#66d9ef>result</span>;
</span></span></code></pre></div><h2 id=ep03-存储过程事务>EP03. 存储过程事务</h2><blockquote><p>武技: 测试设计一个存储过程: 向部门表添加2条记录，带有事务保护</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 如果存储过程存在，则删除: 过程名称不带小括号
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>drop</span> <span style=color:#66d9ef>procedure</span> <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>exists</span> p4;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 创建存储过程p4: in可以省略
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>procedure</span> p4(deptNo int)
</span></span><span style=display:flex><span><span style=color:#66d9ef>begin</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- 有任何异常，回滚操作
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>declare</span> exit <span style=color:#66d9ef>handler</span> <span style=color:#66d9ef>for</span> <span style=color:#66d9ef>sqlexception</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>select</span> <span style=color:#e6db74>&#39;异常回滚...&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>rollback</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- 开启事务保护
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>start</span> <span style=color:#66d9ef>transaction</span>;
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- 第1个SQL正常，进入缓存，未提交
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> test.dept <span style=color:#66d9ef>values</span> (deptNo, <span style=color:#e6db74>&#39;&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- 第2个SQL主键冲突，异常，进入缓存，未提交
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> test.dept <span style=color:#66d9ef>values</span> (deptNo, <span style=color:#e6db74>&#39;&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>commit</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 执行存储过程
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>call</span> p4(<span style=color:#ae81ff>5</span>);
</span></span></code></pre></div><h2 id=ep04-存储过程选择>EP04. 存储过程选择</h2><blockquote><p>武技: 设计一个存储过程: 输入一个num数字，返回该num是正数，负数或者零</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 如果存储过程存在，则删除: 过程名称不带小括号
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>drop</span> <span style=color:#66d9ef>procedure</span> <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>exists</span> p5;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 创建存储过程p5: in可以省略
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>procedure</span> p5(num int)
</span></span><span style=display:flex><span><span style=color:#66d9ef>begin</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- 声明局部变量result，默认值为空字符串
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>declare</span> <span style=color:#66d9ef>result</span> varchar(<span style=color:#ae81ff>50</span>) <span style=color:#66d9ef>default</span> <span style=color:#e6db74>&#39;&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- 使用IF结构
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> num <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>set</span> <span style=color:#66d9ef>result</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;负数&#39;</span>;
</span></span><span style=display:flex><span>    elseif num <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>set</span> <span style=color:#66d9ef>result</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;正数&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>set</span> <span style=color:#66d9ef>result</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;零&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span> <span style=color:#66d9ef>if</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- 查询结果
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>select</span> concat(num, <span style=color:#e6db74>&#39;是一个&#39;</span>, <span style=color:#66d9ef>result</span>) rst;
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 执行存储过程
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>call</span> p5(<span style=color:#ae81ff>0</span>);
</span></span></code></pre></div><h2 id=ep05-存储过程循环>EP05. 存储过程循环</h2><blockquote><p>武技: 设计一个存储过程: 输入一个times值，向dept表循环添加times条测试数据</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 如果存储过程存在，则删除: 过程名称不带小括号
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>drop</span> <span style=color:#66d9ef>procedure</span> <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>exists</span> p6;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 创建过程
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>procedure</span> p6(times int)
</span></span><span style=display:flex><span><span style=color:#66d9ef>begin</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- 初: 定义局部变量i，初始为0
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>declare</span> i int <span style=color:#66d9ef>default</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- 有任何异常，回滚操作
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>declare</span> exit <span style=color:#66d9ef>handler</span> <span style=color:#66d9ef>for</span> <span style=color:#66d9ef>sqlexception</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>select</span> <span style=color:#e6db74>&#39;回滚操作&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>rollback</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- 开启事务保护
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>start</span> <span style=color:#66d9ef>transaction</span> ;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- 循环结构: loop_a是循环的别名
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    loop_a:
</span></span><span style=display:flex><span>    loop
</span></span><span style=display:flex><span>        <span style=color:#75715e>-- 判
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> i <span style=color:#f92672>&gt;=</span> times <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>-- 结束循环，相当于Java循环中的break关键字
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            leave loop_a;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>end</span> <span style=color:#66d9ef>if</span>;
</span></span><span style=display:flex><span>        <span style=color:#75715e>-- 变: 对局部变量i进行自增
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>set</span> i <span style=color:#f92672>=</span> i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>-- 向dept表中添加记录
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> test.dept
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>values</span> (<span style=color:#ae81ff>4</span> <span style=color:#f92672>+</span> i, <span style=color:#e6db74>&#39;&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span> loop;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- 提交事务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>commit</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 测试
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>call</span> p6(<span style=color:#ae81ff>11</span>);
</span></span></code></pre></div><h2 id=ep06-表或行触发器>EP06. 表或行触发器</h2><blockquote><p>心法: 触发器过程</p></blockquote><ul><li>触发器中的内容会在某个条件成立时自动执行，无法人为调用，每张表最多支持6个触发器。</li><li>触发器可在写入数据前，强制检验或者转换数据，以保证护数据安全。</li><li>触发器发生错误时，前面用户已经执行成功的操作会被撤销，类似事务的回滚。</li><li>触发器可用于记录操作日志，即谁在什么时间对表或记录做了什么样的操作。</li><li>触发器可用设计自增字段，比如每次添加数据之前，先对某字段进行自增。</li></ul><blockquote><p>心法: 触发器分类</p></blockquote><ul><li>表级触发器: 当表发生改变时触发一次，如表被删除时，执行触发器。</li><li>行级触发器: 当表的某行记录改变时触发一次，如表中的某行记录被删除时，执行触发器。</li></ul><blockquote><p>武技: 设计触发器</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 创建日志表: 记录表 `dept` 的删除信息
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>drop</span> <span style=color:#66d9ef>table</span> <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>exists</span> test.dept_delete_log;
</span></span><span style=display:flex><span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>exists</span> test.dept_delete_log
</span></span><span style=display:flex><span>(
</span></span><span style=display:flex><span>    log_id         int unsigned auto_increment <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;日志表主键&#39;</span>,
</span></span><span style=display:flex><span>    operation_user varchar(<span style=color:#ae81ff>128</span>) <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;本次操作的用户&#39;</span>,
</span></span><span style=display:flex><span>    operation_info varchar(<span style=color:#ae81ff>50</span>) <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;本次操作的信息&#39;</span>,
</span></span><span style=display:flex><span>    operation_time datetime <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;本次操作的时间&#39;</span>,
</span></span><span style=display:flex><span>    deptno         int unsigned <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;部门表主键&#39;</span>,
</span></span><span style=display:flex><span>    dname          varchar(<span style=color:#ae81ff>14</span>) <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;部门表名称&#39;</span>,
</span></span><span style=display:flex><span>    loc            varchar(<span style=color:#ae81ff>13</span>) <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;部门表地址&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>primary</span> <span style=color:#66d9ef>key</span> (log_id)
</span></span><span style=display:flex><span>) <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;部门表的删除记录日志表&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查询所有用户下的触发器
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>show</span> triggers;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 创建行级触发器: 当删除行记录时触发
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>drop</span> <span style=color:#66d9ef>trigger</span> <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>exists</span> test.dept_delete_log;
</span></span><span style=display:flex><span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>trigger</span> test.dept_delete_log
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>after</span> <span style=color:#66d9ef>delete</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>on</span> test.dept
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#66d9ef>each</span> <span style=color:#66d9ef>row</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>begin</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> test.dept_delete_log (operation_user, operation_info,
</span></span><span style=display:flex><span>                                      operation_time, deptno, dname,
</span></span><span style=display:flex><span>                                      loc)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>values</span> (<span style=color:#66d9ef>current_user</span>(), concat(<span style=color:#e6db74>&#39;删除了id为&#39;</span>, <span style=color:#66d9ef>OLD</span>.deptno, <span style=color:#e6db74>&#39;的记录&#39;</span>), now(),
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>OLD</span>.deptno, <span style=color:#66d9ef>OLD</span>.dname, <span style=color:#66d9ef>OLD</span>.loc);
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>;
</span></span></code></pre></div><h1 id=ch07-优化手段专题>CH07. 优化手段专题</h1><blockquote><p>心法: MySQL优化手段</p></blockquote><table><thead><tr><th>优化层面</th><th>描述</th></tr></thead><tbody><tr><td>硬件系统层面</td><td>从硬件设备层面，影响MySQL性能的因素有CPU，可用内存大小，磁盘读写速度，网络带宽等。从操作系统层面，影响MySQL性能的因素有应用文件句柄数，操作系统网络的配置等。这部分的优化一般由DBA（数据库管理员）或者运维工程师去完成。</td></tr><tr><td>架构设计层面</td><td>1. 主从集群: 提升MySQL系统的容灾性和高可用性。2. 读写分离: 在读多写少的场景下提高性能。3. 分库分表: 降低单个服务器节点的IO压力，降低单表数据量，从而提高SQL查询效率。4. 冷热分离: 针对热点数据，引入更高效的Redis，MongoDB等中间件，缓解MySQL压力。</td></tr><tr><td>应用配置层面</td><td>根据需求修改MySQL的 <code>my.cnf</code> 配置文件，如默认最大连接数，是否开启BinLog，缓存池大小等。</td></tr><tr><td>SQL语句层面</td><td>1. 慢SQL排查: 通过慢查询日志和分析工具排查到有问题的SQL语句列表。2. 执行计划分析: 通过 <code>explain</code> 来查看当前SQL的执行计划，重点关注 <code>type/key/rows</code> 等字段。3. SQL优化细则: 使用效率高的SQL语句替换效率低的SQL语句。</td></tr></tbody></table><h2 id=ep01-mysql执行计划>EP01. MySQL执行计划</h2><blockquote><p>心法: MySQL执行计划</p></blockquote><ul><li>执行计划是一条查询语句的执行过程或对访问路径的描述。</li><li>执行计划通过在查询语句的最前方增加 <code>explain</code> 关键字来完成。</li><li>无法对存储过程和触发器使用执行计划。</li></ul><blockquote><p>武技: 测试执行计划</p></blockquote><ol><li>测试 <code>select_type</code> 结果:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- select_type = simple: 该查询不包含子查询
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>explain</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- select_type = primary: 该查询是一个父查询
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- select_type = subquery: 该查询是一个子查询
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>explain</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> deptno <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>all</span> (<span style=color:#66d9ef>select</span> deptno <span style=color:#66d9ef>from</span> test.dept);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- select_type = primary: 该查询是一个父查询
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- select_type = dependent subquery: 该查询是一个关联子查询
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>explain</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.dept d
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> <span style=color:#66d9ef>exists</span>(<span style=color:#66d9ef>select</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>             <span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span>             <span style=color:#66d9ef>where</span> e.deptno <span style=color:#f92672>=</span> d.deptno);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- select_type = primary: 该查询是一个父查询
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- select_type = union: 该查询是一个并集查询
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- select_type = union result: union查询结果，被放到临时表中
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>explain</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> deptno
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.dept
</span></span><span style=display:flex><span><span style=color:#66d9ef>union</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>select</span> deptno
</span></span><span style=display:flex><span> <span style=color:#66d9ef>from</span> test.emp);
</span></span></code></pre></div><ol start=2><li>测试 <code>type</code> 结果:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- type=null: 该查询未使用任何表和索引
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>explain</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> ceil(<span style=color:#ae81ff>1</span>.<span style=color:#ae81ff>5</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- type=const: 该查询一次就找到了结果
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>explain</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> empno <span style=color:#f92672>=</span> <span style=color:#ae81ff>7369</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- type = eq_ref:
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>explain</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> e.deptno
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp e
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>join</span> test.dept d <span style=color:#66d9ef>on</span> d.deptno <span style=color:#f92672>=</span> e.deptno;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- type=ref: 按照索引查询进行精准查询，且该索引列是不唯一的
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>index</span> emp_empno <span style=color:#66d9ef>on</span> test.emp(job);
</span></span><span style=display:flex><span><span style=color:#66d9ef>explain</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> job <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;CLARK&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- range: 按照索引查询进行范围查询
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>explain</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span> empno <span style=color:#66d9ef>between</span> <span style=color:#ae81ff>2000</span> <span style=color:#66d9ef>and</span> <span style=color:#ae81ff>4000</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- index: 该查询按照索引全表扫描
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>explain</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> empno
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- all: 该查询未使用索引，进行了全表扫描，性能最差
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>explain</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> sal
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> test.emp;
</span></span></code></pre></div><h2 id=ep02-mysql慢查日志>EP02. MySQL慢查日志</h2><blockquote><p>心法: MySQL慢查询日志</p></blockquote><ul><li>超过指定时间的SQL查询称为慢查询，可以被记录在一个log日志文件中以便coder发现和修改:</li></ul><blockquote><p>武技: 测试慢查询日志</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- 查询当前慢查询功能是否开启，1表示开启，0表示关闭
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>@@</span>slow_query_log;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 开启慢查询功能
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>set</span> <span style=color:#66d9ef>global</span> slow_query_log <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>查看当前慢查询超时时间</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>show</span> variables <span style=color:#66d9ef>like</span> <span style=color:#e6db74>&#39;long_query_time&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 设置慢查询超时时间
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>set</span> <span style=color:#66d9ef>global</span> long_query_time <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>0001</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 查看慢查询日志文件位置
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>show</span> variables <span style=color:#66d9ef>like</span> <span style=color:#e6db74>&#39;slow_query_log_file&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 配置慢查询日志文件位置
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>set</span> <span style=color:#66d9ef>global</span> slow_query_log_file <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;D:/slow.log&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 随意运行命令，查看慢查询日志
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> test.emp
</span></span><span style=display:flex><span><span style=color:#66d9ef>union</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> test.emp;
</span></span></code></pre></div><h2 id=ep03-mysql主从架构>EP03. MySQL主从架构</h2><ul><li><a href=res/MySQL%E6%90%AD%E5%BB%BA%E4%B8%BB%E4%BB%8E%E6%9E%B6%E6%9E%84.md>MySQL搭建主从架构</a></li></ul></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div></main><footer class=footer><span>&copy; 2024 The Marauders</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>