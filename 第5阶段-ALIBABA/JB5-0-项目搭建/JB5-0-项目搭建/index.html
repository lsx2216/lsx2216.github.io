<!doctype html><html lang=en><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>JB5-0-项目搭建</title>
<meta name=description content="Java道经第5卷 - 第0阶 - 项目搭建
CH01. 搭建数据库 武技: 创建MySQL数据库和相关表
创建数据库实例: cmd: create database v3_alibaba character set utf8mb4; use v3_alibaba; 导入数据库表和测试数据: res: …"><meta name=keywords content='blog,lsx2216,hugo'><meta property="og:url" content="https://lsx2216.netlify.app/%E7%AC%AC5%E9%98%B6%E6%AE%B5-ALIBABA/JB5-0-%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/JB5-0-%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/"><meta property="og:type" content="website"><meta property="og:title" content="JB5-0-项目搭建"><meta property="og:description" content="Java道经第5卷 - 第0阶 - 项目搭建
CH01. 搭建数据库 武技: 创建MySQL数据库和相关表
创建数据库实例: cmd: create database v3_alibaba character set utf8mb4; use v3_alibaba; 导入数据库表和测试数据: res: …"><meta property="og:image" content="https://lsx2216.netlify.app/assets/images/user.jpg"><meta property="og:image:secure_url" content="https://lsx2216.netlify.app/assets/images/user.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="JB5-0-项目搭建"><meta name=twitter:description content="Java道经第5卷 - 第0阶 - 项目搭建
CH01. 搭建数据库 武技: 创建MySQL数据库和相关表
创建数据库实例: cmd: create database v3_alibaba character set utf8mb4; use v3_alibaba; 导入数据库表和测试数据: res: …"><meta property="twitter:domain" content="https://lsx2216.netlify.app/%E7%AC%AC5%E9%98%B6%E6%AE%B5-ALIBABA/JB5-0-%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/JB5-0-%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/"><meta property="twitter:url" content="https://lsx2216.netlify.app/%E7%AC%AC5%E9%98%B6%E6%AE%B5-ALIBABA/JB5-0-%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/JB5-0-%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/"><meta name=twitter:image content="https://lsx2216.netlify.app/assets/images/user.jpg"><link rel=canonical href=https://lsx2216.netlify.app/%E7%AC%AC5%E9%98%B6%E6%AE%B5-ALIBABA/JB5-0-%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/JB5-0-%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.3eb19cb61dde9e37b9522867f3e024aeb68e26ab8e03252e46e365abcb19acf7.js integrity="sha256-PrGcth3enje5Uihn8+AkrraOJquOAyUuRuNlq8sZrPc="></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css integrity=sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js integrity=sha384-X/XCfMm41VSsqRNQgDerQczD69XqmjOOOwYQvr/uuC+j4OPoNhVgjdGFwhvN02Ja crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script>    <link rel="shortcut icon" href="/assets/images/user.jpg" type="image/x-icon">
</head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://lsx2216.netlify.app/><img src=/assets/images/user.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://lsx2216.netlify.app/>lsx2216</a></div><div class=nav-links><div class=nav-link><a href=https://lsx2216.netlify.app/ aria-label><span data-feather=home></span> Home</a></div><div class=nav-link><a href=https://lsx2216.netlify.app/projects/ aria-label><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://github.com aria-label=github><span data-feather=github></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://lsx2216.netlify.app/><span data-feather=home></span> Home</a></li><li class=nav-item><a href=https://lsx2216.netlify.app/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://github.com><span data-feather=github></span></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>JB5-0-项目搭建</h1></div><div class=post-content><blockquote><p>Java道经第5卷 - 第0阶 - 项目搭建</p></blockquote><hr><h1 id=ch01-搭建数据库>CH01. 搭建数据库</h1><blockquote><p>武技: 创建MySQL数据库和相关表</p></blockquote><ul><li>创建数据库实例:<ul><li>cmd: <code>create database v3_alibaba character set utf8mb4; use v3_alibaba;</code></li></ul></li><li>导入数据库表和测试数据:<ul><li>res: <a href=sql/v3_alibaba.sql>v3_alibaba.sql</a></li></ul></li></ul><h1 id=ch02-父项目管理依赖>CH02. 父项目管理依赖</h1><blockquote><p>武技: 在父项目 <code>java-book</code> 中配置依赖管理</p></blockquote><ol><li>添加全局属性:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;spring-cloud-version&gt;</span>Hoxton.SR12<span style=color:#f92672>&lt;/spring-cloud-version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;spring-cloud-alibaba-version&gt;</span>2.2.9.RELEASE<span style=color:#f92672>&lt;/spring-cloud-alibaba-version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dobbo-version&gt;</span>2.7.13<span style=color:#f92672>&lt;/dobbo-version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;spring-context-support-version&gt;</span>1.0.11<span style=color:#f92672>&lt;/spring-context-support-version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;jjwt-version&gt;</span>0.9.0<span style=color:#f92672>&lt;/jjwt-version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;rocketmq-version&gt;</span>2.0.3<span style=color:#f92672>&lt;/rocketmq-version&gt;</span>
</span></span></code></pre></div><ol start=2><li>添加依赖管理:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-cloud-dependencies--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.cloud<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;artifactId&gt;</span>spring-cloud-dependencies<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;version&gt;</span>${spring-cloud-version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;type&gt;</span>pom<span style=color:#f92672>&lt;/type&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;scope&gt;</span>import<span style=color:#f92672>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-cloud-alibaba-dependencies--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;groupId&gt;</span>com.alibaba.cloud<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;artifactId&gt;</span>spring-cloud-alibaba-dependencies<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;version&gt;</span>${spring-cloud-alibaba-version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;type&gt;</span>pom<span style=color:#f92672>&lt;/type&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;scope&gt;</span>import<span style=color:#f92672>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--dubbo-spring-boot-starter--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;groupId&gt;</span>org.apache.dubbo<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;artifactId&gt;</span>dubbo-spring-boot-starter<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;version&gt;</span>${dobbo-version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-context-support: 解决dubbo2.7.13的jar包冲突问题--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;groupId&gt;</span>com.alibaba.spring<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;artifactId&gt;</span>spring-context-support<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;version&gt;</span>${spring-context-support-version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--jjwt--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;groupId&gt;</span>io.jsonwebtoken<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;artifactId&gt;</span>jjwt<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;version&gt;</span>${jjwt-version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--rocketmq-spring-boot-starter--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;groupId&gt;</span>org.apache.rocketmq<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;artifactId&gt;</span>rocketmq-spring-boot-starter<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;version&gt;</span>${rocketmq-version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><h1 id=ch03-创建common子项目>CH03. 创建common子项目</h1><blockquote><p>心法: 通用子项目 <code>v3-alibaba-common</code></p></blockquote><ul><li>通用子项目 <code>v3-alibaba-common</code> 用于配置常用工具类和ORM实体类。</li></ul><blockquote><p>武技: 创建通用子项目 <code>v3-alibaba-common</code></p></blockquote><ol><li>添加三方依赖:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--junit--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>junit<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>junit<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--lombok--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.projectlombok<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>lombok<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--hutool--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>cn.hutool<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>hutool-all<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start=2><li>开发对应全部表的ORM实体类。</li><li>开发Result响应工具类 <code>Result</code>:<ul><li>将 <code>v2-lesson-userbackground</code> 中的响应工具类拷贝过来即可。</li></ul></li></ol><h1 id=ch04-创建三个业务微服务>CH04. 创建三个业务微服务</h1><blockquote><p>心法: 三个业务微服务</p></blockquote><ul><li><code>v3-alibaba-user</code>: 用户微服务。</li><li><code>v3-alibaba-product</code>: 商品微服务。</li><li><code>v3-alibaba-order</code>: 订单微服务。</li></ul><blockquote><p>武技: 创建三个业务微服务，以 <code>v3-alibaba-user</code> 为例</p></blockquote><ol><li>添加三方依赖:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml></code></pre></div><ol start=2><li>开发主配文件 <code>classpath:application.yml</code>:<ul><li>为用户子项目分配 <code>8010</code> 端口和 <code>alibaba-user</code> 项目名。</li><li>为订单子项目分配 <code>8020</code> 端口和 <code>alibaba-order</code> 项目名。</li><li>为商品子项目分配 <code>8030</code> 端口和 <code>alibaba-product</code> 项目名。</li><li>其余配置均相同。</li></ul></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>server</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>port</span>: <span style=color:#ae81ff>8010</span> <span style=color:#75715e># 项目端口号</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>servlet</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>context-path</span>: <span style=color:#ae81ff>/api/v1</span> <span style=color:#75715e># 全部控制器接口前缀</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spring</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>application</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>alibaba-user</span> <span style=color:#75715e># 项目发布名</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>datasource</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>driver-class-name</span>: <span style=color:#ae81ff>com.mysql.cj.jdbc.Driver</span> <span style=color:#75715e># 驱动串</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>url</span>: <span style=color:#ae81ff>jdbc:mysql://192.168.40.77:3306/v3_alibaba?serverTimezone=Asia/Shanghai</span> <span style=color:#75715e># 连接串</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>username</span>: <span style=color:#ae81ff>root</span> <span style=color:#75715e># 连库账号</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>password</span>: <span style=color:#ae81ff>root</span> <span style=color:#75715e># 连库密码</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>com.alibaba.druid.pool.DruidDataSource</span> <span style=color:#75715e># Druid连接池</span>
</span></span><span style=display:flex><span><span style=color:#f92672>mybatis</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>type-aliases-package</span>: <span style=color:#ae81ff>com.lsx.entity</span> <span style=color:#75715e># 实体类别名包扫描</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>configuration</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>map-underscore-to-camel-case</span>: <span style=color:#66d9ef>true</span> <span style=color:#75715e># 下划线自动转驼峰</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>cache-enabled</span>: <span style=color:#66d9ef>true</span> <span style=color:#75715e># 开启二级缓存</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>lazy-loading-enabled</span>: <span style=color:#66d9ef>true</span> <span style=color:#75715e># 开启全局懒加载</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>aggressive-lazy-loading</span>: <span style=color:#66d9ef>false</span> <span style=color:#75715e># 关闭全局积极加载</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>log-impl</span>: <span style=color:#ae81ff>org.apache.ibatis.logging.stdout.StdOutImpl</span> <span style=color:#75715e># 控制台SQL语句</span>
</span></span></code></pre></div><ol start=3><li>开发启动类:<ul><li>为用户子项目开发 <code>AlibabaUserApp</code> 启动类。</li><li>为订单子项目开发 <code>AlibabaOrderApp</code> 启动类。</li><li>为商品子项目开发 <code>AlibabaProductApp</code> 启动类。</li></ul></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.boot.SpringApplication;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.boot.autoconfigure.SpringBootApplication;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author lsx
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootApplication</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserApp</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>        SpringApplication.<span style=color:#a6e22e>run</span>(UserApp.<span style=color:#a6e22e>class</span>, args);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=4><li>开发MyBatis配置类 <code>MyBatisConfig</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.config;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@MapperScan</span>(<span style=color:#e6db74>&#34;com.lsx.mapper&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyBatisConfig</span> {
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=5><li>开发全局异常处理类 <code>GlobalExceptionHandler</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.exception;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@ControllerAdvice</span>(<span style=color:#e6db74>&#34;com.lsx&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GlobalExceptionHandler</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@ResponseBody</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@ExceptionHandler</span>(Exception.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Result <span style=color:#a6e22e>exception</span>(Exception e) {
</span></span><span style=display:flex><span>        log.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#34;爆发异常，被GlobalExceptionHandler.exception()捕获&#34;</span>, e);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Result.<span style=color:#a6e22e>failure</span>(500, e.<span style=color:#a6e22e>getMessage</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=6><li>开发全部表对应的Mapper接口，Service接口与实现类，以及Controller控制器。</li></ol><h1 id=ch05-开发用户微服务接口>CH05. 开发用户微服务接口</h1><blockquote><p>武技: 在用户微服务 <code>v3-alibaba-user</code> 中开发查询接口</p></blockquote><ol><li>开发数据方法 <code>UserMapper -> selectByUserId()</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.mapper;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>UserMapper</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    String SELECT_ALL <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;select u.user_id, u.username, u.password, u.real_name, u.nick_name, &#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;u.gender, u.age, u.id_card, u.avatar_url, u.phone, u.user_info, u.user_deleted, &#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;u.create_time, u.last_modify from v3_alibaba.user u &#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 按User主键主键查询User记录
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param userId 用户表主键
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return 一条用户记录
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Select</span>(<span style=color:#e6db74>&#34;&lt;script&gt;&#34;</span> <span style=color:#f92672>+</span> SELECT_ALL <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;&lt;where&gt; &#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;&lt;if test = &#39;_parameter != null&#39;&gt; and u.user_id = #{param1} &lt;/if&gt;&#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;or 1 = 2&#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;&lt;/where&gt;&#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;&lt;/script&gt;&#34;</span>)
</span></span><span style=display:flex><span>    User <span style=color:#a6e22e>selectByUserId</span>(Integer userId);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=2><li>开发业务方法 <code>UserService -> selectByUserId()</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.service;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>UserService</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 按User主键主键查询User记录
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param userId 用户表主键
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return 一条用户记录
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    User <span style=color:#a6e22e>selectByUserId</span>(Integer userId);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=3><li>重写业务方法 <code>UserServiceImpl -> selectByUserId()</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.service.impl;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Service</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserServiceImpl</span> <span style=color:#66d9ef>implements</span> UserService {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> UserMapper userMapper;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> User <span style=color:#a6e22e>selectByUserId</span>(Integer userId) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> userMapper.<span style=color:#a6e22e>selectByUserId</span>(userId);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=4><li>开发控制方法 <code>UserController -> selectByUserId()</code></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.controller;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RequestMapping</span>(<span style=color:#e6db74>&#34;/user&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserController</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> UserService userService;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/select-by-user-id/{user-id}&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Result <span style=color:#a6e22e>selectByUserId</span>(<span style=color:#a6e22e>@PathVariable</span>(<span style=color:#e6db74>&#34;user-id&#34;</span>) Integer userId) {
</span></span><span style=display:flex><span>        log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;请求: 按主键查询用户记录，入参: {}&#34;</span>, userId);
</span></span><span style=display:flex><span>        User result <span style=color:#f92672>=</span> userService.<span style=color:#a6e22e>selectByUserId</span>(userId);
</span></span><span style=display:flex><span>        log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;响应: 按主键查询用户记录，结果: {}&#34;</span>, result);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Result.<span style=color:#a6e22e>dql</span>(result);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=5><li>访问控制方法 <code>UserController -> selectByUserId()</code></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>## EP01. 按用户主键查询用户记录
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>GET http://localhost:8010/api/v1/user/select-by-user-id/1
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Accept: application/json
</span></span></span></code></pre></div><h1 id=ch06-开发订单微服务接口>CH06. 开发订单微服务接口</h1><blockquote><p>武技: 在订单微服务 <code>v3-alibaba-order</code> 中开发添加接口</p></blockquote><ol><li>开发Param实体类 <code>OrderInsertParam</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.param;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@JsonNaming</span>(PropertyNamingStrategy.<span style=color:#a6e22e>KebabCaseStrategy</span>.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrderInsertParam</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Integer userId;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String orderInfo;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Double totalFee;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>Map<span style=color:#f92672>&lt;</span>String, Integer<span style=color:#f92672>&gt;&gt;</span> products;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=2><li>开发数据方法 <code>ProductOrderMapper -> insert()</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.mapper;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>ProductOrderMapper</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 添加一条商品订单中间表记录
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param productOrder 商品订单中间表ORM实体
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return 影响条目数
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Insert</span>(<span style=color:#e6db74>&#34;insert into v3_alibaba.product_order &#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;(fk_order_id, fk_product_id, purchase_quantity, create_time, last_modify) &#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;values &#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;(#{fkOrderId}, #{fkProductId}, #{purchaseQuantity}, now(), now())&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Options</span>(useGeneratedKeys <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>, keyProperty <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;productOrderId&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>insert</span>(ProductOrder productOrder);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=3><li>开发数据方法 <code>OrderMapper -> insert()</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.mapper;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>OrderMapper</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 添加一条订单记录
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param order 订单ORM实体
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return 影响条目数
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Insert</span>(<span style=color:#e6db74>&#34;insert into v3_alibaba.`order` &#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;(order_number, total_fee, order_info, fk_user_id, username, create_time, last_modify) &#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;values &#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;(#{orderNumber}, #{totalFee}, #{orderInfo}, #{fkUserId}, #{username}, now(), now())&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Options</span>(useGeneratedKeys <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>, keyProperty <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;orderId&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>insert</span>(Order order);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=4><li>开发业务方法 <code>OrderService -> insert()</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.service;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>OrderService</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 添加一条订单记录
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param orderInsertParam 用于添加订单的Param实体
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return 影响条目数
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>insert</span>(OrderInsertParam orderInsertParam);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=5><li>重写业务方法 <code>OrderServiceImpl -> insert()</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.service.impl;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Service</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrderServiceImpl</span> <span style=color:#66d9ef>implements</span> OrderService {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> OrderMapper orderMapper;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> ProductOrderMapper productOrderMapper;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>insert</span>(OrderInsertParam orderInsertParam) {
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>Map<span style=color:#f92672>&lt;</span>String, Integer<span style=color:#f92672>&gt;&gt;</span> products <span style=color:#f92672>=</span> orderInsertParam.<span style=color:#a6e22e>getProducts</span>();
</span></span><span style=display:flex><span>        String orderInfo <span style=color:#f92672>=</span> orderInsertParam.<span style=color:#a6e22e>getOrderInfo</span>();
</span></span><span style=display:flex><span>        Integer userId <span style=color:#f92672>=</span> orderInsertParam.<span style=color:#a6e22e>getUserId</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 组装Order实体: 用户名先写死</span>
</span></span><span style=display:flex><span>        Order order <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Order();
</span></span><span style=display:flex><span>        order.<span style=color:#a6e22e>setFkUserId</span>(userId);
</span></span><span style=display:flex><span>        order.<span style=color:#a6e22e>setUsername</span>(<span style=color:#e6db74>&#34;赵四&#34;</span>);
</span></span><span style=display:flex><span>        order.<span style=color:#a6e22e>setOrderNumber</span>(RandomUtil.<span style=color:#a6e22e>randomNumbers</span>(19));
</span></span><span style=display:flex><span>        order.<span style=color:#a6e22e>setTotalFee</span>(orderInsertParam.<span style=color:#a6e22e>getTotalFee</span>());
</span></span><span style=display:flex><span>        order.<span style=color:#a6e22e>setOrderInfo</span>(StrUtil.<span style=color:#a6e22e>isBlank</span>(orderInfo) <span style=color:#f92672>?</span> <span style=color:#e6db74>&#34;该订单暂无描述信息&#34;</span> : orderInfo);
</span></span><span style=display:flex><span>        order.<span style=color:#a6e22e>setCreateTime</span>(<span style=color:#66d9ef>new</span> Date());
</span></span><span style=display:flex><span>        order.<span style=color:#a6e22e>setLastModify</span>(<span style=color:#66d9ef>new</span> Date());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 添加Order表记录，若添加失败则抛出异常</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (orderMapper.<span style=color:#a6e22e>insert</span>(order) <span style=color:#f92672>&lt;=</span> 0) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException(<span style=color:#e6db74>&#34;Order表添加异常&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 循环添加VideoOrder中间表数据</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (Map<span style=color:#f92672>&lt;</span>String, Integer<span style=color:#f92672>&gt;</span> product : products) {
</span></span><span style=display:flex><span>            Integer purchaseQuantity <span style=color:#f92672>=</span> product.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;purchase-quantity&#34;</span>);
</span></span><span style=display:flex><span>            Integer productId <span style=color:#f92672>=</span> product.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;product-id&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 组装VideoOrder</span>
</span></span><span style=display:flex><span>            ProductOrder productOrder <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ProductOrder();
</span></span><span style=display:flex><span>            productOrder.<span style=color:#a6e22e>setFkProductId</span>(productId);
</span></span><span style=display:flex><span>            productOrder.<span style=color:#a6e22e>setFkOrderId</span>(order.<span style=color:#a6e22e>getOrderId</span>());
</span></span><span style=display:flex><span>            productOrder.<span style=color:#a6e22e>setPurchaseQuantity</span>(purchaseQuantity);
</span></span><span style=display:flex><span>            productOrder.<span style=color:#a6e22e>setCreateTime</span>(<span style=color:#66d9ef>new</span> Date());
</span></span><span style=display:flex><span>            productOrder.<span style=color:#a6e22e>setLastModify</span>(<span style=color:#66d9ef>new</span> Date());
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 调用数据接口循环添加ProductOrder表记录，若添加失败则抛出异常触发回滚</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (productOrderMapper.<span style=color:#a6e22e>insert</span>(productOrder) <span style=color:#f92672>&lt;=</span> 0) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException(<span style=color:#e6db74>&#34;ProductOrder表添加异常&#34;</span>);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> 1;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=6><li>开发控制方法 <code>OrderController -> insert()</code></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.controller;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RequestMapping</span>(<span style=color:#e6db74>&#34;/order&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrderController</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Resource</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> OrderService orderService;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;/insert&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Result <span style=color:#a6e22e>insert</span>(<span style=color:#a6e22e>@RequestBody</span> OrderInsertParam orderInsertParam) {
</span></span><span style=display:flex><span>        log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;请求: 添加一条订单记录，入参: {}&#34;</span>, orderInsertParam);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> result <span style=color:#f92672>=</span> orderService.<span style=color:#a6e22e>insert</span>(orderInsertParam);
</span></span><span style=display:flex><span>        log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;响应: 添加一条订单记录，结果: {}&#34;</span>, result);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Result.<span style=color:#a6e22e>dml</span>(result <span style=color:#f92672>&gt;</span> 0);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=7><li>访问控制方法 <code>OrderController -> insert()</code></li></ol><pre tabindex=0><code>## 添加一条商品记录
POST http://localhost:8020/api/v1/order/insert
Content-Type: application/json

{
  &#34;user-id&#34;: 2,
  &#34;order-info&#34;: &#34;测试信息&#34;,
  &#34;total-fee&#34;: 123.45,
  &#34;products&#34;: [
      {&#34;product-id&#34;: 2, &#34;purchase-quantity&#34;: 5},
      {&#34;product-id&#34;: 3, &#34;purchase-quantity&#34;: 2}
  ]
}
</code></pre></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div></main><footer class=footer><span>&copy; 2024 The Marauders</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>