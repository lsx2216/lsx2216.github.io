<!doctype html><html lang=en><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>JB5-1-注册中心</title>
<meta name=description content="[!NOTE] Java道经第5卷 - 第1阶 - 注册中心 v5-1-alibaba-nacos
S01. 微服务架构 E01. 微服务演变历史 心法：单体应用 -&amp;gt; 垂直应用 -&amp;gt; 分布式应用 -&amp;gt; SOA应用 -&amp;gt; 微服务应用
1. 单体应用架构 心法：单体应用架构 Monolithic …"><meta name=keywords content='blog,lsx2216,hugo'><meta property="og:url" content="https://lsx2216.netlify.app/%E7%AC%AC5%E9%98%B6%E6%AE%B5-ALIBABA/JB5-1-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/JB5-1-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/"><meta property="og:type" content="website"><meta property="og:title" content="JB5-1-注册中心"><meta property="og:description" content="[!NOTE] Java道经第5卷 - 第1阶 - 注册中心 v5-1-alibaba-nacos
S01. 微服务架构 E01. 微服务演变历史 心法：单体应用 -&amp;gt; 垂直应用 -&amp;gt; 分布式应用 -&amp;gt; SOA应用 -&amp;gt; 微服务应用
1. 单体应用架构 心法：单体应用架构 Monolithic …"><meta property="og:image" content="https://lsx2216.netlify.app/assets/images/user.jpg"><meta property="og:image:secure_url" content="https://lsx2216.netlify.app/assets/images/user.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="JB5-1-注册中心"><meta name=twitter:description content="[!NOTE] Java道经第5卷 - 第1阶 - 注册中心 v5-1-alibaba-nacos
S01. 微服务架构 E01. 微服务演变历史 心法：单体应用 -&amp;gt; 垂直应用 -&amp;gt; 分布式应用 -&amp;gt; SOA应用 -&amp;gt; 微服务应用
1. 单体应用架构 心法：单体应用架构 Monolithic …"><meta property="twitter:domain" content="https://lsx2216.netlify.app/%E7%AC%AC5%E9%98%B6%E6%AE%B5-ALIBABA/JB5-1-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/JB5-1-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/"><meta property="twitter:url" content="https://lsx2216.netlify.app/%E7%AC%AC5%E9%98%B6%E6%AE%B5-ALIBABA/JB5-1-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/JB5-1-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/"><meta name=twitter:image content="https://lsx2216.netlify.app/assets/images/user.jpg"><link rel=canonical href=https://lsx2216.netlify.app/%E7%AC%AC5%E9%98%B6%E6%AE%B5-ALIBABA/JB5-1-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/JB5-1-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.3eb19cb61dde9e37b9522867f3e024aeb68e26ab8e03252e46e365abcb19acf7.js integrity="sha256-PrGcth3enje5Uihn8+AkrraOJquOAyUuRuNlq8sZrPc="></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css integrity=sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js integrity=sha384-X/XCfMm41VSsqRNQgDerQczD69XqmjOOOwYQvr/uuC+j4OPoNhVgjdGFwhvN02Ja crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script>    <link rel="shortcut icon" href="/assets/images/user.jpg" type="image/x-icon">
</head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://lsx2216.netlify.app/><img src=/assets/images/user.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://lsx2216.netlify.app/>lsx2216</a></div><div class=nav-links><div class=nav-link><a href=https://lsx2216.netlify.app/ aria-label><span data-feather=home></span> Home</a></div><div class=nav-link><a href=https://lsx2216.netlify.app/projects/ aria-label><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://github.com aria-label=github><span data-feather=github></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://lsx2216.netlify.app/><span data-feather=home></span> Home</a></li><li class=nav-item><a href=https://lsx2216.netlify.app/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://github.com><span data-feather=github></span></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>JB5-1-注册中心</h1></div><div class=post-content><blockquote><p>[!NOTE] Java道经第5卷 - 第1阶 - 注册中心
v5-1-alibaba-nacos</p></blockquote><h1 id=s01-微服务架构>S01. 微服务架构</h1><h2 id=e01-微服务演变历史>E01. 微服务演变历史</h2><blockquote><p>心法：单体应用 -> 垂直应用 -> 分布式应用 -> SOA应用 -> 微服务应用</p></blockquote><h3 id=1-单体应用架构>1. 单体应用架构</h3><blockquote><p>心法：单体应用架构 <code>Monolithic Architecture</code>，也被各种微服务书籍戏称为巨石架构</p></blockquote><ul><li>单体架构中，用户界面、业务代码和数据库调用等所有内容都包含在同一个Jar包中。</li></ul><p>![[第5阶段-ALIBABA/JB5-1-注册中心/draw/单体应用架构.md#^group=ul-mRDUj0YHYd0uIlWm3o|100%]]</p><p><img src=/%E7%AC%AC5%E9%98%B6%E6%AE%B5-ALIBABA/JB5-1-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/image/%E5%8D%95%E4%BD%93%E6%9C%8D%E5%8A%A1%E6%8A%80%E6%9C%AF%E6%A0%88.png alt></p><table><thead><tr><th>项</th><th>描述</th></tr></thead><tbody><tr><td>优点</td><td>架构简单，项目开发，部署和维护的成本低，适用于小型项目。</td></tr><tr><td>缺点</td><td>1. 功能耦合度极高，单点容错率低。2. 水平扩展性极差，无法单独对某个热点业务进行集群。3. 随着时间的推移，它的代码量将变得越来越庞大，越来越难以管理。4. 任何修改都必须要重新部署整个项目。</td></tr></tbody></table><h3 id=2-垂直应用架构>2. 垂直应用架构</h3><blockquote><p>心法：垂直应用架构 <code>Vertical Architecture</code></p></blockquote><ul><li>垂直应用架构就是按照按功能，将单体应用拆分为N个互不相干的应用，以此来提升整体的性能。</li></ul><p>![[第5阶段-ALIBABA/JB5-1-注册中心/draw/垂直应用架构.md#^group=62odhNUXys5Lfg9Onavlv|100%]]</p><table><thead><tr><th>项</th><th>描述</th></tr></thead><tbody><tr><td>优点</td><td>1. 各个应用分担了整体访问的流量，解决了一部分并发问题，提高了性能。2. 高流量时，仅针对某个热点服务进行集群即可，不用整个项目集群，提高了扩展性。3. 一个应用出问题不会影响到其他应用，提高容错率。</td></tr><tr><td>缺点</td><td>1. 应用之间相互独立，无法相互调用。2. 应用之间难免会产生大量的重复代码，后期维护困难，一改全改。</td></tr></tbody></table><h3 id=3-分布式应用架构>3. 分布式应用架构</h3><blockquote><p>心法：分布式应用架构 <code>Vertical Architecture</code></p></blockquote><ul><li>分布式应用架构在垂直应用架构的基础上，将重复的代码全部抽取到公共服务层，供其他应用来调用。</li></ul><p>![[第5阶段-ALIBABA/JB5-1-注册中心/draw/分布式应用架构.md#^group=OwEfxlEpNW_t4A2PCOZO2|100%]]</p><table><thead><tr><th>项</th><th>描述</th></tr></thead><tbody><tr><td>优点</td><td>引入公共服务层可以提高整体心痛的代码重用性。</td></tr><tr><td>缺点</td><td>应用之间调用关系复杂，耦合度变高，维护困难。</td></tr></tbody></table><h3 id=4-soa应用架构>4. SOA应用架构</h3><blockquote><p>心法：SOA应用架构 <code>Service-Oriented Architecture</code></p></blockquote><ul><li>SOA应用架构在分布式架构基础上，引入了注册中心的概念对集群进行管理，解决了应用之间的复杂调用问题。</li></ul><p>![[第5阶段-ALIBABA/JB5-1-注册中心/draw/SOA应用架构.md#^group=OwEfxlEpNW_t4A2PCOZO2|100%]]</p><table><thead><tr><th>项</th><th>描述</th></tr></thead><tbody><tr><td>优点</td><td>通过注册中心组件，解决了分布式架构中各个应用之间的复杂调用问题。</td></tr><tr><td>缺点</td><td>1. 缺少服务治理的能力。2. 相比微服务，SOA应用仍然显得有些庞大。</td></tr></tbody></table><h3 id=5-微服务应用架构>5. 微服务应用架构</h3><blockquote><p>心法：微服务将服务拆分的更彻底，服务之间采用Restful等协议相互调用</p></blockquote><ul><li>这么多小服务，如何管理他们？（服务治理，注册中心）</li><li>这么多小服务，他们之间如何通讯？（restful、rpc、消息队列）</li><li>这么多小服务，客户端怎么访问他们？（网关）</li><li>这么多小服务，一旦出现问题了，应该如何自处理？（服务容错）</li><li>这么多小服务，一旦出现问题了，应该如何排错? （链路追踪）</li></ul><p>![[第5阶段-ALIBABA/JB5-1-注册中心/draw/微服务架构.md#^group=mgN85whS3rnxegXSy27Oz|100%]]</p><table><thead><tr><th>项</th><th>描述</th></tr></thead><tbody><tr><td>优点</td><td>微服务独立打包，部署和升级，每个微服务任务划分清晰，利于扩展。</td></tr><tr><td>缺点</td><td>技术成本高，如限流，容错，分布式事务等。</td></tr></tbody></table><h2 id=e02-分布式架构特性>E02. 分布式架构特性</h2><blockquote><p>心法: 分布式CAP特性</p></blockquote><ul><li>一个分布式系统，要么满足 <code>CP</code>，要么满足 <code>AP</code>，无法做到 <code>CAP</code> 全满足。</li><li>微服务架构可视为 &ldquo;拆&rdquo; 得更碎的分布式架构，所以也满足 <code>CAP</code> 特性。</li></ul><table><thead><tr><th>代号</th><th>英文</th><th>描述</th></tr></thead><tbody><tr><td>C</td><td><code>Consistency</code></td><td>一致性</td></tr><tr><td>A</td><td><code>Availability</code></td><td>可用性</td></tr><tr><td>P</td><td><code>Partition-tolerance</code></td><td>分区容错性</td></tr></tbody></table><h3 id=1-分区容错性>1. 分区容错性</h3><blockquote><p>心法: 分区容错性（P）：即使某节点崩溃导致所在分区失联，整体也要正常对外提供服务</p></blockquote><ul><li>如何提高分区容错性：<ul><li>扩容节点数量，节点数量越高，分区容错性越高。</li></ul></li><li>分布式架构和微服务架构都必须优先保证分区容错性。</li></ul><h3 id=2-数据一致性>2. 数据一致性</h3><blockquote><p>心法: 数据一致性（C）：节点之间的数据保持强一致性</p></blockquote><ul><li>如何提高数据一致性：<ul><li>在响应结果之前先同步节点数据，避免响应错误结果。</li></ul></li><li>同步数据的过程很耗时，很可能会因为响应超时而报错，此时将无法满足可用性。</li></ul><h3 id=3-服务可用性>3. 服务可用性</h3><blockquote><p>心法: 服务可用性（A）：非故障节点接收到的每个请求都能及时响应</p></blockquote><ul><li>如何提高服务可用性：<ul><li>异步执行节点之间的同步数据过程，避免访问超时报错。</li></ul></li><li>异步操作可能会导致某节点响应的数据和其他节点对应的数据不一致，此时将无法满足一致性。</li></ul><h1 id=s02-注册中心nacos>S02. 注册中心Nacos</h1><blockquote><p>心法: 注册中心</p></blockquote><ul><li>注册中心用于实现服务治理，即实现各个微服务的自动化注册与发现。</li></ul><table><thead><tr><th>注册中心常见产品</th><th>描述</th></tr></thead><tbody><tr><td><code>Zookeeper</code></td><td>分布式服务框架，来自ApaSe，主要用于分布式架构的应用。</td></tr><tr><td><code>Eureka</code></td><td>来自于SpringCloud-Netflix，主要作用就是做服务注册和发现，目前已经闭源。</td></tr><tr><td><code>Consul</code></td><td>基于GO语言开发的开源工具，主要面向分布式架构的应用。</td></tr><tr><td><code>Nacos</code></td><td>来自于SpringCloudAlibaba，更易于构建云原生应用的动态服务发现，配置管理和服务管理平台。</td></tr></tbody></table><h2 id=e01-基础概念入门>E01. 基础概念入门</h2><blockquote><p>心法: Nacos 全称 <code>NAme COntrol Syste</code></p></blockquote><ul><li>Nacos是阿里巴巴开源的一款工具，通过服务注册与发现、配置管理、健康检查等机制，实现了一个完整的服务治理平台，帮助开发者构建和管理微服务架构的应用。</li></ul><table><thead><tr><th>Nacos功能</th><th>描述</th></tr></thead><tbody><tr><td>服务注册</td><td>服务可以将自己的位置和状态等信息注册到Nacos的 <code>服务列表</code> 中</td></tr><tr><td>服务发现</td><td>服务可以基于 <code>RESTFul, gRPC</code> 等多种方式在Nacos <code>服务列表</code> 中发现其他服务</td></tr><tr><td>服务剔除</td><td>Nacos可以将出问题的服务自动剔除到 <code>服务列表</code> 之外，使其不会被调用到</td></tr><tr><td>配置管理</td><td>Nacos可以管理服务的配置信息，并支持动态配置刷新</td></tr><tr><td>健康检查</td><td>Nacos会通过 <code>HTTP, TCP</code> 等方式，定期检查 <code>服务列表</code> 中实例的健康状态</td></tr><tr><td>集群管理</td><td>Nacos支持集群部署，集群节点之间会进行数据同步，保持数据的一致性</td></tr><tr><td>持久化存储</td><td>Nacos支持将数据持久化到 <code>MySQL, SQLite, Redis</code> 等数据仓库中</td></tr><tr><td>事件监听</td><td>Nacos可以监听服务注册、注销、配置变更等事件，并进行相应的处理</td></tr></tbody></table><h3 id=1-临时服务>1. 临时服务</h3><blockquote><p>心法: Nacos临时服务</p></blockquote><ul><li>临时服务在死亡时，有可能会被Nacos从 <code>服务列表</code> 中删除。</li><li>临时服务对应 <code>cloud.nacos.discovery.ephemeral=true</code> 配置。</li><li>每个App服务都默认为临时服务。</li></ul><h3 id=2-持久服务>2. 持久服务</h3><blockquote><p>心法: Nacos持久服务</p></blockquote><ul><li>持久服务即使死亡也不会被Nacos从 <code>服务列表</code> 中删除。</li><li>持久服务对应 <code>cloud.nacos.discovery.ephemeral=false</code> 配置。</li></ul><h3 id=3-心跳检测>3. 心跳检测</h3><blockquote><p>心法: Nacos心跳检测机制流程</p></blockquote><ol><li>App服务启动后，默认每隔5秒会向Nacos发送一个 <code>心跳包</code>:<ol><li>默认 <code>心跳包</code> 内会包含当前App服务的 <code>IP/端口</code> 等基本信息。</li></ol></li><li>若Nacos在15秒内，接收到了App服务的 <code>心跳包</code>:<ol><li>若该App服务不在 <code>服务列表</code> 中，就将该App服务注册登记到 <code>服务列表</code> 中。</li><li>该App服务已在 <code>服务列表</code> 中，就将该App服务标记为健康状态。</li><li>该时间阈值可自定义设置，默认15秒。</li></ol></li><li>若Nacos在15秒内，没有接收到App服务的 <code>心跳包</code>:<ol><li>将App服务标记为不健康状态。</li><li>该时间阈值可自定义设置，默认15秒。</li></ol></li><li>若Nacos在30秒内，没有接收到App服务的 <code>心跳包</code>:<ol><li>将App服务从 <code>服务列表</code> 中删除，持久服务除外。</li><li>该时间阈值可自定义设置，默认30秒。</li></ol></li></ol><h2 id=e02-单机容器搭建>E02. 单机容器搭建</h2><blockquote><p>武技: 在Docker中搭建Nacos单机容器</p></blockquote><h3 id=1-创建运行容器>1. 创建运行容器</h3><ul><li>Nacos2.0版本新增了gRPC的通信方式，需要再多开放两个端口。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 拉取镜像（二选一）</span>
</span></span><span style=display:flex><span>docker pull nacos/nacos-server:2.0.3;
</span></span><span style=display:flex><span>docker pull registry.cn-hangzhou.aliyuncs.com/lsx/nacos:2.0.3;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 创建并运行Nacos容器</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 参数 `-e MODE=standalone`: 以单机模式启动，2.0.3版本默认使用集群模式启动</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Nacos2.0版本新增了gRPC的通信方式，需要再多开放两个端口</span>
</span></span><span style=display:flex><span>docker run --name nacos -d -p 8848:8848 -p 9848:9848 -p 9849:9849 --network my-net <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -e MODE<span style=color:#f92672>=</span>standalone <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    registry.cn-hangzhou.aliyuncs.com/lsx/nacos:2.0.3;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查看Nacos容器</span>
</span></span><span style=display:flex><span>docker ps -a --format <span style=color:#e6db74>&#34;table {{.ID}}\t{{.Names}}\t{{.Ports}}&#34;</span>
</span></span><span style=display:flex><span>docker logs nacos --tail <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 永久开放Nacos容器服务端口，Nacos2+版本中的客户端连接端口和服务端同步端口</span>
</span></span><span style=display:flex><span>firewall-cmd --add-port<span style=color:#f92672>=</span>8848/tcp --permanent
</span></span><span style=display:flex><span>firewall-cmd --add-port<span style=color:#f92672>=</span>9848/tcp --permanent
</span></span><span style=display:flex><span>firewall-cmd --add-port<span style=color:#f92672>=</span>9849/tcp --permanent
</span></span><span style=display:flex><span>firewall-cmd --reload
</span></span></code></pre></div><h3 id=2-访问单机容器>2. 访问单机容器</h3><ul><li>在Window主机访问 <a href=http://192.168.40.77:8848/nacos>Nacos单机容器</a>：使用 <code>nacos/nacos</code> 账号登录。</li></ul><h2 id=e03-集群容器搭建>E03. 集群容器搭建</h2><blockquote><p>武技: 在Docker中搭建Nacos集群容器</p></blockquote><h3 id=1-创建数据库表>1. 创建数据库表</h3><ol><li>创建Nacos集群相关的数据库实例:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>database</span> nacos character <span style=color:#66d9ef>set</span> utf8mb4;
</span></span><span style=display:flex><span>use nacos;
</span></span></code></pre></div><ol start=2><li>创建 <a href=res/Nacos%E9%9B%86%E7%BE%A4SQL.md>Nacos集群相关的12张数据库表</a><ol><li>SQL文件来自于 <a href=https://github.com/alibaba/nacos/releases/tag/2.0.3>Nacos官网</a>的 <code>nacos-server.zip/conf/nacos-mysql.sql</code> 文件。</li></ol></li></ol><h3 id=2-创建运行容器>2. 创建运行容器</h3><ol><li>创建并运行集群节点容器 <code>nacos8858</code>：</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 创建并运行Nacos8858节点容器</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 参数 `-e PREFER_HOST_MODE=ip`: 在容器内部解析主机名时，优先使用 IP 地址而不是 DNS</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 参数 `-e MODE=cluster`: 以集群模式启动，高版本默认使用cluster模式</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 参数 `-e NACOS_SERVERS=&#34;192.168.40.77:8858 192.168.40.77:8868&#34;`: 集群列表</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 参数 `-e SPRING_DATASOURCE_PLATFORM=mysql`: 数据源DB平台</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 参数 `-e MYSQL_SERVICE_HOST=mysql`: mysql主节点地址，建议直接使用节点名称</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 参数 `-e MYSQL_SERVICE_PORT=3306`:  mysql主节点端口，默认3306</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 参数 `-e MYSQL_SERVICE_DB_NAME=nacos`: mysql主节点数据库名称</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 参数 `-e MYSQL_SERVICE_USER=lsx`: mysql主节点账号</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 参数 `-e MYSQL_SERVICE_PASSWORD=lsx`: mysql主节点密码</span>
</span></span><span style=display:flex><span>docker run --name nacos8858 -d -p 8858:8848 -p 9858:9848 -p 9859:9849 --network my-net <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e PREFER_HOST_MODE<span style=color:#f92672>=</span>ip <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e MODE<span style=color:#f92672>=</span>cluster <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e NACOS_SERVERS<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;192.168.40.77:8858 192.168.40.77:8868&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e SPRING_DATASOURCE_PLATFORM<span style=color:#f92672>=</span>mysql <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e MYSQL_SERVICE_HOST<span style=color:#f92672>=</span>mysql <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e MYSQL_SERVICE_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>3306</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e MYSQL_SERVICE_DB_NAME<span style=color:#f92672>=</span>nacos <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e MYSQL_SERVICE_USER<span style=color:#f92672>=</span>lsx <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e MYSQL_SERVICE_PASSWORD<span style=color:#f92672>=</span>lsx <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  registry.cn-hangzhou.aliyuncs.com/lsx/nacos:2.0.3;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查看节点容器</span>
</span></span><span style=display:flex><span>docker ps --format <span style=color:#e6db74>&#34;{{.ID}}\t{{.Names}}\t{{.Ports}}&#34;</span>
</span></span><span style=display:flex><span>docker logs nacos8858 --tail <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 永久开放端口，Nacos2+版本中的客户端连接端口和服务端同步端口</span>
</span></span><span style=display:flex><span>firewall-cmd --add-port<span style=color:#f92672>=</span>8858/tcp --permanent
</span></span><span style=display:flex><span>firewall-cmd --add-port<span style=color:#f92672>=</span>9858/tcp --permanent
</span></span><span style=display:flex><span>firewall-cmd --add-port<span style=color:#f92672>=</span>9859/tcp --permanent
</span></span><span style=display:flex><span>firewall-cmd --reload
</span></span></code></pre></div><ol start=2><li>创建并运行集群节点容器 <code>nacos8868</code>：</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 创建并运行Nacos8868节点容器</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 参数同上</span>
</span></span><span style=display:flex><span>docker run --name nacos8868 -d -p 8868:8848 -p 9868:9848 -p 9869:9849 --network my-net <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e PREFER_HOST_MODE<span style=color:#f92672>=</span>ip <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e MODE<span style=color:#f92672>=</span>cluster <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e NACOS_SERVERS<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;192.168.40.77:8858 192.168.40.77:8868&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e SPRING_DATASOURCE_PLATFORM<span style=color:#f92672>=</span>mysql <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e MYSQL_SERVICE_HOST<span style=color:#f92672>=</span>mysql <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e MYSQL_SERVICE_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>3306</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e MYSQL_SERVICE_DB_NAME<span style=color:#f92672>=</span>nacos <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e MYSQL_SERVICE_USER<span style=color:#f92672>=</span>lsx <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e MYSQL_SERVICE_PASSWORD<span style=color:#f92672>=</span>lsx <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  registry.cn-hangzhou.aliyuncs.com/lsx/nacos:2.0.3;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查看节点容器</span>
</span></span><span style=display:flex><span>docker ps --format <span style=color:#e6db74>&#34;{{.ID}}\t{{.Names}}\t{{.Ports}}&#34;</span>
</span></span><span style=display:flex><span>docker logs nacos8868 --tail <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 永久开放端口，Nacos2+版本中的客户端连接端口和服务端同步端口</span>
</span></span><span style=display:flex><span>firewall-cmd --add-port<span style=color:#f92672>=</span>8868/tcp --permanent
</span></span><span style=display:flex><span>firewall-cmd --add-port<span style=color:#f92672>=</span>9868/tcp --permanent
</span></span><span style=display:flex><span>firewall-cmd --add-port<span style=color:#f92672>=</span>9869/tcp --permanent
</span></span><span style=display:flex><span>firewall-cmd --reload
</span></span></code></pre></div><h3 id=3-访问集群容器>3. 访问集群容器</h3><ol><li>在Window主机访问 <a href=http://192.168.40.77:8858/nacos>Nacos8858</a> 容器：使用nacos/nacos登录，查看管控台集群列表。</li><li>在Window主机访问 <a href=http://192.168.40.77:8858/nacos>Nacos8868</a> 容器：使用nacos/nacos登录，查看管控台集群列表。</li><li>在任意节点的Nacos管控台中添加一个测试配置文件:</li></ol><p><img src=/%E7%AC%AC5%E9%98%B6%E6%AE%B5-ALIBABA/JB5-1-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/image/cb3a0cbee080e64197a57f4e30f8c044.png alt=截图></p><ol start=4><li>查看nacos数据库中的 <code>config_info</code> 表，发现数据则表示DB持久化成功:</li></ol><p><img src=/%E7%AC%AC5%E9%98%B6%E6%AE%B5-ALIBABA/JB5-1-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/image/d92742fb765c2930b693d2a8a2468694.png alt=截图></p><h2 id=e04-nacos负载均衡>E04. Nacos负载均衡</h2><blockquote><p>心法: Nacos负载均衡</p></blockquote><ul><li>Nacos集群没有自集成负载均衡效果，推荐借助Nginx搭建负载均衡效果。</li></ul><blockquote><p>武技: 使用Nginx搭建Nacos集群的负载均衡效果</p></blockquote><h3 id=1-创建相关目录>1. 创建相关目录</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 创建Nginx相关目录</span>
</span></span><span style=display:flex><span>mkdir -p /opt/nginx-nacos/conf;
</span></span><span style=display:flex><span>mkdir -p /opt/nginx-nacos/logs;
</span></span><span style=display:flex><span>chmod -R <span style=color:#ae81ff>777</span> /opt/nginx-nacos;
</span></span></code></pre></div><h3 id=2-开发配置文件>2. 开发配置文件</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 拉取镜像（二选一）</span>
</span></span><span style=display:flex><span>docker pull nginx:1.25.2;
</span></span><span style=display:flex><span>docker pull registry.cn-hangzhou.aliyuncs.com/lsx/nginx:1.25.2;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 创建并运行临时的容器: 该容器仅用于拷贝配置文件，用完即删</span>
</span></span><span style=display:flex><span>docker run -d --name tmp registry.cn-hangzhou.aliyuncs.com/lsx/nginx:1.25.2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 拷贝主配文件，子配置目录和HTML目录到虚拟机</span>
</span></span><span style=display:flex><span>docker cp tmp:/etc/nginx/nginx.conf /opt/nginx-nacos/conf/;
</span></span><span style=display:flex><span>docker cp tmp:/etc/nginx/conf.d /opt/nginx-nacos/;
</span></span><span style=display:flex><span>docker cp tmp:/usr/share/nginx/html /opt/nginx-nacos/;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 删除临时容器，为后续真正的容器让出端口</span>
</span></span><span style=display:flex><span>docker rm -f tmp
</span></span></code></pre></div><h3 id=3-创建运行容器>3. 创建运行容器</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 创建并运行Nginx容器</span>
</span></span><span style=display:flex><span>docker run --name nginx-nacos -dp 1080:80 --network my-net <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>      -v /opt/nginx-nacos/logs:/var/log/nginx <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>      -v /opt/nginx-nacos/conf/nginx.conf:/etc/nginx/nginx.conf <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>      -v /opt/nginx-nacos/conf.d:/etc/nginx/conf.d <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>      -v /opt/nginx-nacos/html:/usr/share/nginx/html <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>      registry.cn-hangzhou.aliyuncs.com/lsx/nginx:1.25.2;
</span></span><span style=display:flex><span>   
</span></span><span style=display:flex><span><span style=color:#75715e># 查看Nginx容器</span>
</span></span><span style=display:flex><span>docker ps --format <span style=color:#e6db74>&#34;{{.ID}}\t{{.Names}}\t{{.Ports}}&#34;</span>
</span></span><span style=display:flex><span>docker logs nginx --tail <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 进入容器的内部并查看Nginx版本</span>
</span></span><span style=display:flex><span>docker exec -it nginx bash
</span></span><span style=display:flex><span>nginx -version
</span></span></code></pre></div><h3 id=4-配置负载均衡>4. 配置负载均衡</h3><ol><li>在Nginx主配置文件的 <code>http{}</code> 块中添加负载均衡器：</li></ol><p><code>/opt/nginx-nacos/conf/nginx.conf -> http{ }</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#75715e># 负载均衡器默认使用轮询策略</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>upstream</span> <span style=color:#e6db74>nacosList {</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>server</span> <span style=color:#e6db74>192.168.40.77:8858 weight=1;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>server</span> <span style=color:#e6db74>192.168.40.77:8868 weight=1;</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>}</span>
</span></span></code></pre></div><ol start=2><li>开发子配置文件：</li></ol><p><code>/opt/nginx-nacos/conf.d/default.conf</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#a6e22e>server</span> <span style=color:#e6db74>{  </span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>listen</span>       <span style=color:#e6db74>80;  </span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>server_name</span>  <span style=color:#e6db74>localhost;  </span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>  </span>
</span></span><span style=display:flex><span>	<span style=color:#75715e># 在 server{} 中开发 location: 建议直接将 `location / {}` 替换掉  </span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>location</span> <span style=color:#e6db74>/nacos {  </span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>proxy_pass</span> <span style=color:#e6db74>http://nacosList/nacos;  </span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>}</span>  
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>}</span>
</span></span></code></pre></div><ol start=3><li>重启Nginx服务使得配置生效：</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker restart nginx-nacos
</span></span></code></pre></div><ol start=4><li>访问Nacos在Nginx中的 <a href=http://192.168.40.77:1080/nacos>代理地址</a>:<ol><li>停止 <code>nacos8858</code> 服务后，继续访问，发现仍可以访问成功，表示Nginx负载均衡成功。</li></ol></li></ol><h2 id=e05-nacos项目整合>E05. Nacos项目整合</h2><blockquote><p>心法：SpringBoot, SpringCloud, SpringCloudAlibaba 版本对照图</p></blockquote><table><thead><tr><th>SpringBoot版本</th><th>SpringCloud版本</th><th>SpringCloudAlibaba版本</th></tr></thead><tbody><tr><td><code>2.3.12.RELEASE</code></td><td><code>Hoxton.SR12</code></td><td><code>2.2.9.RELEASE*</code> 或 <code>2.2.8.RELEASE*</code> 或 <code>2.2.7.RELEASE*</code></td></tr><tr><td><code>2.3.2.RELEASE</code></td><td><code>Hoxton.SR9</code></td><td><code>2.2.6.RELEASE</code></td></tr><tr><td><code>2.2.5.RELEASE</code></td><td><code>Hoxton.SR3</code></td><td><code>2.2.1.RELEASE</code></td></tr><tr><td><code>2.2.X.RELEASE</code></td><td><code>Hoxton.RELEASE</code></td><td><code>2.2.0.RELEASE</code></td></tr><tr><td><code>2.1.13.RELEASE</code></td><td><code>GREENWICH.SR6</code></td><td><code>2.1.4.RELEASE</code></td></tr><tr><td><code>2.1.X.RELEASE</code></td><td><code>GREENWICH</code></td><td><code>2.1.2.RELEASE</code></td></tr></tbody></table><blockquote><p>武技: 创建 <code>v5-1-alibaba-nacos</code> 子项目，以及 <code>nacos-order-1</code> 和 <code>nacos-order-2</code> 两个子项目</p></blockquote><h3 id=1-引入三方依赖>1. 引入三方依赖</h3><ol><li>在父项目中锁定版本：</li></ol><p><code>pom.xml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;spring-boot-version&gt;</span>2.3.12.RELEASE<span style=color:#f92672>&lt;/spring-boot-version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;spring-cloud-version&gt;</span>Hoxton.SR12<span style=color:#f92672>&lt;/spring-cloud-version&gt;</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;spring-cloud-alibaba-version&gt;</span>2.2.9.RELEASE<span style=color:#f92672>&lt;/spring-cloud-alibaba-version&gt;</span>
</span></span></code></pre></div><ol start=2><li>在父项目中管理依赖：</li></ol><p><code>pom.xml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-boot-starter-parent--&gt;</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-parent<span style=color:#f92672>&lt;/artifactId&gt;</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>${spring-boot-version}<span style=color:#f92672>&lt;/version&gt;</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;type&gt;</span>pom<span style=color:#f92672>&lt;/type&gt;</span>  
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;scope&gt;</span>import<span style=color:#f92672>&lt;/scope&gt;</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-cloud-dependencies--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.cloud<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;artifactId&gt;</span>spring-cloud-dependencies<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;version&gt;</span>${spring-cloud-version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;type&gt;</span>pom<span style=color:#f92672>&lt;/type&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;scope&gt;</span>import<span style=color:#f92672>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-cloud-alibaba-dependencies--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;groupId&gt;</span>com.alibaba.cloud<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;artifactId&gt;</span>spring-cloud-alibaba-dependencies<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;version&gt;</span>${spring-cloud-alibaba-version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;type&gt;</span>pom<span style=color:#f92672>&lt;/type&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;scope&gt;</span>import<span style=color:#f92672>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start=3><li>分别在两个子项目中引入依赖:</li></ol><p><code>pom.xml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-boot-starter-web--&gt;</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-web<span style=color:#f92672>&lt;/artifactId&gt;</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>  
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-cloud-starter-alibaba-nacos-discovery--&gt;</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>com.alibaba.cloud<span style=color:#f92672>&lt;/groupId&gt;</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span style=color:#f92672>&lt;/artifactId&gt;</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><h3 id=2-开发启动类>2. 开发启动类</h3><ol><li>在 <code>nacos-order-1</code> 子项目中开发启动类：</li></ol><p><code>com.lsx.NacosOrder1App</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootApplication</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NacosOrder1App</span> {  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {  
</span></span><span style=display:flex><span>        SpringApplication.<span style=color:#a6e22e>run</span>(NacosOrder1App.<span style=color:#a6e22e>class</span>, args);  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=2><li>在 <code>nacos-order-2</code> 子项目中开发启动类：</li></ol><p><code>com.lsx.NacosOrder2App</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootApplication</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NacosOrder2App</span> {  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {  
</span></span><span style=display:flex><span>        SpringApplication.<span style=color:#a6e22e>run</span>(NacosOrder1App.<span style=color:#a6e22e>class</span>, args);  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-开发配置类>3. 开发配置类</h3><ol><li>分别在两个子项目中开发配置类:</li></ol><p><code>com.lsx.config.NacosConfig</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@EnableDiscoveryClient</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NacosConfig</span> {
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=4-开发主配项>4. 开发主配项</h3><ol><li>在 <code>nacos-order-1</code> 子项目中开发主配项：</li></ol><p><code>classpath:application.yml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>server</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>port</span>: <span style=color:#ae81ff>8071</span> <span style=color:#75715e># 端口号</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spring</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>application</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nacos-order</span> <span style=color:#75715e># 项目名称</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>cloud</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>nacos</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>discovery</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>server-addr</span>: <span style=color:#ae81ff>192.168.40.77</span>:<span style=color:#ae81ff>8848</span> <span style=color:#75715e># nacos地址</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>cluster-name</span>: <span style=color:#ae81ff>nacos-order-cluster</span> <span style=color:#75715e># 微服务集群名称</span>
</span></span></code></pre></div><ol start=2><li>在 <code>nacos-order-2</code> 子项目中开发主配项：</li></ol><p><code>classpath:application.yml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>server</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>port</span>: <span style=color:#ae81ff>8072</span> <span style=color:#75715e># 端口号</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spring</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>application</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nacos-order</span> <span style=color:#75715e># 项目名称</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>cloud</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>nacos</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>discovery</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>server-addr</span>: <span style=color:#ae81ff>192.168.40.77</span>:<span style=color:#ae81ff>8848</span> <span style=color:#75715e># nacos地址</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>cluster-name</span>: <span style=color:#ae81ff>nacos-order-cluster</span> <span style=color:#75715e># 微服务集群名称</span>
</span></span></code></pre></div><h3 id=5-开发控制器>5. 开发控制器</h3><ol><li>分别在两个子项目中开发控制器类:</li></ol><p><code>com.lsx.controller.OrderController</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RequestMapping</span>(<span style=color:#e6db74>&#34;/api/v1/order&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrderController</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/** 该接口用于获取Nacos中的服务实例 */</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> DiscoveryClient discoveryClient;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/getDiscoveryClientInfo&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>ServiceInstance<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getDiscoveryClientInfo</span>() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// 获取名称为 nacos-order 的全部服务实例</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> discoveryClient.<span style=color:#a6e22e>getInstances</span>(<span style=color:#e6db74>&#34;nacos-order&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=6-启动微服务>6. 启动微服务</h3><ul><li>启动项目，<a href=http://192.168.40.77:8848/nacos>访问Nacos</a>，在 <code>服务管理 -> 服务列表</code> 中观察微服务是否注册成功。</li><li><a href=http://localhost:8071/api/v1/order/getDiscoveryClientInfo>访问控制器接口</a>：查看实例信息。</li></ul></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div></main><footer class=footer><span>&copy; 2024 The Marauders</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>