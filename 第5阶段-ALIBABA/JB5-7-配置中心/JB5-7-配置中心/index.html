<!doctype html><html lang=en><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>JB5-7-配置中心</title>
<meta name=description content="[!NOTE] Java道经第5卷 - 第7阶 - 配置中心 v5-7-alibaba-nacosconfig
S01. NacosConfig概念入门 心法: 为何使用配置中心
传统微服务架构的配置文件缺点： 相对分散：在一个微服务架构下，配置文件分散在各个微服务中，不好统一配置和管理。 无法区分环境：微服务项目包含 …"><meta name=keywords content='blog,lsx2216,hugo'><meta property="og:url" content="https://lsx2216.netlify.app/%E7%AC%AC5%E9%98%B6%E6%AE%B5-ALIBABA/JB5-7-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/JB5-7-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/"><meta property="og:type" content="website"><meta property="og:title" content="JB5-7-配置中心"><meta property="og:description" content="[!NOTE] Java道经第5卷 - 第7阶 - 配置中心 v5-7-alibaba-nacosconfig
S01. NacosConfig概念入门 心法: 为何使用配置中心
传统微服务架构的配置文件缺点： 相对分散：在一个微服务架构下，配置文件分散在各个微服务中，不好统一配置和管理。 无法区分环境：微服务项目包含 …"><meta property="og:image" content="https://lsx2216.netlify.app/assets/images/user.jpg"><meta property="og:image:secure_url" content="https://lsx2216.netlify.app/assets/images/user.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="JB5-7-配置中心"><meta name=twitter:description content="[!NOTE] Java道经第5卷 - 第7阶 - 配置中心 v5-7-alibaba-nacosconfig
S01. NacosConfig概念入门 心法: 为何使用配置中心
传统微服务架构的配置文件缺点： 相对分散：在一个微服务架构下，配置文件分散在各个微服务中，不好统一配置和管理。 无法区分环境：微服务项目包含 …"><meta property="twitter:domain" content="https://lsx2216.netlify.app/%E7%AC%AC5%E9%98%B6%E6%AE%B5-ALIBABA/JB5-7-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/JB5-7-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/"><meta property="twitter:url" content="https://lsx2216.netlify.app/%E7%AC%AC5%E9%98%B6%E6%AE%B5-ALIBABA/JB5-7-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/JB5-7-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/"><meta name=twitter:image content="https://lsx2216.netlify.app/assets/images/user.jpg"><link rel=canonical href=https://lsx2216.netlify.app/%E7%AC%AC5%E9%98%B6%E6%AE%B5-ALIBABA/JB5-7-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/JB5-7-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.3eb19cb61dde9e37b9522867f3e024aeb68e26ab8e03252e46e365abcb19acf7.js integrity="sha256-PrGcth3enje5Uihn8+AkrraOJquOAyUuRuNlq8sZrPc="></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css integrity=sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js integrity=sha384-X/XCfMm41VSsqRNQgDerQczD69XqmjOOOwYQvr/uuC+j4OPoNhVgjdGFwhvN02Ja crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script>    <link rel="shortcut icon" href="/assets/images/user.jpg" type="image/x-icon">
</head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://lsx2216.netlify.app/><img src=/assets/images/user.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://lsx2216.netlify.app/>lsx2216</a></div><div class=nav-links><div class=nav-link><a href=https://lsx2216.netlify.app/ aria-label><span data-feather=home></span> Home</a></div><div class=nav-link><a href=https://lsx2216.netlify.app/projects/ aria-label><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://github.com aria-label=github><span data-feather=github></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://lsx2216.netlify.app/><span data-feather=home></span> Home</a></li><li class=nav-item><a href=https://lsx2216.netlify.app/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://github.com><span data-feather=github></span></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>JB5-7-配置中心</h1></div><div class=post-content><blockquote><p>[!NOTE] Java道经第5卷 - 第7阶 - 配置中心
v5-7-alibaba-nacosconfig</p></blockquote><h1 id=s01-nacosconfig概念入门>S01. NacosConfig概念入门</h1><blockquote><p>心法: 为何使用配置中心</p></blockquote><ul><li>传统微服务架构的配置文件缺点：<ul><li>相对分散：在一个微服务架构下，配置文件分散在各个微服务中，不好统一配置和管理。</li><li>无法区分环境：微服务项目包含测试，开发，生产等多种不同配置的环境，需要分别手动更新维护，很麻烦。</li><li>无法实时更新：修改配置后，必须重启服务才能使配置生效。</li></ul></li><li>引入配置中心组件之后：<ul><li>项目中各种配置全部都放到一个集中的地方进行统一管理，并提供一套标准的接口。</li><li>当各个服务需要获取配置的时候，就来配置中心的接口拉取自己的配置。</li><li>当配置中心中的各种参数有更新的时候，也能通知到各个服务实时的过来同步最新的信息，使之动态更新。</li></ul></li></ul><table><thead><tr><th>常见配置中心产品</th><th>描述</th></tr></thead><tbody><tr><td><code>Apollo</code></td><td>携程开源，支持实时更新，灰度发布，能对所有的配置进行版本管理、操作审计等功能</td></tr><tr><td><code>Disconf</code></td><td>百度开源，基于Zookeeper来实现配置变更后实时通知和生效</td></tr><tr><td><code>SpringCloudConfig</code></td><td>SpringCloud开源，和Spring是无缝集成，但无操作界面，且不支持实时更新，需要重启或刷新</td></tr><tr><td><code>NacosConfig</code></td><td>SpingCloudAlibaba开源，支持实时更新和版本管理，推荐使用</td></tr></tbody></table><h2 id=e01-开发测试项目>E01. 开发测试项目</h2><blockquote><p>武技: 创建 <code>v5-7-alibaba-nacosconfig/nacosconfig-order</code> 和 <code>v5-7-alibaba-nacosconfig/nacosconfig-product</code> 两个子项目，用于测试配置中心</p></blockquote><h3 id=1-添加三方依赖>1. 添加三方依赖</h3><ul><li>分别在两个子项目中引入三方依赖：</li></ul><p><code>pom.xml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-boot-starter-web--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-web<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-cloud-starter-alibaba-nacos-discovery--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;groupId&gt;</span>com.alibaba.cloud<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-cloud-starter-alibaba-nacos-config--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;groupId&gt;</span>com.alibaba.cloud<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-nacos-config<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><h3 id=2-开发启动类>2. 开发启动类</h3><ol><li>在 <code>v5-7-alibaba-nacosconfig/nacosconfig-order</code> 子项目中开发启动类：</li></ol><p><code>com.lsx.NacosConfigOrderApp</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootApplication</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NacosConfigOrderApp</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>        SpringApplication.<span style=color:#a6e22e>run</span>(NacosConfigOrderApp.<span style=color:#a6e22e>class</span>, args);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=2><li>在 <code>v5-7-alibaba-nacosconfig/nacosconfig-product</code> 子项目中开发启动类：</li></ol><p><code>com.lsx.NacosConfigProductApp</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootApplication</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NacosConfigProductApp</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>        SpringApplication.<span style=color:#a6e22e>run</span>(NacosConfigProductApp.<span style=color:#a6e22e>class</span>, args);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-开发配置文件>3. 开发配置文件</h3><ol><li>在 <code>v5-7-alibaba-nacosconfig/nacosconfig-order</code> 子项目中开发主配文件：<ol><li>优先级：<code>bootstrap.properties -> bootstrap.yml -> application.properties -> application.yml</code></li></ol></li></ol><p><code>classpath:bootstrap.yml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>spring</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>application</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nacosconfig-order</span> <span style=color:#75715e># 项目名称</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>cloud</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>nacos</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>config</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>file-extension</span>: <span style=color:#ae81ff>yaml</span> <span style=color:#75715e># NacosConfig配置文件后缀</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>server-addr</span>: <span style=color:#ae81ff>192.168.40.77</span>:<span style=color:#ae81ff>8848</span> <span style=color:#75715e># NacosConfig配置中心地址</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>group</span>: <span style=color:#ae81ff>alibaba</span> <span style=color:#75715e># NacosConfig配置文件分组</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>profiles</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>active</span>: <span style=color:#ae81ff>test</span> <span style=color:#75715e># 当前开发环境，决定了使用NacosConfig中，哪个环境的配置文件</span>
</span></span><span style=display:flex><span><span style=color:#f92672>logging</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>level</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>com.alibaba.nacos.client.naming</span>: <span style=color:#ae81ff>warn</span> <span style=color:#75715e># 忽略NacosConfig无限心跳检测日志，可选</span>
</span></span></code></pre></div><ol start=2><li>在 <code>v5-7-alibaba-nacosconfig/nacosconfig-product</code> 子项目中开发主配文件：<ol><li>优先级：<code>bootstrap.properties -> bootstrap.yml -> application.properties -> application.yml</code></li></ol></li></ol><p><code>classpath:bootstrap.yml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>spring</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>application</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nacosconfig-product</span> <span style=color:#75715e># 项目名称</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>cloud</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>nacos</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>config</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>file-extension</span>: <span style=color:#ae81ff>yaml</span> <span style=color:#75715e># NacosConfig配置文件后缀</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>server-addr</span>: <span style=color:#ae81ff>192.168.40.77</span>:<span style=color:#ae81ff>8848</span> <span style=color:#75715e># NacosConfig配置中心地址</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>group</span>: <span style=color:#ae81ff>alibaba</span> <span style=color:#75715e># NacosConfig配置文件分组</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>profiles</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>active</span>: <span style=color:#ae81ff>test</span> <span style=color:#75715e># 当前开发环境，决定了使用NacosConfig中，哪个环境的配置文件</span>
</span></span><span style=display:flex><span><span style=color:#f92672>logging</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>level</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>com.alibaba.nacos.client.naming</span>: <span style=color:#ae81ff>warn</span> <span style=color:#75715e># 忽略NacosConfig无限心跳检测日志，可选</span>
</span></span></code></pre></div><ol start=3><li>登录Nacos管控台，点击 <code>配置列表</code>，点击右侧加号进行如下配置：<ol><li><code>Data ID</code>：格式为 <code>微服务名-环境-后缀</code>，如 <code>nacosconfig-order-test.yaml</code> 等。</li><li><code>Group</code>：用于归类不同微服务，如 <code>alibaba</code> 等。</li><li><code>配置格式</code>：选择 <code>YAML</code> 项。</li><li><code>配置内容</code>：将本地 <code>application.properties</code> 中的内容剪切到此处，内容如下：</li></ol></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>server</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>port</span>: <span style=color:#ae81ff>8213</span> <span style=color:#75715e># 端口号</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spring</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>application</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nacosconfig-order</span> <span style=color:#75715e># 项目名称</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>cloud</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>nacos</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>discovery</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>server-addr</span>: <span style=color:#ae81ff>192.168.40.77</span>:<span style=color:#ae81ff>8848</span> <span style=color:#75715e># nacos地址</span>
</span></span></code></pre></div><ol start=4><li>登录Nacos管控台，点击 <code>配置列表</code>，点击右侧加号进行如下配置：<ol><li><code>Data ID</code>：格式为 <code>微服务名-环境-后缀</code>，如 <code>nacosconfig-product-test.yaml</code> 等。</li><li><code>Group</code>：用于归类不同微服务，如 <code>alibaba</code> 等。</li><li><code>配置格式</code>：选择 <code>YAML</code> 项。</li><li><code>配置内容</code>：将本地 <code>application.properties</code> 中的内容剪切到此处，内容如下：</li></ol></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>server</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>port</span>: <span style=color:#ae81ff>8214</span> <span style=color:#75715e># 端口号</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spring</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>application</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nacosconfig-product</span> <span style=color:#75715e># 项目名称</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>cloud</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>nacos</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>discovery</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>server-addr</span>: <span style=color:#ae81ff>192.168.40.77</span>:<span style=color:#ae81ff>8848</span> <span style=color:#75715e># nacos地址</span>
</span></span></code></pre></div><h3 id=4-启动微服务>4. 启动微服务</h3><ol><li>注释掉本地 <code>application.yml</code> 中的全部内容并启动了两个微服务。</li><li>控制台可以观察到 <code>dataId=nacosconfig-order-test.yaml</code> 相关提示。</li></ol><h2 id=e02-动态读取配置>E02. 动态读取配置</h2><blockquote><p>心法: 动态读取NacosConfig配置项</p></blockquote><ul><li>读取: 本地微服务可以通过 <code>@RefreshScope</code> + <code>@Value</code> 读取NacosConfig配置中心的主配内容：<ul><li>类上标记 <code>@RefreshScope</code> 以启用动态刷新Nacos配置文件内容的功能。</li><li>属性标记 <code>@Value</code> 用于指定读取的是哪个属性。</li></ul></li><li>动态: 当NacosConfig配置项发生更改时，无需重启微服务，即可动态获得修改后的最新内容。</li></ul><blockquote><p>武技: 在 <code>v5-7-alibaba-nacosconfig/nacosconfig-order</code> 子项目中动态读取NacosConfig配置项</p></blockquote><h3 id=1-开发控制器>1. 开发控制器</h3><ol><li>开发NacosConfigController控制器并动态读取NacosConfig中的配置项：</li></ol><p><code>com.lsx.controller.NacosConfigController</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RefreshScope</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RequestMapping</span>(<span style=color:#e6db74>&#34;/api/v1/nacosconfig&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NacosConfigController</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Value</span>(<span style=color:#e6db74>&#34;${project.env}&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String env;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/getEnv&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getEnv</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;NacosConfig中的project.env值：&#34;</span> <span style=color:#f92672>+</span> env;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=2-开发主配项>2. 开发主配项</h3><ol><li>在NacosConfig中的 <code>nacosconfig-order-test.yaml</code> 中添加一条自定义配置:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>project</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>env</span>: <span style=color:#ae81ff>TEST</span> <span style=color:#75715e># 测试环境</span>
</span></span></code></pre></div><h3 id=3-启动微服务>3. 启动微服务</h3><ol><li><a href=http://localhost:8213/api/v1/nacosconfig/getEnv>访问控制器</a></li><li>在NacosConfig中修改env配置项的值为 <code>dev</code>，再次访问，查看动态刷新效果。</li></ol><h2 id=e03-环境共享配置>E03. 环境共享配置</h2><blockquote><p>心法：NacosConfig环境共享配置</p></blockquote><ul><li>NacosConfig允许将不同环境的配置文件中相同的部分提取出来。</li></ul><blockquote><p>武技: 在 <code>v5-7-alibaba-nacosconfig/nacosconfig-order</code> 中测试环境共享配置</p></blockquote><h3 id=1-开发环境主配>1. 开发环境主配</h3><ol><li>在NacosConfig配置中心创建开发环境下的微服务主配：<ol><li><code>Data ID</code>：<code>nacosconfig-order-dev.yaml</code></li><li><code>Group</code>：<code>alibaba</code></li><li><code>配置格式</code>：<code>YAML</code></li><li><code>配置内容</code>：内容如下：</li></ol></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>project</span>:
</span></span><span style=display:flex><span>	<span style=color:#f92672>env</span>: <span style=color:#ae81ff>DEV</span> <span style=color:#75715e># 开发环境</span>
</span></span></code></pre></div><h3 id=2-生产环境主配>2. 生产环境主配</h3><ol start=2><li>在NacosConfig配置中心创建生产环境下的微服务主配：<ol><li><code>Data ID</code>：<code>nacosconfig-order-prod.yaml</code></li><li><code>Group</code>：<code>alibaba</code></li><li><code>配置格式</code>：<code>YAML</code></li><li><code>配置内容</code>：内容如下：</li></ol></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>project</span>:
</span></span><span style=display:flex><span>	<span style=color:#f92672>env</span>: <span style=color:#ae81ff>RPOD</span> <span style=color:#75715e># 生产环境</span>
</span></span></code></pre></div><h3 id=3-环境共享配置>3. 环境共享配置</h3><ol><li>在NacosConfig配置中心创建环境共享配置文件：<ol><li><code>Data ID</code>：格式固定为 <code>微服务名.后缀</code>，如 <code>nacosconfig-order.yaml</code> 等。</li><li><code>Group</code>：<code>alibaba</code></li><li><code>配置格式</code>：<code>YAML</code></li><li><code>配置内容</code>：将三种不同环境的配置文件中相同的内容移动到这里，如下：</li></ol></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>server</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>port</span>: <span style=color:#ae81ff>8213</span> <span style=color:#75715e># 端口号</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spring</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>application</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nacosconfig-order</span> <span style=color:#75715e># 项目名称</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>cloud</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>nacos</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>discovery</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>server-addr</span>: <span style=color:#ae81ff>192.168.40.77</span>:<span style=color:#ae81ff>8848</span> <span style=color:#75715e># nacos地址</span>
</span></span></code></pre></div><ol start=2><li>重启微服务，正常启动说明跨环境共享配置成功。</li></ol><h2 id=e04-服务共享配置>E04. 服务共享配置</h2><blockquote><p>心法：NacosConfig服务共享配置</p></blockquote><ul><li>NacosConfig允许将不同微服务的配置文件中相同的部分提取出来。</li></ul><blockquote><p>武技: 将两个微服务的主配中，相同配置内容提取出来</p></blockquote><h3 id=1-服务共享配置>1. 服务共享配置</h3><ol><li>在NacosConfig配置中心创建服务共享配置文件：<ol><li><code>Data ID</code>：命名随意，如 <code>nacosconfig.yaml</code> 等。</li><li><code>Group</code>：<code>alibaba</code></li><li><code>配置格式</code>：<code>YAML</code></li><li><code>配置内容</code>：将两个微服务全部环境的配置文件中相同的内容移动到这里，如下：</li></ol></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>spring</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>cloud</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>nacos</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>discovery</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>server-addr</span>: <span style=color:#ae81ff>192.168.40.77</span>:<span style=color:#ae81ff>8848</span> <span style=color:#75715e># nacos地址</span>
</span></span></code></pre></div><h3 id=2-修改主配文件>2. 修改主配文件</h3><ol><li>分别在两个微服务的主配中添加如下内容：</li></ol><p><code>classpath:bootstrap.yml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>spring</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>cloud</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>nacos</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>config</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>shared-configs</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>group</span>: <span style=color:#ae81ff>alibaba</span> <span style=color:#75715e># NacosConfig配置文件分组</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>data-id</span>: <span style=color:#ae81ff>nacosconfig.yaml</span> <span style=color:#75715e># 配置文件名</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>refresh</span>: <span style=color:#66d9ef>true</span> <span style=color:#75715e># 是否动态刷新，默认为false</span>
</span></span></code></pre></div><ol start=2><li>重启微服务，正常启动说明跨服务共享配置成功。</li></ol></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div></main><footer class=footer><span>&copy; 2024 The Marauders</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>