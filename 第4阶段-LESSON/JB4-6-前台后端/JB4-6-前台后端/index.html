<!doctype html><html lang=en><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>JB4-6-前台后端</title>
<meta name=description content="[!NOTE] Java道经第4卷 - 第6阶 - 前台后端 lesson-server
S01. 搭建项目环境 心法：项目相关资料
项目后台接口图+ 项目业务流程图 武技: 创建 lesson-server 子项目并搭建基础环境
E01. 基础环境搭建 1. 引入项目依赖 pom.xml
&amp;lt;!--引入自己的公共 …"><meta name=keywords content='blog,lsx2216,hugo'><meta property="og:url" content="https://lsx2216.netlify.app/%E7%AC%AC4%E9%98%B6%E6%AE%B5-LESSON/JB4-6-%E5%89%8D%E5%8F%B0%E5%90%8E%E7%AB%AF/JB4-6-%E5%89%8D%E5%8F%B0%E5%90%8E%E7%AB%AF/"><meta property="og:type" content="website"><meta property="og:title" content="JB4-6-前台后端"><meta property="og:description" content="[!NOTE] Java道经第4卷 - 第6阶 - 前台后端 lesson-server
S01. 搭建项目环境 心法：项目相关资料
项目后台接口图+ 项目业务流程图 武技: 创建 lesson-server 子项目并搭建基础环境
E01. 基础环境搭建 1. 引入项目依赖 pom.xml
&amp;lt;!--引入自己的公共 …"><meta property="og:image" content="https://lsx2216.netlify.app/assets/images/user.jpg"><meta property="og:image:secure_url" content="https://lsx2216.netlify.app/assets/images/user.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="JB4-6-前台后端"><meta name=twitter:description content="[!NOTE] Java道经第4卷 - 第6阶 - 前台后端 lesson-server
S01. 搭建项目环境 心法：项目相关资料
项目后台接口图+ 项目业务流程图 武技: 创建 lesson-server 子项目并搭建基础环境
E01. 基础环境搭建 1. 引入项目依赖 pom.xml
&amp;lt;!--引入自己的公共 …"><meta property="twitter:domain" content="https://lsx2216.netlify.app/%E7%AC%AC4%E9%98%B6%E6%AE%B5-LESSON/JB4-6-%E5%89%8D%E5%8F%B0%E5%90%8E%E7%AB%AF/JB4-6-%E5%89%8D%E5%8F%B0%E5%90%8E%E7%AB%AF/"><meta property="twitter:url" content="https://lsx2216.netlify.app/%E7%AC%AC4%E9%98%B6%E6%AE%B5-LESSON/JB4-6-%E5%89%8D%E5%8F%B0%E5%90%8E%E7%AB%AF/JB4-6-%E5%89%8D%E5%8F%B0%E5%90%8E%E7%AB%AF/"><meta name=twitter:image content="https://lsx2216.netlify.app/assets/images/user.jpg"><link rel=canonical href=https://lsx2216.netlify.app/%E7%AC%AC4%E9%98%B6%E6%AE%B5-LESSON/JB4-6-%E5%89%8D%E5%8F%B0%E5%90%8E%E7%AB%AF/JB4-6-%E5%89%8D%E5%8F%B0%E5%90%8E%E7%AB%AF/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.3eb19cb61dde9e37b9522867f3e024aeb68e26ab8e03252e46e365abcb19acf7.js integrity="sha256-PrGcth3enje5Uihn8+AkrraOJquOAyUuRuNlq8sZrPc="></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css integrity=sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js integrity=sha384-X/XCfMm41VSsqRNQgDerQczD69XqmjOOOwYQvr/uuC+j4OPoNhVgjdGFwhvN02Ja crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script>    <link rel="shortcut icon" href="/assets/images/user.jpg" type="image/x-icon">
</head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://lsx2216.netlify.app/><img src=/assets/images/user.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://lsx2216.netlify.app/>lsx2216</a></div><div class=nav-links><div class=nav-link><a href=https://lsx2216.netlify.app/ aria-label><span data-feather=home></span> Home</a></div><div class=nav-link><a href=https://lsx2216.netlify.app/projects/ aria-label><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://github.com aria-label=github><span data-feather=github></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://lsx2216.netlify.app/><span data-feather=home></span> Home</a></li><li class=nav-item><a href=https://lsx2216.netlify.app/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://github.com><span data-feather=github></span></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>JB4-6-前台后端</h1></div><div class=post-content><blockquote><p>[!NOTE] Java道经第4卷 - 第6阶 - 前台后端
lesson-server</p></blockquote><h1 id=s01-搭建项目环境>S01. 搭建项目环境</h1><blockquote><p>心法：项目相关资料</p></blockquote><ul><li><a href=res/%E9%A1%B9%E7%9B%AE%E5%90%8E%E5%8F%B0%E6%8E%A5%E5%8F%A3%E5%9B%BE.md>项目后台接口图</a>+</li><li><a href=res/%E9%A1%B9%E7%9B%AE%E5%90%8E%E5%8F%B0%E4%B8%9A%E5%8A%A1%E5%9B%BE.md>项目业务流程图</a></li></ul><blockquote><p>武技: 创建 <code>lesson-server</code> 子项目并搭建基础环境</p></blockquote><h2 id=e01-基础环境搭建>E01. 基础环境搭建</h2><h3 id=1-引入项目依赖>1. 引入项目依赖</h3><p><code>pom.xml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--引入自己的公共项目--&gt;</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>com.lsx<span style=color:#f92672>&lt;/groupId&gt;</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>lesson-common<span style=color:#f92672>&lt;/artifactId&gt;</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>1.0-SNAPSHOT<span style=color:#f92672>&lt;/version&gt;</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--junit--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>junit<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>junit<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--lombok--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.projectlombok<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>lombok<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--hutool--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>cn.hutool<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>hutool-all<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-boot-starter-web--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-web<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-boot-starter-test--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-test<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;scope&gt;</span>test<span style=color:#f92672>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-boot-starter-aop--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-aop<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--mysql-connector-j--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>com.mysql<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>mysql-connector-j<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-boot-starter-cache--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-cache<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--springdoc-openapi-ui--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.springdoc<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>springdoc-openapi-ui<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--knife4j-springdoc-ui--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>com.github.xiaoymin<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>knife4j-springdoc-ui<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--hibernate-validator--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.hibernate.validator<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>hibernate-validator<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--minio--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>io.minio<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>minio<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--jwt--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>com.auth0<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>java-jwt<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--mybatis-flex-spring-boot-starter--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>com.mybatis-flex<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>mybatis-flex-spring-boot-starter<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--HikariCP--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>com.zaxxer<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>HikariCP<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-boot-starter-data-redis--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-data-redis<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--logstash-logback-encoder--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>net.logstash.logback<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>logstash-logback-encoder<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-boot-starter-data-redis--&gt;</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-data-redis<span style=color:#f92672>&lt;/artifactId&gt;</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><h3 id=2-开发主配文件>2. 开发主配文件</h3><p><code>classpath:application.properties</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#75715e>############################# App ##############################</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#端口号，项目名称#</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>server.port</span><span style=color:#f92672>=</span><span style=color:#e6db74>5277</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.application.name</span><span style=color:#f92672>=</span><span style=color:#e6db74>lesson-server</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>############################# DataSource ##############################</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#驱动串，连接串，账号，密码，连接池类#</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.datasource.driver-class-name</span><span style=color:#f92672>=</span><span style=color:#e6db74>com.mysql.cj.jdbc.Driver</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.datasource.url</span><span style=color:#f92672>=</span><span style=color:#e6db74>jdbc:mysql://192.168.40.77:3306/lesson?\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;characterEncoding=utf-8</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.datasource.username</span><span style=color:#f92672>=</span><span style=color:#e6db74>lsx</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.datasource.password</span><span style=color:#f92672>=</span><span style=color:#e6db74>lsx</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.datasource.type</span><span style=color:#f92672>=</span><span style=color:#e6db74>com.zaxxer.hikari.HikariDataSource</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>############################# MyBatisFlex ##############################  </span>
</span></span><span style=display:flex><span><span style=color:#75715e>#实体类别名包扫描，下划线自动转驼峰，控制台打印SQL#  </span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>mybatis-flex.type-aliases-package</span><span style=color:#f92672>=</span><span style=color:#e6db74>com.lsx.entity  </span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>mybatis-flex.configuration.map-underscore-to-camel-case</span><span style=color:#f92672>=</span><span style=color:#e6db74>true  </span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>mybatis-flex.configuration.log-impl</span><span style=color:#f92672>=</span><span style=color:#e6db74>org.apache.ibatis.logging.stdout.StdOutImpl </span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>############################# MinIO ##############################  </span>
</span></span><span style=display:flex><span><span style=color:#75715e>#总量无限制，单个文件限制1GB#  </span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.servlet.multipart.max-file-size</span><span style=color:#f92672>=</span><span style=color:#e6db74>-1  </span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.servlet.multipart.max-request-size</span><span style=color:#f92672>=</span><span style=color:#e6db74>1GB</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>############################# Logback ##############################  </span>
</span></span><span style=display:flex><span><span style=color:#75715e>#根目录日志等级，控制台格式，文件格式，文件名，文件滚动名，最长时效（天），单个文件最大值，总文件最大值#  </span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>logging.level.root</span><span style=color:#f92672>=</span><span style=color:#e6db74>INFO</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>logging.pattern.console</span><span style=color:#f92672>=</span><span style=color:#e6db74>%d{yyyy-MM-dd HH:mm:ss.SSS} %-5p %4.15(%t) %c{1}.%M:%L %msg%n</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>logging.pattern.file</span><span style=color:#f92672>=</span><span style=color:#e6db74>%d{yyyy-MM-dd HH:mm:ss.SSS} %-5p %4.15(%t) %c{1}.%M:%L %msg%n</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>logging.file.name</span><span style=color:#f92672>=</span><span style=color:#e6db74>log/lesson-server.log</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>logging.pattern.rolling-file-name</span><span style=color:#f92672>=</span><span style=color:#e6db74>log/lesson-server.%d.%i.log</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>logging.file.max-history</span><span style=color:#f92672>=</span><span style=color:#e6db74>7</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>logging.file.max-size</span><span style=color:#f92672>=</span><span style=color:#e6db74>10MB</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>logging.file.total-size-cap</span><span style=color:#f92672>=</span><span style=color:#e6db74>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>############################# StringRedisTemplate ##############################</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#RedisIP，Redis端口，超时毫秒数，最大连接，最大阻塞时间，最大空闲，最小空闲#</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.redis.host</span><span style=color:#f92672>=</span><span style=color:#e6db74>192.168.40.77</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.redis.port</span><span style=color:#f92672>=</span><span style=color:#e6db74>6379</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.redis.timeout</span><span style=color:#f92672>=</span><span style=color:#e6db74>3000ms</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.redis.jedis.pool.max-active</span><span style=color:#f92672>=</span><span style=color:#e6db74>8</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.redis.jedis.pool.max-wait</span><span style=color:#f92672>=</span><span style=color:#e6db74>-1ms</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.redis.jedis.pool.max-idle</span><span style=color:#f92672>=</span><span style=color:#e6db74>8</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.redis.jedis.pool.min-idle</span><span style=color:#f92672>=</span><span style=color:#e6db74>0</span>
</span></span></code></pre></div><h3 id=3-开发配置类>3. 开发配置类</h3><p><code>com.lsx.config.MyBatisFlexConfig</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@MapperScan</span>(<span style=color:#e6db74>&#34;com.lsx.mapper&#34;</span>)  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyBatisFlexConfig</span> {  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=4-引入工具类>4. 引入工具类</h3><ol><li><a href=../../%E7%AC%AC3%E9%98%B6%E6%AE%B5-SSM/JB3-5-Redis/res/RedisUtil%E5%B7%A5%E5%85%B7%E5%B0%81%E8%A3%85.md>封装RedisUtil工具类</a></li></ol><h3 id=5-开发启动类>5. 开发启动类</h3><p><code>com.lsx.LessonServerApp</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootApplication</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LessonServerApp</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>        SpringApplication.<span style=color:#a6e22e>run</span>(LessonServerApp.<span style=color:#a6e22e>class</span>, args);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e02-整合文档框架>E02. 整合文档框架</h2><blockquote><p>武技: 在子项目 <code>lesson-server</code> 中整合 SpringDoc + Knife4j</p></blockquote><h3 id=1-开发主配项>1. 开发主配项</h3><p><code>classpath:application.properties</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#75715e>############################# SpringDoc ##############################  </span>
</span></span><span style=display:flex><span><span style=color:#75715e>#启用SpringDoc，包扫描，分组名，分组规则，包扫描# </span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>springdoc.api-docs.enabled</span><span style=color:#f92672>=</span><span style=color:#e6db74>true</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>springdoc.packages-to-scan</span><span style=color:#f92672>=</span><span style=color:#e6db74>com.lsx.controller</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>springdoc.group-configs[0].group</span><span style=color:#f92672>=</span><span style=color:#e6db74>v1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>springdoc.group-configs[0].paths-to-match</span><span style=color:#f92672>=</span><span style=color:#e6db74>/api/v1/**</span>
</span></span></code></pre></div><ul><li>tips: 若存在 <code>server.servlet.context-path</code> 配置，则SpringDoc会自动添加该请求前缀。</li></ul><h3 id=2-开发常量类>2. 开发常量类</h3><p><code>com.lsx.constant.SpringDocConst</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>SpringDocConst</span> {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/** 前台地址 */</span>  
</span></span><span style=display:flex><span>    String SERVER_URL <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;http//localhost:5277&#34;</span>;  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/** 前台作者 */</span>  
</span></span><span style=display:flex><span>    String SERVER_NAME <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;lsx&#34;</span>;  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/** 前台标题 */</span>  
</span></span><span style=display:flex><span>    String SERVER_TITLE <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;李氏云课堂-前台&#34;</span>;  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/** 前台版本 */</span>  
</span></span><span style=display:flex><span>    String SERVER_VERSION <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;v1.0.0&#34;</span>;   
</span></span><span style=display:flex><span>	<span style=color:#75715e>/** 前台描述 */</span>  
</span></span><span style=display:flex><span>	String SERVER_DESCRIPTION <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&lt;em&gt;&#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;lesson项目全名李氏云课堂，是一个可以在线购买视频，观看视频的电商网站，&#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;lesson-server是普通用户后台子项目，基于SpringBoot + MyBatis框架开发，&#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;使用前后端分离技术，用户可注册，可使用账号密码登录本系统，&#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;也可以使用手机号和验证码登录本系统，用户在未登录状态下，提供浏览首页轮播图广告，&#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;分页查看视频列表，点击查看视频详情，搜索视频等功能入口，用户在登录状态下，&#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;提供查询个人信息，修改个人信息，修改个人密码，上传个人头像，查询个人积分，&#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;注销账号，登出账号，批量添加指定商品到购物车，查看购物车商品，&#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;批量删除购物车内商品，清空购物车，下单购买商品等功能入口，用户在支付成功状态下，&#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;提供查看个人订单，删除个人订单，在线观看视频，实时发送弹幕或评论等功能入口&lt;/em&gt;&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-开发配置类-1>3. 开发配置类</h3><p><code>com.lsx.config.SpringDocConfig</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> io.swagger.v3.oas.models.OpenAPI;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> io.swagger.v3.oas.models.info.Contact;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> io.swagger.v3.oas.models.info.Info;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SpringDocConfig</span> {    
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>/** 通用信息Bean */</span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> OpenAPI <span style=color:#a6e22e>commonInfo</span>() {    
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 联系对象    </span>
</span></span><span style=display:flex><span>		Contact contact <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Contact()    
</span></span><span style=display:flex><span>		        .<span style=color:#a6e22e>name</span>(SpringDocConst.<span style=color:#a6e22e>SERVER_NAME</span>)  
</span></span><span style=display:flex><span>		        .<span style=color:#a6e22e>url</span>(SpringDocConst.<span style=color:#a6e22e>SERVER_URL</span>);  
</span></span><span style=display:flex><span>		              
</span></span><span style=display:flex><span>	    <span style=color:#75715e>// 展板信息    </span>
</span></span><span style=display:flex><span>		Info info <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Info()  
</span></span><span style=display:flex><span>				.<span style=color:#a6e22e>title</span>(SpringDocConst.<span style=color:#a6e22e>SERVER_TITLE</span>)  
</span></span><span style=display:flex><span>		        .<span style=color:#a6e22e>description</span>(SpringDocConst.<span style=color:#a6e22e>SERVER_DESCRIPTION</span>)  
</span></span><span style=display:flex><span>		        .<span style=color:#a6e22e>version</span>(SpringDocConst.<span style=color:#a6e22e>SERVER_VERSION</span>)  
</span></span><span style=display:flex><span>		        .<span style=color:#a6e22e>contact</span>(contact);    
</span></span><span style=display:flex><span>		                
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> OpenAPI().<span style=color:#a6e22e>info</span>(info);  
</span></span><span style=display:flex><span>    }    
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=4-访问项目文档>4. 访问项目文档</h3><ul><li><a href=http://localhost:5277/doc.html>SpringDoc文档页面</a></li></ul><h2 id=e03-整合缓存框架>E03. 整合缓存框架</h2><blockquote><p>武技: 在子项目 <code>lesson-server</code> 中整合SpringCache缓存</p></blockquote><h3 id=1-开发配置类>1. 开发配置类</h3><p><code>com.lsx.config.SpringCacheConfig</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@EnableCaching</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SpringCacheConfig</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/** 缓存有效期，单位分钟 */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>long</span> TTL <span style=color:#f92672>=</span> 30L;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> RedisConnectionFactory connectionFactory;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> CacheManager <span style=color:#a6e22e>cacheManager</span>() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Jackson核心对象</span>
</span></span><span style=display:flex><span>        ObjectMapper objectMapper <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ObjectMapper();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Jackson序列化器: 用于相互转换Java对象和JSON字符串，默认使用JDK的序列化方式（中文有乱码）</span>
</span></span><span style=display:flex><span>        Jackson2JsonRedisSerializer<span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>&gt;</span> serializer <span style=color:#f92672>=</span> 
</span></span><span style=display:flex><span>	        <span style=color:#66d9ef>new</span> Jackson2JsonRedisSerializer<span style=color:#f92672>&lt;&gt;</span>(Object.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 设置LocalDateTime序列化方式</span>
</span></span><span style=display:flex><span>        objectMapper.<span style=color:#a6e22e>registerModule</span>(<span style=color:#66d9ef>new</span> JavaTimeModule());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 设置objectMapper的访问权限: Jackson库可以访问Java对象的任何属性</span>
</span></span><span style=display:flex><span>        objectMapper.<span style=color:#a6e22e>setVisibility</span>(PropertyAccessor.<span style=color:#a6e22e>ALL</span>, JsonAutoDetect.<span style=color:#a6e22e>Visibility</span>.<span style=color:#a6e22e>ANY</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>         * 设置Jackson在序列化和反序列化过程中，对Java泛型的默认处理方案
</span></span></span><span style=display:flex><span><span style=color:#75715e>         *
</span></span></span><span style=display:flex><span><span style=color:#75715e>         * param1: 一个用于验证泛型类型的对象
</span></span></span><span style=display:flex><span><span style=color:#75715e>         * param2: 表示在序列化和反序列化过程中，将Java泛型类型信息作为属性进行处理
</span></span></span><span style=display:flex><span><span style=color:#75715e>         * param3: 表示在JSON数据中，将Java泛型类型信息作为属性进行存储
</span></span></span><span style=display:flex><span><span style=color:#75715e>         */</span>
</span></span><span style=display:flex><span>        objectMapper.<span style=color:#a6e22e>activateDefaultTyping</span>(objectMapper.<span style=color:#a6e22e>getPolymorphicTypeValidator</span>(),
</span></span><span style=display:flex><span>                ObjectMapper.<span style=color:#a6e22e>DefaultTyping</span>.<span style=color:#a6e22e>NON_FINAL</span>,
</span></span><span style=display:flex><span>                JsonTypeInfo.<span style=color:#a6e22e>As</span>.<span style=color:#a6e22e>PROPERTY</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 设置 serializer 使用 objectMapper 来序列化和反序列化对象</span>
</span></span><span style=display:flex><span>        serializer.<span style=color:#a6e22e>setObjectMapper</span>(objectMapper);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 配置redis缓存管理对象: 设置缓存过期时间，value值的序列化方式和对Null值的处理方案</span>
</span></span><span style=display:flex><span>        RedisCacheConfiguration config <span style=color:#f92672>=</span> RedisCacheConfiguration.<span style=color:#a6e22e>defaultCacheConfig</span>()
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>entryTtl</span>(Duration.<span style=color:#a6e22e>ofMinutes</span>(TTL))
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>serializeValuesWith</span>(RedisSerializationContext.<span style=color:#a6e22e>SerializationPair</span>
</span></span><span style=display:flex><span>	                .<span style=color:#a6e22e>fromSerializer</span>(serializer))
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>disableCachingNullValues</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 创建并返回Cache管理器</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> RedisCacheManager.<span style=color:#a6e22e>builder</span>(connectionFactory).<span style=color:#a6e22e>cacheDefaults</span>(config).<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e04-全局异常处理>E04. 全局异常处理</h2><blockquote><p>武技: 在子项目 <code>lesson-server</code> 中整合全局异常处理器</p></blockquote><h3 id=1-自定义业务异常类>1. 自定义业务异常类</h3><blockquote><p>心法: 自定义一个业务异常类，用于业务异常的手动抛出</p></blockquote><p><code>com.lsx.exception.ServiceException</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ServiceException</span> <span style=color:#66d9ef>extends</span> RuntimeException {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>ServiceException</span>(String message) {  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>(message);  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=2-开发全局异常处理方法>2. 开发全局异常处理方法</h3><table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td><code>serviceException()</code></td><td>捕获业务异常，记录业务类型的日志并返回Result结果</td></tr><tr><td><code>exception()</code></td><td>捕获其他异常，记录其他类型的日志并返回Result结果</td></tr></tbody></table><p><code>com.lsx.component.ExceptionAdvice</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.component;  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RestControllerAdvice</span>(basePackages <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;com.lsx.controller&#34;</span>})  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ExceptionAdvice</span> {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@ExceptionHandler</span>(ServiceException.<span style=color:#a6e22e>class</span>)  
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>serviceException</span>(ServiceException e) {  
</span></span><span style=display:flex><span>	    log.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#34;业务异常: &#34;</span> <span style=color:#f92672>+</span> e.<span style=color:#a6e22e>getMessage</span>());  
</span></span><span style=display:flex><span>	    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Result(ResultCode.<span style=color:#a6e22e>FAILED</span>, e.<span style=color:#a6e22e>getMessage</span>());  
</span></span><span style=display:flex><span>	}  
</span></span><span style=display:flex><span>	  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@ExceptionHandler</span>(Exception.<span style=color:#a6e22e>class</span>)  
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>exception</span>(Exception e) {    
</span></span><span style=display:flex><span>	    log.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#34;其他异常: &#34;</span> <span style=color:#f92672>+</span> e.<span style=color:#a6e22e>getMessage</span>());    
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Result(ResultCode.<span style=color:#a6e22e>FAILED</span>);  
</span></span><span style=display:flex><span>	}    
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>tips: 注意异常范围和书写位置。</li></ul><h2 id=e05-整合参数校验>E05. 整合参数校验</h2><blockquote><p>武技: 在子项目 <code>lesson-server</code> 中整合HibernateValidator参数校验器</p></blockquote><h3 id=1-开发校验异常处理方法>1. 开发校验异常处理方法</h3><table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td><code>methodArgumentNotValidException()</code></td><td>捕获参数校验异常，记录业务类型的日志并返回Result结果</td></tr></tbody></table><p><code>com.lsx.component.ExceptionAdvice</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@ExceptionHandler</span>(MethodArgumentNotValidException.<span style=color:#a6e22e>class</span>)  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>methodArgumentNotValidException</span>(MethodArgumentNotValidException e) {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 获取bindingResult中所有属性错误信息集合中的第一个属性错误  </span>
</span></span><span style=display:flex><span>	FieldError firstFieldError <span style=color:#f92672>=</span> e.<span style=color:#a6e22e>getBindingResult</span>().<span style=color:#a6e22e>getFieldErrors</span>().<span style=color:#a6e22e>get</span>(0);  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 异常信息 : &#34;xxx实例的xxx属性校验失败: xxx异常信息&#34;  </span>
</span></span><span style=display:flex><span>	String message <span style=color:#f92672>=</span> String.<span style=color:#a6e22e>format</span>(<span style=color:#e6db74>&#34;%s实例的%s属性校验失败: %s&#34;</span>,  
</span></span><span style=display:flex><span>			firstFieldError.<span style=color:#a6e22e>getObjectName</span>(),  
</span></span><span style=display:flex><span>			firstFieldError.<span style=color:#a6e22e>getField</span>(),  
</span></span><span style=display:flex><span>			firstFieldError.<span style=color:#a6e22e>getDefaultMessage</span>());  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 记录日志  </span>
</span></span><span style=display:flex><span>	log.<span style=color:#a6e22e>error</span>(message);  
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 响应  </span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Result(ResultCode.<span style=color:#a6e22e>VALIDATE_FAILED</span>, message);  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>tips: 注意异常范围和书写位置。</li></ul><h2 id=e06-开发切面代码>E06. 开发切面代码</h2><h3 id=1-开发业务层切面代码>1. 开发业务层切面代码</h3><blockquote><p>心法: <code>lesson-server</code> 业务层切面任务</p></blockquote><table><thead><tr><th>通知</th><th>任务</th></tr></thead><tbody><tr><td>前置通知</td><td>判断业务方法参数中是否存在null值，存在则直接抛出异常</td></tr><tr><td>后置通知</td><td>记录业务方法的调用日志</td></tr><tr><td>返回通知</td><td>无</td></tr><tr><td>异常通知</td><td>AOP中的异常通知比全局异常处理类优先级高，建议将处理异常的工作让给全局异常处理类来做</td></tr></tbody></table><blockquote><p>武技: 在子项目 <code>lesson-server</code> 中开发业务层的AOP代码</p></blockquote><p><code>com.lsx.component.ServiceAspect</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Component</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Aspect</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ServiceAspect</span> {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@SneakyThrows</span>  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Around</span>(<span style=color:#e6db74>&#34;execution(public * com.lsx.service.impl.*.*(..))&#34;</span>)  
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>aroundAdvice</span>(ProceedingJoinPoint pjp) {  
</span></span><span style=display:flex><span>	  
</span></span><span style=display:flex><span>	    <span style=color:#75715e>// 获取方法参数  </span>
</span></span><span style=display:flex><span>	    Object<span style=color:#f92672>[]</span> args <span style=color:#f92672>=</span> pjp.<span style=color:#a6e22e>getArgs</span>();  
</span></span><span style=display:flex><span>	  
</span></span><span style=display:flex><span>	    <span style=color:#75715e>// 获取类名: 截取最后一个点和最后一个@之间的内容  </span>
</span></span><span style=display:flex><span>	    String className <span style=color:#f92672>=</span> pjp.<span style=color:#a6e22e>getTarget</span>().<span style=color:#a6e22e>toString</span>();  
</span></span><span style=display:flex><span>	    <span style=color:#66d9ef>int</span> lastPoint <span style=color:#f92672>=</span> className.<span style=color:#a6e22e>lastIndexOf</span>(<span style=color:#e6db74>&#34;.&#34;</span>) <span style=color:#f92672>+</span> 1;  
</span></span><span style=display:flex><span>	    <span style=color:#66d9ef>int</span> lastAt <span style=color:#f92672>=</span> className.<span style=color:#a6e22e>lastIndexOf</span>(<span style=color:#e6db74>&#34;@&#34;</span>);  
</span></span><span style=display:flex><span>	    className <span style=color:#f92672>=</span> className.<span style=color:#a6e22e>substring</span>(lastPoint, lastAt);  
</span></span><span style=display:flex><span>	  
</span></span><span style=display:flex><span>	    <span style=color:#75715e>// 获取方法名  </span>
</span></span><span style=display:flex><span>	    String methodName <span style=color:#f92672>=</span> pjp.<span style=color:#a6e22e>getSignature</span>().<span style=color:#a6e22e>getName</span>();  
</span></span><span style=display:flex><span>	  
</span></span><span style=display:flex><span>	    <span style=color:#75715e>// 前置通知: 记录日志  </span>
</span></span><span style=display:flex><span>	    log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;进入业务方法 {}.{}()，参数: {}&#34;</span>, className, methodName, Arrays.<span style=color:#a6e22e>toString</span>(args));  
</span></span><span style=display:flex><span>	  
</span></span><span style=display:flex><span>	    <span style=color:#75715e>// 前置通知: 检查参数中是否存在空值  </span>
</span></span><span style=display:flex><span>	    <span style=color:#66d9ef>if</span> (ObjectUtil.<span style=color:#a6e22e>hasNull</span>(args)) {  
</span></span><span style=display:flex><span>	        String msg <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;业务方法 &#34;</span> <span style=color:#f92672>+</span> className <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;.&#34;</span> <span style=color:#f92672>+</span> methodName <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;() 中存在null值参数&#34;</span>;  
</span></span><span style=display:flex><span>	        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(msg);  
</span></span><span style=display:flex><span>	    }  
</span></span><span style=display:flex><span>	  
</span></span><span style=display:flex><span>	    <span style=color:#75715e>// 调用目标方法  </span>
</span></span><span style=display:flex><span>	    Object returnValue <span style=color:#f92672>=</span> pjp.<span style=color:#a6e22e>proceed</span>(args);  
</span></span><span style=display:flex><span>	  
</span></span><span style=display:flex><span>	    <span style=color:#75715e>// 后置通知: 记录日志  </span>
</span></span><span style=display:flex><span>	    log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;离开业务方法 {}.{}()，结果: {}&#34;</span>, className, methodName, returnValue);  
</span></span><span style=display:flex><span>	  
</span></span><span style=display:flex><span>	    <span style=color:#75715e>// 返回目标方法的返回值  </span>
</span></span><span style=display:flex><span>	    <span style=color:#66d9ef>return</span> returnValue;  
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>tips: 测试任一业务方法，故意传递null值参数，查看是否执行AOP代码。</li></ul><h3 id=2-开发控制层切面代码>2. 开发控制层切面代码</h3><blockquote><p>心法: <code>lesson-server</code> 控制层切面任务</p></blockquote><table><thead><tr><th>通知</th><th>任务</th></tr></thead><tbody><tr><td>前置通知</td><td>记录请求日志</td></tr><tr><td>后置通知</td><td>无</td></tr><tr><td>返回通知</td><td>无</td></tr><tr><td>异常通知</td><td>AOP中的异常通知比全局异常处理类优先级高，建议将处理异常的工作让给全局异常处理类来做</td></tr></tbody></table><blockquote><p>武技: 在子项目 <code>lesson-server</code> 中开发控制层的AOP代码</p></blockquote><p><code>com.lsx.dto.RequestLogDTO</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Data</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RequestLogDTO</span> <span style=color:#66d9ef>implements</span> Serializable {  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**请求地址*/</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String url;  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**请求时间*/</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String requestTime;  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**请求方式*/</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String requestMethod;  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**来源地址*/</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String remoteAddress;  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**类全名称*/</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String className;  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**方法名称*/</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String methodName;  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**方法形参*/</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String parameters;  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**响应数据*/</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Object responseData;  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**请求耗时*/</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String spendTime;  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>com.lsx.component.ControllerAspect</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Aspect</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Component</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ControllerAspect</span> {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@SuppressWarnings</span>(<span style=color:#e6db74>&#34;all&#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@SneakyThrows</span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Around</span>(<span style=color:#e6db74>&#34;execution(public * com.lsx.controller.*.*(..))&#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>aroundAdvice</span>(ProceedingJoinPoint pjp) {  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 获取请求对象  </span>
</span></span><span style=display:flex><span>        HttpServletRequest request <span style=color:#f92672>=</span> ((ServletRequestAttributes) RequestContextHolder  
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>getRequestAttributes</span>()).<span style=color:#a6e22e>getRequest</span>();  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 构建控制器日志DTO实体: 包含本次请求的日志信息  </span>
</span></span><span style=display:flex><span>        RequestLogDTO requestLogDTO <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> RequestLogDTO();  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 请求时间  </span>
</span></span><span style=display:flex><span>        requestLogDTO.<span style=color:#a6e22e>setRequestTime</span>(DateUtil.<span style=color:#a6e22e>now</span>());  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 开启计时器  </span>
</span></span><span style=display:flex><span>        TimeInterval timer <span style=color:#f92672>=</span> DateUtil.<span style=color:#a6e22e>timer</span>(<span style=color:#66d9ef>true</span>);  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 执行业务方法  </span>
</span></span><span style=display:flex><span>        Object result <span style=color:#f92672>=</span> pjp.<span style=color:#a6e22e>proceed</span>(pjp.<span style=color:#a6e22e>getArgs</span>());  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 停止计时器，获得总耗时  </span>
</span></span><span style=display:flex><span>        requestLogDTO.<span style=color:#a6e22e>setSpendTime</span>(timer.<span style=color:#a6e22e>intervalPretty</span>());  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 设置请求URL，请求方式，请求地址，类名，方法名，参数，响应数据等  </span>
</span></span><span style=display:flex><span>        requestLogDTO.<span style=color:#a6e22e>setUrl</span>(request.<span style=color:#a6e22e>getRequestURL</span>().<span style=color:#a6e22e>toString</span>());  
</span></span><span style=display:flex><span>        requestLogDTO.<span style=color:#a6e22e>setRequestMethod</span>(request.<span style=color:#a6e22e>getMethod</span>());  
</span></span><span style=display:flex><span>        requestLogDTO.<span style=color:#a6e22e>setRemoteAddress</span>(request.<span style=color:#a6e22e>getRemoteAddr</span>());  
</span></span><span style=display:flex><span>        requestLogDTO.<span style=color:#a6e22e>setClassName</span>(pjp.<span style=color:#a6e22e>getSignature</span>().<span style=color:#a6e22e>getDeclaringTypeName</span>());  
</span></span><span style=display:flex><span>        requestLogDTO.<span style=color:#a6e22e>setMethodName</span>(pjp.<span style=color:#a6e22e>getSignature</span>().<span style=color:#a6e22e>getName</span>());  
</span></span><span style=display:flex><span>        requestLogDTO.<span style=color:#a6e22e>setParameters</span>(JSONUtil.<span style=color:#a6e22e>toJsonStr</span>(pjp.<span style=color:#a6e22e>getArgs</span>()));  
</span></span><span style=display:flex><span>        requestLogDTO.<span style=color:#a6e22e>setResponseData</span>(result);  
</span></span><span style=display:flex><span>        log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;请求日志: &#34;</span> <span style=color:#f92672>+</span> requestLogDTO);  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> result;  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>tips: 测试任一控制方法，查看是否成功记录请求日志。</li></ul><h2 id=e07-整合jwt校验>E07. 整合JWT校验</h2><h3 id=1-开发token拦截器>1. 开发Token拦截器</h3><p><code>com.lsx.component.TokenInterceptor</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TokenInterceptor</span> <span style=color:#66d9ef>implements</span> HandlerInterceptor {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@SneakyThrows</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>preHandle</span>(HttpServletRequest req, HttpServletResponse resp, Object handler) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 若目标方法不是Controller方法，则直接放行</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>(handler <span style=color:#66d9ef>instanceof</span> HandlerMethod)) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 若请求头中不存在Token令牌，则抛出异常</span>
</span></span><span style=display:flex><span>        String token <span style=color:#f92672>=</span> req.<span style=color:#a6e22e>getHeader</span>(JwtConst.<span style=color:#a6e22e>TOKEN_KEY</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (ObjectUtil.<span style=color:#a6e22e>isEmpty</span>(token)) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;Token令牌失效&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 解析Token令牌</span>
</span></span><span style=display:flex><span>        Map<span style=color:#f92672>&lt;</span>String, Object<span style=color:#f92672>&gt;</span> verifyResult <span style=color:#f92672>=</span> JwtUtil.<span style=color:#a6e22e>verify</span>(token);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 获取Token令牌的过期标记: true表示即将要过期</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>boolean</span> expireSoon <span style=color:#f92672>=</span> (<span style=color:#66d9ef>boolean</span>) verifyResult.<span style=color:#a6e22e>get</span>(JwtConst.<span style=color:#a6e22e>EXPIRATION_KEY</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 若Token令牌即将过期，则返回过期提示以及一个新的Token令牌</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (expireSoon) {
</span></span><span style=display:flex><span>            String newToken <span style=color:#f92672>=</span> (String) verifyResult.<span style=color:#a6e22e>get</span>(JwtConst.<span style=color:#a6e22e>NEW_TOKEN_KEY</span>);
</span></span><span style=display:flex><span>            resp.<span style=color:#a6e22e>setContentType</span>(<span style=color:#e6db74>&#34;application/json;charset=utf-8&#34;</span>);
</span></span><span style=display:flex><span>            resp.<span style=color:#a6e22e>getWriter</span>().<span style=color:#a6e22e>print</span>(<span style=color:#66d9ef>new</span> Result(ResultCode.<span style=color:#a6e22e>TOKEN_EXPIRING_SOON</span>, newToken));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 拦截请求</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 在服务端的session中存储会员的ID</span>
</span></span><span style=display:flex><span>        req.<span style=color:#a6e22e>getSession</span>().<span style=color:#a6e22e>setAttribute</span>(<span style=color:#e6db74>&#34;memberId&#34;</span>, verifyResult.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;id&#34;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 放行  </span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=2-配置token拦截器>2. 配置Token拦截器</h3><p><code>com.lsx.config.InterceptorConfig</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.config;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>InterceptorConfig</span> <span style=color:#66d9ef>implements</span> WebMvcConfigurer {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> TokenInterceptor tokenInterceptor;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addInterceptors</span>(InterceptorRegistry registry) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 将自定义拦截器注册到全局拦截器链中  </span>
</span></span><span style=display:flex><span>        registry.<span style=color:#a6e22e>addInterceptor</span>(tokenInterceptor)
</span></span><span style=display:flex><span>                <span style=color:#75715e>// 拦截所有 `/api/v1/**` 请求  </span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>addPathPatterns</span>(<span style=color:#e6db74>&#34;/api/v1/**&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#75715e>// 放行部分不需要Token验证的请求  </span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>excludePathPatterns</span>(
</span></span><span style=display:flex><span>                        <span style=color:#e6db74>&#34;/api/v1/banner/top5&#34;</span>,
</span></span><span style=display:flex><span>                        <span style=color:#e6db74>&#34;/api/v1/course/getInfo/*&#34;</span>,
</span></span><span style=display:flex><span>                        <span style=color:#e6db74>&#34;/api/v1/course/page&#34;</span>,
</span></span><span style=display:flex><span>                        <span style=color:#e6db74>&#34;/api/v1/course/pageLikeTitle&#34;</span>,
</span></span><span style=display:flex><span>                        <span style=color:#e6db74>&#34;/api/v1/member/loginByAccount&#34;</span>,
</span></span><span style=display:flex><span>                        <span style=color:#e6db74>&#34;/api/v1/member/getVcode/*&#34;</span>,
</span></span><span style=display:flex><span>                        <span style=color:#e6db74>&#34;/api/v1/member/loginByPhone&#34;</span>,
</span></span><span style=display:flex><span>                        <span style=color:#e6db74>&#34;/api/v1/member/register&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=s02-开发横幅接口>S02. 开发横幅接口</h1><blockquote><p>心法: Banner接口文档，统一使用 <code>/api/v1/banner</code> 前缀</p></blockquote><table><thead><tr><th></th><th>接口</th><th>类型</th><th>描述</th><th>请求参数</th><th>必要参数</th></tr></thead><tbody><tr><td>1</td><td><code>top5</code></td><td>GET</td><td>查看五条记录</td><td></td><td></td></tr></tbody></table><h2 id=e01-查看五条记录>E01. 查看五条记录</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

n1[查看前五条&lt;br/&gt;横幅记录] 
--&gt; n2[根据权重升序&lt;br/&gt;根据主键降序] 
--&gt; n3[加入&lt;br/&gt;缓存]
--&gt; n4[返回&lt;br/&gt;查询结果]
</code></pre><blockquote><p>武技: 查看前五条横幅记录</p></blockquote><h3 id=1-开发业务方法>1. 开发业务方法</h3><p><code>com.lsx.service.BannerService.top5()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 查看前五条横幅记录，根据权重字段升序，权重相同根据ID降序
</span></span></span><span style=display:flex><span><span style=color:#75715e> *  
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @return 前五条横幅记录  
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>  
</span></span><span style=display:flex><span>List<span style=color:#f92672>&lt;</span>Banner<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>top5</span>();
</span></span></code></pre></div><h3 id=2-重写业务方法>2. 重写业务方法</h3><p><code>com.lsx.service.impl.BannerServiceImpl.top5()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Cacheable</span>(key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#root.methodName&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>Banner<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>top5</span>() {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> bannerMapper.<span style=color:#a6e22e>selectListByQuery</span>(QueryWrapper.<span style=color:#a6e22e>create</span>()
</span></span><span style=display:flex><span>			.<span style=color:#a6e22e>limit</span>(5)
</span></span><span style=display:flex><span>			.<span style=color:#a6e22e>orderBy</span>(BANNER.<span style=color:#a6e22e>WEIGHT</span>.<span style=color:#a6e22e>asc</span>(), BANNER.<span style=color:#a6e22e>ID</span>.<span style=color:#a6e22e>desc</span>()));
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-开发控制方法>3. 开发控制方法</h3><p><code>com.lsx.controller.BannerController.top5()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;查看五条记录&#34;</span>, description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;根据权重字段升序，权重相同根据ID降序&#34;</span>)  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;top5&#34;</span>)  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>Banner<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>top5</span>() {  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> bannerService.<span style=color:#a6e22e>top5</span>();  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=s03-开发评论接口>S03. 开发评论接口</h1><blockquote><p>心法: Comment接口文档，统一使用 <code>/api/v1/comment</code> 前缀</p></blockquote><table><thead><tr><th></th><th>接口</th><th>类型</th><th>描述</th><th>请求参数</th><th>必要参数</th></tr></thead><tbody><tr><td>1</td><td><code>save</code></td><td>POST</td><td>添加一条记录</td><td><code>@RequestBody</code></td><td><code>Integer type</code><code>String content</code></td></tr><tr><td>2</td><td><code>listEpisodeComments/{fkEpisodeId}</code></td><td>GET</td><td>查看视频评论</td><td><code>@PathVariable</code></td><td><code>Long fkEpisodeId</code></td></tr></tbody></table><h2 id=e01-添加一条记录>E01. 添加一条记录</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

n1[主键&lt;br/&gt;置空] 
--&gt; n2[设置当前创建时间&lt;br/&gt;设置当前修改时间] 
--&gt; n3[添加&lt;br/&gt;记录]
--&gt; n4[逐出&lt;br/&gt;缓存]
--&gt; n5[返回&lt;br/&gt;布尔结果]
</code></pre><blockquote><p>武技: 添加一条评论记录</p></blockquote><h3 id=1-开发dto实体类>1. 开发DTO实体类</h3><p><code>com.lsx.dto.CommentInsertDTO</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Schema</span>(name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;评论添加DTO&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CommentInsertDTO</span> <span style=color:#66d9ef>implements</span> Serializable {
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotNull</span>(message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;评论目标不能为空&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;评论目标，0集次1评论&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Integer type;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;目标视频ID&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Long fkEpisodeId;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;目标评论ID&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Long fkCommentId;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;评论人ID&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Long fkMemberId;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotEmpty</span>(message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;评论内容不能为空&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Size</span>(min <span style=color:#f92672>=</span> 1, max <span style=color:#f92672>=</span> 512, message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;评论内容长度必须在1~512之间&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;评论内容&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String content;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=2-重写业务方法-1>2. 重写业务方法</h3><p><code>com.lsx.service.impl.CommentServiceImpl.save()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@CacheEvict</span>(allEntries <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>save</span>(Comment entity) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 清空主键</span>
</span></span><span style=display:flex><span>	entity.<span style=color:#a6e22e>setId</span>(<span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 设置创建时间和修改时间为当前时间</span>
</span></span><span style=display:flex><span>	entity.<span style=color:#a6e22e>setCreated</span>(LocalDateTime.<span style=color:#a6e22e>now</span>());
</span></span><span style=display:flex><span>	entity.<span style=color:#a6e22e>setUpdated</span>(LocalDateTime.<span style=color:#a6e22e>now</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>super</span>.<span style=color:#a6e22e>save</span>(entity);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-开发控制方法-1>3. 开发控制方法</h3><p><code>com.lsx.controller.CommentController.save()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;添加一条记录&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;save&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>save</span>(<span style=color:#a6e22e>@RequestBody</span> <span style=color:#a6e22e>@Validated</span> CommentInsertDTO dto, HttpSession session) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>long</span> memberId <span style=color:#f92672>=</span> (<span style=color:#66d9ef>long</span>)session.<span style=color:#a6e22e>getAttribute</span>(<span style=color:#e6db74>&#34;memberId&#34;</span>);
</span></span><span style=display:flex><span>    dto.<span style=color:#a6e22e>setFkMemberId</span>(memberId);
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> commentService.<span style=color:#a6e22e>save</span>(BeanUtil.<span style=color:#a6e22e>copyProperties</span>(dto, Comment.<span style=color:#a6e22e>class</span>));
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e02-查看视频评论>E02. 查看视频评论</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

n1[查询指定视频的全部评论及子评论&lt;br/&gt;全部评论均联查评论人信息]
--&gt; n2[根据创建时间&lt;br/&gt;降序] 
--&gt; n3[加入&lt;br/&gt;缓存]
--&gt; n4[返回&lt;br/&gt;全部子评论]
</code></pre><blockquote><p>武技: 查询指定视频的全部评论及子评论</p></blockquote><h3 id=1-优化orm实体类>1. 优化ORM实体类</h3><p><code>com.lsx.entity.Comment</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** 评论[1] : 子评论[N] */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RelationOneToMany</span>(selfField <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;id&#34;</span>, targetField <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;fkCommentId&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>Comment<span style=color:#f92672>&gt;</span> subComments;
</span></span></code></pre></div><h3 id=2-开发业务方法>2. 开发业务方法</h3><p><code>com.lsx.service.CommentService.listEpisodeComments()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 查询指定集次下的全部评论，包括子评论
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param fkEpisodeId 指定集次主键
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @return 指定集次下的全部评论，包括子评论
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>List<span style=color:#f92672>&lt;</span>Comment<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>listEpisodeComments</span>(Long fkEpisodeId);
</span></span></code></pre></div><h3 id=3-重写业务方法>3. 重写业务方法</h3><p><code>com.lsx.service.impl.CommentServiceImpl.listEpisodeComments()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Cacheable</span>(key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#root.methodName + &#39;:&#39; + #fkEpisodeId&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>Comment<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>listEpisodeComments</span>(Long fkEpisodeId) {
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 2层递归深度: subComments -&gt; member</span>
</span></span><span style=display:flex><span>	RelationManager.<span style=color:#a6e22e>setMaxDepth</span>(2);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 忽略roles联查</span>
</span></span><span style=display:flex><span>    RelationManager.<span style=color:#a6e22e>addIgnoreRelations</span>(<span style=color:#e6db74>&#34;roles&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 根据集次ID查看评论</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> commentMapper.<span style=color:#a6e22e>selectListWithRelationsByQuery</span>(QueryWrapper.<span style=color:#a6e22e>create</span>()
</span></span><span style=display:flex><span>			.<span style=color:#a6e22e>where</span>(COMMENT.<span style=color:#a6e22e>FK_EPISODE_ID</span>.<span style=color:#a6e22e>eq</span>(fkEpisodeId))
</span></span><span style=display:flex><span>			.<span style=color:#a6e22e>orderBy</span>(COMMENT.<span style=color:#a6e22e>CREATED</span>.<span style=color:#a6e22e>desc</span>()));
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=4-开发控制方法>4. 开发控制方法</h3><p><code>com.lsx.controller.CommentController.listEpisodeComments()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;查看视频评论&#34;</span>, description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;根据创建日期降序，同时联查子评论&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;listEpisodeComments/{fkEpisodeId}&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>Comment<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>listEpisodeComments</span>(<span style=color:#a6e22e>@PathVariable</span> Long fkEpisodeId) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> commentService.<span style=color:#a6e22e>listEpisodeComments</span>(fkEpisodeId);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=s04-开发举报接口>S04. 开发举报接口</h1><blockquote><p>心法: Report接口文档，统一使用 <code>/api/v1/report</code> 前缀</p></blockquote><table><thead><tr><th></th><th>接口</th><th>类型</th><th>描述</th><th>请求参数</th><th>必要参数</th></tr></thead><tbody><tr><td>1</td><td><code>save</code></td><td>POST</td><td>添加一条记录</td><td><code>@RequestBody</code></td><td><code>Integer type</code><code>String reason</code></td></tr></tbody></table><h2 id=e01-添加一条记录-1>E01. 添加一条记录</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

n1[主键&lt;br/&gt;置空] 
--&gt; n2[设置当前创建时间&lt;br/&gt;设置当前修改时间] 
--&gt; n3[添加&lt;br/&gt;记录]
--&gt; n4[逐出&lt;br/&gt;缓存]
--&gt; n5[返回&lt;br/&gt;布尔结果]
</code></pre><blockquote><p>武技: 添加一条举报记录</p></blockquote><h3 id=1-开发dto实体类-1>1. 开发DTO实体类</h3><p><code>com.lsx.dto.ReportInsertDTO</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Schema</span>(name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;举报添加DTO&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ReportInsertDTO</span> <span style=color:#66d9ef>implements</span> Serializable {
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotNull</span>(message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;举报目标不能为空&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;举报目标，0课程1评论&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Integer type;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;目标课程ID&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Long fkCourseId;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;目标评论ID&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Long fkCommentId;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;举报人ID&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Long fkMemberId;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotEmpty</span>(message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;举报内容不能为空&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Size</span>(min <span style=color:#f92672>=</span> 1, max <span style=color:#f92672>=</span> 256, message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;举报内容长度必须在1~256之间&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;举报内容&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String reason;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=2-重写业务方法-2>2. 重写业务方法</h3><p><code>com.lsx.service.impl.ReportServiceImpl.save()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@CacheEvict</span>(allEntries <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>save</span>(Report entity) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 清空主键</span>
</span></span><span style=display:flex><span>	entity.<span style=color:#a6e22e>setId</span>(<span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 设置创建时间和修改时间为当前时间</span>
</span></span><span style=display:flex><span>	entity.<span style=color:#a6e22e>setCreated</span>(LocalDateTime.<span style=color:#a6e22e>now</span>());
</span></span><span style=display:flex><span>	entity.<span style=color:#a6e22e>setUpdated</span>(LocalDateTime.<span style=color:#a6e22e>now</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>super</span>.<span style=color:#a6e22e>save</span>(entity);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-开发控制方法-2>3. 开发控制方法</h3><p><code>com.lsx.controller.ReportController.save()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;添加一条记录&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;save&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>save</span>(<span style=color:#a6e22e>@RequestBody</span> <span style=color:#a6e22e>@Validated</span> ReportInsertDTO dto, HttpSession session) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>long</span> memberId <span style=color:#f92672>=</span> (<span style=color:#66d9ef>long</span>)session.<span style=color:#a6e22e>getAttribute</span>(<span style=color:#e6db74>&#34;memberId&#34;</span>);
</span></span><span style=display:flex><span>	dto.<span style=color:#a6e22e>setFkMemberId</span>(memberId);
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> reportService.<span style=color:#a6e22e>save</span>(BeanUtil.<span style=color:#a6e22e>copyProperties</span>(dto, Report.<span style=color:#a6e22e>class</span>));
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=s05-开发购物车接口>S05. 开发购物车接口</h1><blockquote><p>心法: Cart接口文档，统一使用 <code>/api/v1/cart</code> 前缀</p></blockquote><table><thead><tr><th></th><th>接口</th><th>类型</th><th>描述</th><th>请求参数</th><th>必要参数</th></tr></thead><tbody><tr><td>1</td><td><code>save</code></td><td>POST</td><td>添加一条记录</td><td><code>@RequestBody</code></td><td><code>Long fkCourseId</code></td></tr><tr><td>2</td><td><code>page</code></td><td>GET</td><td>分页查询购物车</td><td></td><td><code>Long pageNumber</code><code>Long pageSize</code></td></tr><tr><td>3</td><td><code>totalAmount</code></td><td>GET</td><td>计算购物车总额</td><td></td><td></td></tr><tr><td>4</td><td><code>clear</code></td><td>POST</td><td>清空购物车记录</td><td></td><td></td></tr><tr><td>5</td><td><code>remove/{id}</code></td><td>POST</td><td>根据主键删除</td><td><code>@PathVariable</code></td><td><code>Long id</code></td></tr><tr><td>6</td><td><code>removeBatch</code></td><td>POST</td><td>根据主键批删</td><td><code>@RequestParam</code></td><td><code>List&lt;Long> ids</code></td></tr></tbody></table><h2 id=e01-添加一条记录-2>E01. 添加一条记录</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

f{&#34;是否重复&lt;br/&gt;添加购物&lt;br/&gt;车记录&#34;}
f --是--&gt; e[&#34;抛出&lt;br/&gt;异常&#34;]
f --否--&gt; n1[主键&lt;br/&gt;置空] 
	--&gt; n2[设置当前创建时间&lt;br/&gt;设置当前修改时间] 
	--&gt; n3[添加&lt;br/&gt;记录]
	--&gt; n4[逐出&lt;br/&gt;缓存]
	--&gt; n5[返回&lt;br/&gt;布尔结果]
</code></pre><blockquote><p>武技: 添加一条购物车记录</p></blockquote><h3 id=1-开发dto实体类-2>1. 开发DTO实体类</h3><p><code>com.lsx.dto.CartInsertDTO</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Schema</span>(name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;购物车添加DTO&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CartInsertDTO</span> <span style=color:#66d9ef>implements</span> Serializable {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;会员ID：购买人&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Long fkMemberId;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;课程ID：购买的课程&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Long fkCourseId;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=2-重写业务方法-3>2. 重写业务方法</h3><p><code>com.lsx.service.impl.CartServiceImpl.save()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@CacheEvict</span>(allEntries <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>save</span>(Cart entity) {
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 检查是否重复添加购物车</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> (cartMapper.<span style=color:#a6e22e>selectCountByQuery</span>(QueryWrapper.<span style=color:#a6e22e>create</span>()
</span></span><span style=display:flex><span>			.<span style=color:#a6e22e>where</span>(CART.<span style=color:#a6e22e>FK_MEMBER_ID</span>.<span style=color:#a6e22e>eq</span>(entity.<span style=color:#a6e22e>getFkMemberId</span>()))
</span></span><span style=display:flex><span>			.<span style=color:#a6e22e>and</span>(CART.<span style=color:#a6e22e>FK_COURSE_ID</span>.<span style=color:#a6e22e>eq</span>(entity.<span style=color:#a6e22e>getFkCourseId</span>()))) <span style=color:#f92672>&gt;</span> 0) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;无需重复添加购物车！&#34;</span>);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 清空主键</span>
</span></span><span style=display:flex><span>	entity.<span style=color:#a6e22e>setId</span>(<span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 设置创建时间和修改时间为当前时间</span>
</span></span><span style=display:flex><span>	entity.<span style=color:#a6e22e>setCreated</span>(LocalDateTime.<span style=color:#a6e22e>now</span>());
</span></span><span style=display:flex><span>	entity.<span style=color:#a6e22e>setUpdated</span>(LocalDateTime.<span style=color:#a6e22e>now</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>super</span>.<span style=color:#a6e22e>save</span>(entity);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-开发控制方法-3>3. 开发控制方法</h3><p><code>com.lsx.controller.CartController.save()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;添加一条记录&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;save&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>save</span>(<span style=color:#a6e22e>@RequestBody</span> <span style=color:#a6e22e>@Validated</span> CartInsertDTO dto, HttpSession session) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>long</span> memberId <span style=color:#f92672>=</span> (<span style=color:#66d9ef>long</span>)session.<span style=color:#a6e22e>getAttribute</span>(<span style=color:#e6db74>&#34;memberId&#34;</span>);  
</span></span><span style=display:flex><span>	dto.<span style=color:#a6e22e>setFkMemberId</span>(memberId);
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> cartService.<span style=color:#a6e22e>save</span>(BeanUtil.<span style=color:#a6e22e>copyProperties</span>(dto, Cart.<span style=color:#a6e22e>class</span>));
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e02-分页查询购物车>E02. 分页查询购物车</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

n1[根据会员主键&lt;br/&gt;分页查询购物车，同时联查课程信息] --&gt; f{是否&lt;br/&gt;存在}
	f --是--&gt; n2[加入缓存] --&gt; n2a[返回结果]
	f --否--&gt; n3[返回空值]
</code></pre><blockquote><p>武技: 根据会员主键分页查询购物车记录，同时联查课程信息</p></blockquote><h3 id=1-开发业务方法-1>1. 开发业务方法</h3><p><code>com.lsx.service.CartService.pageByMember()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 根据会员主键分页查询购物车记录
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param page     分页信息
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param memberId 会员主键
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @return 分页信息
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>Page<span style=color:#f92672>&lt;</span>Cart<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>pageByMember</span>(Page<span style=color:#f92672>&lt;</span>Cart<span style=color:#f92672>&gt;</span> page, <span style=color:#66d9ef>long</span> memberId);
</span></span></code></pre></div><h3 id=2-重写业务方法-4>2. 重写业务方法</h3><p><code>com.lsx.service.impl.CartServiceImpl.pageByMember()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Cacheable</span>(key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#root.methodName + &#39;:&#39; + #page.getPageSize() + &#39;:&#39; + #page.getPageNumber()&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> Page<span style=color:#f92672>&lt;</span>Cart<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>pageByMember</span>(Page<span style=color:#f92672>&lt;</span>Cart<span style=color:#f92672>&gt;</span> page, <span style=color:#66d9ef>long</span> memberId) {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 忽略member  </span>
</span></span><span style=display:flex><span>	RelationManager.<span style=color:#a6e22e>addIgnoreRelations</span>(<span style=color:#e6db74>&#34;member&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> cartMapper.<span style=color:#a6e22e>paginateWithRelations</span>(page, QueryWrapper.<span style=color:#a6e22e>create</span>()
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>where</span>(CART.<span style=color:#a6e22e>FK_MEMBER_ID</span>.<span style=color:#a6e22e>eq</span>(memberId)));
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-开发控制方法-4>3. 开发控制方法</h3><p><code>com.lsx.controller.CartController.page()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;分页查询购物车&#34;</span>, description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;同时联查课程信息&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;page&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> Page<span style=color:#f92672>&lt;</span>Cart<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>page</span>(Page<span style=color:#f92672>&lt;</span>Cart<span style=color:#f92672>&gt;</span> page, HttpSession session) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>long</span> memberId <span style=color:#f92672>=</span> (<span style=color:#66d9ef>long</span>)session.<span style=color:#a6e22e>getAttribute</span>(<span style=color:#e6db74>&#34;memberId&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> cartService.<span style=color:#a6e22e>pageByMember</span>(page, memberId);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e03-分页查询购物车>E03. 分页查询购物车</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

n1[根据会员主键&lt;br/&gt;查询购物车记录] 
--&gt; n2[&#34;计算总金额&#34;] 
--&gt; n3[加入缓存] 
--&gt; n4[返回结果]
</code></pre><blockquote><p>武技: 根据会员主键计算购物车总金额</p></blockquote><h3 id=1-开发业务方法-2>1. 开发业务方法</h3><p><code>com.lsx.service.CartService.totalAmount()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 根据会员主键计算购物车记录总金额
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param memberId 会员主键
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @return 购物车记录总金额
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>double</span> <span style=color:#a6e22e>totalAmount</span>(<span style=color:#66d9ef>long</span> memberId);
</span></span></code></pre></div><h3 id=2-重写业务方法-5>2. 重写业务方法</h3><p><code>com.lsx.service.impl.CartServiceImpl.totalAmount()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Cacheable</span>(key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#root.methodName + &#39;:&#39; + #memberId&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>double</span> <span style=color:#a6e22e>totalAmount</span>(<span style=color:#66d9ef>long</span> memberId) {
</span></span><span style=display:flex><span>    AtomicReference<span style=color:#f92672>&lt;</span>Double<span style=color:#f92672>&gt;</span> totalAmount <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> AtomicReference<span style=color:#f92672>&lt;&gt;</span>(0.<span style=color:#a6e22e>0</span>);
</span></span><span style=display:flex><span>    List<span style=color:#f92672>&lt;</span>Cart<span style=color:#f92672>&gt;</span> carts <span style=color:#f92672>=</span> cartMapper.<span style=color:#a6e22e>selectListWithRelationsByQuery</span>(QueryWrapper.<span style=color:#a6e22e>create</span>()
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>where</span>(CART.<span style=color:#a6e22e>FK_MEMBER_ID</span>.<span style=color:#a6e22e>eq</span>(memberId)));
</span></span><span style=display:flex><span>    carts.<span style=color:#a6e22e>forEach</span>(cart <span style=color:#f92672>-&gt;</span> totalAmount.<span style=color:#a6e22e>updateAndGet</span>(v <span style=color:#f92672>-&gt;</span> v <span style=color:#f92672>+</span> cart.<span style=color:#a6e22e>getCourse</span>().<span style=color:#a6e22e>getPrice</span>()));
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> totalAmount.<span style=color:#a6e22e>get</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-开发控制方法-5>3. 开发控制方法</h3><p><code>com.lsx.controller.CartController.totalAmount()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;计算购物车总额&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;totalAmount&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>double</span> <span style=color:#a6e22e>totalAmount</span>(HttpSession session) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>long</span> memberId <span style=color:#f92672>=</span> (<span style=color:#66d9ef>long</span>)session.<span style=color:#a6e22e>getAttribute</span>(<span style=color:#e6db74>&#34;memberId&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> cartService.<span style=color:#a6e22e>totalAmount</span>(memberId);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e04-清空购物车记录>E04. 清空购物车记录</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

n1[根据会员主键&lt;br/&gt;清空购物车记录]
--&gt; n2[逐出&lt;br/&gt;缓存]
--&gt; n3[返回&lt;br/&gt;布尔结果]
</code></pre><blockquote><p>武技: 根据会员主键清空购物车记录</p></blockquote><h3 id=1-开发业务方法-3>1. 开发业务方法</h3><p><code>com.lsx.service.CartService.removeByMember()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 根据会员主键删除购物车记录
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param memberId 会员主键
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @return true成功，false失败
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>removeByMember</span>(Long memberId);
</span></span></code></pre></div><h3 id=2-重写业务方法-6>2. 重写业务方法</h3><p><code>com.lsx.service.impl.CartServiceImpl.removeByMember()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@CacheEvict</span>(allEntries <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>)  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>removeByMember</span>(Long memberId) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> cartMapper.<span style=color:#a6e22e>deleteByQuery</span>(QueryWrapper.<span style=color:#a6e22e>create</span>()
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>where</span>(CART.<span style=color:#a6e22e>FK_MEMBER_ID</span>.<span style=color:#a6e22e>eq</span>(memberId))) <span style=color:#f92672>&gt;</span> 0;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-开发控制方法-6>3. 开发控制方法</h3><p><code>com.lsx.controller.CartController.clear()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;清空购物车记录&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;clear&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>clear</span>(HttpSession session) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>long</span> memberId <span style=color:#f92672>=</span> (<span style=color:#66d9ef>long</span>)session.<span style=color:#a6e22e>getAttribute</span>(<span style=color:#e6db74>&#34;memberId&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> cartService.<span style=color:#a6e22e>removeByMember</span>(memberId);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e05-删除购物车记录>E05. 删除购物车记录</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

n1[根据购物车主键&lt;br/&gt;删除购物车记录]
--&gt; n2[逐出&lt;br/&gt;缓存]
--&gt; n3[返回&lt;br/&gt;布尔结果]
</code></pre><blockquote><p>武技: 根据购物车主键删除购物车记录</p></blockquote><h3 id=1-重写业务方法>1. 重写业务方法</h3><p><code>com.lsx.service.impl.CartServiceImpl.removeById()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@CacheEvict</span>(allEntries <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>removeById</span>(Serializable id) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>super</span>.<span style=color:#a6e22e>removeById</span>(id);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=2-开发控制方法>2. 开发控制方法</h3><p><code>com.lsx.controller.CartController.removeById()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;删除购物车记录&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;remove/{id}&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>remove</span>(<span style=color:#a6e22e>@PathVariable</span> Long id) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> cartService.<span style=color:#a6e22e>removeById</span>(id);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e06-批删购物车记录>E06. 批删购物车记录</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

n1[根据购物车主键数组&lt;br/&gt;批量删除购物车记录]
--&gt; n2[逐出&lt;br/&gt;缓存]
--&gt; n3[返回&lt;br/&gt;布尔结果]
</code></pre><blockquote><p>武技: 根据购物车主键数组批量删除购物车记录</p></blockquote><h3 id=1-重写业务方法-1>1. 重写业务方法</h3><p><code>com.lsx.service.impl.CartServiceImpl.removeByIds()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@CacheEvict</span>(allEntries <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>)  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>removeByIds</span>(Collection<span style=color:#f92672>&lt;?</span> <span style=color:#66d9ef>extends</span> Serializable<span style=color:#f92672>&gt;</span> ids) {  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>super</span>.<span style=color:#a6e22e>removeByIds</span>(ids);  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=2-开发控制方法-1>2. 开发控制方法</h3><p><code>com.lsx.controller.CartController.removeBatch()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;批删购物车记录&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;removeBatch&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>removeBatch</span>(<span style=color:#a6e22e>@RequestParam</span> List<span style=color:#f92672>&lt;</span>Long<span style=color:#f92672>&gt;</span> ids) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> cartService.<span style=color:#a6e22e>removeByIds</span>(ids);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=s06-开发优惠卷接口>S06. 开发优惠卷接口</h1><blockquote><p>心法: Coupans接口文档，统一使用 <code>/api/v1/coupans</code> 前缀</p></blockquote><table><thead><tr><th></th><th>接口</th><th>类型</th><th>描述</th><th>请求参数</th><th>必要参数</th></tr></thead><tbody><tr><td>1</td><td><code>getByCode/{code}</code></td><td>GET</td><td>根据兑换码查询</td><td><code>@PathVariable</code></td><td><code>String code</code></td></tr></tbody></table><h2 id=e01-根据兑换码查询>E01. 根据兑换码查询</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

n1[根据兑换码&lt;br/&gt;查询优惠卷] --&gt; f{是否&lt;br/&gt;存在}
	f --是--&gt; f2{是否&lt;br/&gt;过期}
		f2 --否--&gt; n2[加入缓存] --&gt; n2a[返回结果]
		f2 --是--&gt; n3[返回空值]
	f --否--&gt; n3
</code></pre><blockquote><p>武技: 根据兑换码查询一条优惠卷记录</p></blockquote><h3 id=1-开发业务方法-4>1. 开发业务方法</h3><p><code>com.lsx.service.CoupansService.getByCode()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 根据优惠卷兑换码查询一条优惠卷记录
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param code 优惠卷兑换码
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @return 一条优惠卷记录，若过期或不存在则返回null值
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>Coupons <span style=color:#a6e22e>getByCode</span>(String code);
</span></span></code></pre></div><h3 id=2-重写业务方法-7>2. 重写业务方法</h3><p><code>com.lsx.service.impl.CoupansServiceImpl.getByCode()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Cacheable</span>(key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#code&#34;</span>, unless <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#result == null&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> Coupons <span style=color:#a6e22e>getByCode</span>(String code) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> couponsMapper.<span style=color:#a6e22e>selectOneByQuery</span>(QueryWrapper.<span style=color:#a6e22e>create</span>()
</span></span><span style=display:flex><span>			.<span style=color:#a6e22e>where</span>(COUPONS.<span style=color:#a6e22e>CODE</span>.<span style=color:#a6e22e>eq</span>(code))
</span></span><span style=display:flex><span>			.<span style=color:#a6e22e>and</span>(COUPONS.<span style=color:#a6e22e>STATE</span>.<span style=color:#a6e22e>eq</span>(CouponsConst.<span style=color:#a6e22e>AVAILABLE</span>))
</span></span><span style=display:flex><span>			.<span style=color:#a6e22e>and</span>(dateDiff(COUPONS.<span style=color:#a6e22e>END_AT</span>, curDate()).<span style=color:#a6e22e>gt</span>(0)));
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-开发控制方法-7>3. 开发控制方法</h3><p><code>com.lsx.controller.CouponsController.getByCode()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;根据兑换码查询&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;getByCode/{code}&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> Coupons <span style=color:#a6e22e>getByCode</span>(<span style=color:#a6e22e>@PathVariable</span> String code) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> couponsService.<span style=color:#a6e22e>getByCode</span>(code);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=s07-开发订单接口>S07. 开发订单接口</h1><blockquote><p>心法: Order接口文档，统一使用 <code>/api/v1/order</code> 前缀</p></blockquote><table><thead><tr><th></th><th>接口</th><th>类型</th><th>描述</th><th>请求参数</th><th>必要参数</th></tr></thead><tbody><tr><td>1</td><td><code>save</code></td><td>POST</td><td>添加一条记录</td><td><code>@RequestBody</code></td><td><code>List&lt;Long> courseIds</code><code>Double totalAmount</code><code>Double payAmount</code><code>Integer payType</code></td></tr><tr><td>2</td><td><code>page</code></td><td>GET</td><td>分页查询订单</td><td></td><td><code>Long pageNumber</code><code>Long pageSize</code></td></tr><tr><td>3</td><td><code>remove/{id}</code></td><td>POST</td><td>根据主键删除</td><td><code>@PathVariable</code></td><td><code>Long id</code></td></tr><tr><td>4</td><td><code>removeBatch</code></td><td>POST</td><td>批删订单记录</td><td><code>@RequestParam</code></td><td><code>List&lt;Long> ids</code></td></tr></tbody></table><h2 id=e01-添加一条记录-3>E01. 添加一条记录</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

n1[主键&lt;br/&gt;置空] 
--&gt; n2[设置当前创建时间&lt;br/&gt;设置当前修改时间] 
--&gt; n3[添加&lt;br/&gt;记录]
--&gt; n4[逐出&lt;br/&gt;缓存]
--&gt; n5[返回&lt;br/&gt;布尔结果]
</code></pre><blockquote><p>武技: 添加一条订单记录</p></blockquote><h3 id=1-开发dto实体类-3>1. 开发DTO实体类</h3><p><code>com.lsx.dto.OrderInsertDTO</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Schema</span>(name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;订单添加DTO&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrderInsertDTO</span> <span style=color:#66d9ef>implements</span> Serializable {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;课程主键数组&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotNull</span>(message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;课程主键数组不能为空&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Size</span>(min <span style=color:#f92672>=</span> 1, message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;课程主键数组长度不能少于1&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>Long<span style=color:#f92672>&gt;</span> courseIds;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;订单总金额&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotNull</span>(message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;订单总金额不能为空&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@DecimalMin</span>(value <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0&#34;</span>, message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;订单总金额不能小于0元&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Double totalAmount;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;订单实际支付总金额&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotNull</span>(message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;订单实际支付总金额不能为空&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@DecimalMin</span>(value <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0&#34;</span>, message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;订单实际支付总金额不能小于0元&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Double payAmount;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotNull</span>(message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;支付方式不能为空&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;支付方式，0未支付，1支付宝，2微信，3其他&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Integer payType;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;订单描述&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Size</span>(min <span style=color:#f92672>=</span> 1, max <span style=color:#f92672>=</span> 512, message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;订单描述长度必须在1~512之间&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String info;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Null</span>(message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;不要传递会员ID&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;会员ID：下单人&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Long fkMemberId;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Null</span>(message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;不要传递会员账号&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;会员账号：下单人账号&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String username;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;优惠卷ID：下单时使用的优惠卷&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Long fkCouponsId;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=2-开发业务方法-1>2. 开发业务方法</h3><p><code>com.lsx.service.OrderService.save()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 添加一条订单记录
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param entity    订单实体
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param courseIds 课程主键数组
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @return true成功，false失败
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>save</span>(Order entity, List<span style=color:#f92672>&lt;</span>Long<span style=color:#f92672>&gt;</span> courseIds);
</span></span></code></pre></div><h3 id=3-重写业务方法-1>3. 重写业务方法</h3><p><code>com.lsx.service.impl.OrderServiceImpl.save()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@CacheEvict</span>(allEntries <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Transactional</span>(rollbackFor <span style=color:#f92672>=</span> Exception.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>save</span>(Order entity, List<span style=color:#f92672>&lt;</span>Long<span style=color:#f92672>&gt;</span> courseIds) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 取出会员ID</span>
</span></span><span style=display:flex><span>    Long fkMemberId <span style=color:#f92672>=</span> entity.<span style=color:#a6e22e>getFkMemberId</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 查看会员是否存在</span>
</span></span><span style=display:flex><span>    Member member <span style=color:#f92672>=</span> memberMapper.<span style=color:#a6e22e>selectOneByCondition</span>(MEMBER.<span style=color:#a6e22e>ID</span>.<span style=color:#a6e22e>eq</span>(fkMemberId));
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (ObjectUtil.<span style=color:#a6e22e>isNull</span>(member)) <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;下单失败: 会员不存在&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 查看即将购买的视频是否全都存在</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>long</span> courseCount <span style=color:#f92672>=</span> courseMapper.<span style=color:#a6e22e>selectCountByCondition</span>(COURSE.<span style=color:#a6e22e>ID</span>.<span style=color:#a6e22e>in</span>(courseIds));
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (courseCount <span style=color:#f92672>&lt;</span> courseIds.<span style=color:#a6e22e>size</span>()) <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;下单失败: 至少一门课程不存在&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 查看当前会员的全部订单</span>
</span></span><span style=display:flex><span>    List<span style=color:#f92672>&lt;</span>Order<span style=color:#f92672>&gt;</span> orders <span style=color:#f92672>=</span> orderMapper.<span style=color:#a6e22e>selectListWithRelationsByQuery</span>(QueryWrapper.<span style=color:#a6e22e>create</span>()
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>where</span>(ORDER.<span style=color:#a6e22e>FK_MEMBER_ID</span>.<span style=color:#a6e22e>eq</span>(fkMemberId)));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 校验是否重复购买任意课程</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (Long courseId : courseIds) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (Order order : orders) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> (Course course : order.<span style=color:#a6e22e>getCourses</span>()) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (course.<span style=color:#a6e22e>getId</span>().<span style=color:#a6e22e>equals</span>(courseId)) {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;下单失败: 至少一门课程已购买&#34;</span>);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 构建Order实体：清空主键，随机生成订单号，设置创建时间和修改时间为当前时间</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 若支付类型为 &#34;未支付&#34; 则表示订单状态为 &#34;未支付&#34;，否则订单状态为 &#34;已支付&#34;</span>
</span></span><span style=display:flex><span>    entity.<span style=color:#a6e22e>setId</span>(<span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>    entity.<span style=color:#a6e22e>setSn</span>(RandomUtil.<span style=color:#a6e22e>randomNumbers</span>(19));
</span></span><span style=display:flex><span>    entity.<span style=color:#a6e22e>setCreated</span>(LocalDateTime.<span style=color:#a6e22e>now</span>());
</span></span><span style=display:flex><span>    entity.<span style=color:#a6e22e>setUpdated</span>(LocalDateTime.<span style=color:#a6e22e>now</span>());
</span></span><span style=display:flex><span>	entity.<span style=color:#a6e22e>setState</span>(entity.<span style=color:#a6e22e>getPayType</span>().<span style=color:#a6e22e>equals</span>(OrderConst.<span style=color:#a6e22e>NO_PAY</span>) <span style=color:#f92672>?</span> 
</span></span><span style=display:flex><span>		OrderConst.<span style=color:#a6e22e>UNPAID</span> : OrderConst.<span style=color:#a6e22e>PAID</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 添加订单基础表</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (orderMapper.<span style=color:#a6e22e>insert</span>(entity) <span style=color:#f92672>&lt;=</span> 0) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;下单失败: 订单表数据库记录添加失败&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 循环添加订单课程中间表记录</span>
</span></span><span style=display:flex><span>    Long orderId <span style=color:#f92672>=</span> entity.<span style=color:#a6e22e>getId</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (Long courseId : courseIds) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 构建订单课程中间表实体</span>
</span></span><span style=display:flex><span>        OrderCourse orderCourse <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> OrderCourse();
</span></span><span style=display:flex><span>        orderCourse.<span style=color:#a6e22e>setFkCourseId</span>(courseId);
</span></span><span style=display:flex><span>        orderCourse.<span style=color:#a6e22e>setFkOrderId</span>(orderId);
</span></span><span style=display:flex><span>        orderCourse.<span style=color:#a6e22e>setCreated</span>(LocalDateTime.<span style=color:#a6e22e>now</span>());
</span></span><span style=display:flex><span>        orderCourse.<span style=color:#a6e22e>setUpdated</span>(LocalDateTime.<span style=color:#a6e22e>now</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 添加订单课程中间表记录，若添加失败则抛出异常触发回滚</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (orderCourseMapper.<span style=color:#a6e22e>insert</span>(orderCourse) <span style=color:#f92672>&lt;=</span> 0) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;下单失败: 订单明细表数据库记录添加失败&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=4-开发控制方法-1>4. 开发控制方法</h3><p><code>com.lsx.controller.OrderController.save()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;下单购买商品&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;/save&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>save</span>(<span style=color:#a6e22e>@RequestBody</span> <span style=color:#a6e22e>@Validated</span> OrderInsertDTO dto, HttpSession session) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>long</span> memberId <span style=color:#f92672>=</span> (<span style=color:#66d9ef>long</span>)session.<span style=color:#a6e22e>getAttribute</span>(<span style=color:#e6db74>&#34;memberId&#34;</span>);
</span></span><span style=display:flex><span>    String username <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;admin&#34;</span>;
</span></span><span style=display:flex><span>    dto.<span style=color:#a6e22e>setFkMemberId</span>(memberId);
</span></span><span style=display:flex><span>    dto.<span style=color:#a6e22e>setUsername</span>(username);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> orderService.<span style=color:#a6e22e>save</span>(BeanUtil.<span style=color:#a6e22e>copyProperties</span>(dto, Order.<span style=color:#a6e22e>class</span>), dto.<span style=color:#a6e22e>getCourseIds</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e02-分页查询订单>E02. 分页查询订单</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

n1[根据会员ID分页查询&lt;br/&gt;订单记录] 
--&gt; n2[根据创建时间降序&lt;br/&gt;根据主键降序] 
--&gt; n3[加入&lt;br/&gt;缓存]
--&gt; n4[返回&lt;br/&gt;分页结果]
</code></pre><blockquote><p>武技: 根据会员ID分页查询订单记录，级联查询每个订单下的全部商品</p></blockquote><h3 id=1-优化orm实体类-1>1. 优化ORM实体类</h3><p><code>com.lsx.entity.Order</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** 订单[N] : 课程[N] */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RelationManyToMany</span>(
</span></span><span style=display:flex><span>		selfField <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;id&#34;</span>, targetField <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;id&#34;</span>,
</span></span><span style=display:flex><span>		joinTable <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;oms_order_course&#34;</span>,
</span></span><span style=display:flex><span>		joinSelfColumn <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;fk_order_id&#34;</span>, joinTargetColumn <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;fk_course_id&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>Course<span style=color:#f92672>&gt;</span> courses;
</span></span></code></pre></div><h3 id=2-开发业务方法-2>2. 开发业务方法</h3><p><code>com.lsx.service.OrderService.pageByMember()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 根据会员ID分页查询订单记录，级联查询每个订单下的全部商品
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param page     分页实体
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param memberId 会员ID
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @return 分页数据
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>Page<span style=color:#f92672>&lt;</span>Order<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>pageByMember</span>(Page<span style=color:#f92672>&lt;</span>Order<span style=color:#f92672>&gt;</span> page, Long memberId);
</span></span></code></pre></div><h3 id=3-重写业务方法-2>3. 重写业务方法</h3><p><code>com.lsx.service.impl.OrderServiceImpl.pageByMember()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Cacheable</span>(key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#root.methodName + &#39;:&#39; + #memberId + &#39;:&#39; &#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;+ #page.getPageSize() + &#39;:&#39; + #page.getPageNumber()&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> Page<span style=color:#f92672>&lt;</span>Order<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>pageByMember</span>(Page<span style=color:#f92672>&lt;</span>Order<span style=color:#f92672>&gt;</span> page, Long memberId) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> orderMapper.<span style=color:#a6e22e>paginateWithRelations</span>(page, QueryWrapper.<span style=color:#a6e22e>create</span>()
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>where</span>(ORDER.<span style=color:#a6e22e>FK_MEMBER_ID</span>.<span style=color:#a6e22e>eq</span>(memberId))
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>orderBy</span>(ORDER.<span style=color:#a6e22e>CREATED</span>.<span style=color:#a6e22e>desc</span>(), ORDER.<span style=color:#a6e22e>ID</span>.<span style=color:#a6e22e>desc</span>()));
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=4-开发控制方法-2>4. 开发控制方法</h3><p><code>com.lsx.controller.OrderController.page()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;分页查询订单&#34;</span>, description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;级联查询每个订单下的全部商品&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;page&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> Page<span style=color:#f92672>&lt;</span>Order<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>page</span>(Page<span style=color:#f92672>&lt;</span>Order<span style=color:#f92672>&gt;</span> page, HttpSession session) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>long</span> memberId <span style=color:#f92672>=</span> (<span style=color:#66d9ef>long</span>)session.<span style=color:#a6e22e>getAttribute</span>(<span style=color:#e6db74>&#34;memberId&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> orderService.<span style=color:#a6e22e>pageByMember</span>(page, memberId);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e03-根据主键删除>E03. 根据主键删除</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

n1[根据主键&lt;br/&gt;删除订单记录]
--&gt; n2[逐出&lt;br/&gt;缓存]
--&gt; n3[返回&lt;br/&gt;布尔结果]
</code></pre><blockquote><p>武技: 根据主键删除一条订单记录</p></blockquote><h3 id=1-重写业务方法-2>1. 重写业务方法</h3><p><code>com.lsx.service.impl.OrderServiceImpl.removeById()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@CacheEvict</span>(allEntries <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Transactional</span>(rollbackFor <span style=color:#f92672>=</span> Exception.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>removeById</span>(Serializable id) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 按订单主键删除中间表记录  </span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> (orderCourseMapper.<span style=color:#a6e22e>deleteByCondition</span>(ORDER_COURSE.<span style=color:#a6e22e>FK_ORDER_ID</span>.<span style=color:#a6e22e>eq</span>(id)) <span style=color:#f92672>&lt;=</span> 0) {  
</span></span><span style=display:flex><span>	    <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;删除订单失败: 该订单无明细数据&#34;</span>);  
</span></span><span style=display:flex><span>	}  
</span></span><span style=display:flex><span>	  
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 按订单主键删除一条订单记录  </span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> (orderMapper.<span style=color:#a6e22e>deleteById</span>(id) <span style=color:#f92672>&lt;=</span> 0) {  
</span></span><span style=display:flex><span>	    <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;删除订单失败: 订单不存在&#34;</span>);  
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=2-开发控制方法-2>2. 开发控制方法</h3><p><code>com.lsx.controller.OrderController.remove()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;根据主键删除&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;remove/{id}&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>remove</span>(<span style=color:#a6e22e>@PathVariable</span> Long id) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> orderService.<span style=color:#a6e22e>removeById</span>(id);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e04-根据主键批删>E04. 根据主键批删</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

n1[根据主键列表&lt;br/&gt;批量删除订单记录]
--&gt; n2[逐出&lt;br/&gt;缓存]
--&gt; n3[返回&lt;br/&gt;布尔结果]
</code></pre><blockquote><p>武技: 根据主键数组批量删除订单记录</p></blockquote><h3 id=1-重写业务方法-3>1. 重写业务方法</h3><p><code>com.lsx.service.impl.OrderServiceImpl.removeByIds()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@CacheEvict</span>(allEntries <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>)  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Transactional</span>(rollbackFor <span style=color:#f92672>=</span> Exception.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>removeByIds</span>(Collection<span style=color:#f92672>&lt;?</span> <span style=color:#66d9ef>extends</span> Serializable<span style=color:#f92672>&gt;</span> ids) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 按订单主键批量删除中间表记录</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (orderCourseMapper.<span style=color:#a6e22e>deleteByCondition</span>(ORDER_COURSE.<span style=color:#a6e22e>FK_ORDER_ID</span>.<span style=color:#a6e22e>in</span>(ids)) <span style=color:#f92672>&lt;=</span> 0) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;删除订单失败: 该订单无明细数据&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 按订单主键批量删除订单记录</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (orderMapper.<span style=color:#a6e22e>deleteBatchByIds</span>(ids) <span style=color:#f92672>&lt;=</span> 0) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;删除订单失败: 订单不存在&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=2-重写控制方法>2. 重写控制方法</h3><p><code>com.lsx.controller.OrderController.removeBatch()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;根据主键批删&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;removeBatch&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>removeBatch</span>(<span style=color:#a6e22e>@RequestParam</span> List<span style=color:#f92672>&lt;</span>Long<span style=color:#f92672>&gt;</span> ids) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> orderService.<span style=color:#a6e22e>removeByIds</span>(ids);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=s08-开发课程接口>S08. 开发课程接口</h1><blockquote><p>心法: Course接口文档，统一使用 <code>/api/v1/course</code> 前缀</p></blockquote><table><thead><tr><th></th><th>接口</th><th>类型</th><th>描述</th><th>请求参数</th><th>必要参数</th></tr></thead><tbody><tr><td>1</td><td><code>getInfo/{id}</code></td><td>GET</td><td>根据主键查询</td><td><code>@PathVariable</code></td><td><code>Long id</code></td></tr></tbody></table><h2 id=e01-根据主键查询>E01. 根据主键查询</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

n1[根据主键&lt;br/&gt;查询课程] --&gt; f{是否&lt;br/&gt;存在}
	f --是--&gt; n2[加入缓存] --&gt; n2a[返回结果]
	f --否--&gt; n3[返回空值]
</code></pre><blockquote><p>武技: 根据主键查询一条课程记录，同时联查作者信息和类目信息</p></blockquote><h3 id=1-优化orm实体类-2>1. 优化ORM实体类</h3><p><code>com.lsx.entity.Course</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** 课程[N] : 作者[1] */</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RelationManyToOne</span>(selfField <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;fkMemberId&#34;</span>, targetField <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;id&#34;</span>)  
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> Member member;  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#75715e>/** 课程[N] : 类目[1] */</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RelationManyToOne</span>(selfField <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;fkCategoryId&#34;</span>, targetField <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;id&#34;</span>)  
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> Category category;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** 课程[1] : 季次[N] */</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RelationOneToMany</span>(selfField <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;id&#34;</span>, targetField <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;fkCourseId&#34;</span>)  
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>Season<span style=color:#f92672>&gt;</span> seasons;
</span></span></code></pre></div><p><code>com.lsx.entity.Season</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** 季次[1] : 集次[N] */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RelationOneToMany</span>(selfField <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;id&#34;</span>, targetField <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;fkSeasonId&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>Episode<span style=color:#f92672>&gt;</span> episodes;
</span></span></code></pre></div><h3 id=2-重写业务方法-8>2. 重写业务方法</h3><p><code>com.lsx.service.impl.CourseServiceImpl.getById()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Cacheable</span>(key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#id&#34;</span>, unless <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#result == null&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> Course <span style=color:#a6e22e>getById</span>(Serializable id) {
</span></span><span style=display:flex><span>    RelationManager.<span style=color:#a6e22e>addIgnoreRelations</span>(<span style=color:#e6db74>&#34;roles&#34;</span>, <span style=color:#e6db74>&#34;course&#34;</span>, <span style=color:#e6db74>&#34;season&#34;</span>);
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> courseMapper.<span style=color:#a6e22e>selectOneWithRelationsById</span>(id);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-开发控制方法-8>3. 开发控制方法</h3><p><code>com.lsx.service.controller.CourseController.getInfo()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;根据主键查询&#34;</span>, description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;同时联查作者信息和类目信息&#34;</span>)  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;getInfo/{id}&#34;</span>)  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> Course <span style=color:#a6e22e>getInfo</span>(<span style=color:#a6e22e>@PathVariable</span> Long id) {  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> courseService.<span style=color:#a6e22e>getById</span>(id);  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=s09-开发会员接口>S09. 开发会员接口</h1><blockquote><p>心法: Member接口文档，统一使用 <code>/api/v1/member</code> 前缀</p></blockquote><table><thead><tr><th></th><th>接口</th><th>类型</th><th>描述</th><th>请求参数</th><th>必要参数</th></tr></thead><tbody><tr><td>1</td><td><code>register</code></td><td>POST</td><td>注册一名会员</td><td><code>@RequestBody</code></td><td><code>String username</code><code>String password</code><code>String phone</code><code>String email</code><code>String idcard</code><code>String realname</code></td></tr><tr><td>2</td><td><code>loginByAccount</code></td><td>POST</td><td>根据账号登录</td><td><code>@RequestBody</code></td><td><code>String username</code><code>String password</code></td></tr><tr><td>3</td><td><code>followCourse/{targetCourseId}</code></td><td>POST</td><td>收藏指定课程</td><td><code>@PathVariable</code></td><td><code>Long targetCourseId</code></td></tr><tr><td>4</td><td><code>unfollowCourse/{targetCourseId}</code></td><td>POST</td><td>取消收藏课程</td><td><code>@PathVariable</code></td><td><code>Long targetCourseId</code></td></tr><tr><td>5</td><td><code>followMember/{targetMemberId}</code></td><td>POST</td><td>关注指定会员</td><td><code>@PathVariable</code></td><td><code>Long targetMemberId</code></td></tr><tr><td>6</td><td><code>unfollowMember/{targetMemberId}</code></td><td>POST</td><td>取消关注会员</td><td><code>@PathVariable</code></td><td><code>Long targetMemberId</code></td></tr><tr><td>7</td><td><code>getInfo</code></td><td>GET</td><td>查看个人信息</td><td></td><td></td></tr><tr><td>8</td><td><code>pageFollowCourse</code></td><td>GET</td><td>我的收藏列表</td><td></td><td><code>Long pageNumber</code><code>Long pageSize</code></td></tr><tr><td>9</td><td><code>pageFollowMember</code></td><td>GET</td><td>我的关注列表</td><td></td><td><code>Long pageNumber</code><code>Long pageSize</code></td></tr><tr><td>10</td><td><code>pageFan</code></td><td>GET</td><td>我的粉丝列表</td><td></td><td><code>Long pageNumber</code><code>Long pageSize</code></td></tr><tr><td>11</td><td><code>update</code></td><td>POST</td><td>修改个人信息</td><td></td><td></td></tr><tr><td>12</td><td><code>updatePassword</code></td><td>POST</td><td>修改个人密码</td><td></td><td><code>String oldPassword</code><code>String newPassword</code></td></tr><tr><td>13</td><td><code>uploadAvatar</code></td><td>POST</td><td>修改个人头像</td><td></td><td><code>MultipartFile avatarFile</code></td></tr><tr><td>14</td><td><code>delete</code></td><td>POST</td><td>注销个人账号</td><td></td><td></td></tr></tbody></table><h2 id=e01-注册一名会员>E01. 注册一名会员</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph TB

f{依次判断会员的&lt;br/&gt;登录账号&lt;br/&gt;手机号码&lt;br/&gt;身份证号&lt;br/&gt;电子邮箱&lt;br/&gt;是否已经存在}
f --是--&gt; e1[抛出异常]
f --否--&gt; n1[设置会员部分信息默认值] 
    --&gt; f1{检查身份证号&lt;br/&gt;是否合法}
	    f1 --否--&gt; e2[抛出异常]
	    f1 --是--&gt; n2[登录密码MD5加密]
			--&gt; n3[添加会员记录，添加失败直接抛出异常触发回滚] 
			--&gt; n4[添加会员角色中间表记录，添加失败直接抛出异常触发回滚] 
			--&gt; n5[清空缓存并返回结果] 
</code></pre><blockquote><p>武技: 注册一名会员</p></blockquote><h3 id=1-开发dto实体类-4>1. 开发DTO实体类</h3><p><code>com.lsx.dto.MemberRegisterDTO</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Schema</span>(name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;会员注册DTO&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MemberRegisterDTO</span> <span style=color:#66d9ef>implements</span> Serializable {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;登录账号&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotEmpty</span>(message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;登录账号不能为空&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Pattern</span>(regexp <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;^[a-zA-Z0-9]{4,10}$&#34;</span>, message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;账号须由4到10个字母或数字组成&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String username;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;登录密码&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotEmpty</span>(message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;登录密码不能为空&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Pattern</span>(regexp <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;^[a-zA-Z0-9]{4,10}$&#34;</span>, message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;密码须由4到10个字母或数字组成&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String password;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;真实姓名&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotEmpty</span>(message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;真实姓名不能为空&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Pattern</span>(regexp <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;^[\\u4e00-\\u9fa5]{2,4}$&#34;</span>, message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;姓名须由2到4个中文组成&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String realname;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;身份证号&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotEmpty</span>(message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;身份证号不能为空&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Pattern</span>(regexp <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;^\\d{17}[X|0-9]$&#34;</span>, message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;身份证号格式不正确&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String idcard;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;手机号码&#34;</span>)  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@NotEmpty</span>(message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;手机号不能为空&#34;</span>)  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Pattern</span>(regexp <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;^1(3[0-9]|4[01456879]|5[0-35-9]|6[2567]|7[0-8]|8[0-9]|9[0-35-9])\\d{8}$&#34;</span>,  
</span></span><span style=display:flex><span>	        message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;手机号码格式不正确&#34;</span>)  
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> String phone;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;电子邮箱&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotEmpty</span>(message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;电子邮箱不能为空&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Pattern</span>(regexp <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\\.[a-zA-Z0-9_-]+)+$&#34;</span>, 
</span></span><span style=display:flex><span>            message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;电子邮箱格式不正确&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String email;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=2-开发业务方法-3>2. 开发业务方法</h3><p><code>com.lsx.service.MemberService.register()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 注册一名会员
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param member 会员实体类
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @return 成功时返回新会员记录，失败时抛异常
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>Member <span style=color:#a6e22e>register</span>(Member member);
</span></span></code></pre></div><h3 id=3-重写业务方法-3>3. 重写业务方法</h3><p><code>com.lsx.service.impl.MemberServiceImpl.register()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@CacheEvict</span>(allEntries <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Transactional</span>(rollbackFor <span style=color:#f92672>=</span> Exception.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> Member <span style=color:#a6e22e>register</span>(Member member) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 获取会员身份证号</span>
</span></span><span style=display:flex><span>	String idcard <span style=color:#f92672>=</span> member.<span style=color:#a6e22e>getIdcard</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 检查 [登录账号] 是否已存在</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (ObjectUtil.<span style=color:#a6e22e>isNotNull</span>(memberMapper.<span style=color:#a6e22e>selectOneByCondition</span>(
</span></span><span style=display:flex><span>            MEMBER.<span style=color:#a6e22e>USERNAME</span>.<span style=color:#a6e22e>eq</span>(member.<span style=color:#a6e22e>getUsername</span>())))) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;注册失败: 登录账号已经存在&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 检查 [手机号码] 是否已存在</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (ObjectUtil.<span style=color:#a6e22e>isNotNull</span>(memberMapper.<span style=color:#a6e22e>selectOneByCondition</span>(
</span></span><span style=display:flex><span>            MEMBER.<span style=color:#a6e22e>PHONE</span>.<span style=color:#a6e22e>eq</span>(member.<span style=color:#a6e22e>getPhone</span>())))) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;注册失败: 手机号码已经存在&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 检查 [身份证号] 是否已存在</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (ObjectUtil.<span style=color:#a6e22e>isNotNull</span>(memberMapper.<span style=color:#a6e22e>selectOneByCondition</span>(
</span></span><span style=display:flex><span>            MEMBER.<span style=color:#a6e22e>IDCARD</span>.<span style=color:#a6e22e>eq</span>(member.<span style=color:#a6e22e>getIdcard</span>())))) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;注册失败: 身份证号已经存在&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 检查 [电子邮箱] 是否已存在</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (ObjectUtil.<span style=color:#a6e22e>isNotNull</span>(memberMapper.<span style=color:#a6e22e>selectOneByCondition</span>(
</span></span><span style=display:flex><span>            MEMBER.<span style=color:#a6e22e>EMAIL</span>.<span style=color:#a6e22e>eq</span>(member.<span style=color:#a6e22e>getEmail</span>())))) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;注册失败: 电子邮箱已经存在&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 检查 [身份证号] 是否合法    </span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>IdcardUtil.<span style=color:#a6e22e>isValidCard</span>(idcard)) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;注册失败: 身份证号不合法&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 设置默认昵称: 使用 &#34;随机7位字符串&#34; 格式作为默认昵称</span>
</span></span><span style=display:flex><span>    member.<span style=color:#a6e22e>setNickname</span>(RandomUtil.<span style=color:#a6e22e>randomString</span>(7));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 设置默认性别: 根据身份证号自动识别</span>
</span></span><span style=display:flex><span>    member.<span style=color:#a6e22e>setGender</span>(IdcardUtil.<span style=color:#a6e22e>getGenderByIdCard</span>(idcard));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 设置默认年龄: 根据身份证号自动识别</span>
</span></span><span style=display:flex><span>    member.<span style=color:#a6e22e>setAge</span>(IdcardUtil.<span style=color:#a6e22e>getAgeByIdCard</span>(idcard));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 设置会员星座: 根据身份证号自动识别</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>int</span> month <span style=color:#f92672>=</span> IdcardUtil.<span style=color:#a6e22e>getMonthByIdCard</span>(idcard);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> date <span style=color:#f92672>=</span> IdcardUtil.<span style=color:#a6e22e>getDayByIdCard</span>(idcard);
</span></span><span style=display:flex><span>    member.<span style=color:#a6e22e>setZodiac</span>(DateUtil.<span style=color:#a6e22e>getZodiac</span>(month <span style=color:#f92672>-</span> 1, date));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 设置默认头像: 使用 &#34;属相.png&#34; 作为默认头像文件</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> year <span style=color:#f92672>=</span> IdcardUtil.<span style=color:#a6e22e>getYearByIdCard</span>(idcard);
</span></span><span style=display:flex><span>    member.<span style=color:#a6e22e>setAvatar</span>(DateUtil.<span style=color:#a6e22e>getChineseZodiac</span>(year) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;.png&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 设置所在省份: 根据身份证号自动识别</span>
</span></span><span style=display:flex><span>    member.<span style=color:#a6e22e>setProvince</span>(IdcardUtil.<span style=color:#a6e22e>getProvinceByIdCard</span>(idcard));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 设置默认描述: 使用 &#34;高级VIP用户&#34; 格式作为默认描述</span>
</span></span><span style=display:flex><span>    member.<span style=color:#a6e22e>setInfo</span>(<span style=color:#e6db74>&#34;高级VIP用户&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 设置粉丝数量: 初始为0</span>
</span></span><span style=display:flex><span>    member.<span style=color:#a6e22e>setFanCount</span>(0L);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 设置会员状态：初始为正常  </span>
</span></span><span style=display:flex><span>	member.<span style=color:#a6e22e>setState</span>(MemberConst.<span style=color:#a6e22e>NORMAL</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 设置默认创建时间和修改时间</span>
</span></span><span style=display:flex><span>    member.<span style=color:#a6e22e>setCreated</span>(LocalDateTime.<span style=color:#a6e22e>now</span>());
</span></span><span style=display:flex><span>    member.<span style=color:#a6e22e>setUpdated</span>(LocalDateTime.<span style=color:#a6e22e>now</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 处理用户密码: 使用MD5加密</span>
</span></span><span style=display:flex><span>    member.<span style=color:#a6e22e>setPassword</span>(SecureUtil.<span style=color:#a6e22e>md5</span>(member.<span style=color:#a6e22e>getPassword</span>()));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 添加会员记录</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (memberMapper.<span style=color:#a6e22e>insert</span>(member) <span style=color:#f92672>&lt;=</span> 0) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;注册失败: 会员记录添加失败&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 设置会员初始角色: 默认为普通会员</span>
</span></span><span style=display:flex><span>    MemberRole memberRole <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MemberRole();
</span></span><span style=display:flex><span>    memberRole.<span style=color:#a6e22e>setFkMemberId</span>(member.<span style=color:#a6e22e>getId</span>());
</span></span><span style=display:flex><span>	memberRole.<span style=color:#a6e22e>setFkRoleId</span>(MemberConst.<span style=color:#a6e22e>NORMAL_ROLE</span>);
</span></span><span style=display:flex><span>    memberRole.<span style=color:#a6e22e>setCreated</span>(LocalDateTime.<span style=color:#a6e22e>now</span>());
</span></span><span style=display:flex><span>    memberRole.<span style=color:#a6e22e>setUpdated</span>(LocalDateTime.<span style=color:#a6e22e>now</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 添加会员角色中间表记录</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (memberRoleMapper.<span style=color:#a6e22e>insert</span>(memberRole) <span style=color:#f92672>&lt;=</span> 0) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;注册失败: 会员角色添加失败&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 将会员记录脱敏后返回</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>desensitizationMember</span>(member);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 对会员记录进行脱敏  
</span></span></span><span style=display:flex><span><span style=color:#75715e> *  
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param member 会员实体，包含手机号码，身份证号，姓名和密码  
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @return 脱敏后的会员记录  
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> Member <span style=color:#a6e22e>desensitizationMember</span>(Member member) {  
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 身份证号脱敏规则: 前面显示6个数，后面显示3个数，其余都为星号  </span>
</span></span><span style=display:flex><span>    member.<span style=color:#a6e22e>setIdcard</span>(DesensitizedUtil.<span style=color:#a6e22e>idCardNum</span>(member.<span style=color:#a6e22e>getIdcard</span>(), 6, 3));  
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 手机号码脱敏规则: 前面显示3个数，后面显示4个数，其余都为星号  </span>
</span></span><span style=display:flex><span>    member.<span style=color:#a6e22e>setPhone</span>(DesensitizedUtil.<span style=color:#a6e22e>mobilePhone</span>(member.<span style=color:#a6e22e>getPhone</span>()));  
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 真实姓名脱敏规则: 只显示姓  </span>
</span></span><span style=display:flex><span>    member.<span style=color:#a6e22e>setRealname</span>(DesensitizedUtil.<span style=color:#a6e22e>chineseName</span>(member.<span style=color:#a6e22e>getRealname</span>()));  
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 会员密码脱敏规则: 置空  </span>
</span></span><span style=display:flex><span>    member.<span style=color:#a6e22e>setPassword</span>(<span style=color:#e6db74>&#34;&#34;</span>);  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> member;  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=4-开发控制方法-3>4. 开发控制方法</h3><p><code>com.lsx.controller.MemberController.register()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;注册一名会员&#34;</span>, description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;账号，密码，手机号码，真实姓名，身份证号和电子邮箱必填&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;register&#34;</span>)  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> Member <span style=color:#a6e22e>register</span>(<span style=color:#a6e22e>@RequestBody</span> <span style=color:#a6e22e>@Validated</span> MemberRegisterDTO dto){  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> memberService.<span style=color:#a6e22e>register</span>(BeanUtil.<span style=color:#a6e22e>copyProperties</span>(dto, Member.<span style=color:#a6e22e>class</span>));  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e02-根据账号登陆>E02. 根据账号登陆</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

n1[对登录密码&lt;br/&gt;进行MD5加密]
--&gt; n2[根据账号密码&lt;br/&gt;查询一名会员]
--&gt; n3[根据会员信息&lt;br/&gt;创建Token令牌]
--&gt; n4[构建&lt;br/&gt;VO实体类]
--&gt; n5[返回&lt;br/&gt;VO实体类]
</code></pre><blockquote><p>武技: 根据账号密码登录</p></blockquote><h3 id=1-开发vo实体类>1. 开发VO实体类</h3><p><code>com.lsx.vo.MemberVO</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Schema</span>(name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;会员VO&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MemberVO</span> <span style=color:#66d9ef>implements</span> Serializable {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/** 会员实体 */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Member member;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/** Token令牌 */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String token;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=2-开发dto实体类>2. 开发DTO实体类</h3><p><code>com.lsx.dto.MemberLoginByAccountDTO</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Schema</span>(name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;会员登录DTO&#34;</span>, description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;按照账号密码登录&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MemberLoginByAccountDTO</span> <span style=color:#66d9ef>implements</span> Serializable {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;登录账号&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotEmpty</span>(message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;登录账号不能为空&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Pattern</span>(regexp <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;^[a-zA-Z0-9_-]{4,16}$&#34;</span>,
</span></span><span style=display:flex><span>            message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;登录账号必须由4-16位的数字，字母，下划线或横线组成&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String username;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;登录密码&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotEmpty</span>(message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;登录密码不能为空&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Pattern</span>(regexp <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;^[a-zA-Z0-9_-]{4,16}$&#34;</span>,
</span></span><span style=display:flex><span>            message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;登录密码必须由4-16位的数字，字母，下划线或横线组成&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String password;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-开发业务方法>3. 开发业务方法</h3><p><code>com.lsx.service.MemberService.loginByAccount()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 根据账号登录
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param member 会员实体
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @return 成功时返回会员记录，其中包括Token令牌，失败时抛异常
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>MemberVO <span style=color:#a6e22e>loginByAccount</span>(Member member);
</span></span></code></pre></div><h3 id=4-重写业务方法>4. 重写业务方法</h3><p><code>com.lsx.service.impl.MemberServiceImpl.loginByAccount()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> MemberVO <span style=color:#a6e22e>loginByAccount</span>(Member member) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 对密码进行MD5加密</span>
</span></span><span style=display:flex><span>	String password <span style=color:#f92672>=</span> SecureUtil.<span style=color:#a6e22e>md5</span>(member.<span style=color:#a6e22e>getPassword</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 根据账号和密码查询一名会员</span>
</span></span><span style=display:flex><span>	Member memberFromDb <span style=color:#f92672>=</span> memberMapper.<span style=color:#a6e22e>selectOneByQuery</span>(QueryWrapper.<span style=color:#a6e22e>create</span>()
</span></span><span style=display:flex><span>			.<span style=color:#a6e22e>where</span>(MEMBER.<span style=color:#a6e22e>USERNAME</span>.<span style=color:#a6e22e>eq</span>(member.<span style=color:#a6e22e>getUsername</span>()))
</span></span><span style=display:flex><span>		    .<span style=color:#a6e22e>and</span>(MEMBER.<span style=color:#a6e22e>PASSWORD</span>.<span style=color:#a6e22e>eq</span>(password)
</span></span><span style=display:flex><span>		    .<span style=color:#a6e22e>and</span>(MEMBER.<span style=color:#a6e22e>STATE</span>.<span style=color:#a6e22e>eq</span>(MemberConst.<span style=color:#a6e22e>NORMAL</span>))));
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> (ObjectUtil.<span style=color:#a6e22e>isNull</span>(memberFromDb)) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;登录失败: 账号或密码错误&#34;</span>);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 构建MemberVO实体类</span>
</span></span><span style=display:flex><span>	MemberVO memberVO <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MemberVO();
</span></span><span style=display:flex><span>	memberVO.<span style=color:#a6e22e>setMember</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>desensitizationMember</span>(memberFromDb));
</span></span><span style=display:flex><span>	memberVO.<span style=color:#a6e22e>setToken</span>(JwtUtil.<span style=color:#a6e22e>build</span>(
</span></span><span style=display:flex><span>			memberFromDb.<span style=color:#a6e22e>getId</span>(),
</span></span><span style=display:flex><span>			memberFromDb.<span style=color:#a6e22e>getNickname</span>(),
</span></span><span style=display:flex><span>			memberFromDb.<span style=color:#a6e22e>getAvatar</span>()
</span></span><span style=display:flex><span>	));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 返回MemberVO实体类</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> memberVO;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=5-开发控制方法>5. 开发控制方法</h3><p><code>com.lsx.controller.MemberController.loginByAccount()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;根据账号登录&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;loginByAccount&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> MemberVO <span style=color:#a6e22e>loginByAccount</span>(<span style=color:#a6e22e>@RequestBody</span> <span style=color:#a6e22e>@Validated</span> MemberLoginByAccountDTO dto){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> memberService.<span style=color:#a6e22e>loginByAccount</span>(BeanUtil.<span style=color:#a6e22e>copyProperties</span>(dto, Member.<span style=color:#a6e22e>class</span>));
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e03-收藏指定课程>E03. 收藏指定课程</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

f1{判断目标课程&lt;br/&gt;是否存在}
	f1 --否--&gt; 抛出异常
	f1 --是--&gt; f2{判断课程是否&lt;br/&gt;已经被自己收藏}
		f2 --是--&gt; 抛出异常
		f2 --否--&gt; 添加课程收藏中间表记录 --&gt; 删除缓存 --&gt; 返回结果
</code></pre><blockquote><p>武技: 收藏指定课程</p></blockquote><h3 id=1-开发业务方法-5>1. 开发业务方法</h3><p><code>com.lsx.service.MemberService.followCourse()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 收藏指定课程
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param memberId 会员ID，收藏者
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param targetCourseId 课程ID，被收藏的课程
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @return true收藏成功，false收藏失败
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>followCourse</span>(Long memberId, Long targetCourseId);
</span></span></code></pre></div><h3 id=2-重写业务方法-9>2. 重写业务方法</h3><p><code>com.lsx.service.impl.MemberServiceImpl.followCourse()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@CacheEvict</span>(allEntries <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>followCourse</span>(Long memberId, Long targetCourseId) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 判断课程是否存在</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (courseMapper.<span style=color:#a6e22e>selectCountByCondition</span>(COURSE.<span style=color:#a6e22e>ID</span>.<span style=color:#a6e22e>eq</span>(targetCourseId)) <span style=color:#f92672>&lt;=</span> 0) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;收藏失败: 目标课程不存在&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 不允许重复收藏</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (courseFollowMapper.<span style=color:#a6e22e>selectCountByQuery</span>(QueryWrapper.<span style=color:#a6e22e>create</span>()
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>where</span>(COURSE_FOLLOW.<span style=color:#a6e22e>FK_COURSE_ID</span>.<span style=color:#a6e22e>eq</span>(targetCourseId))
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>and</span>(COURSE_FOLLOW.<span style=color:#a6e22e>FK_MEMBER_ID</span>.<span style=color:#a6e22e>eq</span>(memberId))) <span style=color:#f92672>&gt;</span> 0) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;收藏失败: 你已经收藏过该课程&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 组装ORM实体</span>
</span></span><span style=display:flex><span>    CourseFollow courseFollow <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CourseFollow();
</span></span><span style=display:flex><span>    courseFollow.<span style=color:#a6e22e>setId</span>(<span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>    courseFollow.<span style=color:#a6e22e>setFkCourseId</span>(targetCourseId);
</span></span><span style=display:flex><span>    courseFollow.<span style=color:#a6e22e>setFkMemberId</span>(memberId);
</span></span><span style=display:flex><span>    courseFollow.<span style=color:#a6e22e>setCreated</span>(LocalDateTime.<span style=color:#a6e22e>now</span>());
</span></span><span style=display:flex><span>    courseFollow.<span style=color:#a6e22e>setUpdated</span>(LocalDateTime.<span style=color:#a6e22e>now</span>());
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> courseFollowMapper.<span style=color:#a6e22e>insert</span>(courseFollow) <span style=color:#f92672>&gt;</span> 0;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-开发控制方法-9>3. 开发控制方法</h3><p><code>com.lsx.controller.MemberController.unfollowCourse()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;收藏指定课程&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;followCourse/{targetCourseId}&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>followCourse</span>(<span style=color:#a6e22e>@PathVariable</span> Long targetCourseId, HttpSession session) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>long</span> memberId <span style=color:#f92672>=</span> (<span style=color:#66d9ef>long</span>)session.<span style=color:#a6e22e>getAttribute</span>(<span style=color:#e6db74>&#34;memberId&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> memberService.<span style=color:#a6e22e>followCourse</span>(memberId, targetCourseId);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e04-取消课程收藏>E04. 取消课程收藏</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

f1{判断目标课程&lt;br/&gt;是否存在}
	f1 --否--&gt; 抛出异常
	f1 --是--&gt; f2{判断课程是否&lt;br/&gt;已经被自己收藏}
		f2 --否--&gt; 抛出异常
		f2 --是--&gt; 删除课程收藏中间表记录 --&gt; 删除缓存 --&gt; 返回结果
</code></pre><blockquote><p>武技: 取消课程收藏</p></blockquote><h3 id=1-开发业务方法-6>1. 开发业务方法</h3><p><code>com.lsx.service.MemberService.unfollowCourse()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 取消收藏指定课程
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param memberId 会员ID，收藏者
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param targetCourseId 课程ID，被取消收藏的课程
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @return true取消收藏成功，false取消收藏失败
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>unfollowCourse</span>(Long memberId, Long targetCourseId);
</span></span></code></pre></div><h3 id=2-重写业务方法-10>2. 重写业务方法</h3><p><code>com.lsx.service.impl.MemberServiceImpl.unfollowCourse()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@CacheEvict</span>(allEntries <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>unfollowCourse</span>(Long memberId, Long targetCourseId) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 判断课程是否存在</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (courseMapper.<span style=color:#a6e22e>selectCountByCondition</span>(COURSE.<span style=color:#a6e22e>ID</span>.<span style=color:#a6e22e>eq</span>(targetCourseId)) <span style=color:#f92672>&lt;=</span> 0) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;取消收藏失败: 目标课程不存在&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 在收藏的前提下，才能取消收藏</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (courseFollowMapper.<span style=color:#a6e22e>selectCountByQuery</span>(QueryWrapper.<span style=color:#a6e22e>create</span>()
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>where</span>(COURSE_FOLLOW.<span style=color:#a6e22e>FK_COURSE_ID</span>.<span style=color:#a6e22e>eq</span>(targetCourseId))
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>and</span>(COURSE_FOLLOW.<span style=color:#a6e22e>FK_MEMBER_ID</span>.<span style=color:#a6e22e>eq</span>(memberId))) <span style=color:#f92672>&lt;=</span> 0) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;取消收藏失败: 你还未收藏该课程&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 取消收藏</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> courseFollowMapper.<span style=color:#a6e22e>deleteByQuery</span>(QueryWrapper.<span style=color:#a6e22e>create</span>()
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>where</span>(COURSE_FOLLOW.<span style=color:#a6e22e>FK_COURSE_ID</span>.<span style=color:#a6e22e>eq</span>(targetCourseId))
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>and</span>(COURSE_FOLLOW.<span style=color:#a6e22e>FK_MEMBER_ID</span>.<span style=color:#a6e22e>eq</span>(memberId))) <span style=color:#f92672>&gt;</span> 0;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-开发控制方法-10>3. 开发控制方法</h3><p><code>com.lsx.controller.MemberController.unfollowCourse()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;取消收藏课程&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;unfollowCourse/{targetCourseId}&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>unfollowCourse</span>(<span style=color:#a6e22e>@PathVariable</span> Long targetCourseId, HttpSession session) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>long</span> memberId <span style=color:#f92672>=</span> (<span style=color:#66d9ef>long</span>)session.<span style=color:#a6e22e>getAttribute</span>(<span style=color:#e6db74>&#34;memberId&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> memberService.<span style=color:#a6e22e>unfollowCourse</span>(memberId, targetCourseId);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e05-关注指定会员>E05. 关注指定会员</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

f1{判断目标会员&lt;br/&gt;是否存在}
	f1 --否--&gt; 抛出异常
	f1 --是--&gt; f2{判断会员是否&lt;br/&gt;已经被自己关注}
		f2 --是--&gt; 抛出异常
		f2 --否--&gt; n1[添加&lt;br/&gt;会员粉丝中间表记录] 
			--&gt; n2[将被关注者的&lt;br/&gt;粉丝数量自增] 
			--&gt; n3[删除&lt;br/&gt;缓存] 
			--&gt; n4[返回&lt;br/&gt;结果]
</code></pre><blockquote><p>武技: 关注指定会员</p></blockquote><h3 id=1-开发业务方法-7>1. 开发业务方法</h3><p><code>com.lsx.service.MemberService.followMember()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 关注指定会员
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param memberId       会员ID，关注者
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param targetMemberId 会员ID，被关注的会员
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @return true关注成功，false关注失败
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>followMember</span>(Long memberId, Long targetMemberId);
</span></span></code></pre></div><h3 id=2-重写业务方法-11>2. 重写业务方法</h3><p><code>com.lsx.service.impl.MemberServiceImpl.followMember()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@CacheEvict</span>(allEntries <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Transactional</span>(rollbackFor <span style=color:#f92672>=</span> Exception.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>followMember</span>(Long memberId, Long targetMemberId) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 查询目标会员</span>
</span></span><span style=display:flex><span>    Member member <span style=color:#f92672>=</span> memberMapper.<span style=color:#a6e22e>selectOneByCondition</span>(MEMBER.<span style=color:#a6e22e>ID</span>.<span style=color:#a6e22e>eq</span>(targetMemberId));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 判断会员是否存在</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (ObjectUtil.<span style=color:#a6e22e>isNull</span>(member)) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;关注失败: 目标会员不存在&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 不允许重复关注</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (memberFanMapper.<span style=color:#a6e22e>selectCountByQuery</span>(QueryWrapper.<span style=color:#a6e22e>create</span>()
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>where</span>(MEMBER_FAN.<span style=color:#a6e22e>FK_MEMBER_ID</span>.<span style=color:#a6e22e>eq</span>(targetMemberId))
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>and</span>(MEMBER_FAN.<span style=color:#a6e22e>FK_FAN_ID</span>.<span style=color:#a6e22e>eq</span>(memberId))) <span style=color:#f92672>&gt;</span> 0) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;关注失败: 你已经关注过该会员&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 组装ORM实体</span>
</span></span><span style=display:flex><span>    MemberFan memberFan <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MemberFan();
</span></span><span style=display:flex><span>    memberFan.<span style=color:#a6e22e>setId</span>(<span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>    memberFan.<span style=color:#a6e22e>setFkMemberId</span>(targetMemberId);
</span></span><span style=display:flex><span>    memberFan.<span style=color:#a6e22e>setFkFanId</span>(memberId);
</span></span><span style=display:flex><span>    memberFan.<span style=color:#a6e22e>setCreated</span>(LocalDateTime.<span style=color:#a6e22e>now</span>());
</span></span><span style=display:flex><span>    memberFan.<span style=color:#a6e22e>setUpdated</span>(LocalDateTime.<span style=color:#a6e22e>now</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 添加中间表记录</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (memberFanMapper.<span style=color:#a6e22e>insert</span>(memberFan) <span style=color:#f92672>&lt;=</span> 0) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;关注失败: 中间表记录添加失败&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 将被关注者的粉丝数量自增</span>
</span></span><span style=display:flex><span>    member.<span style=color:#a6e22e>setFanCount</span>(member.<span style=color:#a6e22e>getFanCount</span>() <span style=color:#f92672>+</span> 1);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (memberMapper.<span style=color:#a6e22e>update</span>(member) <span style=color:#f92672>&lt;=</span> 0) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;关注失败: 粉丝数量自增失败&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-开发控制方法-11>3. 开发控制方法</h3><p><code>com.lsx.controller.MemberController.followMember()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;关注指定会员&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;followMember/{targetMemberId}&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>followMember</span>(<span style=color:#a6e22e>@PathVariable</span> Long targetMemberId, HttpSession session) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>long</span> memberId <span style=color:#f92672>=</span> (<span style=color:#66d9ef>long</span>)session.<span style=color:#a6e22e>getAttribute</span>(<span style=color:#e6db74>&#34;memberId&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> memberService.<span style=color:#a6e22e>followMember</span>(memberId, targetMemberId);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e06-取消关注会员>E06. 取消关注会员</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

f1{判断目标会员&lt;br/&gt;是否存在}
	f1 --否--&gt; 抛出异常
	f1 --是--&gt; f2{判断会员是否&lt;br/&gt;已经被自己关注}
		f2 --否--&gt; 抛出异常
		f2 --是--&gt; n1[删除&lt;br/&gt;会员粉丝中间表记录] 
			--&gt; n2[将被关注者的&lt;br/&gt;粉丝数量自减] 
			--&gt; n3[删除&lt;br/&gt;缓存] 
			--&gt; n4[返回&lt;br/&gt;结果]
</code></pre><blockquote><p>武技: 取消关注会员</p></blockquote><h3 id=1-开发业务方法-8>1. 开发业务方法</h3><p><code>com.lsx.service.MemberService.unfollowMember()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 取消关注指定会员
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param memberId       会员ID，关注者
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param targetMemberId 会员ID，被取消关注的会员
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @return true取消关注成功，false取消关注失败
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>unfollowMember</span>(Long memberId, Long targetMemberId);
</span></span></code></pre></div><h3 id=2-重写业务方法-12>2. 重写业务方法</h3><p><code>com.lsx.service.impl.MemberServiceImpl.unfollowMember()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@CacheEvict</span>(allEntries <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Transactional</span>(rollbackFor <span style=color:#f92672>=</span> Exception.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>unfollowMember</span>(Long memberId, Long targetMemberId) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 查询目标会员</span>
</span></span><span style=display:flex><span>    Member member <span style=color:#f92672>=</span> memberMapper.<span style=color:#a6e22e>selectOneByCondition</span>(MEMBER.<span style=color:#a6e22e>ID</span>.<span style=color:#a6e22e>eq</span>(targetMemberId));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 判断会员是否存在</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (ObjectUtil.<span style=color:#a6e22e>isNull</span>(member)) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;取消关注失败: 目标会员不存在&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 在关注的前提下，才能取消关注</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (memberFanMapper.<span style=color:#a6e22e>selectCountByQuery</span>(QueryWrapper.<span style=color:#a6e22e>create</span>()
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>where</span>(MEMBER_FAN.<span style=color:#a6e22e>FK_MEMBER_ID</span>.<span style=color:#a6e22e>eq</span>(targetMemberId))
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>and</span>(MEMBER_FAN.<span style=color:#a6e22e>FK_FAN_ID</span>.<span style=color:#a6e22e>eq</span>(memberId))) <span style=color:#f92672>&lt;=</span> 0) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;取消关注失败: 你还未关注该会员&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 删除中间表记录</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (memberFanMapper.<span style=color:#a6e22e>deleteByQuery</span>(QueryWrapper.<span style=color:#a6e22e>create</span>()
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>where</span>(MEMBER_FAN.<span style=color:#a6e22e>FK_MEMBER_ID</span>.<span style=color:#a6e22e>eq</span>(targetMemberId))
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>and</span>(MEMBER_FAN.<span style=color:#a6e22e>FK_FAN_ID</span>.<span style=color:#a6e22e>eq</span>(memberId))) <span style=color:#f92672>&lt;=</span> 0) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;取消关注失败: 中间表记录删除失败&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 将被关注者的粉丝数量自减</span>
</span></span><span style=display:flex><span>    Long fanCount <span style=color:#f92672>=</span> member.<span style=color:#a6e22e>getFanCount</span>();
</span></span><span style=display:flex><span>    member.<span style=color:#a6e22e>setFanCount</span>(fanCount <span style=color:#f92672>&lt;=</span> 0 <span style=color:#f92672>?</span> 0 : fanCount<span style=color:#f92672>--</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (memberMapper.<span style=color:#a6e22e>update</span>(member) <span style=color:#f92672>&lt;=</span> 0) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;取消关注失败: 粉丝数量自增失败&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-开发控制方法-12>3. 开发控制方法</h3><p><code>com.lsx.controller.MemberController.unfollowMember()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;取消关注会员&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;unfollowMember/{targetMemberId}&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>unfollowMember</span>(<span style=color:#a6e22e>@PathVariable</span> Long targetMemberId, HttpSession session) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>long</span> memberId <span style=color:#f92672>=</span> (<span style=color:#66d9ef>long</span>)session.<span style=color:#a6e22e>getAttribute</span>(<span style=color:#e6db74>&#34;memberId&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> memberService.<span style=color:#a6e22e>unfollowMember</span>(memberId, targetMemberId);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e07-查看个人信息>E07. 查看个人信息</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

n1[根据主键&lt;br/&gt;查询会员] --&gt; f{是否&lt;br/&gt;存在}
	f --是--&gt; n2[加入&lt;br/&gt;缓存] --&gt; n2a[脱敏记录] --&gt; n2b[返回&lt;br/&gt;会员记录]
	f --否--&gt; n3[抛出&lt;br/&gt;异常]
</code></pre><blockquote><p>武技: 查看个人信息</p></blockquote><h3 id=1-重写业务方法-4>1. 重写业务方法</h3><p><code>com.lsx.service.impl.MemberServiceImpl.getById()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Cacheable</span>(key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#id&#34;</span>, unless <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#result == null&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> Member <span style=color:#a6e22e>getById</span>(Serializable id) {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 脱敏后返回  </span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>desensitizationMember</span>(<span style=color:#66d9ef>super</span>.<span style=color:#a6e22e>getById</span>(id));
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=2-开发控制方法-3>2. 开发控制方法</h3><p><code>com.lsx.controller.MemberController.getInfo()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;查看个人信息&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;getInfo&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> Member <span style=color:#a6e22e>getInfo</span>(HttpSession session) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>long</span> memberId <span style=color:#f92672>=</span> (<span style=color:#66d9ef>long</span>)session.<span style=color:#a6e22e>getAttribute</span>(<span style=color:#e6db74>&#34;memberId&#34;</span>);
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> memberService.<span style=color:#a6e22e>getById</span>(memberId);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e08-我的收藏列表>E08. 我的收藏列表</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

n1[根据会员主键分页查询&lt;br/&gt;课程收藏中间表记录] 
--&gt; n2[从课程收藏中间表记录中&lt;br/&gt;提取课程记录]
--&gt; n3[封装&lt;br/&gt;分页VO]
--&gt; n4[加入&lt;br/&gt;缓存]
--&gt; n5[返回&lt;br/&gt;记录]
</code></pre><blockquote><p>武技: 查看我的收藏列表</p></blockquote><h3 id=1-优化orm实体类-3>1. 优化ORM实体类</h3><p><code>com.lsx.entity.CourseFollow</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** 课程收藏中间表[N] : 课程[1] */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RelationManyToOne</span>(selfField <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;fkCourseId&#34;</span>, targetField <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;id&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> Course course;
</span></span></code></pre></div><h3 id=2-开发业务方法-4>2. 开发业务方法</h3><p><code>com.lsx.service.MemberService.pageFollowCourse()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 分页查询我收藏的全部课程
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param page     分页数据
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param memberId 会员主键
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @return 分页信息
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>PageVO<span style=color:#f92672>&lt;</span>Course<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>pageFollowCourse</span>(Page<span style=color:#f92672>&lt;</span>CourseFollow<span style=color:#f92672>&gt;</span> page, Long memberId);
</span></span></code></pre></div><h3 id=3-重写业务方法-4>3. 重写业务方法</h3><p>`com.lsx.service.impl.MemberServiceImpl.pageFollowCourse()</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Cacheable</span>(key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#root.methodName + &#39;:&#39; + #page.getPageSize() + &#39;:&#39; + #page.getPageNumber()&#34;</span>)  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> PageVO<span style=color:#f92672>&lt;</span>Course<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>pageFollowCourse</span>(Page<span style=color:#f92672>&lt;</span>CourseFollow<span style=color:#f92672>&gt;</span> page, Long memberId) {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 分页查询我收藏的全部课程，按收藏时间降序  </span>
</span></span><span style=display:flex><span>    Page<span style=color:#f92672>&lt;</span>CourseFollow<span style=color:#f92672>&gt;</span> courseFollowPage <span style=color:#f92672>=</span> courseFollowMapper.<span style=color:#a6e22e>paginateWithRelations</span>(page,  
</span></span><span style=display:flex><span>            QueryWrapper.<span style=color:#a6e22e>create</span>()  
</span></span><span style=display:flex><span>                    .<span style=color:#a6e22e>where</span>(COURSE_FOLLOW.<span style=color:#a6e22e>FK_MEMBER_ID</span>.<span style=color:#a6e22e>eq</span>(memberId))  
</span></span><span style=display:flex><span>                    .<span style=color:#a6e22e>orderBy</span>(COURSE_FOLLOW.<span style=color:#a6e22e>CREATED</span>.<span style=color:#a6e22e>desc</span>()));  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 提取全部课程  </span>
</span></span><span style=display:flex><span>    List<span style=color:#f92672>&lt;</span>Course<span style=color:#f92672>&gt;</span> courses <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;</span>();  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (CourseFollow courseFollow : courseFollowPage.<span style=color:#a6e22e>getRecords</span>()) {  
</span></span><span style=display:flex><span>        courses.<span style=color:#a6e22e>add</span>(courseFollow.<span style=color:#a6e22e>getCourse</span>());  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 构建VO实体类  </span>
</span></span><span style=display:flex><span>	PageVO<span style=color:#f92672>&lt;</span>Course<span style=color:#f92672>&gt;</span> pageVO <span style=color:#f92672>=</span> BeanUtil.<span style=color:#a6e22e>copyProperties</span>(courseFollowPage, PageVO.<span style=color:#a6e22e>class</span>);  
</span></span><span style=display:flex><span>	pageVO.<span style=color:#a6e22e>setRecords</span>(courses);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 返回VO实体类  </span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> pageVO;  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=4-开发控制方法-4>4. 开发控制方法</h3><p><code>com.lsx.controller.MemberController.pageFollowCourse()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;我的收藏列表&#34;</span>, description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;根据收藏时间降序&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;pageFollowCourse&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> PageVO<span style=color:#f92672>&lt;</span>Course<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>pageFollowCourse</span>(Page<span style=color:#f92672>&lt;</span>CourseFollow<span style=color:#f92672>&gt;</span> page, HttpSession session) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>long</span> memberId <span style=color:#f92672>=</span> (<span style=color:#66d9ef>long</span>)session.<span style=color:#a6e22e>getAttribute</span>(<span style=color:#e6db74>&#34;memberId&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> memberService.<span style=color:#a6e22e>pageFollowCourse</span>(page, memberId);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e09-我的关注列表>E09. 我的关注列表</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

n1[根据会员主键分页查询&lt;br/&gt;会员粉丝中间表记录] 
--&gt; n2[从会员粉丝中间表记录中&lt;br/&gt;提取会员记录]
--&gt; n3[封装&lt;br/&gt;分页VO]
--&gt; n4[加入&lt;br/&gt;缓存]
--&gt; n5[返回&lt;br/&gt;记录]
</code></pre><blockquote><p>武技: 查看我的关注列表</p></blockquote><h3 id=1-优化orm实体类-4>1. 优化ORM实体类</h3><p><code>com.lsx.entity.MemberFan</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** 会员粉丝中间表[N] : 会员[1] */</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RelationManyToOne</span>(selfField <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;fkMemberId&#34;</span>, targetField <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;id&#34;</span>)  
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> Member member;
</span></span></code></pre></div><h3 id=2-开发业务方法-5>2. 开发业务方法</h3><p><code>com.lsx.service.MemberService.pageFollowMember()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 分页查询我关注的全部会员  
</span></span></span><span style=display:flex><span><span style=color:#75715e> *  
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param page     分页数据  
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param memberId 会员主键  
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @return 分页信息  
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>  
</span></span><span style=display:flex><span>PageVO<span style=color:#f92672>&lt;</span>Member<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>pageFollowMember</span>(Page<span style=color:#f92672>&lt;</span>MemberFan<span style=color:#f92672>&gt;</span> page, Long memberId);
</span></span></code></pre></div><h3 id=3-重写业务方法-5>3. 重写业务方法</h3><p>`com.lsx.service.impl.MemberServiceImpl.pageFollowMember()</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Cacheable</span>(key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#root.methodName + &#39;:&#39; + #page.getPageSize() + &#39;:&#39; + #page.getPageNumber()&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> PageVO<span style=color:#f92672>&lt;</span>Member<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>pageFollowMember</span>(Page<span style=color:#f92672>&lt;</span>MemberFan<span style=color:#f92672>&gt;</span> page, Long memberId) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 忽略roles</span>
</span></span><span style=display:flex><span>    RelationManager.<span style=color:#a6e22e>addIgnoreRelations</span>(<span style=color:#e6db74>&#34;roles&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 分页查询我关注的全部会员，按关注时间降序</span>
</span></span><span style=display:flex><span>    Page<span style=color:#f92672>&lt;</span>MemberFan<span style=color:#f92672>&gt;</span> memberFanPage <span style=color:#f92672>=</span> memberFanMapper.<span style=color:#a6e22e>paginateWithRelations</span>(page,
</span></span><span style=display:flex><span>            QueryWrapper.<span style=color:#a6e22e>create</span>()
</span></span><span style=display:flex><span>                    .<span style=color:#a6e22e>where</span>(MEMBER_FAN.<span style=color:#a6e22e>FK_FAN_ID</span>.<span style=color:#a6e22e>eq</span>(memberId))
</span></span><span style=display:flex><span>                    .<span style=color:#a6e22e>orderBy</span>(MEMBER_FAN.<span style=color:#a6e22e>CREATED</span>.<span style=color:#a6e22e>desc</span>()));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 提取全部会员</span>
</span></span><span style=display:flex><span>    List<span style=color:#f92672>&lt;</span>Member<span style=color:#f92672>&gt;</span> members <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (MemberFan memberFan : memberFanPage.<span style=color:#a6e22e>getRecords</span>()) {
</span></span><span style=display:flex><span>        members.<span style=color:#a6e22e>add</span>(memberFan.<span style=color:#a6e22e>getMember</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 构建VO实体类  </span>
</span></span><span style=display:flex><span>	PageVO<span style=color:#f92672>&lt;</span>Member<span style=color:#f92672>&gt;</span> pageVO <span style=color:#f92672>=</span> BeanUtil.<span style=color:#a6e22e>copyProperties</span>(memberFanPage, PageVO.<span style=color:#a6e22e>class</span>);  
</span></span><span style=display:flex><span>	pageVO.<span style=color:#a6e22e>setRecords</span>(members);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 返回VO实体类</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> pageVO;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=4-开发控制方法-5>4. 开发控制方法</h3><p><code>com.lsx.controller.MemberController.pageFollowMember()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;我的关注列表&#34;</span>, description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;根据关注时间降序&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;pageFollowMember&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> PageVO<span style=color:#f92672>&lt;</span>Member<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>pageFollowMember</span>(Page<span style=color:#f92672>&lt;</span>MemberFan<span style=color:#f92672>&gt;</span> page, HttpSession session) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>long</span> memberId <span style=color:#f92672>=</span> (<span style=color:#66d9ef>long</span>)session.<span style=color:#a6e22e>getAttribute</span>(<span style=color:#e6db74>&#34;memberId&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> memberService.<span style=color:#a6e22e>pageFollowMember</span>(page, memberId);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e10-我的粉丝列表>E10. 我的粉丝列表</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

n1[根据会员主键分页查询&lt;br/&gt;会员粉丝中间表记录] 
--&gt; n2[从会员粉丝中间表记录中&lt;br/&gt;提取粉丝记录]
--&gt; n3[封装&lt;br/&gt;分页VO]
--&gt; n4[加入&lt;br/&gt;缓存]
--&gt; n5[返回&lt;br/&gt;记录]
</code></pre><blockquote><p>武技: 查看我的粉丝列表</p></blockquote><h3 id=1-优化orm实体类-5>1. 优化ORM实体类</h3><p><code>com.lsx.entity.MemberFan</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** 会员粉丝中间表[N] : 粉丝[1] */</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RelationManyToOne</span>(selfField <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;fkFanId&#34;</span>, targetField <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;id&#34;</span>)  
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> Member fan;
</span></span></code></pre></div><h3 id=2-开发业务方法-6>2. 开发业务方法</h3><p><code>com.lsx.service.MemberService.pageFan()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 分页查询关注我的全部粉丝
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param page     分页数据
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param memberId 会员主键
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @return 分页信息
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>PageVO<span style=color:#f92672>&lt;</span>Member<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>pageFan</span>(Page<span style=color:#f92672>&lt;</span>MemberFan<span style=color:#f92672>&gt;</span> page, Long memberId);
</span></span></code></pre></div><h3 id=3-重写业务方法-6>3. 重写业务方法</h3><p>`com.lsx.service.impl.MemberServiceImpl.pageFan()</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Cacheable</span>(key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#root.methodName + &#39;:&#39; + #page.getPageSize() + &#39;:&#39; + #page.getPageNumber()&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> PageVO<span style=color:#f92672>&lt;</span>Member<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>pageFan</span>(Page<span style=color:#f92672>&lt;</span>MemberFan<span style=color:#f92672>&gt;</span> page, Long memberId) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 忽略roles</span>
</span></span><span style=display:flex><span>    RelationManager.<span style=color:#a6e22e>addIgnoreRelations</span>(<span style=color:#e6db74>&#34;roles&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 分页查询我关注的全部会员，按关注时间降序</span>
</span></span><span style=display:flex><span>    Page<span style=color:#f92672>&lt;</span>MemberFan<span style=color:#f92672>&gt;</span> memberFanPage <span style=color:#f92672>=</span> memberFanMapper.<span style=color:#a6e22e>paginateWithRelations</span>(page,
</span></span><span style=display:flex><span>            QueryWrapper.<span style=color:#a6e22e>create</span>()
</span></span><span style=display:flex><span>                    .<span style=color:#a6e22e>where</span>(MEMBER_FAN.<span style=color:#a6e22e>FK_MEMBER_ID</span>.<span style=color:#a6e22e>eq</span>(memberId))
</span></span><span style=display:flex><span>                    .<span style=color:#a6e22e>orderBy</span>(MEMBER_FAN.<span style=color:#a6e22e>CREATED</span>.<span style=color:#a6e22e>desc</span>()));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 获取全部粉丝</span>
</span></span><span style=display:flex><span>    List<span style=color:#f92672>&lt;</span>Member<span style=color:#f92672>&gt;</span> fans <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (MemberFan memberFan : memberFanPage.<span style=color:#a6e22e>getRecords</span>()) {
</span></span><span style=display:flex><span>        fans.<span style=color:#a6e22e>add</span>(memberFan.<span style=color:#a6e22e>getFan</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 构建VO实体类  </span>
</span></span><span style=display:flex><span>	PageVO<span style=color:#f92672>&lt;</span>Member<span style=color:#f92672>&gt;</span> pageVO <span style=color:#f92672>=</span> BeanUtil.<span style=color:#a6e22e>copyProperties</span>(memberFanPage, PageVO.<span style=color:#a6e22e>class</span>);  
</span></span><span style=display:flex><span>	pageVO.<span style=color:#a6e22e>setRecords</span>(fans);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 返回VO实体类</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> pageVO;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=4-开发控制方法-6>4. 开发控制方法</h3><p><code>com.lsx.controller.MemberController.pageFan()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;我的粉丝列表&#34;</span>, description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;根据关注时间降序&#34;</span>)  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;pageFan&#34;</span>)  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> PageVO<span style=color:#f92672>&lt;</span>Member<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>pageFan</span>(Page<span style=color:#f92672>&lt;</span>MemberFan<span style=color:#f92672>&gt;</span> page, HttpSession session) {  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>long</span> memberId <span style=color:#f92672>=</span> (<span style=color:#66d9ef>long</span>)session.<span style=color:#a6e22e>getAttribute</span>(<span style=color:#e6db74>&#34;memberId&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> memberService.<span style=color:#a6e22e>pageFan</span>(page, memberId);  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e11-修改个人信息>E11. 修改个人信息</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

f{依次判断会员的&lt;br/&gt;手机号码&lt;br/&gt;身份证号&lt;br/&gt;电子邮箱&lt;br/&gt;会员昵称&lt;br/&gt;是否已经存在}
f --是--&gt; e1[抛出异常]
f --否--&gt; f1{检查身份证号&lt;br/&gt;是否合法}
	f1 --否--&gt; e2[抛出异常]
	f1 --是--&gt; n1[根据会员主键&lt;br/&gt;修改会员记录] --&gt; n2[清空&lt;br/&gt;缓存] --&gt; n3[返回&lt;br/&gt;结果] 
</code></pre><blockquote><p>武技: 修改个人信息</p></blockquote><h3 id=1-开发dto实体类-5>1. 开发DTO实体类</h3><p><code>com.lsx.dto.MemberUpdateDTO</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Schema</span>(name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;会员修改DTO&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MemberUpdateDTO</span> <span style=color:#66d9ef>implements</span> Serializable {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;会员昵称&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Pattern</span>(regexp <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;[\\u4e00-\\u9fa5_a-zA-Z0-9]{4,10}&#34;</span>,
</span></span><span style=display:flex><span>            message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;昵称须由4到10个中文，字母或数字组成&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String nickname;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;手机号码&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Pattern</span>(regexp <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;^[1-9]\\d{5}(19\\|20)\\d{2}((0[1-9])|(1[0-2]))(([0-2][1-9])$&#34;</span>,
</span></span><span style=display:flex><span>            message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;手机号码格式不正确&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String phone;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;电子邮箱&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Pattern</span>(regexp <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\\.[a-zA-Z0-9_-]+)+$&#34;</span>,
</span></span><span style=display:flex><span>            message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;电子邮箱格式不正确&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String email;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;会员性别&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Range</span>(max <span style=color:#f92672>=</span> 2, message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;性别只能使用0，1，2三个值&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Integer gender;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;会员年龄&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Range</span>(min <span style=color:#f92672>=</span> 16, max <span style=color:#f92672>=</span> 60, message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;年龄必须在16-60之间&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Integer age;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;会员星座&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Pattern</span>(regexp <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;^[\\u4e00-\\u9fa5]{2,4}$&#34;</span>,
</span></span><span style=display:flex><span>            message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;星座须由2到4个中文组成&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String zodiac;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;会员省份&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Pattern</span>(regexp <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;^[\\u4e00-\\u9fa5]{2,20}$&#34;</span>,
</span></span><span style=display:flex><span>            message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;省份须由2到20个中文组成&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String province;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;真实姓名&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Pattern</span>(regexp <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;^[\\u4e00-\\u9fa5]{2,4}$&#34;</span>,
</span></span><span style=display:flex><span>            message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;姓名须由2到4个中文组成&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String realname;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;身份证号&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Pattern</span>(regexp <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;^\\d{17}[X|0-9]$&#34;</span>, message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;身份证号格式不正确&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String idcard;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;会员描述&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Length</span>(max <span style=color:#f92672>=</span> 512, message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;会员描述长度必须在0-512之间&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String info;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=2-开发业务方法-7>2. 开发业务方法</h3><p><code>com.lsx.service.MemberService.update()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 根据会员主键修改会员信息
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param member 会员实体
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @return true修改成功，false修改失败
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>update</span>(Member member);
</span></span></code></pre></div><h3 id=3-重写业务方法-7>3. 重写业务方法</h3><p><code>com.lsx.service.impl.MemberServiceImpl.update()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@CacheEvict</span>(allEntries <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>update</span>(Member member) {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    String phone <span style=color:#f92672>=</span> member.<span style=color:#a6e22e>getPhone</span>();
</span></span><span style=display:flex><span>    String idcard <span style=color:#f92672>=</span> member.<span style=color:#a6e22e>getIdcard</span>();
</span></span><span style=display:flex><span>    String email <span style=color:#f92672>=</span> member.<span style=color:#a6e22e>getEmail</span>();
</span></span><span style=display:flex><span>    String nickname <span style=color:#f92672>=</span> member.<span style=color:#a6e22e>getNickname</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 检查 [手机号码] 是否已存在</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (ObjectUtil.<span style=color:#a6e22e>isNotNull</span>(phone) <span style=color:#f92672>&amp;&amp;</span> ObjectUtil.<span style=color:#a6e22e>isNotNull</span>(
</span></span><span style=display:flex><span>            memberMapper.<span style=color:#a6e22e>selectOneByCondition</span>(MEMBER.<span style=color:#a6e22e>PHONE</span>.<span style=color:#a6e22e>eq</span>(phone)))) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;修改失败: 手机号码已经存在&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 检查 [身份证号] 是否已存在</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (ObjectUtil.<span style=color:#a6e22e>isNotNull</span>(idcard) <span style=color:#f92672>&amp;&amp;</span> ObjectUtil.<span style=color:#a6e22e>isNotNull</span>(
</span></span><span style=display:flex><span>            memberMapper.<span style=color:#a6e22e>selectOneByCondition</span>(MEMBER.<span style=color:#a6e22e>IDCARD</span>.<span style=color:#a6e22e>eq</span>(idcard)))) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;修改失败: 身份证号已经存在&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 检查 [电子邮箱] 是否已存在</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (ObjectUtil.<span style=color:#a6e22e>isNotNull</span>(email) <span style=color:#f92672>&amp;&amp;</span> ObjectUtil.<span style=color:#a6e22e>isNotNull</span>(
</span></span><span style=display:flex><span>            memberMapper.<span style=color:#a6e22e>selectOneByCondition</span>(MEMBER.<span style=color:#a6e22e>EMAIL</span>.<span style=color:#a6e22e>eq</span>(email)))) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;修改失败: 电子邮箱已经存在&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 检查 [会员昵称] 是否已存在</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (ObjectUtil.<span style=color:#a6e22e>isNotNull</span>(nickname) <span style=color:#f92672>&amp;&amp;</span> ObjectUtil.<span style=color:#a6e22e>isNotNull</span>(
</span></span><span style=display:flex><span>            memberMapper.<span style=color:#a6e22e>selectOneByCondition</span>(MEMBER.<span style=color:#a6e22e>NICKNAME</span>.<span style=color:#a6e22e>eq</span>(nickname)))) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;修改失败: 会员昵称已经存在&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 检查 [身份证号] 是否合法</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (ObjectUtil.<span style=color:#a6e22e>isNotNull</span>(idcard) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span>IdcardUtil.<span style=color:#a6e22e>isValidCard</span>(idcard)) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;修改失败: 身份证号不合法&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 修改一名会员</span>
</span></span><span style=display:flex><span>    member.<span style=color:#a6e22e>setUsername</span>(<span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>    member.<span style=color:#a6e22e>setCreated</span>(<span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>    member.<span style=color:#a6e22e>setUpdated</span>(LocalDateTime.<span style=color:#a6e22e>now</span>());
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (memberMapper.<span style=color:#a6e22e>update</span>(member) <span style=color:#f92672>&lt;=</span> 0) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;修改失败: 会员记录修改失败&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=4-开发控制方法-7>4. 开发控制方法</h3><p><code>com.lsx.controller.MemberController.update()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;修改个人信息&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;update&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>update</span>(<span style=color:#a6e22e>@RequestBody</span> <span style=color:#a6e22e>@Validated</span> MemberUpdateDTO dto, HttpSession session) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>long</span> memberId <span style=color:#f92672>=</span> (<span style=color:#66d9ef>long</span>)session.<span style=color:#a6e22e>getAttribute</span>(<span style=color:#e6db74>&#34;memberId&#34;</span>);
</span></span><span style=display:flex><span>    Member member <span style=color:#f92672>=</span> BeanUtil.<span style=color:#a6e22e>copyProperties</span>(dto, Member.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span>    member.<span style=color:#a6e22e>setId</span>(memberId);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> memberService.<span style=color:#a6e22e>update</span>(member);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e12-修改个人密码>E12. 修改个人密码</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

n1[根据会员主键和旧密码&lt;br/&gt;查询会员]
--&gt; f{查询&lt;br/&gt;成功}
	f --否--&gt; 抛出异常
	f --是--&gt; n2[根据会员主键&lt;br/&gt;修改会员密码] 
		--&gt; n3[清空&lt;br/&gt;缓存] 
		--&gt; n4[返回&lt;br/&gt;结果] 
</code></pre><blockquote><p>武技: 修改个人密码</p></blockquote><h3 id=1-开发dto实体类-6>1. 开发DTO实体类</h3><p><code>com.lsx.dto.MemberUpdatePasswordDTO</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Schema</span>(name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;会员修改密码DTO&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MemberUpdatePasswordDTO</span> <span style=color:#66d9ef>implements</span> Serializable {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;登录密码&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotEmpty</span>(message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;旧密码不能为空&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Pattern</span>(regexp <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;^[a-zA-Z0-9]{4,10}$&#34;</span>, message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;密码须由4到10个字母或数字组成&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String oldPassword;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;登录密码&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotEmpty</span>(message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;新密码不能为空&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Pattern</span>(regexp <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;^[a-zA-Z0-9]{4,10}$&#34;</span>, message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;密码须由4到10个字母或数字组成&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String newPassword;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=2-开发接口方法>2. 开发接口方法</h3><p><code>com.lsx.service.MemberService.updatePassword()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 根据会员主键修改密码
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param memberId    会员主键
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param oldPassword 旧密码
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param newPassword 新密码
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @return true修改成功，false修改失败
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>updatePassword</span>(Long memberId, String oldPassword, String newPassword);
</span></span></code></pre></div><h3 id=3-重写接口方法>3. 重写接口方法</h3><p><code>com.lsx.service.impl.MemberServiceImpl.updatePassword()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@CacheEvict</span>(allEntries <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>updatePassword</span>(Long memberId, String oldPassword, String newPassword) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 根据会员主键和旧密码查询会员</span>
</span></span><span style=display:flex><span>    Member member <span style=color:#f92672>=</span> memberMapper.<span style=color:#a6e22e>selectOneByQuery</span>(QueryWrapper.<span style=color:#a6e22e>create</span>()
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>where</span>(MEMBER.<span style=color:#a6e22e>ID</span>.<span style=color:#a6e22e>eq</span>(memberId))
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>and</span>(MEMBER.<span style=color:#a6e22e>PASSWORD</span>.<span style=color:#a6e22e>eq</span>(SecureUtil.<span style=color:#a6e22e>md5</span>(oldPassword))));
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (ObjectUtil.<span style=color:#a6e22e>isNull</span>(member)) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;修改密码失败: 会员不存在或原密码有误&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 根据会员主键修改会员密码</span>
</span></span><span style=display:flex><span>    member.<span style=color:#a6e22e>setPassword</span>(SecureUtil.<span style=color:#a6e22e>md5</span>(newPassword));
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (memberMapper.<span style=color:#a6e22e>update</span>(member) <span style=color:#f92672>&lt;=</span> 0) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;修改密码失败: 会员密码修改失败&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=4-开发控制方法-8>4. 开发控制方法</h3><p><code>com.lsx.controller.MemberController.updatePassword()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;修改个人密码&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;/updatePassword&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>updatePassword</span>(<span style=color:#a6e22e>@Validated</span> <span style=color:#a6e22e>@RequestBody</span> MemberUpdatePasswordDTO dto, HttpSession session) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>long</span> memberId <span style=color:#f92672>=</span> (<span style=color:#66d9ef>long</span>)session.<span style=color:#a6e22e>getAttribute</span>(<span style=color:#e6db74>&#34;memberId&#34;</span>);
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> memberService.<span style=color:#a6e22e>updatePassword</span>(memberId, dto.<span style=color:#a6e22e>getOldPassword</span>(), dto.<span style=color:#a6e22e>getNewPassword</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e13-上传个人头像>E13. 上传个人头像</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

n1[根据会员主键和旧密码&lt;br/&gt;查询会员]
--&gt; f{查询&lt;br/&gt;成功}
	f --否--&gt; 抛出异常
	f --是--&gt; n2[根据会员主键&lt;br/&gt;修改会员密码] 
		--&gt; n3[清空&lt;br/&gt;缓存] 
		--&gt; n4[返回&lt;br/&gt;结果] 
</code></pre><blockquote><p>武技: 上传个人头像</p></blockquote><h3 id=1-开发业务方法-9>1. 开发业务方法</h3><p><code>com.lsx.service.MemberService.uploadAvatar()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 根据会员主键上传头像
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param avatarFile 头像文件
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param memberId   会员主键
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @return 返回新文件名
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>String <span style=color:#a6e22e>uploadAvatar</span>(MultipartFile avatarFile, Long memberId);
</span></span></code></pre></div><h3 id=2-重写业务方法-13>2. 重写业务方法</h3><p><code>com.lsx.service.impl.MemberServiceImpl.uploadAvatar()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@CacheEvict</span>(allEntries <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>uploadAvatar</span>(MultipartFile avatarFile, Long memberId) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 按会员主键查询会员记录</span>
</span></span><span style=display:flex><span>    Member member <span style=color:#f92672>=</span> memberMapper.<span style=color:#a6e22e>selectOneByCondition</span>(MEMBER.<span style=color:#a6e22e>ID</span>.<span style=color:#a6e22e>eq</span>(memberId));
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (ObjectUtil.<span style=color:#a6e22e>isNull</span>(member)) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;上传头像失败: 会员不存在&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 从MinIO中删除旧头像: 默认头像不删除</span>
</span></span><span style=display:flex><span>    String avatar <span style=color:#f92672>=</span> member.<span style=color:#a6e22e>getAvatar</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>MemberConst.<span style=color:#a6e22e>DEFAULT_AVATARS</span>.<span style=color:#a6e22e>contains</span>(avatar)) {
</span></span><span style=display:flex><span>        MinioUtil.<span style=color:#a6e22e>delete</span>(avatar, <span style=color:#e6db74>&#34;avatar&#34;</span>, MinioConst.<span style=color:#a6e22e>BUCKET_NAME</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 重新生成文件名</span>
</span></span><span style=display:flex><span>    String filename <span style=color:#f92672>=</span> MinioUtil.<span style=color:#a6e22e>randomFilename</span>(avatarFile);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 向MinIO中上传新头像</span>
</span></span><span style=display:flex><span>    MinioUtil.<span style=color:#a6e22e>upload</span>(avatarFile, filename, <span style=color:#e6db74>&#34;avatar&#34;</span>, MinioConst.<span style=color:#a6e22e>BUCKET_NAME</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 根据会员主键修改会员头像</span>
</span></span><span style=display:flex><span>    member.<span style=color:#a6e22e>setAvatar</span>(filename);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (memberMapper.<span style=color:#a6e22e>update</span>(member) <span style=color:#f92672>&lt;=</span> 0) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;上传头像失败: 数据库操作异常&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> filename;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-开发控制方法-13>3. 开发控制方法</h3><p><code>com.lsx.controller.MemberController.uploadAvatar()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** 这里不要使用 @RequestParam 因为文件类型不是 application/json */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;上传个人头像&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;/uploadAvatar&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> Result <span style=color:#a6e22e>uploadAvatar</span>(MultipartFile avatarFile, HttpSession session) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>long</span> memberId <span style=color:#f92672>=</span> (<span style=color:#66d9ef>long</span>)session.<span style=color:#a6e22e>getAttribute</span>(<span style=color:#e6db74>&#34;memberId&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Result(memberService.<span style=color:#a6e22e>uploadAvatar</span>(avatarFile, memberId));
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e14-注销个人账号>E14. 注销个人账号</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

n1[根据会员主键&lt;br/&gt;查询会员状态]
--&gt; f{已经被&lt;br/&gt;注销了}
	f --是--&gt; 抛出异常
	f --否--&gt; n2[修改会员状态&lt;br/&gt;为不可用] 
		--&gt; n3[清空&lt;br/&gt;缓存] 
		--&gt; n4[返回&lt;br/&gt;结果] 
</code></pre><blockquote><p>武技: 注销个人账号</p></blockquote><h3 id=1-开发业务方法-10>1. 开发业务方法</h3><p><code>com.lsx.service.MemberService.fakeDelete()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 根据会员主键删除会员（假删）  
</span></span></span><span style=display:flex><span><span style=color:#75715e> *  
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param memberId 会员主键  
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>fakeDelete</span>(Long memberId);
</span></span></code></pre></div><h3 id=2-重写业务方法-14>2. 重写业务方法</h3><p><code>com.lsx.service.impl.MemberServiceImpl.fakeDelete()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@CacheEvict</span>(allEntries <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>)  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>fakeDelete</span>(Long memberId) {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 根据会员主键查询会员信息  </span>
</span></span><span style=display:flex><span>    Member member <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>getById</span>(memberId);  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 判断会员账号是否已经被注销  </span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (member.<span style=color:#a6e22e>getState</span>().<span style=color:#a6e22e>equals</span>(MemberConst.<span style=color:#a6e22e>FROZEN</span>)) {  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;注销失败: 该账号已被注销&#34;</span>);  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 修改会员状态为1  </span>
</span></span><span style=display:flex><span>    member.<span style=color:#a6e22e>setState</span>(MemberConst.<span style=color:#a6e22e>FROZEN</span>);  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 发送SQL  </span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (memberMapper.<span style=color:#a6e22e>update</span>(member) <span style=color:#f92672>&lt;=</span> 0) {  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;注销失败: 数据库操作异常&#34;</span>);  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-开发控制方法-14>3. 开发控制方法</h3><p><code>com.lsx.controller.MemberController.delete()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;注销个人账号&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;/delete&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>delete</span>(HttpSession session) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>long</span> memberId <span style=color:#f92672>=</span> (<span style=color:#66d9ef>long</span>)session.<span style=color:#a6e22e>getAttribute</span>(<span style=color:#e6db74>&#34;memberId&#34;</span>);
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> memberService.<span style=color:#a6e22e>fakeDelete</span>(memberId); 
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e15-获取验证号码>E15. 获取验证号码</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

f{&#34;检查手机号码&lt;br/&gt;是否存在&#34;}
f --否--&gt; e1[&#34;抛出异常&#34;]
f --是--&gt; n1[&#34;组装key值&lt;br/&gt;前缀+手机号码&#34;] 
	--&gt; n2[&#34;组装Value值&lt;br/&gt;生成4位随机验证码&#34;] 
	--&gt; n3[&#34;将验证码存入Redis&lt;br/&gt;时效5分钟&#34;]
	--&gt; n4[&#34;返回&lt;br/&gt;验证码&#34;] 
</code></pre><blockquote><p>武技: 获取验证号码</p></blockquote><h3 id=1-开发业务方法-11>1. 开发业务方法</h3><p><code>com.lsx.service.MemberService.getVcode()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 根据手机号码生成一个随机的4位短信验证码
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param phone 手机号码
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @return 一个随机的4位短信验证码
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>String <span style=color:#a6e22e>getVcode</span>(String phone);
</span></span></code></pre></div><h3 id=2-重写业务方法-15>2. 重写业务方法</h3><p><code>com.lsx.service.impl.MemberServiceImpl.getVcode()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getVcode</span>(String phone) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 根据手机号码查询一名会员</span>
</span></span><span style=display:flex><span>	Member memberFromDb <span style=color:#f92672>=</span> memberMapper.<span style=color:#a6e22e>selectOneByQuery</span>(QueryWrapper.<span style=color:#a6e22e>create</span>()
</span></span><span style=display:flex><span>			.<span style=color:#a6e22e>where</span>(MEMBER.<span style=color:#a6e22e>PHONE</span>.<span style=color:#a6e22e>eq</span>(phone))
</span></span><span style=display:flex><span>			.<span style=color:#a6e22e>and</span>(MEMBER.<span style=color:#a6e22e>STATE</span>.<span style=color:#a6e22e>eq</span>(MemberConst.<span style=color:#a6e22e>NORMAL</span>)));
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> (ObjectUtil.<span style=color:#a6e22e>isNull</span>(memberFromDb)) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;获取失败: 手机号码不存在&#34;</span>);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 组装key值</span>
</span></span><span style=display:flex><span>	String key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;VCODE_&#34;</span> <span style=color:#f92672>+</span> phone;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 组装Value值：生成4位随机的验证码</span>
</span></span><span style=display:flex><span>	String val <span style=color:#f92672>=</span> RandomUtil.<span style=color:#a6e22e>randomNumbers</span>(4);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 将短信验证码存入redis中</span>
</span></span><span style=display:flex><span>	redisUtil.<span style=color:#a6e22e>setEx</span>(key, val, 5, TimeUnit.<span style=color:#a6e22e>MINUTES</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// todo: 向指定手机号码发送验证码</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 将短信验证码返回给客户端</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> val;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-开发控制方法-15>3. 开发控制方法</h3><p><code>com.lsx.controller.MemberController.getVcode()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;获取短信验证码&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/getVcode/{phone}&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> Result <span style=color:#a6e22e>getVcode</span>(<span style=color:#a6e22e>@PathVariable</span> String phone, HttpSession session) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Result(memberService.<span style=color:#a6e22e>getVcode</span>(phone));
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e16-手机号码登陆>E16. 手机号码登陆</h2><blockquote><p>心法: 业务流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

n1[对登录密码&lt;br/&gt;进行MD5加密]
--&gt; n2[根据账号密码&lt;br/&gt;查询一名会员]
--&gt; n3[根据会员信息&lt;br/&gt;创建Token令牌]
--&gt; n4[构建&lt;br/&gt;VO实体类]
--&gt; n5[返回&lt;br/&gt;VO实体类]
</code></pre><blockquote><p>武技: 根据手机号码登陆</p></blockquote><h3 id=1-开发dto实体类-7>1. 开发DTO实体类</h3><p><code>com.lsx.dto.MemberLoginByPhoneDTO</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Schema</span>(name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;会员登录DTO&#34;</span>, description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;按照手机号码登录&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MemberLoginByPhoneDTO</span> <span style=color:#66d9ef>implements</span> Serializable {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;验证码&#34;</span>, required <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>, example <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;1234&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotEmpty</span>(message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;登录业务中验证码不能为空&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Pattern</span>(regexp <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;^\\w{4}$&#34;</span>, 
</span></span><span style=display:flex><span>             message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;验证码必须由4位数字或字母组成&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String vcode;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;手机号码&#34;</span>)  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@NotEmpty</span>(message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;手机号不能为空&#34;</span>)  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Pattern</span>(regexp <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;^1(3[0-9]|4[01456879]|5[0-35-9]|6[2567]|7[0-8]|8[0-9]|9[0-35-9])\\d{8}$&#34;</span>,  
</span></span><span style=display:flex><span>	        message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;手机号码格式不正确&#34;</span>)  
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> String phone;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=2-开发业务方法-8>2. 开发业务方法</h3><p><code>com.lsx.service.MemberService.loginByPhone()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 根据手机号码登录
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param dto 会员登录DTO
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @return 成功时返回会员记录，其中包括Token令牌，失败时抛异常
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>MemberVO <span style=color:#a6e22e>loginByPhone</span>(MemberLoginByPhoneDTO dto);
</span></span></code></pre></div><h3 id=3-重写业务方法-8>3. 重写业务方法</h3><p><code>com.lsx.service.impl.MemberServiceImpl.loginByPhone()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> MemberVO <span style=color:#a6e22e>loginByPhone</span>(MemberLoginByPhoneDTO dto) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    String phone <span style=color:#f92672>=</span> dto.<span style=color:#a6e22e>getPhone</span>();
</span></span><span style=display:flex><span>    String vcode <span style=color:#f92672>=</span> dto.<span style=color:#a6e22e>getVcode</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 根据手机号码查询一名会员</span>
</span></span><span style=display:flex><span>    Member memberFromDb <span style=color:#f92672>=</span> memberMapper.<span style=color:#a6e22e>selectOneByQuery</span>(QueryWrapper.<span style=color:#a6e22e>create</span>()
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>where</span>(MEMBER.<span style=color:#a6e22e>PHONE</span>.<span style=color:#a6e22e>eq</span>(phone))
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>and</span>(MEMBER.<span style=color:#a6e22e>STATE</span>.<span style=color:#a6e22e>eq</span>(MemberConst.<span style=color:#a6e22e>NORMAL</span>)));
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (ObjectUtil.<span style=color:#a6e22e>isNull</span>(memberFromDb)) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;登录失败: 手机号码不存在&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 组装key值</span>
</span></span><span style=display:flex><span>    String key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;VCODE_&#34;</span> <span style=color:#f92672>+</span> phone;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 校验验证码是否正确</span>
</span></span><span style=display:flex><span>    String vcodeFromRedis <span style=color:#f92672>=</span> redisUtil.<span style=color:#a6e22e>get</span>(key);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (ObjectUtil.<span style=color:#a6e22e>isNull</span>(vcodeFromRedis) <span style=color:#f92672>||</span> <span style=color:#f92672>!</span>vcodeFromRedis.<span style=color:#a6e22e>equals</span>(vcode)) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;登录失败: 验证码无效&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 构建MemberVO实体类</span>
</span></span><span style=display:flex><span>    MemberVO memberVO <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MemberVO();
</span></span><span style=display:flex><span>    memberVO.<span style=color:#a6e22e>setMember</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>desensitizationMember</span>(memberFromDb));
</span></span><span style=display:flex><span>    memberVO.<span style=color:#a6e22e>setToken</span>(JwtUtil.<span style=color:#a6e22e>build</span>(
</span></span><span style=display:flex><span>            memberFromDb.<span style=color:#a6e22e>getId</span>(),
</span></span><span style=display:flex><span>            memberFromDb.<span style=color:#a6e22e>getNickname</span>(),
</span></span><span style=display:flex><span>            memberFromDb.<span style=color:#a6e22e>getAvatar</span>()
</span></span><span style=display:flex><span>    ));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 返回MemberVO实体类</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> memberVO;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=4-开发控制方法-9>4. 开发控制方法</h3><p><code>com.lsx.controller.MemberController.loginByPhone()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;根据手机号码登录&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;loginByPhone&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> MemberVO <span style=color:#a6e22e>loginByPhone</span>(<span style=color:#a6e22e>@RequestBody</span> <span style=color:#a6e22e>@Validated</span> MemberLoginByPhoneDTO dto) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> memberService.<span style=color:#a6e22e>loginByPhone</span>(dto);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=s01-部署前台项目>S01. 部署前台项目</h1><h2 id=e01-部署项目>E01. 部署项目</h2><blockquote><p>武技：在Docker中部署 <code>lesson-server</code> 项目</p></blockquote><h3 id=1-打包项目>1. 打包项目</h3><ol><li>将主配中的全部IP地址由 <code>localhost</code> 改为 <code>192.168.40.77</code> 虚拟机地址。</li><li>在子项目 <code>lesson-server</code> 中添加打包插件：</li></ol><p><code>pom.xml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--项目打包--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;build&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>&lt;!--最终Jar包名--&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;finalName&gt;</span>lesson-server<span style=color:#f92672>&lt;/finalName&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;plugins&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!--SpringBoot打包插件--&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;plugin&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-maven-plugin<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;version&gt;</span>2.4.8<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>&lt;!--配置启动类--&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;configuration&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;mainClass&gt;</span>com.lsx.LessonServerApp<span style=color:#f92672>&lt;/mainClass&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;/configuration&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>&lt;!--打包本项目全部依赖包到最终Jar包内--&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;executions&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;execution&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&lt;goals&gt;</span>
</span></span><span style=display:flex><span>                        <span style=color:#f92672>&lt;goal&gt;</span>repackage<span style=color:#f92672>&lt;/goal&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&lt;/goals&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;/execution&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;/executions&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/plugin&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/plugins&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/build&gt;</span>
</span></span></code></pre></div><ol start=3><li>打包父项目（然后打包子项目）：</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># 打包父项目</span>
</span></span><span style=display:flex><span>cd D:\workspace\java\lesson-project
</span></span><span style=display:flex><span>mvn clean install -Dmaven.test.skip=true
</span></span></code></pre></div><h3 id=2-创建容器>2. 创建容器</h3><ol><li>创建相关目录：</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 创建相关目录</span>
</span></span><span style=display:flex><span>mkdir -p /opt/app/lesson/lesson-server;
</span></span><span style=display:flex><span>chmod -R <span style=color:#ae81ff>777</span> /opt/app/lesson;
</span></span></code></pre></div><ol start=2><li>将Jar包 <code>lesson-server.jar</code> 拷贝到 <code>/opt/app/lesson/lesson-server</code> 目录中。</li><li>创建DockerFile：</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 开发节点的Dockerfile文件</span>
</span></span><span style=display:flex><span>cd /opt/app/lesson/lesson-server;
</span></span><span style=display:flex><span>touch Dockerfile;
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#39;FROM openjdk:11&#39;</span> &gt;&gt; Dockerfile;
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#39;MAINTAINER lsx&#39;</span> &gt;&gt; Dockerfile;
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#39;ADD lesson-server.jar lesson-server.jar&#39;</span> &gt;&gt; Dockerfile;
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#39;EXPOSE 5277&#39;</span> &gt;&gt; Dockerfile;
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#39;CMD [&#34;nohup&#34;, &#34;java&#34;, &#34;-jar&#34;, &#34;lesson-server.jar&#34;, &#34;&amp;&#34;]&#39;</span> &gt;&gt; Dockerfile;
</span></span></code></pre></div><ol start=4><li>构建镜像：</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cd /opt/app/lesson/lesson-server;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 根据Dockerfile文件制作镜像: 必须在Dockerfile文件同级目录下</span>
</span></span><span style=display:flex><span>docker build -t lesson-server:v1.0 .
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查看镜像</span>
</span></span><span style=display:flex><span>docker images
</span></span></code></pre></div><ol start=5><li>创建容器：</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 创建并运行节点容器</span>
</span></span><span style=display:flex><span>docker run --name lesson-server --network my-net -p 5277:5277 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	-e TZ<span style=color:#f92672>=</span>Asia/Shanghai <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	-d lesson-server:v1.0;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查看节点容器</span>
</span></span><span style=display:flex><span>docker ps --format <span style=color:#e6db74>&#34;{{.ID}}\t{{.Names}}\t{{.Ports}}&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 永久开放5277端口</span>
</span></span><span style=display:flex><span>firewall-cmd --add-port<span style=color:#f92672>=</span>5277/tcp --permanent
</span></span><span style=display:flex><span>firewall-cmd --reload
</span></span></code></pre></div><ol start=6><li>在Windows机器上 <a href=http://192.168.40.77:5277/doc.html>访问容器的Swagger文档</a></li></ol></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div></main><footer class=footer><span>&copy; 2024 The Marauders</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>