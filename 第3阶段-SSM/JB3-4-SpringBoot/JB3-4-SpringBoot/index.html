<!doctype html><html lang=en><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>JB3-4-SpringBoot</title>
<meta name=description content="[!NOTE] Java道经第3卷 - 第4阶 - SpringBoot v3-4-ssm-springboot
S01. SpringBoot基础入门 心法: SpringBoot 基本概念
SpringBoot是由Pivotal团队提供的基于Spring框架的轻量级应用开发框架，包含Spring全部功能。 …"><meta name=keywords content='blog,lsx2216,hugo'><meta property="og:url" content="https://lsx2216.netlify.app/%E7%AC%AC3%E9%98%B6%E6%AE%B5-SSM/JB3-4-SpringBoot/JB3-4-SpringBoot/"><meta property="og:type" content="website"><meta property="og:title" content="JB3-4-SpringBoot"><meta property="og:description" content="[!NOTE] Java道经第3卷 - 第4阶 - SpringBoot v3-4-ssm-springboot
S01. SpringBoot基础入门 心法: SpringBoot 基本概念
SpringBoot是由Pivotal团队提供的基于Spring框架的轻量级应用开发框架，包含Spring全部功能。 …"><meta property="og:image" content="https://lsx2216.netlify.app/assets/images/user.jpg"><meta property="og:image:secure_url" content="https://lsx2216.netlify.app/assets/images/user.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="JB3-4-SpringBoot"><meta name=twitter:description content="[!NOTE] Java道经第3卷 - 第4阶 - SpringBoot v3-4-ssm-springboot
S01. SpringBoot基础入门 心法: SpringBoot 基本概念
SpringBoot是由Pivotal团队提供的基于Spring框架的轻量级应用开发框架，包含Spring全部功能。 …"><meta property="twitter:domain" content="https://lsx2216.netlify.app/%E7%AC%AC3%E9%98%B6%E6%AE%B5-SSM/JB3-4-SpringBoot/JB3-4-SpringBoot/"><meta property="twitter:url" content="https://lsx2216.netlify.app/%E7%AC%AC3%E9%98%B6%E6%AE%B5-SSM/JB3-4-SpringBoot/JB3-4-SpringBoot/"><meta name=twitter:image content="https://lsx2216.netlify.app/assets/images/user.jpg"><link rel=canonical href=https://lsx2216.netlify.app/%E7%AC%AC3%E9%98%B6%E6%AE%B5-SSM/JB3-4-SpringBoot/JB3-4-SpringBoot/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.3eb19cb61dde9e37b9522867f3e024aeb68e26ab8e03252e46e365abcb19acf7.js integrity="sha256-PrGcth3enje5Uihn8+AkrraOJquOAyUuRuNlq8sZrPc="></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css integrity=sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js integrity=sha384-X/XCfMm41VSsqRNQgDerQczD69XqmjOOOwYQvr/uuC+j4OPoNhVgjdGFwhvN02Ja crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script>    <link rel="shortcut icon" href="/assets/images/user.jpg" type="image/x-icon">
</head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://lsx2216.netlify.app/><img src=/assets/images/user.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://lsx2216.netlify.app/>lsx2216</a></div><div class=nav-links><div class=nav-link><a href=https://lsx2216.netlify.app/ aria-label><span data-feather=home></span> Home</a></div><div class=nav-link><a href=https://lsx2216.netlify.app/projects/ aria-label><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://github.com aria-label=github><span data-feather=github></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://lsx2216.netlify.app/><span data-feather=home></span> Home</a></li><li class=nav-item><a href=https://lsx2216.netlify.app/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://github.com><span data-feather=github></span></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>JB3-4-SpringBoot</h1></div><div class=post-content><blockquote><p>[!NOTE] Java道经第3卷 - 第4阶 - SpringBoot
v3-4-ssm-springboot</p></blockquote><h1 id=s01-springboot基础入门>S01. SpringBoot基础入门</h1><blockquote><p>心法: <a href=https://spring.io/>SpringBoot</a> 基本概念</p></blockquote><ul><li>SpringBoot是由Pivotal团队提供的基于Spring框架的轻量级应用开发框架，包含Spring全部功能。</li><li>SpringBoot的主要目的是简化Spring应用的开发和部署过程，从而提高开发和部署效率。</li></ul><table><thead><tr><th>SpringBoot优势</th><th>描述</th></tr></thead><tbody><tr><td>减少配置文件</td><td>SpringBoot大量使用注解来替代繁琐复杂的XML配置，大大地提高了开发效率和开发体验。</td></tr><tr><td>自动装配组件</td><td>SpringBoot可以自动将第三方组件的Bean装载进Spring容器，无需手写Bean的装配配置。</td></tr><tr><td>应用拓展性高</td><td>SpringBoot针对常见场景提供了丰富的启动依赖集合 <code>starter</code>，以支持快速开发和部署应用程序。</td></tr><tr><td>提高部署效率</td><td>SpringBoot项目内嵌Tomcat，Jetty等容器，不仅可以更快速便捷地将应用部署到各种云平台，Docker等环境中，而且以Jar包的形式独立运行和部署的项目，启动速度会更快。</td></tr><tr><td>面向生产环境</td><td>SpringBoot提供了很多面向生产环境的功能，如管理端点、健康检查、指标收集，应用监控等。</td></tr></tbody></table><h2 id=e01-springboot项目搭建>E01. SpringBoot项目搭建</h2><blockquote><p>心法: SpringBoot项目的三种创建方式</p></blockquote><ol><li>使用 <a href=https://start.spring.io/>官方在线工具</a> 创建SpringBoot项目，没有IDEA时推荐该方式。</li><li>使用IDEA创建SpringBoot项目: 创建过程中直接选择 <code>Spring Initializr</code> 进行快速搭建，工作时推荐该方式。</li><li>使用IDEA创建SpringBoot项目: 先创建MavenJar项目，然后再改造为SpringBoot项目，学习时推荐该方式。</li></ol><p><img src=/%E7%AC%AC3%E9%98%B6%E6%AE%B5-SSM/JB3-4-SpringBoot/image/img.png alt></p><blockquote><p>武技: 手动创建MavenJar项目 <code>v3-4-ssm-springboot/springboot-start</code></p></blockquote><h3 id=1-添加三方依赖>1. 添加三方依赖</h3><ol><li>在父项目中锁定版本：</li></ol><p><code>pom.xml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;junit-version&gt;</span>4.13.2<span style=color:#f92672>&lt;/junit-version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;lombok-version&gt;</span>1.18.24<span style=color:#f92672>&lt;/lombok-version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;hutool-version&gt;</span>5.8.14<span style=color:#f92672>&lt;/hutool-version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;spring-boot-version&gt;</span>2.3.12.RELEASE<span style=color:#f92672>&lt;/spring-boot-version&gt;</span>
</span></span></code></pre></div><ol start=2><li>在父项目中管理依赖:</li></ol><p><code>pom.xml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--junit--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>junit<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>junit<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>${junit-version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;scope&gt;</span>test<span style=color:#f92672>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--lombok--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.projectlombok<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>lombok<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>${lombok-version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;scope&gt;</span>provided<span style=color:#f92672>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--hutool-all--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>cn.hutool<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>hutool-all<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>${hutool-version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-boot-starter-parent--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-parent<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>${spring-boot-version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>&lt;!--声明该项目是一个POM类型的父项目，不参与打包，只用于传递依赖--&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;type&gt;</span>pom<span style=color:#f92672>&lt;/type&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>&lt;!--导入 spring-boot-starter-parent 项目中的 `&lt;dependencyManagement&gt;` 到本项目--&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;scope&gt;</span>import<span style=color:#f92672>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start=3><li>如果是单独的SpringBoot项目，不存在Maven父子结构，则需要在单独项目使用 <code>&lt;parent></code> 进行引入:</li></ol><p><code>pom.xml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-boot-starter-parent--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;parent&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-parent<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>2.3.12.RELEASE<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/parent&gt;</span>
</span></span></code></pre></div><ol start=4><li>在子项目中引入依赖:</li></ol><p><code>pom.xml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--junit--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>junit<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>junit<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--lombok--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.projectlombok<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>lombok<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--hutool--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>cn.hutool<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>hutool-all<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-boot-starter-web--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-web<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><h3 id=2-开发配置文件>2. 开发配置文件</h3><p><code>classpath:application.yml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>server</span>:  
</span></span><span style=display:flex><span>  <span style=color:#f92672>port</span>: <span style=color:#ae81ff>8001</span> <span style=color:#75715e># 端口号  </span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>tomcat</span>:  
</span></span><span style=display:flex><span>    <span style=color:#f92672>threads</span>:  
</span></span><span style=display:flex><span>      <span style=color:#f92672>max</span>: <span style=color:#ae81ff>200</span> <span style=color:#75715e># Tomcat线程池最大值（默认200）</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spring</span>:  
</span></span><span style=display:flex><span>  <span style=color:#f92672>application</span>:  
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>springboot-start</span> <span style=color:#75715e># 项目名称  </span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>resources</span>:  
</span></span><span style=display:flex><span>    <span style=color:#f92672>static-locations</span>: <span style=color:#ae81ff>classpath:/static/</span> <span style=color:#75715e># 静态资源位置</span>
</span></span></code></pre></div><h3 id=3-开发启动类>3. 开发启动类</h3><blockquote><p>心法：启动类上的 @SpringBootApplication 注解用于标记启动类</p></blockquote><ul><li>启动类要放在其他所有类的上层：</li></ul><pre tabindex=0><code class=language-mermaid data-lang=mermaid>flowchart LR
n[&#34;@SpringBootApplication&#34;]
n --&gt; n1[&#34;@SpringBootConfiguration&#34;] --&gt; n1a[&#34;声明启动类是一个配置类&#34;]
n --&gt; n2[&#34;@EnableAutoConfiguration&#34;] --&gt; n2a[&#34;开启SpringBoot自动装配功能&#34;]
n --&gt; n3[&#34;@ComponentScan&#34;] --&gt; n3a[&#34;扫描所在包及子包下的@Component注解&#34;]
</code></pre><p><code>com.lsx.SpringBootApp</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootApplication</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SpringBootApp</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>        SpringApplication.<span style=color:#a6e22e>run</span>(SpringBootApp.<span style=color:#a6e22e>class</span>, args);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=4-开发控制器类>4. 开发控制器类</h3><ol><li><a href=/%E7%AC%AC3%E9%98%B6%E6%AE%B5-ssm/JB3-3-SpringMVC/res/%E5%B0%81%E8%A3%85Result%E5%93%8D%E5%BA%94%E7%B1%BB/>封装Result响应类</a></li><li>开发控制器方法 <code>test()</code>：</li></ol><p><code>com.lsx.controller.StartController</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RequestMapping</span>(<span style=color:#e6db74>&#34;/api/v1/start/&#34;</span>)  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>StartController</span> {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/test&#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Result<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>test</span>() {  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Result<span style=color:#f92672>&lt;&gt;</span>(<span style=color:#e6db74>&#34;success&#34;</span>);  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=3><li><a href=http://localhost:8001/api/v1/start/test>访问控制方法 start</a></li></ol><h3 id=5-启动流程解析>5. 启动流程解析</h3><blockquote><p>心法: 通过SpringBoot启动类源码，分析SpringBoot启动流程</p></blockquote><ol><li>SpringBoot启动类代码:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// p1: 启动类的Class对象</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// p2: JVM启动参数列表</span>
</span></span><span style=display:flex><span>    SpringApplication.<span style=color:#a6e22e>run</span>(SpringBootApp.<span style=color:#a6e22e>class</span>, args);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=2><li>SpringBoot启动类上层代码:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> ConfigurableApplicationContext <span style=color:#a6e22e>run</span>(Class<span style=color:#f92672>&lt;?&gt;[]</span> primarySources, String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 第1步: 调用 SpringApplication 构造器以创建 SpringApplication 实例</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 第2步: 调用 SpringApplication 实例的 run() 方法，注意不是上层的静态 run() 方法</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (<span style=color:#66d9ef>new</span> SpringApplication(primarySources)).<span style=color:#a6e22e>run</span>(args);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=3><li>解析SpringBoot项目的启动第1步源码 <code>new SpringApplication(primarySources)</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#a6e22e>SpringApplication</span>(ResourceLoader resourceLoader, Class<span style=color:#f92672>&lt;?&gt;</span>... primarySources) {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ..</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 1. 推测并设置当前项目使用的容器，默认使用Servlet容器，可选Reactive容器</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>webApplicationType</span> <span style=color:#f92672>=</span> WebApplicationType.<span style=color:#a6e22e>deduceFromClasspath</span>();
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 2. 加载 spring-boot.jar 和 spring-boot-autoconfigure.jar 中配置的的初始化器</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//    初始化器配置在 META-INF\spring.factories 中的 ApplicationContextInitializer 项</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setInitializers</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>getSpringFactoriesInstances</span>(ApplicationContextInitializer.<span style=color:#a6e22e>class</span>));
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 3. 加载 spring-boot.jar 和 spring-boot-autoconfigure.jar 中配置的监听器</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//    监听器配置在 META-INF\spring.factories 中的 ApplicationListener 项</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setListeners</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>getSpringFactoriesInstances</span>(ApplicationListener.<span style=color:#a6e22e>class</span>));
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 4. 推测并设置项目启动类: 找到main方法所在的类，为后面的包扫描做准备</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mainApplicationClass</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>deduceMainApplicationClass</span>();
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 5. 此时SpringApplication构造方法执行完毕，SpringApplication实例被创建</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=4><li>解析SpringBoot项目的启动第2步源码 <code>.run(args)</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> ConfigurableApplicationContext <span style=color:#a6e22e>run</span>(String... args) {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 1. 创建并启动计时器，用于记实SpringBoot的启动时长</span>
</span></span><span style=display:flex><span>    StopWatch stopWatch <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> StopWatch();
</span></span><span style=display:flex><span>    stopWatch.<span style=color:#a6e22e>start</span>();
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    ConfigurableApplicationContext context <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 2. 设置即使在没有检测到显示器和鼠标键盘等硬件的情况下，项目依然可以启动</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>configureHeadlessProperty</span>();
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 3. 获取并启动全部SpringBoot的运行监听器</span>
</span></span><span style=display:flex><span>    SpringApplicationRunListeners listeners <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>getRunListeners</span>(args);
</span></span><span style=display:flex><span>    listeners.<span style=color:#a6e22e>starting</span>();
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 4. 设置JVM运行参数</span>
</span></span><span style=display:flex><span>    ApplicationArguments applicationArguments <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> DefaultApplicationArguments(args);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 5. 准备环境变量，包括系统属性变量和项目主配中的配置项等</span>
</span></span><span style=display:flex><span>    ConfigurableEnvironment environment <span style=color:#f92672>=</span> 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>prepareEnvironment</span>(listeners, applicationArguments);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 6. 忽略环境变量中配置的BEAN信息</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>configureIgnoreBeanInfo</span>(environment);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 7. 打印SpringBoot的Banner横幅，源码在 o.s.b.SpringBootBanner 类中</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//    在 resources 下新建 banner.txt 可以覆盖SpringBoot默认的Banner横幅内容</span>
</span></span><span style=display:flex><span>    Banner printedBanner <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>printBanner</span>(environment);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 8. 创建应用上下文，利用反射创建实例</span>
</span></span><span style=display:flex><span>    context <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>createApplicationContext</span>();
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 9. 准备应用上下文</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//    this.postProcessApplicationContext(context): 创建beanName生成器，用于生成bean实例的名称</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//    this.applyInitializers(context): 执行SpringApplication构造器中加载的所有初始化器</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>prepareContext</span>(context, environment, listeners, applicationArguments, printedBanner);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 10. 刷新应用上下文，执行自动装配并启动Tomcat容器</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>refreshContext</span>(context);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 11. 一个空方法，在刷新应用上下文后执行，是留给我们自行拓展的方法</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>afterRefresh</span>(context, applicationArguments);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 12. 结束定时器并</span>
</span></span><span style=display:flex><span>    stopWatch.<span style=color:#a6e22e>stop</span>();
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 13. 打印SpringBoot项目启动时长</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>logStartupInfo</span>) {
</span></span><span style=display:flex><span>            (<span style=color:#66d9ef>new</span> StartupInfoLogger(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mainApplicationClass</span>))
</span></span><span style=display:flex><span>              .<span style=color:#a6e22e>logStarted</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>getApplicationLog</span>(), stopWatch);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 14. 运行监听器准备完毕</span>
</span></span><span style=display:flex><span>    listeners.<span style=color:#a6e22e>started</span>(context);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 15. 执行重写了 ApplicationRunner.run() 的自定义Runner类，是一个拓展功能</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>callRunners</span>(context, applicationArguments);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 16. 运行监听器开始工作</span>
</span></span><span style=display:flex><span>    listeners.<span style=color:#a6e22e>running</span>(context);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 17. 返回配置好的上下文对象</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> context;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e02-springboot常用注解>E02. SpringBoot常用注解</h2><h3 id=1-springboottest>1. @SpringBootTest</h3><blockquote><p>心法: SpringBoot单元测试</p></blockquote><ul><li>如果在进行单元测试之前，不需要启动SpringBoot项目，则直接使用Junit单元测试即可。</li><li>如果在进行单元测试之前，需要先启动SpringBoot项目，则可以使用SpringBoot单元测试:<ul><li>类上标记 <code>@RunWith(SpringRunner.class)</code>: SpringBoot整合Junit单元测试。</li><li>类上标记 <code>@SpringBootTest(classes = SpringBootApp.class)</code>: 指定启动类。</li></ul></li></ul><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

n1[准备进行&lt;br/&gt;单元测试] --&gt; f{是否需要&lt;br/&gt;先启动项目}
	f--否--&gt; n2[使用Junit单元测试] --&gt; n3[无需任何注解]
	f--是--&gt; n4[使用SpringBootTest单元测试] --&gt; n5[需要RunWith和SpringBootTest注解]
</code></pre><blockquote><p>武技: 测试SpringBoot单元测试</p></blockquote><ol><li>在子项目中引入依赖:</li></ol><p><code>pom.xml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-boot-starter-test--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-test<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;scope&gt;</span>test<span style=color:#f92672>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start=2><li>开发实体类 <code>Cat</code>: 标记 <code>@Component</code> 加入Spring管理：</li></ol><p><code>com.lsx.entity.Cat</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Cat</span> <span style=color:#66d9ef>implements</span> Serializable {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String catName;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Integer catAge;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=3><li>开发SpringBoot单元测试类 <code>CatTest</code>:</li></ol><p><code>springboottest.CatTest</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RunWith</span>(SpringRunner.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>(classes <span style=color:#f92672>=</span> SpringBootStartApp.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CatTest</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Cat cat;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>cat</span>() {
</span></span><span style=display:flex><span>        cat.<span style=color:#a6e22e>setCatName</span>(<span style=color:#e6db74>&#34;咪咪&#34;</span>);
</span></span><span style=display:flex><span>        cat.<span style=color:#a6e22e>setCatAge</span>(5);
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(cat);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=2-propertysource>2. @PropertySource</h3><blockquote><p>心法: @PropertySource + @Value 注解</p></blockquote><ul><li><code>@PropertySource</code> 用在类上，用于读取指定的properties或yaml配置文件：<ul><li>如 <code>@PropertySource("classpath:xxx.yml")</code> 等。</li><li>该注解需要在项目启动的前提下才能生效。</li></ul></li><li><code>@Value</code> 用在属性上，用于读取配置文件中的指定值，需要使用 <code>${}</code> 进行引入：<ul><li>如 <code>@Value("server.port") int port</code> 等。</li><li>类全名：<code>org.springframework.beans.factory.annotation.Value</code> 。</li></ul></li></ul><blockquote><p>武技: 测试 @PropertySource + @Value 注解</p></blockquote><ol><li>开发测试类 <code>PropertySourceTest</code>：</li></ol><p><code>propertysource.PropertySourceTest</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RunWith</span>(SpringRunner.<span style=color:#a6e22e>class</span>)  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>(classes <span style=color:#f92672>=</span> SpringBootStartApp.<span style=color:#a6e22e>class</span>)  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@PropertySource</span>(<span style=color:#e6db74>&#34;classpath:application.yml&#34;</span>)  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PropertySourceTest</span> {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Value</span>(<span style=color:#e6db74>&#34;${server.port}&#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> port;  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Value</span>(<span style=color:#e6db74>&#34;${spring.application.name}&#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String name;  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>getProperty</span>() {  
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;项目端口: &#34;</span> <span style=color:#f92672>+</span> port);  
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;项目名称: &#34;</span> <span style=color:#f92672>+</span> name);  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-aspect>3. @Aspect</h3><blockquote><p>心法: AOP异常通知的处理方案</p></blockquote><ul><li>AOP中的异常通知比全局异常处理类优先级高，建议将处理异常的工作让给全局异常处理类来做。</li></ul><blockquote><p>武技: 在子项目中开发业务层的AOP代码</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

    n1[添加&lt;br/&gt;AOP相关依赖] 
--&gt; n2[开发&lt;br/&gt;业务方法] 
--&gt; n3[开发&lt;br/&gt;切面类] 
--&gt; n4[开发&lt;br/&gt;环绕通知方法] 
	--&gt; n4a[前置通知&lt;br/&gt;校验参数是否包含null值] &amp; n4b[后置通知&lt;br/&gt;记录业务方法调用日志]
--&gt; n5[测试&lt;br/&gt;业务方法]
</code></pre><ol><li>在子项目中添加依赖：</li></ol><p><code>pom.xml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-boot-starter-aop--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-aop<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start=2><li>开发业务接口 <code>DogService</code>：</li></ol><p><code>com.lsx.service.DogService</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>DogService</span> {  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>insert</span>(String param);  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>select</span>(String param);  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=3><li>实现业务接口 <code>DogServiceImpl</code>：</li></ol><p><code>com.lsx.service.impl.DogServiceImpl</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Component</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DogServiceImpl</span> <span style=color:#66d9ef>implements</span> DogService {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>insert</span>(String param) {  
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;调用insert方法，参数为: &#34;</span> <span style=color:#f92672>+</span> param);  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>select</span>(String param) {  
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;调用select方法，参数为: &#34;</span> <span style=color:#f92672>+</span> param);  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=4><li>开发切面类 <code>ServiceAspect</code>:</li></ol><p><code>com.lsx.component.ServiceAspect</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Aspect</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Component</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ServiceAspect</span> {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Around</span>(<span style=color:#e6db74>&#34;execution(public * com.lsx.service.impl.*.*(..))&#34;</span>)  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@SneakyThrows</span>  
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>aroundAdvice</span>(ProceedingJoinPoint pjp) {  
</span></span><span style=display:flex><span>	  
</span></span><span style=display:flex><span>	    <span style=color:#75715e>// 获取方法参数  </span>
</span></span><span style=display:flex><span>	    Object<span style=color:#f92672>[]</span> args <span style=color:#f92672>=</span> pjp.<span style=color:#a6e22e>getArgs</span>();  
</span></span><span style=display:flex><span>	    <span style=color:#75715e>// 组装完整业务方法名：类名.方法名()  </span>
</span></span><span style=display:flex><span>	    String className <span style=color:#f92672>=</span> pjp.<span style=color:#a6e22e>getTarget</span>().<span style=color:#a6e22e>toString</span>();  
</span></span><span style=display:flex><span>	    className <span style=color:#f92672>=</span> className.<span style=color:#a6e22e>substring</span>(className.<span style=color:#a6e22e>lastIndexOf</span>(<span style=color:#e6db74>&#39;.&#39;</span>) <span style=color:#f92672>+</span> 1, className.<span style=color:#a6e22e>indexOf</span>(<span style=color:#e6db74>&#39;@&#39;</span>));  
</span></span><span style=display:flex><span>	    String methodName <span style=color:#f92672>=</span> pjp.<span style=color:#a6e22e>getSignature</span>().<span style=color:#a6e22e>getName</span>();  
</span></span><span style=display:flex><span>	    methodName <span style=color:#f92672>=</span> className <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;.&#34;</span> <span style=color:#f92672>+</span> methodName <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;()&#34;</span>;  
</span></span><span style=display:flex><span>	  
</span></span><span style=display:flex><span>	    <span style=color:#75715e>// 前置通知: 检查参数中是否存在空值  </span>
</span></span><span style=display:flex><span>	    <span style=color:#66d9ef>if</span> (ObjectUtil.<span style=color:#a6e22e>hasNull</span>(args)) {  
</span></span><span style=display:flex><span>	        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException(<span style=color:#e6db74>&#34;通知: 业务方法 &#34;</span> <span style=color:#f92672>+</span> methodName <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;中存在null值参数&#34;</span>);  
</span></span><span style=display:flex><span>	    }  
</span></span><span style=display:flex><span>	  
</span></span><span style=display:flex><span>	    <span style=color:#75715e>// 调用目标方法  </span>
</span></span><span style=display:flex><span>	    Object returnValue <span style=color:#f92672>=</span> pjp.<span style=color:#a6e22e>proceed</span>(args);  
</span></span><span style=display:flex><span>	  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 后置通知: 记录业务层调用日志</span>
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;通知: 业务方法 %s 被调用:\n\t形参：%s\n\t返回：%s\n&#34;</span>,
</span></span><span style=display:flex><span>                methodName,
</span></span><span style=display:flex><span>                Arrays.<span style=color:#a6e22e>toString</span>(args),
</span></span><span style=display:flex><span>                returnValue);
</span></span><span style=display:flex><span>	  
</span></span><span style=display:flex><span>	    <span style=color:#75715e>// 返回目标方法的返回值  </span>
</span></span><span style=display:flex><span>	    <span style=color:#66d9ef>return</span> returnValue;  
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=5><li>测试业务方法 <code>DogServiceTest -> method()</code>：</li></ol><p><code>aspect.DogServiceTest</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RunWith</span>(SpringRunner.<span style=color:#a6e22e>class</span>)  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>(classes <span style=color:#f92672>=</span> SpringBootStartApp.<span style=color:#a6e22e>class</span>)  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DogServiceTest</span> {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> DogService dogService;  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>insert</span>(){  
</span></span><span style=display:flex><span>        dogService.<span style=color:#a6e22e>insert</span>(<span style=color:#e6db74>&#34;hello&#34;</span>);  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>select</span>(){  
</span></span><span style=display:flex><span>        dogService.<span style=color:#a6e22e>select</span>(<span style=color:#66d9ef>null</span>);  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=4-restcontrolleradvice>4. @RestControllerAdvice</h3><blockquote><p>心法: SpringBoot响应通知类</p></blockquote><ul><li>SpringBoot响应通知类的本质是对控制方法的AOP操作：<ul><li>它会在 <code>@ResponseBody</code> 控制方法返回后执行。</li><li>它会在 <code>HttpMessageConverter</code> 响应数据前执行。</li></ul></li><li>SpringBoot响应通知类要求：<ul><li>类上标记 <code>@RestControllerAdvice</code>：用于指定控制器类的扫描范围，尽量保持最小。</li><li>需要实现 <code>ResponseBodyAdvice</code> 接口。</li><li>实现方法 <code>supports()</code>：返回true表示继续调用处理数据的方法，返回false表示不处理数据，直接返回。</li><li>实现方法 <code>beforeBodyWrite()</code>：用于对响应数据进行二次处理。</li></ul></li></ul><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

B[浏览器] --&gt; 控制方法 --返回值数据--&gt; n1[supports方法]
n1 -- return true 
	--&gt; n2[beforeBodyWrite方法&lt;br/&gt;二次处理返回值]
	--&gt; n3[HttpMessageConverter转换器&lt;br/&gt;将最终数据写入响应体]
n1 -- return false --&gt; n3
n3 --响应--&gt; B
</code></pre><blockquote><p>武技: 在子项目中开发响应处理类，统一封装控制器的返回值</p></blockquote><ol><li>开发响应通知类 <code>ResultAdvice</code>：</li></ol><p><code>com.lsx.component.ResultAdvice</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RestControllerAdvice</span>(basePackages <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;com.lsx.controller&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ResultAdvice</span> <span style=color:#66d9ef>implements</span> ResponseBodyAdvice<span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>supports</span>(MethodParameter methodParameter, Class aClass) {
</span></span><span style=display:flex><span>	    <span style=color:#75715e>// 放行到 beforeBodyWrite() 方法</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param o      响应数据  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param aClass 转换器类型，以下两种均为 HttpMessageConverter 的子类
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *               字符串型数据使用 StringHttpMessageConverter转换，
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *               其他类型数据使用 MappingJackson2HttpMessageConverter转换。
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>beforeBodyWrite</span>(Object o, MethodParameter methodParameter,
</span></span><span style=display:flex><span>                                  MediaType mediaType, Class aClass,
</span></span><span style=display:flex><span>                                  ServerHttpRequest serverHttpRequest,
</span></span><span style=display:flex><span>                                  ServerHttpResponse serverHttpResponse) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 若Jackson使用字符串转换器，使用JSON封装一下再直接返回字符串，避免爆发转换异常</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (aClass <span style=color:#f92672>==</span> StringHttpMessageConverter.<span style=color:#a6e22e>class</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> JSONUtil.<span style=color:#a6e22e>toJsonStr</span>(o);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 若返回值已经是Result类型则直接返回</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (o <span style=color:#66d9ef>instanceof</span> Result) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> o;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// 统一将Controller的返回值封装为Result类型</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Result<span style=color:#f92672>&lt;&gt;</span>(o);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=2><li>开发控制器 <code>PigController</code>：</li></ol><p><code>com.lsx.controller.PigController</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RequestMapping</span>(<span style=color:#e6db74>&#34;/api/v1/pig/&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PigController</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/test01&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>test01</span>() {
</span></span><span style=display:flex><span>	    <span style=color:#75715e>// 返回Map型数据，此时SpringMVC采用 MappingJackson2HttpMessageConverter 对数据进行转换</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Map.<span style=color:#a6e22e>of</span>(<span style=color:#e6db74>&#34;username&#34;</span>, <span style=color:#e6db74>&#34;test04&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/test02&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>test02</span>() {
</span></span><span style=display:flex><span>	    <span style=color:#75715e>// 返回String型数据，此时SpringMVC采用 StringHttpMessageConverter 对数据进行转换</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;{\&#34;name\&#34;: \&#34;zhaosi\&#34;}&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/test03&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>test03</span>() {
</span></span><span style=display:flex><span>	    <span style=color:#75715e>// 返回Result型数据，此时SpringMVC采用 MappingJackson2HttpMessageConverter 对数据进行转换</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Result<span style=color:#f92672>&lt;&gt;</span>(ResultCode.<span style=color:#a6e22e>FAILED</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=3><li>访问控制方法：<ol><li><a href=http://localhost:8001/api/v1/pig/test01>test01()</a>：SpringMVC采用 <code>MappingJackson2HttpMessageConverter</code> 对 <code>Map</code> 等型数据进行转换。</li><li><a href=http://localhost:8001/api/v1/pig/test02>test02()</a>：SpringMVC采用 <code>StringHttpMessageConverter</code> 对 <code>String</code> 型数据进行转换。</li><li><a href=http://localhost:8001/api/v1/pig/test03>test03()</a>：<code>Result</code> 型数据不会进行二次Result封装。</li></ol></li></ol><h3 id=5-exceptionhandler>5. @ExceptionHandler</h3><blockquote><p>心法: SpringBoot处理全局异常</p></blockquote><ul><li>全局异常处理类用于统一处理控制器类中爆发的异常：<ul><li>类上标记 <code>@RestControllerAdvice</code>: 用于指定控制器类的扫描范围，尽量保持最小。</li><li>方法标记 <code>@ExceptionHandler</code>: 用于指定异常类型，方法可设计多个，但要注意异常的大小顺序。</li></ul></li><li>全局异常处理方法的优先级比AOP异常通知要低，同时存在时将无法生效。</li></ul><blockquote><p>武技: 开发全局异常处理类</p></blockquote><ol><li>开发全局异常处理类 <code>ExceptionAdvice</code>：</li></ol><p><code>com.lsx.component.ExceptionAdvice</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span> 
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RestControllerAdvice</span>(basePackages <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;com.lsx.controller&#34;</span>})  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ExceptionAdvice</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@ExceptionHandler</span>(Exception.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Result<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>exception</span>(Exception e) {
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(e.<span style=color:#a6e22e>getMessage</span>());
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Result<span style=color:#f92672>&lt;&gt;</span>(ResultCode.<span style=color:#a6e22e>FAILED</span>, e.<span style=color:#a6e22e>getMessage</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=2><li>开发控制方法 <code>FishController -> test()</code>：</li></ol><p><code>com.lsx.controller.FishController</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RequestMapping</span>(<span style=color:#e6db74>&#34;/api/v1/fish/&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FishController</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/test/{num}&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>test</span>(<span style=color:#a6e22e>@PathVariable</span> Integer num) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (num <span style=color:#f92672>==</span> 0) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException(<span style=color:#e6db74>&#34;除数不能为零&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> 100 <span style=color:#f92672>/</span> num;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=3><li><a href=http://localhost:8001/api/v1/fish/test/0>访问控制方法</a></li></ol><h3 id=6-scheduled>6. @Scheduled</h3><blockquote><p>心法: @Scheduled 定时注解</p></blockquote><ul><li>SpringBoot支持使用 <code>@Scheduled(corn = "")</code> 标记方法，使其成为一个定时执行的任务方法：<ul><li>Spring自研的定时任务工具，相比于Quartz更加简单方便，且不需要引入其他依赖即可使用。</li></ul></li><li>SpringBoot定时任务默认不开启，需要在配置类上标记 <code>@EnableScheduling</code> 注解以开启该功能。</li><li>Cron表达式: 本质是一个规则字符串，格式为 <code>秒 分 时 日 月 星期 年（可省略）</code></li></ul><table><thead><tr><th></th><th>秒(0~59)</th><th>分(0~59)</th><th>时(0~23)</th><th>日(0~31)</th><th>月(1~12)</th><th>周(1~7)</th></tr></thead><tbody><tr><td><code>2,5</code></td><td>每分钟的第2秒和第5秒各执行一次</td><td>每小时的第2分钟和第5分钟各执行一次</td><td>每天的2点和5点各执行一次</td><td>每月的2号和5号各执行一次</td><td>每年的2月和5月各执行一次</td><td>每星期的周2和周5各执行一次</td></tr><tr><td><code>2-5</code></td><td>每分钟的第 2,3,4,5 秒各执行一次</td><td>每小时的第 2,3,4,5 分钟各执行一次</td><td>每天的第 2,3,4,5 小时各执行一次</td><td>每月的第 2,3,4,5 日各执行一次</td><td>每年的第 2,3,4,5 月各执行一次</td><td>每星期的周 2,3,4,5各执行一次</td></tr><tr><td><code>2/5</code></td><td>每分钟的第2秒开始每隔5秒执行一次</td><td>每小时的第2分钟开始每隔5分钟执行一次</td><td>每天的2点开始每隔5小时执行一次</td><td>每月的2号开始每隔5天执行一次</td><td>每年的2月开始每隔5个月执行一次</td><td>不支持</td></tr><tr><td><code>*</code></td><td>每秒执行一次</td><td>每分钟执行一次</td><td>每小时执行一次</td><td>每天执行一次</td><td>每月执行一次</td><td>每星期执行一次</td></tr><tr><td><code>?</code></td><td>不支持</td><td>不支持</td><td>不支持</td><td>指定周时使用因为日和周冲突</td><td>不支持</td><td>指定日时使用因为日和周冲突</td></tr></tbody></table><blockquote><p>武技: 在子项目中测试定时任务</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

    n1[开发&lt;br/&gt;定时任务类] 
--&gt; n2[开发&lt;br/&gt;定时任务配置类]
--&gt; n3[开发&lt;br/&gt;corn定时任务]
--&gt; n4[启动项目&lt;br/&gt;查看定时效果]
</code></pre><ol><li>在启动类上添加 <code>@EnableScheduling</code> 注解。</li><li>开发定时任务类 <code>ScheduledTask</code>:</li></ol><p><code>com.lsx.component.ScheduledTask</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ScheduledTask</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/** 每天凌晨2点半，执行一次任务 */</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Scheduled</span>(cron <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0 30 02 * * ?&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>task</span>() {
</span></span><span style=display:flex><span>	    System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;task: 执行定时任务&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=3><li>启动SpringBoot项目，查看定时任务效果。</li></ol><h2 id=e09-springboot异步任务>E09. SpringBoot异步任务</h2><blockquote><p>心法: Spring异步任务</p></blockquote><ul><li>异步任务由主线程Fork出来的一个单独的子线程执行，不占用主线程资源，可以提高资源利用率。</li><li>异步任务方法的返回值需要使用 <code>Future&lt;T></code> 接口类型或其子类 <code>AsyncResult&lt;T></code> 类型:<ul><li>调用 <code>Future</code> 中的 <code>get()</code> 方法可以得到返回值，该过程会阻塞主线程。</li></ul></li></ul><p><img src=/%E7%AC%AC3%E9%98%B6%E6%AE%B5-SSM/JB3-4-SpringBoot/image/dcddee0c021b9a310d471fbb6153358d.png alt=Async异步任务流程图></p><blockquote><p>武技: 在子项目中测试异步任务</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

    n1[开发&lt;br/&gt;异步任务类] 
--&gt; n2[开发&lt;br/&gt;异步任务配置类]
--&gt; n3[开发&lt;br/&gt;异步任务] 
--&gt; n4[测试&lt;br/&gt;异步任务]
</code></pre><ol><li>在启动类上添加 <code>@EnableAsync</code> 注解。</li><li>开发异步任务类 <code>AsyncTask</code>:</li></ol><p><code>com.lsx.component.AsyncTask</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyAsyncTask</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@SneakyThrows</span>  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Async</span>  
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> Future<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>taskA</span>() {  
</span></span><span style=display:flex><span>	  
</span></span><span style=display:flex><span>	    <span style=color:#75715e>// 睡眠3秒钟，模拟任务耗时  </span>
</span></span><span style=display:flex><span>	    TimeUnit.<span style=color:#a6e22e>SECONDS</span>.<span style=color:#a6e22e>sleep</span>(5);   
</span></span><span style=display:flex><span>	    System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;异步任务A执行完毕&#34;</span>);  
</span></span><span style=display:flex><span>	  
</span></span><span style=display:flex><span>	    <span style=color:#75715e>// 构建返回值并返回，无返回值时参数传入null即可  </span>
</span></span><span style=display:flex><span>	    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> AsyncResult<span style=color:#f92672>&lt;&gt;</span>(<span style=color:#e6db74>&#34;异步任务A结果数据&#34;</span>);  
</span></span><span style=display:flex><span>	}  
</span></span><span style=display:flex><span>	  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@SneakyThrows</span>  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Async</span>  
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> Future<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>taskB</span>() {  
</span></span><span style=display:flex><span>	  
</span></span><span style=display:flex><span>	    <span style=color:#75715e>// 睡眠10秒钟，模拟任务耗时  </span>
</span></span><span style=display:flex><span>	    TimeUnit.<span style=color:#a6e22e>SECONDS</span>.<span style=color:#a6e22e>sleep</span>(10);  
</span></span><span style=display:flex><span>	    System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;异步任务B执行完毕&#34;</span>);  
</span></span><span style=display:flex><span>	  
</span></span><span style=display:flex><span>	    <span style=color:#75715e>// 构建返回值并返回，无返回值时参数传入null即可  </span>
</span></span><span style=display:flex><span>	    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> AsyncResult<span style=color:#f92672>&lt;&gt;</span>(<span style=color:#e6db74>&#34;异步任务B结果数据&#34;</span>);  
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=2><li>测试异步任务类 <code>AsyncTaskTest</code>:</li></ol><p><code>async.AsyncTaskTest</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RunWith</span>(SpringRunner.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>(classes <span style=color:#f92672>=</span> SpringBootApp.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyAsyncTaskTest</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> MyAsyncTask myAsyncTask;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@SneakyThrows</span>  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Test</span>  
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>task</span>() {  
</span></span><span style=display:flex><span>	  
</span></span><span style=display:flex><span>		System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;任务开始&#34;</span>);  
</span></span><span style=display:flex><span>		  
</span></span><span style=display:flex><span>		<span style=color:#75715e>// 观察日志中的线程名是否为main线程fork出来的一个子线程  </span>
</span></span><span style=display:flex><span>		Future<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> futureA <span style=color:#f92672>=</span> myAsyncTask.<span style=color:#a6e22e>taskA</span>();  
</span></span><span style=display:flex><span>		Future<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> futureB <span style=color:#f92672>=</span> myAsyncTask.<span style=color:#a6e22e>taskB</span>();
</span></span><span style=display:flex><span>	  
</span></span><span style=display:flex><span>	    <span style=color:#75715e>// 轮询  </span>
</span></span><span style=display:flex><span>	    <span style=color:#66d9ef>while</span> (<span style=color:#66d9ef>true</span>) {  
</span></span><span style=display:flex><span>	        <span style=color:#75715e>// 当两个异步任务都结束时，统一获取两个异步任务的返回值  </span>
</span></span><span style=display:flex><span>	        <span style=color:#66d9ef>if</span> (futureA.<span style=color:#a6e22e>isDone</span>() <span style=color:#f92672>&amp;&amp;</span> futureB.<span style=color:#a6e22e>isDone</span>()) {  
</span></span><span style=display:flex><span>	            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(futureA.<span style=color:#a6e22e>get</span>());  
</span></span><span style=display:flex><span>	            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(futureB.<span style=color:#a6e22e>get</span>());  
</span></span><span style=display:flex><span>	            <span style=color:#66d9ef>break</span>;        
</span></span><span style=display:flex><span>			}  
</span></span><span style=display:flex><span>	    }  
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e10-springboot拦截器类>E10. SpringBoot拦截器类</h2><blockquote><p>心法: Interceptor拦截器</p></blockquote><ul><li>Interceptor拦截器用于拦截请求和响应，多个拦截器可组成拦截器链。</li><li>自定义Interceptor拦截器要求实现 <code>HandlerInterceptor</code> 接口:<ul><li>重写前置拦截方法 <code>preHandle()</code>: 在进入控制方法之前执行。</li><li>重写后置拦截方法 <code>postHandle()</code>: 在控制方法返回数据前执行。</li><li>重写渲染拦截方法 <code>afterCompletion()</code>: 在控制方法返回数据后执行。</li></ul></li><li>自定义Interceptor拦截器需要在 <code>WebMvcConfigurer -> addInterceptors()</code> 方法中注册后才能生效。</li></ul><p><img src=/%E7%AC%AC3%E9%98%B6%E6%AE%B5-SSM/JB3-4-SpringBoot/image/JB3-4-SpringBoot-2.png alt></p><blockquote><p>武技: 测试SpringBoot拦截器</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

    n1[开发&lt;br/&gt;拦截器类] 
--&gt; n2a[开发&lt;br/&gt;preHandle方法] &amp; n2b[开发&lt;br/&gt;postHandle方法] &amp; n2c[开发&lt;br/&gt;afterCompletion方法]
--&gt; n3[注册&lt;br/&gt;拦截器类] 
--&gt; n4[开发&lt;br/&gt;控制器类] 
--&gt; n5[访问&lt;br/&gt;控制器类]
</code></pre><ol><li>开发拦截器类 <code>MyInterceptor</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.component;  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SuppressWarnings</span>(<span style=color:#e6db74>&#34;all&#34;</span>)  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Component</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyInterceptor</span> <span style=color:#66d9ef>implements</span> HandlerInterceptor {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 前置拦截: 用于实现控制器的预处理工作  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param req     请求对象  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param resp    响应对象  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param handler 目标控制方法  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return true表示放行，false表示阻止，阻止后直接调用 afterCompletion() 方法  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>preHandle</span>(HttpServletRequest req, HttpServletResponse resp,  
</span></span><span style=display:flex><span>                             Object handler) {  
</span></span><span style=display:flex><span>        log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;preHandle: 获取URL: {}&#34;</span>, req.<span style=color:#a6e22e>getRequestURL</span>());  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 后置拦截: 用于实现控制器的后处理工作，在渲染试图之前调用  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param req     请求对象  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param resp    响应对象  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param handler 目标控制方法  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param mv      模型和视图对象  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>postHandle</span>(HttpServletRequest req, HttpServletResponse resp,  
</span></span><span style=display:flex><span>                           Object handler, ModelAndView mv) <span style=color:#66d9ef>throws</span> Exception {  
</span></span><span style=display:flex><span>        log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;postHandle: 获取State: {}&#34;</span>, resp.<span style=color:#a6e22e>getStatus</span>());  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 渲染拦截: 在渲染试图之后调用，一般用于清理资源，记录请求耗时等工作，仅执行最后一个拦截器的渲染拦截方法 
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param req     请求对象  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param resp    响应对象  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param handler 目标控制方法  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param ex      异常对象  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>afterCompletion</span>(HttpServletRequest req, HttpServletResponse resp,  
</span></span><span style=display:flex><span>                                Object handler, Exception ex) <span style=color:#66d9ef>throws</span> Exception {  
</span></span><span style=display:flex><span>        log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;afterCompletion: 清理&#34;</span>);  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=2><li>配置拦截器类 <code>InterceptorConfig</code>:<ul><li>类上标记 <code>@Configuration</code> 以声明为配置类，以便于Spring启动时加载该配置类。</li></ul></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.config;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>InterceptorConfig</span> <span style=color:#66d9ef>implements</span> WebMvcConfigurer {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> MyInterceptor myInterceptor;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addInterceptors</span>(InterceptorRegistry registry) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 将自定义拦截器注册到全局拦截器链末尾，添加多个拦截器时，按代码顺序排序</span>
</span></span><span style=display:flex><span>        registry.<span style=color:#a6e22e>addInterceptor</span>(myInterceptor)
</span></span><span style=display:flex><span>                <span style=color:#75715e>// 拦截所有 `/api/v0/**` 请求</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>addPathPatterns</span>(<span style=color:#e6db74>&#34;/api/v0/**&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#75715e>// 放行部分请求</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>excludePathPatterns</span>(<span style=color:#e6db74>&#34;/api/v0/noInterceptor&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=3><li>开发控制器类 <code>InterceptorController</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.controller;  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>InterceptorController</span> {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/api/v0/interceptor&#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>interceptor</span>() {  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;interceptor测试成功&#34;</span>;  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/api/v0/noInterceptor&#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>noInterceptor</span>() {  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;noInterceptor测试成功&#34;</span>;  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=4><li><a href=http://localhost:8070/api/v0/interceptor>访问控制方法 interceptor()</a></li><li><a href=http://localhost:8070/api/v0/noInterceptor>访问控制方法 noInterceptor()</a></li></ol><h2 id=e11-springboot跨域配置>E11. SpringBoot跨域配置</h2><blockquote><p>心法: 同源策略</p></blockquote><ul><li>同源策略是一种安全约定，会阻止一个域的JS脚本和另外一个域的内容进行交互:<ul><li>跨域: 当请求URL中的协议，IP或端口三者之间任意一个与当前页面URL不相同，都属于跨域。</li></ul></li><li>浏览器是同源策略的一种实现，即浏览器默认会阻止跨域请求，当浏览器在发送一些复杂跨域请求时:<ol><li>先发送一次OPTIONS预检请求到服务器。</li><li>若服务器正常响应，则发出正式请求，且在超时时间内，不再发送OPTIONS请求。</li><li>若服务器异常响应，如返回500，则直接取消本次请求。</li></ol></li></ul><pre tabindex=0><code class=language-mermaid data-lang=mermaid>sequenceDiagram 
	title: 当浏览器在发送一些复杂跨域请求时
	participant B as 浏览器
	participant S as 服务器

B -&gt;&gt; S: OPTIONS预检请求

opt 服务器正常响应
	B -&gt;&gt; S: 真正请求
end

opt 服务器异常响应
	B --&gt;&gt; S: 取消本次请求
end
</code></pre><blockquote><p>心法: CORS <code>Cross-Origin Resource Sharing</code> 跨域解决方案</p></blockquote><ul><li>CORS是解决跨源AJAX请求的最佳方案:<ul><li>全局跨域方案: 可使用CORS过滤器或拦截器，或重写 <code>WebMvcConfigurer.addCorsMappings()</code> 以设置全局跨域。</li><li>局部跨域方案: 可使用 <code>@CrossOrigin</code> 注解或手动设置响应头以设置局部跨域，局部跨域规则会覆盖全局跨域规则。</li></ul></li><li>无论那种方式跨域，最终目的都是在响应头中添加浏览器需要的数据，进而实现跨域。</li></ul><blockquote><p>武技: 使用CORS解决子项目的跨域访问限制</p></blockquote><ol><li>开发CORS配置类 <code>CorsConfig</code>:<ul><li>标记 <code>@Configuration</code> 以声明为配置类。</li><li>重写 <code>WebMvcConfigurer -> addCorsMappings()</code> 方法，用于开发CORS跨域相关配置。</li></ul></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.config;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CorsConfig</span> <span style=color:#66d9ef>implements</span> WebMvcConfigurer {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addCorsMappings</span>(CorsRegistry registry) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 允许跨域访问我所有的URL路径</span>
</span></span><span style=display:flex><span>        registry.<span style=color:#a6e22e>addMapping</span>(<span style=color:#e6db74>&#34;/**&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#75715e>// 允许所有的请求来源对我进行跨域访问</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>allowedOrigins</span>(<span style=color:#e6db74>&#34;*&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#75715e>// 允许发送Cookie信息</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>allowCredentials</span>(<span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>                <span style=color:#75715e>// 允许所有的请求类型对我进行跨域访问，单独设置时逗号分隔，且必须使用大写字母</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>allowedMethods</span>(<span style=color:#e6db74>&#34;*&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#75715e>// 允许请求中携带任意的Header信息</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>allowedHeaders</span>(<span style=color:#e6db74>&#34;*&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#75715e>// 设置预检请求的超时时间，默认1800秒</span>
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>maxAge</span>(1800);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=2><li>在电脑桌面新建HTML文件，用于测试跨域请求:<ul><li>自行引入 <a href=/%E7%AC%AC2%E9%98%B6%E6%AE%B5-WEB/JB2-9-JavaScript/res/ajax-util.js/>ajax-util.js</a></li></ul></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE html&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>html</span> <span style=color:#a6e22e>lang</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;en&#34;</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>charset</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;UTF-8&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>title</span>&gt;测试跨域&lt;/<span style=color:#f92672>title</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;ajax-util.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ajax</span>({
</span></span><span style=display:flex><span>		<span style=color:#e6db74>&#34;url&#34;</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;http://localhost:8070/test/start&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>&#34;success&#34;</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>res</span> =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>res</span>)
</span></span><span style=display:flex><span>	});
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>html</span>&gt;
</span></span></code></pre></div><h1 id=s02-springboot模块整合>S02. SpringBoot模块整合</h1><h2 id=e01-整合logback>E01. 整合Logback</h2><blockquote><p>心法: LogBack日志框架</p></blockquote><ul><li>在 <code>spring-boot-starter-web</code> 依赖中已经包含了Logback日志框架的相关依赖，无需再单独引入。</li></ul><p><img src=/%E7%AC%AC3%E9%98%B6%E6%AE%B5-SSM/JB3-4-SpringBoot/image/fc48ffe3100aff7376576c3a7daedf7d.png alt=截图></p><blockquote><p>武技: 在子项目中整合LogBack框架</p></blockquote><ol><li>在主配中引入Logback配置:<ul><li>若想使用xml配置文件替代以下所有配置，则仅需使用 <code>logging.config=classpath:logback.xml</code> 项指定xml文件名即可。</li></ul></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#75715e>############################# Logback ##############################  </span>
</span></span><span style=display:flex><span><span style=color:#75715e>#根目录日志等级，控制台格式，文件格式，文件名，文件滚动名，最长时效（天），单个文件最大值，总文件最大值#  </span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>logging.level.root</span><span style=color:#f92672>=</span><span style=color:#e6db74>INFO</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>logging.pattern.console</span><span style=color:#f92672>=</span><span style=color:#e6db74>%d{yyyy-MM-dd HH:mm:ss.SSS} %-5p %4.15(%t) %c{1}.%M:%L %msg%n</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>logging.pattern.file</span><span style=color:#f92672>=</span><span style=color:#e6db74>%d{yyyy-MM-dd HH:mm:ss.SSS} %-5p %4.15(%t) %c{1}.%M:%L %msg%n</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>logging.file.name</span><span style=color:#f92672>=</span><span style=color:#e6db74>v3-4-ssm-springboot/log/springboot.log</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>logging.pattern.rolling-file-name</span><span style=color:#f92672>=</span><span style=color:#e6db74>v3-4-ssm-springboot/log/springboot.%d.%i.log</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>logging.file.max-history</span><span style=color:#f92672>=</span><span style=color:#e6db74>7</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>logging.file.max-size</span><span style=color:#f92672>=</span><span style=color:#e6db74>2KB</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>logging.file.total-size-cap</span><span style=color:#f92672>=</span><span style=color:#e6db74>0</span>
</span></span></code></pre></div><ol start=2><li>开发控制器方法 <code>LogbackController -> logback()</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.controller;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LogbackController</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/test/logback&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>logback</span>() {
</span></span><span style=display:flex><span>        log.<span style=color:#a6e22e>debug</span>(<span style=color:#e6db74>&#34;一条DEBUG级别日志测试记录&#34;</span>);
</span></span><span style=display:flex><span>        log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;一条INFO级别日志测试记录&#34;</span>);
</span></span><span style=display:flex><span>        log.<span style=color:#a6e22e>warn</span>(<span style=color:#e6db74>&#34;一条WARN级别日志测试记录&#34;</span>);
</span></span><span style=display:flex><span>        log.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#34;一条ERROR级别日志测试记录&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;logback测试成功&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=3><li><a href=http://localhost:8070/test/logback>访问控制器方法 logback</a></li></ol><h2 id=e02-整合mybatis>E02. 整合MyBatis</h2><blockquote><p>心法: 在子项目中整合MyBatis框架的流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

    n1[准备&lt;br/&gt;数据库信息] 
--&gt; n2[添加&lt;br/&gt;MyBatis相关依赖]
--&gt; n3[添加&lt;br/&gt;MyBatis主配] 
--&gt; n4[扫描&lt;br/&gt;Mapper接口] 
--&gt; n5[开发&lt;br/&gt;ORM实体类] 
--&gt; n6[开发&lt;br/&gt;Mapper接口] 
--&gt; n7[测试&lt;br/&gt;Mapper接口]
</code></pre><blockquote><p>武技: 在子项目中整合MyBatis框架</p></blockquote><h3 id=1-开发数据库>1. 开发数据库</h3><ol><li>开发测试数据库：</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- db
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>database</span> springboot character <span style=color:#66d9ef>set</span> utf8mb4;  
</span></span><span style=display:flex><span>use springboot; 
</span></span></code></pre></div><ol start=2><li>开发测试表：</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- table 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>drop</span> <span style=color:#66d9ef>table</span> <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>exists</span> <span style=color:#f92672>`</span>dept<span style=color:#f92672>`</span>;  
</span></span><span style=display:flex><span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>exists</span> <span style=color:#f92672>`</span>dept<span style=color:#f92672>`</span>  
</span></span><span style=display:flex><span>(  
</span></span><span style=display:flex><span>    <span style=color:#f92672>`</span>id<span style=color:#f92672>`</span>         bigint       auto_increment         <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;主键&#39;</span>,  
</span></span><span style=display:flex><span>    <span style=color:#f92672>`</span>name<span style=color:#f92672>`</span>       varchar(<span style=color:#ae81ff>128</span>) <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span> <span style=color:#66d9ef>default</span> <span style=color:#e6db74>&#39;&#39;</span>    <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;部门名称&#39;</span>,  
</span></span><span style=display:flex><span>    <span style=color:#f92672>`</span>created<span style=color:#f92672>`</span>    datetime     <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span> <span style=color:#66d9ef>default</span> now() <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;创建时间&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>`</span>updated<span style=color:#f92672>`</span>    datetime     <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span> <span style=color:#66d9ef>default</span> now() <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;修改时间&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>primary</span> <span style=color:#66d9ef>key</span> (<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span>),  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unique</span> (<span style=color:#f92672>`</span>name<span style=color:#f92672>`</span>)  
</span></span><span style=display:flex><span>) <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;部门表&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>drop</span> <span style=color:#66d9ef>table</span> <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>exists</span> <span style=color:#f92672>`</span>emp<span style=color:#f92672>`</span>;  
</span></span><span style=display:flex><span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>exists</span> <span style=color:#f92672>`</span>emp<span style=color:#f92672>`</span>  
</span></span><span style=display:flex><span>(  
</span></span><span style=display:flex><span>    <span style=color:#f92672>`</span>id<span style=color:#f92672>`</span>         bigint       auto_increment         <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;主键&#39;</span>,  
</span></span><span style=display:flex><span>    <span style=color:#f92672>`</span>name<span style=color:#f92672>`</span>       varchar(<span style=color:#ae81ff>128</span>) <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span> <span style=color:#66d9ef>default</span> <span style=color:#e6db74>&#39;&#39;</span>    <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;员工姓名&#39;</span>,  
</span></span><span style=display:flex><span>    <span style=color:#f92672>`</span>age<span style=color:#f92672>`</span>        int unsigned <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span> <span style=color:#66d9ef>default</span> <span style=color:#ae81ff>0</span>     <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;员工年龄&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>`</span>fk_dept_id<span style=color:#f92672>`</span> bigint                              <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;部门外键&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>`</span>created<span style=color:#f92672>`</span>    datetime     <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span> <span style=color:#66d9ef>default</span> now() <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;创建时间&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>`</span>updated<span style=color:#f92672>`</span>    datetime     <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span> <span style=color:#66d9ef>default</span> now() <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;修改时间&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>primary</span> <span style=color:#66d9ef>key</span> (<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span>),  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>unique</span> (<span style=color:#f92672>`</span>name<span style=color:#f92672>`</span>)  
</span></span><span style=display:flex><span>) <span style=color:#66d9ef>comment</span> <span style=color:#e6db74>&#39;员工表&#39;</span>;  
</span></span></code></pre></div><h3 id=2-开发实体类>2. 开发实体类</h3><ol><li>开发ORM实体类 <code>Dept</code>:</li></ol><p><code>com.lsx.entity.Dept</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Data</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Dept</span> <span style=color:#66d9ef>implements</span> Serializable {  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Long id;  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String name;  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=2><li>开发ORM实体类 <code>Emp</code>:</li></ol><p><code>com.lsx.entity.Emp</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Data</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Emp</span> <span style=color:#66d9ef>implements</span> Serializable {  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Long id;  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String name;  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Long age;  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Long fkDeptId;  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Date created;  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Date updated;  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol><li>在父项目中锁定版本：</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;mysql-connector-j-version&gt;</span>8.0.33<span style=color:#f92672>&lt;/mysql-connector-j-version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;mybatis-spring-boot-starter-version&gt;</span>2.1.3<span style=color:#f92672>&lt;/mybatis-spring-boot-starter-version&gt;</span>
</span></span></code></pre></div><ol start=2><li>在父项目中管理依赖:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--mysql-connector-j--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>com.mysql<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>mysql-connector-j<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>${mysql-connector-j-version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;scope&gt;</span>runtime<span style=color:#f92672>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--mybatis-spring-boot-starter--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.mybatis.spring.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>mybatis-spring-boot-starter<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>${mybatis-spring-boot-starter-version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start=3><li>在子项目中添加依赖:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--mysql-connector-j--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>com.mysql<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>mysql-connector-j<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--mybatis-spring-boot-starter--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.mybatis.spring.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>mybatis-spring-boot-starter<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start=4><li>开发主配项 <code>application.properties</code>:<ul><li>这里不要开启MyBatis的延迟加载，否则会和后面的SpringCache冲突。</li></ul></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#75715e>############################# DataSource ##############################</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#驱动串，连接串，账号，密码，连接池类#</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.datasource.driver-class-name</span><span style=color:#f92672>=</span><span style=color:#e6db74>com.mysql.cj.jdbc.Driver</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.datasource.url</span><span style=color:#f92672>=</span><span style=color:#e6db74>jdbc:mysql://192.168.40.77:3306/springboot?\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;characterEncoding=utf-8</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.datasource.username</span><span style=color:#f92672>=</span><span style=color:#e6db74>lsx</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.datasource.password</span><span style=color:#f92672>=</span><span style=color:#e6db74>lsx</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.datasource.type</span><span style=color:#f92672>=</span><span style=color:#e6db74>com.zaxxer.hikari.HikariDataSource</span>
</span></span><span style=display:flex><span><span style=color:#75715e>############################# MyBatis ##############################</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#实体类别名包扫描，下划线自动转驼峰，开启二级缓存，控制台打印SQL，Mapper配置文件位置#</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#这里不要开启MyBatis的延迟加载，否则会和后面的SpringCache冲突#</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>mybatis.type-aliases-package</span><span style=color:#f92672>=</span><span style=color:#e6db74>com.lsx.entity</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>mybatis.configuration.map-underscore-to-camel-case</span><span style=color:#f92672>=</span><span style=color:#e6db74>true</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>mybatis.configuration.cache-enabled</span><span style=color:#f92672>=</span><span style=color:#e6db74>true</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>mybatis.configuration.log-impl</span><span style=color:#f92672>=</span><span style=color:#e6db74>org.apache.ibatis.logging.stdout.StdOutImpl</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>mybatis.mapper-locations</span><span style=color:#f92672>=</span><span style=color:#e6db74>classpath:mapper/*Mapper.xml</span>
</span></span></code></pre></div><ol start=5><li>开发MyBatis配置类 <code>MyBatisConfig</code>:<ul><li>标记 <code>@Configuration</code>: 声明为配置类。</li><li>标记 <code>@MapperScan</code>: 扫描Mapper接口包，包范围必须最小。</li></ul></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.config;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@MapperScan</span>(<span style=color:#e6db74>&#34;com.lsx.mapper&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyBatisConfig</span> { }
</span></span></code></pre></div><ol start=6><li>开发Mapper接口 <code>DeptMapper</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.mapper;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Repository</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>DeptMapper</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * 查询全部 [部门]  
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @return 查询失败时返回空List对象  
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Select</span>(<span style=color:#e6db74>&#34;select d.id, d.name from springboot.dept d&#34;</span>)  
</span></span><span style=display:flex><span>	List<span style=color:#f92672>&lt;</span>Dept<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>list</span>();  
</span></span><span style=display:flex><span>	  
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * 按 [部门主键数组] 查询 [部门]  
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @param ids 部门主键数组  
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @return 查询失败时返回空List对象  
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>  
</span></span><span style=display:flex><span>	List<span style=color:#f92672>&lt;</span>Dept<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>selectByIds</span>(Long<span style=color:#f92672>[]</span> ids);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=7><li>开发Mapper配置 <code>classpath:mapper/DeptMapper.xml</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>  
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE mapper  
</span></span></span><span style=display:flex><span><span style=color:#75715e>        PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34;  
</span></span></span><span style=display:flex><span><span style=color:#75715e>        &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;mapper</span> <span style=color:#a6e22e>namespace=</span><span style=color:#e6db74>&#34;com.lsx.mapper.DeptMapper&#34;</span><span style=color:#f92672>&gt;</span>  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>&lt;!--按 [部门主键数组] 查询 [部门]--&gt;</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;select</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;selectByIds&#34;</span> <span style=color:#a6e22e>resultType=</span><span style=color:#e6db74>&#34;Dept&#34;</span><span style=color:#f92672>&gt;</span>  
</span></span><span style=display:flex><span>        select d.id, d.name from springboot.dept d where d.id in  
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;foreach</span> <span style=color:#a6e22e>collection=</span><span style=color:#e6db74>&#34;array&#34;</span> <span style=color:#a6e22e>item=</span><span style=color:#e6db74>&#34;id&#34;</span> <span style=color:#a6e22e>open=</span><span style=color:#e6db74>&#34;(&#34;</span> <span style=color:#a6e22e>close=</span><span style=color:#e6db74>&#34;)&#34;</span> <span style=color:#a6e22e>separator=</span><span style=color:#e6db74>&#34;,&#34;</span><span style=color:#f92672>&gt;</span>  
</span></span><span style=display:flex><span>            #{id}  
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/foreach&gt;</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/select&gt;</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/mapper&gt;</span>
</span></span></code></pre></div><ol start=8><li>测试Mapper接口 <code>EmpMapperTest</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.mapper;  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RunWith</span>(SpringRunner.<span style=color:#a6e22e>class</span>)  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>(classes <span style=color:#f92672>=</span> SpringBootApp.<span style=color:#a6e22e>class</span>)  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DeptMapperTest</span> {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> DeptMapper deptMapper;  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>list</span>() {  
</span></span><span style=display:flex><span>        deptMapper.<span style=color:#a6e22e>list</span>().<span style=color:#a6e22e>forEach</span>(System.<span style=color:#a6e22e>out</span>::println);  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>selectByIds</span>() {  
</span></span><span style=display:flex><span>        deptMapper.<span style=color:#a6e22e>selectByIds</span>(<span style=color:#66d9ef>new</span> Long<span style=color:#f92672>[]</span>{1L, 2L, 3L}).<span style=color:#a6e22e>forEach</span>(System.<span style=color:#a6e22e>out</span>::println);  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e03-整合springcache>E03. 整合SpringCache</h2><blockquote><p>心法: SpringCache</p></blockquote><ul><li>SpringCache用于提供缓存 ==方法返回值== 的功能， 默认使用本地缓存，若配置了Redis，则会自动切换为使用Redis缓存。</li><li>SpringCache功能需要使用 <code>@EnableCaching</code> 注解来开启。</li></ul><pre tabindex=0><code class=language-mermaid data-lang=mermaid>sequenceDiagram
    autonumber
	title: SpringCache缓存查询流程
    participant controller as 控制层
	participant service as 业务层
	participant cache as 缓存
	participant db as 数据库

controller -&gt;&gt; service: 查询1号数据
service -&gt;&gt; cache: 检查缓存中是否存在1号数据

opt 存在1号数据
	cache --&gt;&gt; service: 返回1号数据
end

opt 不存在1号数据
	service -&gt;&gt; db: 查询1号数据
	db --&gt;&gt; cache: 备份1号数据
	cache --&gt;&gt; service: 返回1号数据
end

service -&gt;&gt; controller: 返回1号数据
</code></pre><blockquote><p>心法: SpringCache常用注解</p></blockquote><table><thead><tr><th>注解</th><th>描述</th></tr></thead><tbody><tr><td><code>@CachePut</code></td><td>业务方法执行后，在指定 <code>缓存名称</code> 下添加一条对应 <code>key</code> 的缓存，缓存的值就是方法的返回值</td></tr><tr><td><code>@Cacheable</code></td><td>业务方法执行前，在指定 <code>缓存名称</code> 下搜索对应 <code>key</code> 的缓存若命中成功，则直接返回缓存结果，不会执行业务方法若命中失败，则执行业务方法，然后在指定 <code>缓存名称</code> 下添加一条对应 <code>key</code> 的缓存，缓存的值就是方法的返回值</td></tr><tr><td><code>@CacheEvict</code></td><td>方法执行后，在指定 <code>缓存名称</code> 下删除一条对应 <code>key</code> 的缓存</td></tr></tbody></table><table><thead><tr><th>属性</th><th>描述</th><th>其他</th></tr></thead><tbody><tr><td><code>value</code></td><td>缓存名称</td><td>可以直接在类上使用 <code>@CacheConfig(cacheNames = "a")</code> 来统一配置本类中所有方法的缓存名称</td></tr><tr><td><code>key</code></td><td>缓存Key名</td><td>支持在表达式中使用 <code>#</code> 来引用参数，如 <code>key = "#id"</code>支持在表达式中使用 <code>#result</code> 来引用返回值，如 <code>key = "'orders'"</code>支持在表达式中使用 <code>'</code> 来定义纯字符串， 如 <code>key = "'#result.id'"</code></td></tr><tr><td><code>condition</code></td><td>缓存条件，条件成立时执行缓存逻辑一般用于参数条件判断</td><td>支持在表达式中使用 <code>#</code> 来引用参数，如 <code>condition = "#id != null"</code>不支持 <code>#result</code> 写法</td></tr><tr><td><code>unless</code></td><td>缓存条件，条件成立时阻止缓存逻辑一般用于返回值条件判断</td><td>支持在表达式中使用 <code>#</code> 来引用参数，如 <code>unless = "#result == null"</code></td></tr></tbody></table><blockquote><p>武技: 在子项目中整合SpringCache缓存组件</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

n1[添加SpringCache相关依赖]
--&gt; n2[开启缓存功能]
--&gt; n3[开发ORM实体类]
--&gt; n4[开发业务方法]
--&gt; n4a[添加后加入缓存] &amp; n4b[查询时查询缓存] &amp; n4c[修改和删除时逐出缓存]
--&gt; n5[测试业务方法]
</code></pre><ol><li>在子项目中添加依赖:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-boot-starter-cache--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-cache<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start=2><li>开发缓存配置类 <code>SpringCacheConfig</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.config;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@EnableCaching</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SpringCacheConfig</span> { }
</span></span></code></pre></div><ol start=3><li>开发数据接口方法 <code>EmpMapper -> *()</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.mapper;  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Repository</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>EmpMapper</span> {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * 添加一名 [员工]  
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * 
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @param emp 添加字段  
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @return 影响条目数  
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Options</span>(useGeneratedKeys <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>, keyProperty <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;id&#34;</span>)  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Insert</span>(<span style=color:#e6db74>&#34;insert into springboot.emp &#34;</span> <span style=color:#f92672>+</span>  
</span></span><span style=display:flex><span>	        <span style=color:#e6db74>&#34;(id, name, age, fk_dept_id, created, updated) &#34;</span> <span style=color:#f92672>+</span>  
</span></span><span style=display:flex><span>	        <span style=color:#e6db74>&#34;values &#34;</span> <span style=color:#f92672>+</span>  
</span></span><span style=display:flex><span>	        <span style=color:#e6db74>&#34;(#{id}, #{name}, #{age}, #{fkDeptId}, #{created}, #{updated})&#34;</span>)  
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>insert</span>(Emp emp);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 按 [员工主键] 查询 [员工]  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @param id 员工主键  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return 查询失败时返回空List对象  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Select</span>(<span style=color:#e6db74>&#34;select e.id, e.name, e.age, e.fk_dept_id, e.created, e.updated &#34;</span> <span style=color:#f92672>+</span>  
</span></span><span style=display:flex><span>	        <span style=color:#e6db74>&#34;from springboot.emp e &#34;</span> <span style=color:#f92672>+</span>  
</span></span><span style=display:flex><span>	        <span style=color:#e6db74>&#34;where e.id = #{param1}&#34;</span>)  
</span></span><span style=display:flex><span>	Emp <span style=color:#a6e22e>selectById</span>(Long id);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 按 [员工主键] 修改 [员工]  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param emp 修改字段  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param id  员工主键  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Update</span>(<span style=color:#e6db74>&#34;update springboot.emp set &#34;</span> <span style=color:#f92672>+</span>  
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;name = #{param1.name}, age = #{param1.age}, fk_dept_id = #{param1.fkDeptId}, &#34;</span> <span style=color:#f92672>+</span>  
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;created = #{param1.created}, updated = #{param1.updated} &#34;</span> <span style=color:#f92672>+</span>  
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;where id = #{param2}&#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>updateById</span>(Emp emp, Long id);  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 按 [员工主键] 删除 [员工]  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param id 员工主键  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Delete</span>(<span style=color:#e6db74>&#34;delete from springboot.emp where id = #{param1} &#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>deleteById</span>(Long id);  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=4><li>开发业务接口 <code>EmpService</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.service;  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>EmpService</span> {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 添加一名 [员工]  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param emp 添加字段  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return 刚添加的记录  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>  
</span></span><span style=display:flex><span>    Emp <span style=color:#a6e22e>insert</span>(Emp emp);  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 按 [员工主键] 查询 [员工]  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param id 员工主键  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return 查询失败时返回空List对象  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>  
</span></span><span style=display:flex><span>    Emp <span style=color:#a6e22e>selectById</span>(Long id);  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 按 [员工主键] 修改 [员工]  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param emp 修改字段  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param id  员工主键  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>updateById</span>(Emp emp, Long id);  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 按 [员工主键] 删除 [员工]  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param id 员工主键  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>deleteById</span>(Long id);  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=5><li>实现业务接口 <code>EmpServiceImpl</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.service.impl;  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@CacheConfig</span>(cacheNames <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;emp&#34;</span>)  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Service</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>EmpServiceImpl</span> <span style=color:#66d9ef>implements</span> EmpService {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> EmpMapper empMapper;  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@CachePut</span>(key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#result.id&#34;</span>, unless <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#result.id == null&#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Emp <span style=color:#a6e22e>insert</span>(Emp emp) {  
</span></span><span style=display:flex><span>        empMapper.<span style=color:#a6e22e>insert</span>(emp);  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> emp;  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Cacheable</span>(key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#id&#34;</span>, condition <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#id != null&#34;</span>, unless <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#result == null&#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Emp <span style=color:#a6e22e>selectById</span>(Long id) {  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> empMapper.<span style=color:#a6e22e>selectById</span>(id);  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@CacheEvict</span>(key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#id&#34;</span>, condition <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#id != null&#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>updateById</span>(Emp emp, Long id) {  
</span></span><span style=display:flex><span>        empMapper.<span style=color:#a6e22e>updateById</span>(emp, id);  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@CacheEvict</span>(key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#id&#34;</span>, condition <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#id != null&#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>deleteById</span>(Long id) {  
</span></span><span style=display:flex><span>        empMapper.<span style=color:#a6e22e>deleteById</span>(id);  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=6><li>测试业务接口 <code>EmpServiceTest</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.service;  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RunWith</span>(SpringRunner.<span style=color:#a6e22e>class</span>)  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>(classes <span style=color:#f92672>=</span> SpringBootApp.<span style=color:#a6e22e>class</span>)  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>EmpServiceTest</span> {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> EmpService empService;  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>crud</span>() {  
</span></span><span style=display:flex><span>        Emp emp <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Emp();  
</span></span><span style=display:flex><span>        emp.<span style=color:#a6e22e>setName</span>(<span style=color:#e6db74>&#34;钟无艳&#34;</span>);  
</span></span><span style=display:flex><span>        emp.<span style=color:#a6e22e>setAge</span>(18L);  
</span></span><span style=display:flex><span>        emp.<span style=color:#a6e22e>setFkDeptId</span>(1L);  
</span></span><span style=display:flex><span>        emp.<span style=color:#a6e22e>setCreated</span>(<span style=color:#66d9ef>new</span> Date());  
</span></span><span style=display:flex><span>        emp.<span style=color:#a6e22e>setUpdated</span>(<span style=color:#66d9ef>new</span> Date());  
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;添加成功: &#34;</span> <span style=color:#f92672>+</span> empService.<span style=color:#a6e22e>insert</span>(emp));  
</span></span><span style=display:flex><span>        emp.<span style=color:#a6e22e>setName</span>(<span style=color:#e6db74>&#34;马可波罗&#34;</span>);  
</span></span><span style=display:flex><span>        Long id <span style=color:#f92672>=</span> emp.<span style=color:#a6e22e>getId</span>();  
</span></span><span style=display:flex><span>        empService.<span style=color:#a6e22e>updateById</span>(emp, id);  
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;修改成功: &#34;</span> <span style=color:#f92672>+</span> empService.<span style=color:#a6e22e>selectById</span>(id));  
</span></span><span style=display:flex><span>        empService.<span style=color:#a6e22e>deleteById</span>(id);  
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;删除成功: &#34;</span> <span style=color:#f92672>+</span> empService.<span style=color:#a6e22e>selectById</span>(id));  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>crudWithCache</span>() {  
</span></span><span style=display:flex><span>        Long id <span style=color:#f92672>=</span> 1L;  
</span></span><span style=display:flex><span>        Emp emp <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Emp();  
</span></span><span style=display:flex><span>        emp.<span style=color:#a6e22e>setName</span>(<span style=color:#e6db74>&#34;后裔&#34;</span>);  
</span></span><span style=display:flex><span>        emp.<span style=color:#a6e22e>setAge</span>(18L);  
</span></span><span style=display:flex><span>        emp.<span style=color:#a6e22e>setFkDeptId</span>(1L);  
</span></span><span style=display:flex><span>        emp.<span style=color:#a6e22e>setCreated</span>(<span style=color:#66d9ef>new</span> Date());  
</span></span><span style=display:flex><span>        emp.<span style=color:#a6e22e>setUpdated</span>(<span style=color:#66d9ef>new</span> Date());  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 发送SQL  </span>
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(empService.<span style=color:#a6e22e>selectById</span>(id));  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 不发送SQL  </span>
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(empService.<span style=color:#a6e22e>selectById</span>(id));  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 发送SQL - 删除1号缓存  </span>
</span></span><span style=display:flex><span>        empService.<span style=color:#a6e22e>updateById</span>(emp, id);  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 发送SQL  </span>
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(empService.<span style=color:#a6e22e>selectById</span>(id));  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 发送SQL - 删除1号缓存  </span>
</span></span><span style=display:flex><span>        empService.<span style=color:#a6e22e>deleteById</span>(id);  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 发送SQL - 添加x号缓存  </span>
</span></span><span style=display:flex><span>        empService.<span style=color:#a6e22e>insert</span>(emp);  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 不发送SQL  </span>
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(empService.<span style=color:#a6e22e>selectById</span>(emp.<span style=color:#a6e22e>getId</span>()));  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e04-整合pagehelper>E04. 整合PageHelper</h2><blockquote><p>心法: PageHelper使用流程</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

    n1[添加&lt;br/&gt;PageHelper相关依赖]
--&gt; n2[配置&lt;br/&gt;PageHelper主配项]
--&gt; n3[在调用全查方法前&lt;br/&gt;开启分页]
--&gt; n4[调用&lt;br/&gt;全查方法]
--&gt; n5[封装&lt;br/&gt;全查结果]
</code></pre><blockquote><p>武技: 在子项目中整合PageHelper分页插件</p></blockquote><ol><li>在父项目中锁定版本:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;pagehelper-spring-boot-starter-version&gt;</span>1.3.0<span style=color:#f92672>&lt;/pagehelper-spring-boot-starter-version&gt;</span>
</span></span></code></pre></div><ol start=2><li>在父项目中管理依赖:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--pagehelper-spring-boot-starter--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>com.github.pagehelper<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>pagehelper-spring-boot-starter<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>${pagehelper-spring-boot-starter-version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start=3><li>在子项目中添加依赖:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--pagehelper-spring-boot-starter--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>com.github.pagehelper<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>pagehelper-spring-boot-starter<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start=4><li>开发主配项 <code>classpath:application.properties</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#75715e>############################# PageHelper ##############################</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#数据库方言，当page小于0或大于总页数时查询首页或尾页，当size设置为0时执行全查#</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>pagehelper.helper-dialect</span><span style=color:#f92672>=</span><span style=color:#e6db74>mysql</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>pagehelper.reasonable</span><span style=color:#f92672>=</span><span style=color:#e6db74>true</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>pagehelper.page-size-zero</span><span style=color:#f92672>=</span><span style=color:#e6db74>true</span>
</span></span></code></pre></div><ol start=5><li>测试分页功能 <code>PageHelperTest</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.pagehelper;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RunWith</span>(SpringRunner.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>(classes <span style=color:#f92672>=</span> SpringBootApp.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PageHelperTest</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> DeptMapper deptMapper;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>page</span>(){
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 开启分页功能</span>
</span></span><span style=display:flex><span>        PageHelper.<span style=color:#a6e22e>startPage</span>(2, 3);
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>Dept<span style=color:#f92672>&gt;</span> depts <span style=color:#f92672>=</span> deptMapper.<span style=color:#a6e22e>list</span>();
</span></span><span style=display:flex><span>        PageInfo<span style=color:#f92672>&lt;</span>Dept<span style=color:#f92672>&gt;</span> pageInfo <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> PageInfo<span style=color:#f92672>&lt;&gt;</span>(depts);
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;当前第几页: &#34;</span> <span style=color:#f92672>+</span> pageInfo.<span style=color:#a6e22e>getPageNum</span>());
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;每页多少条: &#34;</span> <span style=color:#f92672>+</span> pageInfo.<span style=color:#a6e22e>getPageSize</span>());
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;一共多少条: &#34;</span> <span style=color:#f92672>+</span> pageInfo.<span style=color:#a6e22e>getTotal</span>());
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;一共多少页: &#34;</span> <span style=color:#f92672>+</span> pageInfo.<span style=color:#a6e22e>getPages</span>());
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;分页导航条: &#34;</span> <span style=color:#f92672>+</span> Arrays.<span style=color:#a6e22e>toString</span>(pageInfo.<span style=color:#a6e22e>getNavigatepageNums</span>()));
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;分页数据集: &#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (Dept dept : pageInfo.<span style=color:#a6e22e>getList</span>()) {
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;\t&#34;</span> <span style=color:#f92672>+</span> dept);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e05-整合springdoc>E05. 整合SpringDoc</h2><blockquote><p>心法: 文档框架常用产品</p></blockquote><ul><li>Swagger是一款基于OpenApi3的自动生成以及在线测试REST接口的技术，是文档框架的底层技术。</li><li>SpringDoc是一款优秀的Swagger库，用于将Swagger集成到Spring中，推荐Knife4j一起使用。</li><li>生产环境下建议禁用文档框架以节省资源。</li></ul><table><thead><tr><th>SpringDoc 常用注解</th><th>描述</th></tr></thead><tbody><tr><td><code>@Tag(name = "类名", description = "描述")</code></td><td>标记控制类</td></tr><tr><td><code>@Operation(summary = "简单描述", description = "详细描述")</code></td><td>标记控制方法</td></tr><tr><td><code>@Parameter(description = "描述")</code></td><td>标记 <code>@RequestParam / @PathVariable</code> 参数</td></tr><tr><td><code>@Schema(name = "类名", description = "描述")</code></td><td>标记 <code>@RequestBody</code> 参数类</td></tr><tr><td><code>@Schema(description = "描述", required = true, example = "示例值")</code></td><td>标记 <code>@RequestBody</code> 参数类属性</td></tr></tbody></table><blockquote><p>武技: 在子项目中整合 SpringDoc + Knife4j 文档框架</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

    n1[添加&lt;br/&gt;SpringDoc相关依赖]
--&gt; n2[配置&lt;br/&gt;SpringDoc主配项]
--&gt; n3[开发&lt;br/&gt;SpringDoc配置类]
--&gt; n4[开发&lt;br/&gt;控制方法]
--&gt; n5[启动项目]
--&gt; n6[访问&lt;br/&gt;SpringDoc页面]
</code></pre><ol><li>在父项目中锁定版本:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;springdoc-version&gt;</span>1.3.1<span style=color:#f92672>&lt;/springdoc-version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;knife4j-version&gt;</span>3.0.3<span style=color:#f92672>&lt;/knife4j-version&gt;</span>
</span></span></code></pre></div><ol start=2><li>在父项目中管理依赖:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--springdoc-openapi-ui--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.springdoc<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>springdoc-openapi-ui<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>${springdoc-version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--knife4j-springdoc-ui--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>com.github.xiaoymin<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>knife4j-springdoc-ui<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>${knife4j-version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start=3><li>在子项目中引入依赖:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--springdoc-openapi-ui--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.springdoc<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>springdoc-openapi-ui<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--knife4j-springdoc-ui--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>com.github.xiaoymin<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>knife4j-springdoc-ui<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start=4><li>开发主配项 <code>classpath:application.properties</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#75715e>############################# SpringDoc ##############################  </span>
</span></span><span style=display:flex><span><span style=color:#75715e>#启用SpringDoc，包扫描，分组名，分组规则，包扫描#  </span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>springdoc.api-docs.enabled</span><span style=color:#f92672>=</span><span style=color:#e6db74>true</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>springdoc.packages-to-scan</span><span style=color:#f92672>=</span><span style=color:#e6db74>com.lsx.controller</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>springdoc.group-configs[0].group</span><span style=color:#f92672>=</span><span style=color:#e6db74>test</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>springdoc.group-configs[0].paths-to-match</span><span style=color:#f92672>=</span><span style=color:#e6db74>/test/**</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>springdoc.group-configs[1].group</span><span style=color:#f92672>=</span><span style=color:#e6db74>v0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>springdoc.group-configs[1].paths-to-match</span><span style=color:#f92672>=</span><span style=color:#e6db74>/api/v0/**</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>springdoc.group-configs[2].group</span><span style=color:#f92672>=</span><span style=color:#e6db74>v1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>springdoc.group-configs[2].paths-to-match</span><span style=color:#f92672>=</span><span style=color:#e6db74>/api/v1/**</span>
</span></span></code></pre></div><ol start=5><li>开发常量属性文件 <code>classpath:constant.properties</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#75715e>############################# SpringDoc ##############################  </span>
</span></span><span style=display:flex><span><span style=color:#75715e>#作者，host，标题，简介，版本#  </span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>springdoc.info.name</span><span style=color:#f92672>=</span><span style=color:#e6db74>lsx  </span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>springdoc.info.url</span><span style=color:#f92672>=</span><span style=color:#e6db74>http//localhost:8070  </span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>springdoc.info.title</span><span style=color:#f92672>=</span><span style=color:#e6db74>SpringBoot练习项目  </span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>springdoc.info.description</span><span style=color:#f92672>=</span><span style=color:#e6db74>一个SpringBoot练习项目  </span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>springdoc.info.version</span><span style=color:#f92672>=</span><span style=color:#e6db74>v1.0.1</span>
</span></span></code></pre></div><ol start=6><li>开发SpringDoc配置类 <code>SpringDocConfig</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.config;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> io.swagger.v3.oas.models.OpenAPI;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> io.swagger.v3.oas.models.info.Contact;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> io.swagger.v3.oas.models.info.Info;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@PropertySource</span>(<span style=color:#e6db74>&#34;classpath:constant.properties&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SpringDocConfig</span> {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Value</span>(<span style=color:#e6db74>&#34;${springdoc.info.name}&#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String name;  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Value</span>(<span style=color:#e6db74>&#34;${springdoc.info.url}&#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String url;  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Value</span>(<span style=color:#e6db74>&#34;${springdoc.info.title}&#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String title;  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Value</span>(<span style=color:#e6db74>&#34;${springdoc.info.description}&#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String description;  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Value</span>(<span style=color:#e6db74>&#34;${springdoc.info.version}&#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String version;  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/** 通用信息Bean */</span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> OpenAPI <span style=color:#a6e22e>commonInfo</span>() {  
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>		<span style=color:#75715e>// 联系对象  </span>
</span></span><span style=display:flex><span>		Contact contact <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Contact()  
</span></span><span style=display:flex><span>		        .<span style=color:#a6e22e>name</span>(name)
</span></span><span style=display:flex><span>		        .<span style=color:#a6e22e>url</span>(url);  
</span></span><span style=display:flex><span>		        
</span></span><span style=display:flex><span>		<span style=color:#75715e>// 展板信息  </span>
</span></span><span style=display:flex><span>		Info info <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Info()
</span></span><span style=display:flex><span>				.<span style=color:#a6e22e>title</span>(title)
</span></span><span style=display:flex><span>		        .<span style=color:#a6e22e>description</span>(description)
</span></span><span style=display:flex><span>		        .<span style=color:#a6e22e>version</span>(version)
</span></span><span style=display:flex><span>		        .<span style=color:#a6e22e>contact</span>(contact);  
</span></span><span style=display:flex><span>		        
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> OpenAPI().<span style=color:#a6e22e>info</span>(info);
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=7><li>开发DTO实体类 <code>PigDTO</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.dto;  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Schema</span>(name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;猪的DTO实体&#34;</span>, description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;猪的DTO实体，包含猪表的全部可操作属性&#34;</span>)  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Data</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PigDTO</span> <span style=color:#66d9ef>implements</span> Serializable {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Schema</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;猪的名字&#34;</span>, required <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>, example <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;佩奇&#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String pigName;  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=8><li>开发控制器方法 <code>SpringDocController -> *()</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.controller;  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Tag</span>(name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;PigController&#34;</span>, description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;猪的控制器&#34;</span>)  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SpringDocController</span> {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;分页查询猪&#34;</span>, description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;用于分页查询猪的控制方法&#34;</span>)  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/test/springDoc/page&#34;</span>)  
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>page</span>(<span style=color:#a6e22e>@RequestParam</span> <span style=color:#a6e22e>@Parameter</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;显示第几页&#34;</span>) Integer pageNum,  
</span></span><span style=display:flex><span>	                   <span style=color:#a6e22e>@RequestParam</span> <span style=color:#a6e22e>@Parameter</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;每页多少条&#34;</span>) Integer pageSize) {  
</span></span><span style=display:flex><span>	    <span style=color:#66d9ef>return</span> Map.<span style=color:#a6e22e>of</span>(<span style=color:#e6db74>&#34;参数pageNum&#34;</span>, pageNum, <span style=color:#e6db74>&#34;参数pageSize&#34;</span>, pageSize);  
</span></span><span style=display:flex><span>	}  
</span></span><span style=display:flex><span>	  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;查询一只猪&#34;</span>, description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;用于查询一只猪的控制方法&#34;</span>)  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/test/springDoc/selectById/{id}&#34;</span>)  
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>selectById</span>(<span style=color:#a6e22e>@PathVariable</span> <span style=color:#a6e22e>@Parameter</span>(description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;猪的主键&#34;</span>) Long id) {  
</span></span><span style=display:flex><span>	    <span style=color:#66d9ef>return</span> Map.<span style=color:#a6e22e>of</span>(<span style=color:#e6db74>&#34;参数id&#34;</span>, id);  
</span></span><span style=display:flex><span>	}  
</span></span><span style=display:flex><span>	  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Operation</span>(summary <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;添加一只猪&#34;</span>, description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;用于添加一只猪的控制方法&#34;</span>)  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;/test/springDoc/insert&#34;</span>)  
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>insert</span>(<span style=color:#a6e22e>@RequestBody</span> PigDTO pigDTO) {  
</span></span><span style=display:flex><span>	    <span style=color:#66d9ef>return</span> Map.<span style=color:#a6e22e>of</span>(<span style=color:#e6db74>&#34;参数pigName&#34;</span>, pigDTO.<span style=color:#a6e22e>getPigName</span>());  
</span></span><span style=display:flex><span>	} 
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=9><li>访问 <a href=http://localhost:8070/swagger-ui.html>SwaggerUI文档页面</a></li><li>访问 <a href=http://localhost:8070/doc.html>SpringDoc文档页面</a></li></ol><h2 id=e06-整合hibernatevalidator>E06. 整合HibernateValidator</h2><blockquote><p>心法: HibernateValidator参数校验器</p></blockquote><ul><li>HibernateValidator校验器对JSR303校验器进行了拓展，用于对实体类型的请求参数进行校验。</li><li>HibernateValidator校验器解耦使得验证逻辑和业务逻辑之间进行了分离，且统一了校验方式，无需重复编写校验代码。</li></ul><table><thead><tr><th>HibernateValidator常用校验注解</th><th>描述</th></tr></thead><tbody><tr><td><code>@Null / @NotNull</code></td><td>该引用型属性必须为 <code>null</code> / 该引用型属性必须不为 <code>null</code></td></tr><tr><td><code>@NotEmpty</code></td><td>该字符串属性不能为 <code>null</code> 且长度不能为 <code>0</code></td></tr><tr><td><code>@AssertTrue / @AssertFalse</code></td><td>该布尔型属性必须为 <code>true</code> /该布尔型属性必须为 <code>false</code></td></tr><tr><td><code>@Min(16) / @Max(60)</code></td><td>该整数型属性必须大于等于 <code>16</code> / 该整数型属性必须小于等于 <code>60</code></td></tr><tr><td><code>@DecimalMin(40) / @DecimalMax(99)</code></td><td>该浮点型属性必须大于等于 <code>40</code> / 该浮点型属性必须小于等于 <code>99</code></td></tr><tr><td><code>@Past / @Future</code></td><td>该日期属性必须是一个过去的日期 / 该日期属性必须是一个未来的日期</td></tr><tr><td><code>@Digits(integer=4, fraction=2)</code></td><td>该浮点型属性的整数部分最多 <code>4</code> 位，小数部分最多 <code>2</code> 位</td></tr><tr><td><code>@Pattern(regexp="\\d")</code></td><td>该字符串属性必须符合指定的正则表达式</td></tr><tr><td><code>@Size(min=2, max=9)</code></td><td>该字符串/集合/Map/数组类型的属性的长度必须在 <code>2</code> 到 <code>9</code> 之间，包括两端值</td></tr><tr><td><code>@Email</code></td><td>该字符串属性必须是一个合法的电子邮箱地址，拓展注解</td></tr><tr><td><code>@Length(min=2, max=9)</code></td><td>该字符串属性的长度必须在 <code>2</code> 到 <code>9</code> 之间，拓展注解</td></tr><tr><td><code>@Range(min=16, max=60)</code></td><td>该整数/浮点数/数值字符串类型的属性值必须在指定的范围内，拓展注解</td></tr></tbody></table><blockquote><p>武技: 在子项目中整合HibernateValidator参数校验器</p></blockquote><ol><li>在父项目中锁定版本:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span> <span style=color:#f92672>&lt;hibernate-validator-version&gt;</span>6.2.0.Final<span style=color:#f92672>&lt;/hibernate-validator-version&gt;</span>
</span></span></code></pre></div><ol start=2><li>在父项目中管理依赖:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--hibernate-validator--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.hibernate.validator<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>hibernate-validator<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>${hibernate-validator-version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start=3><li>在子项目中添加依赖:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--hibernate-validator--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.hibernate.validator<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>hibernate-validator<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start=4><li>开发全局异常处理方法 <code>ExceptionAdvice -> methodArgumentNotValidException()</code>:<ul><li>方法位置要写在 <code>exception()</code> 之上。</li></ul></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.component;  
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.validation.BindingResult;  
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.validation.FieldError;  
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.web.bind.MethodArgumentNotValidException;  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RestControllerAdvice</span>(basePackages <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;com.lsx.controller&#34;</span>})  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ExceptionAdvice</span> {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@ExceptionHandler</span>(MethodArgumentNotValidException.<span style=color:#a6e22e>class</span>)  
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>methodArgumentNotValidException</span>(MethodArgumentNotValidException e) {  
</span></span><span style=display:flex><span>	  
</span></span><span style=display:flex><span>	    <span style=color:#75715e>// 获取bindingResult中所有属性错误信息集合中的第一个属性错误  </span>
</span></span><span style=display:flex><span>	    FieldError firstFieldError <span style=color:#f92672>=</span> e.<span style=color:#a6e22e>getBindingResult</span>().<span style=color:#a6e22e>getFieldErrors</span>().<span style=color:#a6e22e>get</span>(0);  
</span></span><span style=display:flex><span>	  
</span></span><span style=display:flex><span>	    <span style=color:#75715e>// 异常信息 : &#34;xxx实例的xxx属性校验失败: xxx异常信息&#34;  </span>
</span></span><span style=display:flex><span>	    String message <span style=color:#f92672>=</span> String.<span style=color:#a6e22e>format</span>(<span style=color:#e6db74>&#34;%s实例的%s属性校验失败: %s&#34;</span>,  
</span></span><span style=display:flex><span>	            firstFieldError.<span style=color:#a6e22e>getObjectName</span>(),  
</span></span><span style=display:flex><span>	            firstFieldError.<span style=color:#a6e22e>getField</span>(),  
</span></span><span style=display:flex><span>	            firstFieldError.<span style=color:#a6e22e>getDefaultMessage</span>());  
</span></span><span style=display:flex><span>	  
</span></span><span style=display:flex><span>	    <span style=color:#75715e>// 记录日志  </span>
</span></span><span style=display:flex><span>	    log.<span style=color:#a6e22e>error</span>(message);  
</span></span><span style=display:flex><span>	    
</span></span><span style=display:flex><span>	    <span style=color:#75715e>// 响应  </span>
</span></span><span style=display:flex><span>	    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Result(ResultCode.<span style=color:#a6e22e>VALIDATE_FAILED</span>, message);  
</span></span><span style=display:flex><span>	}  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@ExceptionHandler</span>(Exception.<span style=color:#a6e22e>class</span>)  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>exception</span>(Exception e) {  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 略 </span>
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=5><li>开发DTO实体类 <code>UserDTO</code>:<ul><li>JSR303校验注解均来自 <code>javax.validation.constraints</code> 包。</li><li>HibernateValidator的几个拓展注解均来自 <code>org.hibernate.validator.constraints</code> 包。</li></ul></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.dto;  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Data</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserDTO</span> <span style=color:#66d9ef>implements</span> Serializable {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Size</span>(min <span style=color:#f92672>=</span> 2, max <span style=color:#f92672>=</span> 5, message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;昵称长度须在4-10之间&#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String username;  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotEmpty</span>(message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;密码不能为空&#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String password;  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotNull</span>(message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;年龄不能为空&#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Range</span>(min <span style=color:#f92672>=</span> 16, max <span style=color:#f92672>=</span> 60, message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;年龄范围须在16-60之间&#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Long age;  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NotNull</span>(message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;生日不能为空&#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Past</span>(message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;生日须是一个过去的时间&#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Date birthday;  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Pattern</span>(regexp<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;1(3[0-9]|4[01456879]|5[0-35-9]|6[2567]|7[0-8]|8[0-9]|9[0-35-9])\\d{8}&#34;</span>,  
</span></span><span style=display:flex><span>            message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;手机号格式有误&#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String phone;  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=6><li>开发控制器类 <code>HibernateValidatorController</code>:<ul><li>实体类形参必须标记 <code>@Validated</code> 才表示开启HibernateValidator校验功能，支持实体类连用。</li></ul></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.controller;  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HibernateValidatorController</span> {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;/test/hibernateValidator&#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>hibernateValidator</span>(<span style=color:#a6e22e>@RequestBody</span> <span style=color:#a6e22e>@Validated</span> UserDTO dto) {  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Map.<span style=color:#a6e22e>of</span>(<span style=color:#e6db74>&#34;参数&#34;</span>, dto);  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e07-整合minio>E07. 整合MinIO</h2><blockquote><p>心法: <a href=http://minio.org.cn/>MinIO</a></p></blockquote><ul><li>MinIO是一个基于ApacheLicense2.0开源协议的对象存储服务，虽然轻量，却拥有着不错的性能。</li><li>MinIO兼容亚马逊S3云存储服务接口，非常适合于存储大容量非结构化的数据。</li></ul><blockquote><p>武技: 在Docker中搭建MinIO对象存储服务端</p></blockquote><ul><li><a href=/%E7%AC%AC3%E9%98%B6%E6%AE%B5-SSM/JB3-4-SpringBoot/res/Docker%E5%AE%89%E8%A3%85MinIO/Docker%E5%AE%89%E8%A3%85MinIO/>Docker安装MinIO</a></li></ul><blockquote><p>武技: 在子项目中搭建MinIO使用环境</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>graph LR

    n1[添加&lt;br/&gt;MinIO相关依赖]
--&gt; n2[开发&lt;br/&gt;MinIO主配项]
--&gt; n3[封装&lt;br/&gt;MinIO工具类]
--&gt; n4[开发&lt;br/&gt;控制方法]
--&gt; n5[访问&lt;br/&gt;控制方法]
</code></pre><ol><li>同步Linux时间与本地时间，否则可能导致MinIO失败:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#75715e># 同步系统时间</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>ntpdate -u pool.ntp.org<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><ol start=2><li>在父项目中锁定版本:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;minio-version&gt;</span>3.0.10<span style=color:#f92672>&lt;/minio-version&gt;</span>
</span></span></code></pre></div><ol start=3><li>在父项目中管理依赖:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--minio--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>io.minio<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>minio<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>${minio-version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start=4><li>在子项目中添加依赖:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--minio--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>io.minio<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>minio<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start=5><li>开发主配项 <code>classpath:application.properties</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#75715e>############################# MinIO ##############################  </span>
</span></span><span style=display:flex><span><span style=color:#75715e>#每次文件上传的最大限制，每个文件的大小限制#  </span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.servlet.multipart.max-file-size</span><span style=color:#f92672>=</span><span style=color:#e6db74>100MB  </span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.servlet.multipart.max-request-size</span><span style=color:#f92672>=</span><span style=color:#e6db74>10MB</span>
</span></span></code></pre></div><ol start=6><li><a href=/%E7%AC%AC3%E9%98%B6%E6%AE%B5-SSM/JB3-4-SpringBoot/res/%E5%B0%81%E8%A3%85MinIO%E5%B7%A5%E5%85%B7%E7%B1%BB/>封装MinIO工具类</a></li><li>开发控制器 <code>MinIOController</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.controller;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MinIOController</span> {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;/test/minio/upload&#34;</span>)  
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>upload</span>(<span style=color:#a6e22e>@RequestParam</span> MultipartFile file) {  
</span></span><span style=display:flex><span>	    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Result(MinioUtil.<span style=color:#a6e22e>upload</span>(file, <span style=color:#e6db74>&#34;测试目录&#34;</span>));  
</span></span><span style=display:flex><span>	} 
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;/test/minio/delete/{fileName}&#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>delete</span>(<span style=color:#a6e22e>@PathVariable</span> String fileName) {  
</span></span><span style=display:flex><span>        MinioUtil.<span style=color:#a6e22e>delete</span>(fileName, <span style=color:#e6db74>&#34;测试目录&#34;</span>);  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Result(ResultCode.<span style=color:#a6e22e>SUCCESS</span>);  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e08-整合jsonwebtoken>E08. 整合JsonWebToken</h2><blockquote><p>心法: <a href=https://jwt.io/>JSON Web Token</a></p></blockquote><ul><li>JWT是一种基于JSON的高效，简洁，安全的开放标准。</li></ul><h3 id=1-jwt底层结构>1. JWT底层结构</h3><ul><li>JWT使用 <code>header.payload.signature</code> 结构的Token字符串进行通信，常用于登录鉴权，单点登录等分布式场景。</li></ul><p><code>token = base64编码(header).base64编码(payload).HMAC256(base64Url(header) + "." + base64Url(payload), 密钥)</code></p><pre tabindex=0><code class=language-mermaid data-lang=mermaid>flowchart LR
n1[&#34;header&lt;br/&gt;头&#34;]
n2[&#34;payload&lt;br/&gt;负载&#34;]
n3[&#34;signature&lt;br/&gt;签名&#34;]

n1--&gt;n1a[&#34;Token类型typ&#34;]--&gt;n1a1[&#34;JWT&#34;]
n1--&gt;n1b[&#34;签名的算法alg&#34;]--&gt;n1c[&#34;如HMAC / SHA256 / RSA 等&#34;]
n2--&gt;n2a[&#34;JWT的声明信息&#34;]--&gt;n2a1[&#34;如iss签发者 / sub主题 / exp过期时间 / iat签发时间等&#34;]
n2--&gt;n2b[&#34;部分非敏感用户自定义信息&#34;]--&gt;n2b1[&#34;如用户头像，用户主键，用户昵称等&#34;]
n3--&gt;n3a[&#34;存放服务端密钥，用于防止Token被篡改或伪造&#34;]
</code></pre><h3 id=2-jwt登录流程>2. JWT登录流程</h3><blockquote><p>心法: JWT校验流程 - 登录请求</p></blockquote><ul><li>客户端首次登录成功时，服务端将部分用户信息和密钥组合加密成一个Token字符串返回客户端。</li><li>客户端将该Token字符串保存在cookie，sessionStorage，localStorage或vuex中。</li><li>后续客户端请求均携带此Token字符串，服务端解密成功时执行请求，否则阻止。</li></ul><pre tabindex=0><code class=language-mermaid data-lang=mermaid>sequenceDiagram 
    autonumber
    participant b as 客户端
	participant i as 拦截器
	participant m as 控制方法

b -&gt;&gt; i: 发送登录请求
	note over i: 放行登录请求
i -&gt;&gt; m: 访问控制方法
	note right of m: 登录成功后&lt;br/&gt;根据服务端密钥和部分个人信息&lt;br/&gt;生成一个token字符串令牌
m --&gt;&gt; b: 响应token令牌
	note left of b: 在cookie或sessionStorage中&lt;br/&gt;存储token令牌
</code></pre><h3 id=3-jwt下单流程>3. JWT下单流程</h3><blockquote><p>心法: JWT校验流程图 - 下单请求</p></blockquote><pre tabindex=0><code class=language-mermaid data-lang=mermaid>sequenceDiagram 
    autonumber
    participant b as 客户端
	participant i as 拦截器
	participant m as 控制方法
	
b -&gt;&gt; i: 发送下单请求并在请求头中携带Token字符串
	note over i: 拦截下单请求

opt 请求中携带了正确的token令牌
	i -&gt;&gt; m: 放行请求
	m --&gt;&gt; b: 正常响应
end

opt 请求中未携带正确的token令牌
	i --&gt;&gt; b: 异常响应-Token令牌失效
end
</code></pre><h3 id=4-jwt防止重放>4. JWT防止重放</h3><blockquote><p>心法：请求重放 <code>Request Replay</code></p></blockquote><ul><li>请求重放是指在网络通信中，攻击者通过拦截和重复发送已经捕获的有效请求，以达到欺骗、篡改或者影响系统的目的，可能会导致重复操作，非法访问，数据篡改和信息泄漏等问题。</li></ul><table><thead><tr><th>重放问题</th><th>描述</th></tr></thead><tbody><tr><td>重复操作</td><td>攻击者重放请求，导致系统多次重复执行相同的操作，造成数据不一致或资源浪费。</td></tr><tr><td>非法访问</td><td>攻击者重放请求，绕过身份验证机制，获取未授权的访问权限。</td></tr><tr><td>数据篡改</td><td>攻击者拦截请求，修改请求中的数据后重放请求，以达到篡改数据的目的。</td></tr><tr><td>信息泄露</td><td>攻击者拦截请求，获取到请求中的敏感数据，如用户凭证等。</td></tr></tbody></table><blockquote><p>心法：JWT 防止请求重放</p></blockquote><ul><li>本身并不具备防止重放攻击的机制，但可以通过一些其他手段来加强JWT的安全性，以防止重放攻击的发生。</li></ul><pre tabindex=0><code class=language-mermaid data-lang=mermaid>flowchart LR
n1[&#34;短期有效&#34;]
n2[&#34;添加时间戳&#34;]
n3[&#34;使用一次性Token&#34;]
n4[&#34;记录请求IP&#34;]
n5[&#34;使用HTTPS&#34;]
n6[&#34;黑名单机制&#34;]

n1--&gt;n1a[&#34;限制JWT的有效期，使其在短时间内失效，从而降低被重放的可能性。&#34;]
n2--&gt;n2a[&#34;将时间戳包含在JWT的Payload中，并在服务端验证JWT时检查时间戳，
          如果发现时间戳与当前时间相差太大，就拒绝该JWT，防止被重放。&#34;]
n3--&gt;n3a[&#34;每次验证成功后都重新生成一个新的JWT，旧的JWT立即失效，
          这样即使有人尝试重放之前的JWT，也不会成功。&#34;]         
n4--&gt;n4a[&#34;在服务端记录每个JWT的使用情况，如何时从何地发起的请求等信息。
          通过监控和记录，可以及时发现异常的JWT使用行为，并采取相应的措施。&#34;] 
n5--&gt;n5a[&#34;通过使用HTTPS协议进行通信，加密请求和响应，避免了请求被篡改和窃听。&#34;]
n6--&gt;n6a[&#34;服务端可以维护一个JWT的黑名单，记录已经失效的JWT。
          当收到JWT时，首先检查该JWT是否在黑名单中，如果在黑名单中则拒绝该JWT。&#34;]
</code></pre><h3 id=5-jwt项目整合>5. JWT项目整合</h3><blockquote><p>武技: 在子项目中整合JWT工具</p></blockquote><ol><li>在父项目中锁定版本:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;jwt-version&gt;</span>3.4.0<span style=color:#f92672>&lt;/jwt-version&gt;</span>
</span></span></code></pre></div><ol start=2><li>在父项目中管理依赖:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--java-jwt--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>com.auth0<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>java-jwt<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>${jwt-version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start=3><li>在子项目中添加依赖:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--jwt--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>com.auth0<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>java-jwt<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start=4><li>测试JWT令牌的生成和验证方法 <code>JwtTest</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.jwt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>JwtTest</span> {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/** token令牌服务端秘钥，值随意，但千万不要泄露 */</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> String SECRET_KEY <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;my-secret&#34;</span>;  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>build</span>() {  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 用户部分信息  </span>
</span></span><span style=display:flex><span>        Long id <span style=color:#f92672>=</span> 1L;  
</span></span><span style=display:flex><span>        String nickname <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;赵四&#34;</span>;  
</span></span><span style=display:flex><span>        String avatar <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;赵四.jpg&#34;</span>;  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 主题  </span>
</span></span><span style=display:flex><span>        String subject <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;用户登录认证&#34;</span>;  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 颁发人  </span>
</span></span><span style=display:flex><span>        String issuer <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;lsx&#34;</span>;  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 颁发时间  </span>
</span></span><span style=display:flex><span>        Date issuedAt <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date();  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 过期时间  </span>
</span></span><span style=display:flex><span>        Date expiresAt <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date(System.<span style=color:#a6e22e>currentTimeMillis</span>() <span style=color:#f92672>+</span> (1000 <span style=color:#f92672>*</span> 60 <span style=color:#f92672>*</span> 60 <span style=color:#f92672>*</span> 24L));  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 创建一个令牌创建器  </span>
</span></span><span style=display:flex><span>        JWTCreator.<span style=color:#a6e22e>Builder</span> builder <span style=color:#f92672>=</span> JWT.<span style=color:#a6e22e>create</span>();  
</span></span><span style=display:flex><span>        builder.<span style=color:#a6e22e>withClaim</span>(<span style=color:#e6db74>&#34;id&#34;</span>, id);  
</span></span><span style=display:flex><span>        builder.<span style=color:#a6e22e>withClaim</span>(<span style=color:#e6db74>&#34;nickname&#34;</span>, nickname);  
</span></span><span style=display:flex><span>        builder.<span style=color:#a6e22e>withClaim</span>(<span style=color:#e6db74>&#34;avatar&#34;</span>, avatar);  
</span></span><span style=display:flex><span>        builder.<span style=color:#a6e22e>withSubject</span>(subject);  
</span></span><span style=display:flex><span>        builder.<span style=color:#a6e22e>withIssuer</span>(issuer);  
</span></span><span style=display:flex><span>        builder.<span style=color:#a6e22e>withIssuedAt</span>(issuedAt);  
</span></span><span style=display:flex><span>        builder.<span style=color:#a6e22e>withExpiresAt</span>(expiresAt);  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 签名  </span>
</span></span><span style=display:flex><span>        String token <span style=color:#f92672>=</span> builder.<span style=color:#a6e22e>sign</span>(Algorithm.<span style=color:#a6e22e>HMAC256</span>(SECRET_KEY));  
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(token);  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>verify</span>() {  
</span></span><span style=display:flex><span>        String token <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.&#34;</span> <span style=color:#f92672>+</span>  
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;eyJzdWIiOiLnlKjmiLfnmbvlvZXorqTor4EiLCJhdmF0&#34;</span> <span style=color:#f92672>+</span>  
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;YXJVcmwiOiLotbXlm5suanBnIiwibmlja25hbWUiOiLo&#34;</span> <span style=color:#f92672>+</span>  
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;tbXlm5siLCJpc3MiOiJKb2VaaG91IiwiaWQiOjEsImV4&#34;</span> <span style=color:#f92672>+</span>  
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;cCI6MTcwNTIxNjIxNiwiaWF0IjoxNzA1MTI5ODE2fQ.d&#34;</span> <span style=color:#f92672>+</span>  
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;dIK0sfDgZc6Skq4ePPk54rhxFDFrMeHn6PAUS0Uf3Q&#34;</span>;  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 通过秘钥验证token字符串，验证失败直接抛出异常  </span>
</span></span><span style=display:flex><span>        DecodedJWT decodedJwt <span style=color:#f92672>=</span> JWT.<span style=color:#a6e22e>require</span>(Algorithm.<span style=color:#a6e22e>HMAC256</span>(SECRET_KEY)).<span style=color:#a6e22e>build</span>().<span style=color:#a6e22e>verify</span>(token);  
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;subject: &#34;</span> <span style=color:#f92672>+</span> decodedJwt.<span style=color:#a6e22e>getSubject</span>());  
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;issuer: &#34;</span> <span style=color:#f92672>+</span> decodedJwt.<span style=color:#a6e22e>getIssuer</span>());  
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;issuedAt: &#34;</span> <span style=color:#f92672>+</span> decodedJwt.<span style=color:#a6e22e>getIssuedAt</span>());  
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;expiresAt: &#34;</span> <span style=color:#f92672>+</span> decodedJwt.<span style=color:#a6e22e>getExpiresAt</span>());  
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;id: &#34;</span> <span style=color:#f92672>+</span> decodedJwt.<span style=color:#a6e22e>getClaim</span>(<span style=color:#e6db74>&#34;id&#34;</span>).<span style=color:#a6e22e>asLong</span>());  
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;nickname: &#34;</span> <span style=color:#f92672>+</span> decodedJwt.<span style=color:#a6e22e>getClaim</span>(<span style=color:#e6db74>&#34;nickname&#34;</span>).<span style=color:#a6e22e>asString</span>());  
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;avatar: &#34;</span> <span style=color:#f92672>+</span> decodedJwt.<span style=color:#a6e22e>getClaim</span>(<span style=color:#e6db74>&#34;avatar&#34;</span>).<span style=color:#a6e22e>asString</span>());  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=6-jwt工具封装>6. JWT工具封装</h3><ul><li><a href=/%E7%AC%AC3%E9%98%B6%E6%AE%B5-SSM/JB3-4-SpringBoot/res/%E5%B0%81%E8%A3%85JWT%E5%B7%A5%E5%85%B7%E7%B1%BB/>封装JWT工具类</a></li></ul><h2 id=e09-整合easyexcel>E09. 整合EasyExcel</h2><blockquote><p>心法: <a href=https://easyexcel.opensource.alibaba.com/>EasyExcel</a></p></blockquote><ul><li>EasyExcel是一个基于Java的、快速、简洁、解决大文件内存溢出的Excel处理工具。</li><li>EasyExcel能让你在不用考虑性能、内存的等因素的情况下，快速完成Excel的读，写等功能。</li></ul><table><thead><tr><th>实体类标记</th><th>描述</th></tr></thead><tbody><tr><td><code>@HeadRowHeight(20)</code></td><td>标记类，表示设置Excel表格中标题行的行高</td></tr><tr><td><code>@ContentRowHeight(10)</code></td><td>标记类，表示设置Excel表格中内容行的行高</td></tr><tr><td><code>@ColumnWidth(18)</code></td><td>标记类或属性，表示设置Excel表格中的列宽度</td></tr><tr><td><code>@ExcelProperty(value = {"用户信息表", "主键"}, index = 0)</code></td><td>标记属性，设置大标题，列名和列索引</td></tr><tr><td><code>@ExcelIgnore</code></td><td>忽略该属性</td></tr><tr><td><code>@DateTimeFormat("yyyy/MM/dd HH:mm:ss")</code></td><td>格式化日期属性</td></tr><tr><td><code>@NumberFormat("##.00")</code></td><td>格式化浮点数属性</td></tr></tbody></table><blockquote><p>武技: 在子项目整合EasyExcel功能</p></blockquote><ol><li>在父项目中锁定版本:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;easyexcel-version&gt;</span>3.0.5<span style=color:#f92672>&lt;/easyexcel-version&gt;</span>
</span></span></code></pre></div><ol start=2><li>在父项目中管理依赖:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--easyexcel--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>com.alibaba<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>easyexcel<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>${easyexcel-version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start=3><li>在子项目中添加依赖:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--easyexcel--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>com.alibaba<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>easyexcel<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start=4><li>开发自定义转换器 <code>TimestampConverter</code>:<ul><li>用于将Long类型的时间戳转为日期字符串之后，再输出到表格中。</li></ul></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.component;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TimestampConverter</span> <span style=color:#66d9ef>implements</span> Converter<span style=color:#f92672>&lt;</span>Long<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> WriteCellData<span style=color:#f92672>&lt;?&gt;</span> convertToExcelData(Long value, ExcelContentProperty contentProperty, 
</span></span><span style=display:flex><span>                                               GlobalConfiguration globalConfiguration) <span style=color:#66d9ef>throws</span> Exception {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 将时间戳转为日期类型</span>
</span></span><span style=display:flex><span>        Date date <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date(value);
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 将日期转为字符串类型</span>
</span></span><span style=display:flex><span>        String result <span style=color:#f92672>=</span> DateFormat.<span style=color:#a6e22e>getDateTimeInstance</span>().<span style=color:#a6e22e>format</span>(date);
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 将结果写入单元格</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> WriteCellData<span style=color:#f92672>&lt;</span>Date<span style=color:#f92672>&gt;</span>(result);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=5><li>开发Excel实体类 <code>DogExcel</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.excel;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@ColumnWidth</span>(20)  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Data</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@AllArgsConstructor</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@NoArgsConstructor</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DogExcel</span> <span style=color:#66d9ef>implements</span> Serializable {  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@ExcelIgnore</span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@ExcelProperty</span>(value <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;狗子统计表&#34;</span>, <span style=color:#e6db74>&#34;狗子主键&#34;</span>})  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Long id;  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@ExcelProperty</span>(value <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;狗子统计表&#34;</span>, <span style=color:#e6db74>&#34;狗子姓名&#34;</span>})  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String name;  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@ExcelProperty</span>(value <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;狗子统计表&#34;</span>, <span style=color:#e6db74>&#34;狗子年龄&#34;</span>})  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Integer age;  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@ExcelProperty</span>(value <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;狗子统计表&#34;</span>, <span style=color:#e6db74>&#34;创建日期&#34;</span>})  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@DateTimeFormat</span>(<span style=color:#e6db74>&#34;yyyy/MM/dd HH:mm:ss&#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Date created;  
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@ExcelProperty</span>(value <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;狗子统计表&#34;</span>, <span style=color:#e6db74>&#34;修改日期&#34;</span>}, converter <span style=color:#f92672>=</span> TimestampConverter.<span style=color:#a6e22e>class</span>)  
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> Long updated;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=6><li>开发控制器类 <code>EasyExcelController</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.controller;  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>EasyExcelController</span> {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@SneakyThrows</span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/test/excel&#34;</span>)  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>excel</span>(HttpServletResponse resp) {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 准备Excel数据  </span>
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>DogExcel<span style=color:#f92672>&gt;</span> dogExcels <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;</span>();  
</span></span><span style=display:flex><span>        dogExcels.<span style=color:#a6e22e>add</span>(<span style=color:#66d9ef>new</span> DogExcel(1L, <span style=color:#e6db74>&#34;小白&#34;</span>, 1, <span style=color:#66d9ef>new</span> Date(), System.<span style=color:#a6e22e>currentTimeMillis</span>()));  
</span></span><span style=display:flex><span>        dogExcels.<span style=color:#a6e22e>add</span>(<span style=color:#66d9ef>new</span> DogExcel(2L, <span style=color:#e6db74>&#34;小黑&#34;</span>, 2, <span style=color:#66d9ef>new</span> Date(), System.<span style=color:#a6e22e>currentTimeMillis</span>()));  
</span></span><span style=display:flex><span>        dogExcels.<span style=color:#a6e22e>add</span>(<span style=color:#66d9ef>new</span> DogExcel(3L, <span style=color:#e6db74>&#34;小黄&#34;</span>, 3, <span style=color:#66d9ef>new</span> Date(), System.<span style=color:#a6e22e>currentTimeMillis</span>()));  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>        String fileName <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;狗子统计表.xlsx&#34;</span>;  
</span></span><span style=display:flex><span>        String sheetName <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;我的sheet&#34;</span>;  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 对文件名重新编码，以避免文件名中文乱码问题  </span>
</span></span><span style=display:flex><span>        fileName <span style=color:#f92672>=</span> URLEncoder.<span style=color:#a6e22e>encode</span>(fileName, StandardCharsets.<span style=color:#a6e22e>UTF_8</span>);  
</span></span><span style=display:flex><span>        sheetName <span style=color:#f92672>=</span> URLEncoder.<span style=color:#a6e22e>encode</span>(sheetName, StandardCharsets.<span style=color:#a6e22e>UTF_8</span>);  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 设置响应MIME类型为Excel文件下载类型  </span>
</span></span><span style=display:flex><span>        resp.<span style=color:#a6e22e>setContentType</span>(<span style=color:#e6db74>&#34;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8&#34;</span>);  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 设置以附件的形式下载文件  </span>
</span></span><span style=display:flex><span>        resp.<span style=color:#a6e22e>setHeader</span>(<span style=color:#e6db74>&#34;Content-disposition&#34;</span>, <span style=color:#e6db74>&#34;attachment;filename=&#34;</span> <span style=color:#f92672>+</span> fileName);  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 生成Excel报表并自动下载  </span>
</span></span><span style=display:flex><span>        EasyExcel.<span style=color:#a6e22e>write</span>(resp.<span style=color:#a6e22e>getOutputStream</span>(), DogExcel.<span style=color:#a6e22e>class</span>)  
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>sheet</span>(sheetName).<span style=color:#a6e22e>doWrite</span>(dogExcels);  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=7><li>访问 <a href=http://localhost:8070/test/excel>EasyExcelController</a></li><li><a href=/%E7%AC%AC3%E9%98%B6%E6%AE%B5-SSM/JB3-4-SpringBoot/res/%E5%B0%81%E8%A3%85Excel%E5%B7%A5%E5%85%B7%E7%B1%BB/>封装Excel工具类</a></li></ol><h1 id=s03-websocket通信>S03. WebSocket通信</h1><blockquote><p>心法: WebSocket服务</p></blockquote><ul><li>WebSocket是HTML5提供的一种在单个TCP连接上进行全双工通讯的协议，B端和S端只需完成一次握手即可建立一条快速的，持久的双向数据通道，更节省服务器资源和带宽，自动支持跨域访问。</li><li>学习过程中可以使用同一个项目同时作为服务端和客户端，但生产环境下建议分开搭建</li></ul><h2 id=e01-websocket服务端>E01. WebSocket服务端</h2><blockquote><p>武技: 使用子项目作为WebSocket服务端</p></blockquote><ol><li>在子项目中添加依赖:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-boot-starter-websocket--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-websocket<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start=2><li>开发主配项 <code>classpath:application.properties</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#75715e>############################# App ##############################</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#静态资源目录#</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.resources.static-locations</span><span style=color:#f92672>=</span><span style=color:#e6db74>classpath:/static/</span>
</span></span></code></pre></div><ol start=3><li>开发WS服务端类 <code>QQServer</code>: 用于接收客户端 <code>ws://</code> 开头的连接请求:<ul><li>类上标记 <code>@ServerEndpoint</code> 以指定端点地址和客户端唯一标识。</li><li>类上标记 <code>@Component</code> 以加入Spring管理。</li></ul></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.component;  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@ServerEndpoint</span>(<span style=color:#e6db74>&#34;/qq/{id}&#34;</span>)  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Component</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>QQServer</span> {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 用于存储每个WS客户端的Session实例: ConcurrentHashMap保证线程安全，static保证实例唯一  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> Map<span style=color:#f92672>&lt;</span>Long, Session<span style=color:#f92672>&gt;</span> CLIENTS <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ConcurrentHashMap<span style=color:#f92672>&lt;&gt;</span>();  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 当WS客户端上线时触发  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param id  WS客户端唯一标识  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param session 每个WS客户端连入WS服务端时，都会生成独有的session对象  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@OnOpen</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onOpen</span>(<span style=color:#a6e22e>@PathParam</span>(<span style=color:#e6db74>&#34;id&#34;</span>) Long id, Session session) {  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 将客户端唯一标识及其Session实例存入Map  </span>
</span></span><span style=display:flex><span>        CLIENTS.<span style=color:#a6e22e>put</span>(id, session);  
</span></span><span style=display:flex><span>        log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;{} 号用户上线了&#34;</span>, id);  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 当WS客户端下线时触发  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param id  WS客户端唯一标识  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param session 每个WS客户端连入WS服务端时，都会生成独有的session对象  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@OnClose</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onClose</span>(<span style=color:#a6e22e>@PathParam</span>(<span style=color:#e6db74>&#34;id&#34;</span>) Long id, Session session) {  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 从Map中移除该客户端和及其Session实例  </span>
</span></span><span style=display:flex><span>        CLIENTS.<span style=color:#a6e22e>remove</span>(id);  
</span></span><span style=display:flex><span>        log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;{} 号用户下线了&#34;</span>, id);  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 当WS客户端连接WS服务端异常时触发  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param id      WS客户端唯一标识  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param e       异常实例  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param session 每个WS客户端连入WS服务端时，都会生成独有的session对象  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@OnError</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onError</span>(<span style=color:#a6e22e>@PathParam</span>(<span style=color:#e6db74>&#34;id&#34;</span>) Long id, Throwable e, Session session) {  
</span></span><span style=display:flex><span>        log.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#34;{} 号用户连接或者通信异常&#34;</span>, id, e);  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 当WS服务端接收到消息的时候触发  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param id  WS客户端唯一标识  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param msg     消息内容  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param session 每个WS客户端连入WS服务端时，都会生成独有的session对象  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@OnMessage</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onMessage</span>(<span style=color:#a6e22e>@PathParam</span>(<span style=color:#e6db74>&#34;id&#34;</span>) Long id, String msg, Session session) {  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 遍历Map容器并向所有在线的客户端推送该消息  </span>
</span></span><span style=display:flex><span>        CLIENTS.<span style=color:#a6e22e>keySet</span>().<span style=color:#a6e22e>forEach</span>(key <span style=color:#f92672>-&gt;</span> CLIENTS.<span style=color:#a6e22e>get</span>(key).<span style=color:#a6e22e>getAsyncRemote</span>().<span style=color:#a6e22e>sendText</span>(id <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;:&#34;</span> <span style=color:#f92672>+</span> msg));  
</span></span><span style=display:flex><span>        log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;{} 号用户发来消息: {}&#34;</span>, id, msg);  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=4><li>管理WS服务端配置类: 用于扫描 <code>@ServerEndpoint</code> 注解:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.config;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>QQServerConfig</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>/** 该bean会自动扫描@ServerEndpoint注解并使其生效 */</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> ServerEndpointExporter <span style=color:#a6e22e>serverEndpointExporter</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> ServerEndpointExporter();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=e02-websocket客户端>E02. WebSocket客户端</h2><blockquote><p>武技: 使用子项目作为WebSocket客户端</p></blockquote><ol><li>开发全局样式 <code>classpath:static/style/global.css</code>:<ul><li>自行引入 <a href=https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css>bootstrap.min.css</a></li></ul></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css><span style=display:flex><span>::<span style=color:#a6e22e>-webkit-scrollbar</span> {  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>display</span>: <span style=color:#66d9ef>none</span>; <span style=color:#75715e>/*隐藏滚动条*/</span>  
</span></span><span style=display:flex><span>}  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>.<span style=color:#a6e22e>jumbotron</span> {  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>background</span>: rgb(<span style=color:#ae81ff>192</span>, <span style=color:#ae81ff>214</span>, <span style=color:#ae81ff>245</span>);   <span style=color:#75715e>/*背景色*/</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>width</span>: <span style=color:#ae81ff>1000</span><span style=color:#66d9ef>px</span>;   <span style=color:#75715e>/*宽度*/</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>margin</span>: <span style=color:#ae81ff>20</span><span style=color:#66d9ef>px</span> <span style=color:#66d9ef>auto</span>;   <span style=color:#75715e>/*上下外边距 左右居中*/</span>
</span></span><span style=display:flex><span>}  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>.<span style=color:#a6e22e>leftScreen</span><span style=color:#f92672>,</span> .<span style=color:#a6e22e>rightScreen</span> {  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>height</span>: <span style=color:#ae81ff>400</span><span style=color:#66d9ef>px</span>;   <span style=color:#75715e>/*高度*/</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>text-align</span>: <span style=color:#66d9ef>left</span>;   <span style=color:#75715e>/*内容居左*/</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>overflow-y</span>: <span style=color:#66d9ef>scroll</span>;   <span style=color:#75715e>/*垂直滚动条*/</span>
</span></span><span style=display:flex><span>}  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>.<span style=color:#a6e22e>media</span> <span style=color:#f92672>img</span> {  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>height</span>: <span style=color:#ae81ff>50</span><span style=color:#66d9ef>px</span>;  <span style=color:#75715e>/*高度*/</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>width</span>: <span style=color:#ae81ff>50</span><span style=color:#66d9ef>px</span>;  <span style=color:#75715e>/*宽度*/</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=2><li>开发客户端测试页面 <code>classpath:static/jack.html</code> :</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE html&gt;</span>  
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>html</span> <span style=color:#a6e22e>lang</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;en&#34;</span>&gt;  
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>head</span>&gt;  
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>charset</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;UTF-8&#34;</span>&gt;  
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>title</span>&gt;Jack&lt;/<span style=color:#f92672>title</span>&gt;  
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>link</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;stylesheet&#34;</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;style/bootstrap.min.css&#34;</span>&gt;  
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>link</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;stylesheet&#34;</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;style/global.css&#34;</span>&gt;  
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>head</span>&gt;  
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>body</span>&gt;  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;jumbotron&#34;</span>&gt;  
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>h2</span>&gt;[1]Jack&lt;/<span style=color:#f92672>h2</span>&gt;  
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>hr</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;my-4&#34;</span>&gt;  
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;container&#34;</span>&gt;  
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;row&#34;</span>&gt;  
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;col-sm-8&#34;</span> <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;border-right: 1px solid gray&#34;</span>&gt;  
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>section</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;leftScreen&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;leftScreen&#34;</span>&gt;&lt;/<span style=color:#f92672>section</span>&gt;  
</span></span><span style=display:flex><span>            &lt;/<span style=color:#f92672>div</span>&gt;            
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;col-sm-4&#34;</span>&gt;  
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>section</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;rightScreen&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;rightScreen&#34;</span>&gt;&lt;/<span style=color:#f92672>section</span>&gt;  
</span></span><span style=display:flex><span>            &lt;/<span style=color:#f92672>div</span>&gt;        
</span></span><span style=display:flex><span>		&lt;/<span style=color:#f92672>div</span>&gt;    
</span></span><span style=display:flex><span>	&lt;/<span style=color:#f92672>div</span>&gt;    
</span></span><span style=display:flex><span>	&lt;<span style=color:#f92672>hr</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;my-4&#34;</span>&gt;  
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;input-group&#34;</span>&gt;  
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>label</span> <span style=color:#a6e22e>for</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;msgIpt&#34;</span>&gt;&lt;/<span style=color:#f92672>label</span>&gt;  
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;msgIpt&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-control&#34;</span> <span style=color:#a6e22e>placeholder</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;输入聊天内容&#34;</span>/&gt;  
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;input-group-append&#34;</span>&gt;  
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;btn btn-info&#34;</span> <span style=color:#a6e22e>onclick</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;send()&#34;</span>&gt;发送&lt;/<span style=color:#f92672>button</span>&gt;  
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;btn btn-primary&#34;</span> <span style=color:#a6e22e>onclick</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;online()&#34;</span>&gt;上线&lt;/<span style=color:#f92672>button</span>&gt;  
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;btn btn-danger&#34;</span> <span style=color:#a6e22e>onclick</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;offline()&#34;</span>&gt;下线&lt;/<span style=color:#f92672>button</span>&gt;  
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>div</span>&gt;    
</span></span><span style=display:flex><span>	&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>div</span>&gt; 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>script</span>&gt;  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>socket</span>, <span style=color:#a6e22e>leftScreen</span>, <span style=color:#a6e22e>rightScreen</span>, <span style=color:#a6e22e>msgIpt</span>;  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>isOnline</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>onload</span> <span style=color:#f92672>=</span> () =&gt; {  
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>leftScreen</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#39;#leftScreen&#39;</span>);  
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>rightScreen</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#39;#rightScreen&#39;</span>);  
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>msgIpt</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#39;#msgIpt&#39;</span>);  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>WebSocket</span>) <span style=color:#a6e22e>showRightScreen</span>(<span style=color:#e6db74>&#39;系统: 浏览器不支持WebSocket!&#39;</span>);  
</span></span><span style=display:flex><span>    };  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>online</span>() {  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 使用ws://协议连接S端，并传递Jack的用户ID过去  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>socket</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>WebSocket</span>(<span style=color:#e6db74>&#39;ws://localhost:8070/qq/1&#39;</span>);  
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>onopen</span> <span style=color:#f92672>=</span> () =&gt; {  
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>isOnline</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;  
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>showRightScreen</span>(<span style=color:#e6db74>&#39;系统: Jack上线了&#39;</span>);  
</span></span><span style=display:flex><span>        }  
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>onclose</span> <span style=color:#f92672>=</span> () =&gt; {  
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>isOnline</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;  
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>showRightScreen</span>(<span style=color:#e6db74>&#39;系统: Jack下线了&#39;</span>);  
</span></span><span style=display:flex><span>        }  
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>onerror</span> <span style=color:#f92672>=</span> () =&gt; {  
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>isOnline</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;  
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>showRightScreen</span>(<span style=color:#e6db74>&#39;系统: Jack连接或通信异常&#39;</span>);  
</span></span><span style=display:flex><span>        }  
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>onmessage</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>resp</span> =&gt; {  
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isOnline</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>data</span>) {  
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>id</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#39;:&#39;</span>)[<span style=color:#ae81ff>0</span>];  
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>msg</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#39;:&#39;</span>)[<span style=color:#ae81ff>1</span>];  
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>showLeftScreen</span>(<span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>msg</span>);  
</span></span><span style=display:flex><span>            }  
</span></span><span style=display:flex><span>        }  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>offline</span>() {  
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>close</span>();  
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>isOnline</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>send</span>() {  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>isOnline</span>) {  
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>showRightScreen</span>(<span style=color:#e6db74>&#39;系统: 用户未上线&#39;</span>);  
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>;        
</span></span><span style=display:flex><span>		}  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>msgIpt</span>.<span style=color:#a6e22e>value</span>) {  
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>showRightScreen</span>(<span style=color:#e6db74>&#39;系统: 未输入消息内容&#39;</span>);  
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>;        
</span></span><span style=display:flex><span>		}  
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>send</span>(<span style=color:#a6e22e>msgIpt</span>.<span style=color:#a6e22e>value</span>)  
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>msgIpt</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>;  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>showLeftScreen</span>(<span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>content</span>) {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 消息来源是自己，左对齐显示  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>id</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;1&#39;</span>) {  
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>leftScreen</span>.<span style=color:#a6e22e>innerHTML</span> <span style=color:#f92672>+=</span>  
</span></span><span style=display:flex><span>                <span style=color:#e6db74>`&lt;div class=&#34;media&#34; style=&#34;text-align: left; margin-top: 10px;&#34;&gt;  
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &lt;img src=&#34;image/猴.png&#34; class=&#34;mr-3&#34;&gt;  
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &lt;div class=&#34;media-body&#34;&gt;                      
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	                    &lt;div&gt;&lt;small&gt;[自己]&lt;/small&gt;&lt;/div&gt;  
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	                    &lt;div&gt;&lt;strong&gt;</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>content</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&lt;/strong&gt;&lt;/div&gt;  
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &lt;/div&gt;                
</span></span></span><span style=display:flex><span><span style=color:#e6db74>				&lt;/div&gt;`</span>;  
</span></span><span style=display:flex><span>        }  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 消息来源是他人，右对齐显示  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>else</span> {  
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>leftScreen</span>.<span style=color:#a6e22e>innerHTML</span> <span style=color:#f92672>+=</span>  
</span></span><span style=display:flex><span>                <span style=color:#e6db74>`&lt;div class=&#34;media&#34; style=&#34;text-align: right; margin-top: 10px;&#34;&gt;  
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &lt;div class=&#34;media-body&#34;&gt;                      
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	                    &lt;div&gt;&lt;small&gt;[</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>id</span><span style=color:#e6db74>}</span><span style=color:#e6db74>号用户] 发来消息: &lt;/small&gt;&lt;/div&gt;  
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        &lt;div&gt;&lt;strong&gt;</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>content</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&lt;/strong&gt;&lt;/div&gt;  
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &lt;/div&gt;                    
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &lt;img src=&#34;image/兔.png&#34; class=&#34;ml-3&#34;&gt;  
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &lt;/div&gt;`</span>;  
</span></span><span style=display:flex><span>        }  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 滚动条处于底部  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>leftScreen</span>.<span style=color:#a6e22e>scrollTop</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>leftScreen</span>.<span style=color:#a6e22e>scrollHeight</span>;  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>showRightScreen</span>(<span style=color:#a6e22e>content</span>) {  
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>rightScreen</span>.<span style=color:#a6e22e>innerHTML</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>content</span>;  
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>rightScreen</span>.<span style=color:#a6e22e>innerHTML</span> <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#39;&lt;br/&gt;&#39;</span>;  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>script</span>&gt;  
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>body</span>&gt;  
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>html</span>&gt;
</span></span></code></pre></div><ol start=3><li>开发 <code>classpath:static/rose.html</code> 客户端测试页面:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE html&gt;</span>  
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>html</span> <span style=color:#a6e22e>lang</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;en&#34;</span>&gt;  
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>head</span>&gt;  
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>charset</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;UTF-8&#34;</span>&gt;  
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>title</span>&gt;Rose&lt;/<span style=color:#f92672>title</span>&gt;  
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>link</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;stylesheet&#34;</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;style/bootstrap.min.css&#34;</span>&gt;  
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>link</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;stylesheet&#34;</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;style/global.css&#34;</span>&gt;  
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>head</span>&gt;  
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>body</span>&gt;  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;jumbotron&#34;</span>&gt;  
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>h2</span>&gt;[2]Rose&lt;/<span style=color:#f92672>h2</span>&gt;  
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>hr</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;my-4&#34;</span>&gt;  
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;container&#34;</span>&gt;  
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;row&#34;</span>&gt;  
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;col-sm-8&#34;</span> <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;border-right: 1px solid gray&#34;</span>&gt;  
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>section</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;leftScreen&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;leftScreen&#34;</span>&gt;&lt;/<span style=color:#f92672>section</span>&gt;  
</span></span><span style=display:flex><span>            &lt;/<span style=color:#f92672>div</span>&gt;            
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;col-sm-4&#34;</span>&gt;  
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>section</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;rightScreen&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;rightScreen&#34;</span>&gt;&lt;/<span style=color:#f92672>section</span>&gt;  
</span></span><span style=display:flex><span>            &lt;/<span style=color:#f92672>div</span>&gt;        
</span></span><span style=display:flex><span>		&lt;/<span style=color:#f92672>div</span>&gt;    
</span></span><span style=display:flex><span>	&lt;/<span style=color:#f92672>div</span>&gt;    
</span></span><span style=display:flex><span>	&lt;<span style=color:#f92672>hr</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;my-4&#34;</span>&gt;  
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;input-group&#34;</span>&gt;  
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>label</span> <span style=color:#a6e22e>for</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;msgIpt&#34;</span>&gt;&lt;/<span style=color:#f92672>label</span>&gt;  
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;msgIpt&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-control&#34;</span> <span style=color:#a6e22e>placeholder</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;输入聊天内容&#34;</span>/&gt;  
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;input-group-append&#34;</span>&gt;  
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;btn btn-info&#34;</span> <span style=color:#a6e22e>onclick</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;send()&#34;</span>&gt;发送&lt;/<span style=color:#f92672>button</span>&gt;  
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;btn btn-primary&#34;</span> <span style=color:#a6e22e>onclick</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;online()&#34;</span>&gt;上线&lt;/<span style=color:#f92672>button</span>&gt;  
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;btn btn-danger&#34;</span> <span style=color:#a6e22e>onclick</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;offline()&#34;</span>&gt;下线&lt;/<span style=color:#f92672>button</span>&gt;  
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>div</span>&gt;    
</span></span><span style=display:flex><span>	&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>div</span>&gt;  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>script</span>&gt;  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>socket</span>, <span style=color:#a6e22e>leftScreen</span>, <span style=color:#a6e22e>rightScreen</span>, <span style=color:#a6e22e>msgIpt</span>;  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>isOnline</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>onload</span> <span style=color:#f92672>=</span> () =&gt; {  
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>leftScreen</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#39;#leftScreen&#39;</span>);  
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>rightScreen</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#39;#rightScreen&#39;</span>);  
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>msgIpt</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#39;#msgIpt&#39;</span>);  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>WebSocket</span>) <span style=color:#a6e22e>showRightScreen</span>(<span style=color:#e6db74>&#39;系统: 浏览器不支持WebSocket!&#39;</span>);  
</span></span><span style=display:flex><span>    };  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>online</span>() {  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 使用ws://协议连接S端，并传递Jack的用户ID过去  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>socket</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>WebSocket</span>(<span style=color:#e6db74>&#39;ws://localhost:8070/qq/2&#39;</span>);  
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>onopen</span> <span style=color:#f92672>=</span> () =&gt; {  
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>isOnline</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;  
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>showRightScreen</span>(<span style=color:#e6db74>&#39;系统: Rose上线了&#39;</span>);  
</span></span><span style=display:flex><span>        }  
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>onclose</span> <span style=color:#f92672>=</span> () =&gt; {  
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>isOnline</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;  
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>showRightScreen</span>(<span style=color:#e6db74>&#39;系统: Rose下线了&#39;</span>);  
</span></span><span style=display:flex><span>        }  
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>onerror</span> <span style=color:#f92672>=</span> () =&gt; {  
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>isOnline</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;  
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>showRightScreen</span>(<span style=color:#e6db74>&#39;系统: Rose连接或通信异常&#39;</span>);  
</span></span><span style=display:flex><span>        }  
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>onmessage</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>resp</span> =&gt; {  
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isOnline</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>data</span>) {  
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>id</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#39;:&#39;</span>)[<span style=color:#ae81ff>0</span>];  
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>msg</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#39;:&#39;</span>)[<span style=color:#ae81ff>1</span>];  
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>showLeftScreen</span>(<span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>msg</span>);  
</span></span><span style=display:flex><span>            }  
</span></span><span style=display:flex><span>        }  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>offline</span>() {  
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>close</span>();  
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>isOnline</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>send</span>() {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>isOnline</span>) {  
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>showRightScreen</span>(<span style=color:#e6db74>&#39;系统: 用户未上线&#39;</span>);  
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>;        }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>msgIpt</span>.<span style=color:#a6e22e>value</span>) {  
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>showRightScreen</span>(<span style=color:#e6db74>&#39;系统: 未输入消息内容&#39;</span>);  
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>;        }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>send</span>(<span style=color:#a6e22e>msgIpt</span>.<span style=color:#a6e22e>value</span>)  
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>msgIpt</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>;  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>showLeftScreen</span>(<span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>content</span>) {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 消息来源是自己，左对齐显示  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>id</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;2&#39;</span>) {  
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>leftScreen</span>.<span style=color:#a6e22e>innerHTML</span> <span style=color:#f92672>+=</span>  
</span></span><span style=display:flex><span>                <span style=color:#e6db74>`&lt;div class=&#34;media&#34; style=&#34;text-align: left; margin-top: 10px;&#34;&gt;  
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &lt;img src=&#34;image/兔.png&#34; class=&#34;mr-3&#34;&gt;  
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &lt;div class=&#34;media-body&#34;&gt;                      
</span></span></span><span style=display:flex><span><span style=color:#e6db74>						&lt;div&gt;&lt;small&gt;[自己]&lt;/small&gt;&lt;/div&gt;  
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        &lt;div&gt;&lt;strong&gt;</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>content</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&lt;/strong&gt;&lt;/div&gt;  
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &lt;/div&gt;                
</span></span></span><span style=display:flex><span><span style=color:#e6db74>				  &lt;/div&gt;`</span>;  
</span></span><span style=display:flex><span>        }  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 消息来源是他人，右对齐显示  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>else</span> {  
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>leftScreen</span>.<span style=color:#a6e22e>innerHTML</span> <span style=color:#f92672>+=</span>  
</span></span><span style=display:flex><span>                <span style=color:#e6db74>`&lt;div class=&#34;media&#34; style=&#34;text-align: right; margin-top: 10px;&#34;&gt;  
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &lt;div class=&#34;media-body&#34;&gt;                      
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	                    &lt;div&gt;&lt;small&gt;[</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>id</span><span style=color:#e6db74>}</span><span style=color:#e6db74>号用户] 发来消息: &lt;/small&gt;&lt;/div&gt;  
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        &lt;div&gt;&lt;strong&gt;</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>content</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&lt;/strong&gt;&lt;/div&gt;  
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &lt;/div&gt;                    
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &lt;img src=&#34;image/猴.png&#34; class=&#34;ml-3&#34;&gt;  
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &lt;/div&gt;`</span>;  
</span></span><span style=display:flex><span>        }  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 滚动条处于底部  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>leftScreen</span>.<span style=color:#a6e22e>scrollTop</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>leftScreen</span>.<span style=color:#a6e22e>scrollHeight</span>;  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>showRightScreen</span>(<span style=color:#a6e22e>content</span>) {  
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>rightScreen</span>.<span style=color:#a6e22e>innerHTML</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>content</span>;  
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>rightScreen</span>.<span style=color:#a6e22e>innerHTML</span> <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#39;&lt;br/&gt;&#39;</span>;  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>script</span>&gt;  
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>body</span>&gt;  
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>html</span>&gt;
</span></span></code></pre></div><ol start=4><li>启动项目并访问 <a href=http://localhost:8070/jack.html>jack.html</a></li><li>启动项目并访问 <a href=http://localhost:5001/8070.html>rose.html</a></li></ol><h1 id=s04-springbootadmin监控>S04. SpringBootAdmin监控</h1><h2 id=e01-springbootadmin服务端>E01. SpringBootAdmin服务端</h2><blockquote><p>心法: <a href=https://codecentric.github.io/spring-boot-admin/>SpringBootAdmin</a></p></blockquote><ul><li><a href=https://docs.spring.io/spring-boot/docs/2.4.8/reference/html/production-ready-features.html#production-ready>Actuator监控组件</a> 负责使用HTTP端点对线上项目进行健康检查，审计，收集指标等，目的是保持项目的高可用。</li><li>SpringBootAdmin内部整合了Actuator监控组件，监控所有SpringBoot应用的健康状态，JVM信息，线程信息，HTTP请求链路追踪信息等。</li><li>尽量不要使用同一个项目同时作为SpringBootAdmin的服务端和客户端，容易导致SpringDoc路径失效。</li></ul><table><thead><tr><th>端点</th><th>描述</th><th>示例</th></tr></thead><tbody><tr><td><code>actuator/health</code></td><td>运行状态</td><td>DB信息，redis信息，diskSpace硬盘信息等</td></tr><tr><td><code>actuator/beans</code></td><td>实例信息</td><td>所有bean信息</td></tr><tr><td><code>actuator/info</code></td><td>自定义信息</td><td>项目运行主配中，以info为前缀的自定义信息</td></tr><tr><td><code>actuator/metrics</code></td><td>度量信息</td><td>JVM内存，Request请求，Tomcat，GC等信息</td></tr><tr><td><code>actuator/mappings</code></td><td>接口信息</td><td>项目中所有 <code>@RequestMapping</code> 接口路径信息</td></tr><tr><td><code>actuator/env</code></td><td>环境信息</td><td>环境变量，JVM属性，项目配置，命令行参数等</td></tr><tr><td><code>actuator/configprops</code></td><td>属性信息</td><td>项目中所有 <code>@ConfigurationProperties</code> 信息</td></tr><tr><td><code>actuator/threaddump</code></td><td>线程信息</td><td>每个线程的阻塞状态，锁状态等信息</td></tr><tr><td><code>actuator/caches</code></td><td>缓存信息</td><td>所有可用的缓存</td></tr><tr><td><code>actuator/loggers</code></td><td>日志级别</td><td>支持通过Post亲贵 <code>actuator/loggers/包路径</code> 进行动态指定</td></tr><tr><td><code>actuator/scheduledtasks</code></td><td>定时任务</td><td>所有定时计划任务信息</td></tr><tr><td><code>actuator/conditions</code></td><td>自动配置</td><td>自动配置的候选项以及它们的先决条件是否满足</td></tr><tr><td><code>actuator/shutdown</code></td><td>关闭项目</td><td>默认禁用，需使用 <code>management.endpoint.shutdown.enabled = true</code> 打开</td></tr><tr><td><code>actuator/integrationgraph</code></td><td>显示图表</td><td>需要添加 <code>spring-integration-core</code> 依赖</td></tr><tr><td><code>actuator/httptrace</code></td><td>请求链路</td><td>显示近100个HTTP请求链路需要配置一个 HttpTraceRespository的bean</td></tr><tr><td><code>actuator/flyway</code></td><td>数据库迁移</td><td>显示已应用的任何Flyway数据库迁移需要配置1或N个Flyway的bean</td></tr><tr><td><code>actuator/liquibase</code></td><td>数据库迁移</td><td>显示已应用的任何Liquicbase数据库迁移需要配置1或N个Liquicbase的bean</td></tr><tr><td><code>actuator/auditevents</code></td><td>审计信息</td><td>显示项目的审计事件信息，需要配置1个AuditEventRepository的bean</td></tr><tr><td><code>actuator/sessions</code></td><td>删除会员</td><td>允许从session中检索和删除用户会话需要在一个基于Servlet的Web项目中使用SpringSession</td></tr></tbody></table><blockquote><p>武技: 创建子项目 <code>monitor</code> 为SpringBootAdmin服务端</p></blockquote><ol><li>在父项目中锁定版本:<ul><li>该版本不要超过SpringBoot的版本，否则会启动报错。</li></ul></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;spring-boot-admin-version&gt;</span>2.2.4<span style=color:#f92672>&lt;/spring-boot-admin-version&gt;</span>
</span></span></code></pre></div><ol start=2><li>在父项目中管理依赖:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-boot-admin-server--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>de.codecentric<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-admin-server<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>${spring-boot-admin-version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-boot-admin-server-ui--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>de.codecentric<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-admin-server-ui<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>${spring-boot-admin-version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start=3><li>在子项目中引入依赖:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-boot-admin-server--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>de.codecentric<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-admin-server<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-boot-admin-server-ui--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>de.codecentric<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-admin-server-ui<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start=4><li>开发主配项 <code>classpath:application.properties</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#75715e>############################# SpringBootAdmin服务端 #############################</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#项目名，端口号，管控台账号，管控台密码#  </span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.application.name</span><span style=color:#f92672>=</span><span style=color:#e6db74>monitor  </span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>server.port</span><span style=color:#f92672>=</span><span style=color:#e6db74>8060  </span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.security.user.name</span><span style=color:#f92672>=</span><span style=color:#e6db74>admin  </span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.security.user.password</span><span style=color:#f92672>=</span><span style=color:#e6db74>admin</span>
</span></span></code></pre></div><ol start=5><li>开发监控配置类 <code>MonitorConfig</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.config;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@EnableAdminServer</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MonitorConfig</span> {
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=6><li>启动项目，<a href=http://localhost:8060/actuator>查看对外暴露的所有端点</a>。</li></ol><h2 id=e02-springbootadmin客户端>E02. SpringBootAdmin客户端</h2><blockquote><p>武技: 使用子项目作为SpringBootAdmin客户端</p></blockquote><ol><li>在父项目中锁定版本:<ul><li>该版本不要超过SpringBoot的版本，否则会启动报错。</li></ul></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;spring-boot-admin-version&gt;</span>2.2.4<span style=color:#f92672>&lt;/spring-boot-admin-version&gt;</span>
</span></span></code></pre></div><ol start=2><li>在父项目中管理依赖:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-boot-admin-starter-client--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>de.codecentric<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-admin-starter-client<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>${spring-boot-admin-version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start=3><li>添加三方依赖:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!--spring-boot-admin-starter-client--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>de.codecentric<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-admin-starter-client<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start=4><li>开发主配项 <code>classpath:application.properties</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#75715e>############################# SpringBootAdmin客户端 ##############################</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#客户端地址，服务端地址，使用IP地址，账号，密码，暴露所有端点，展示health端点详情#</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.boot.admin.client.instance.service-base-url</span><span style=color:#f92672>=</span><span style=color:#e6db74>http://localhost:8070</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.boot.admin.client.url</span><span style=color:#f92672>=</span><span style=color:#e6db74>http://localhost:8060</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.boot.admin.client.instance.prefer-ip</span><span style=color:#f92672>=</span><span style=color:#e6db74>true</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.boot.admin.client.username</span><span style=color:#f92672>=</span><span style=color:#e6db74>admin</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.boot.admin.client.password</span><span style=color:#f92672>=</span><span style=color:#e6db74>admin</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>management.endpoints.web.exposure.include</span><span style=color:#f92672>=</span><span style=color:#e6db74>*</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>management.endpoint.health.show-details</span><span style=color:#f92672>=</span><span style=color:#e6db74>always</span>
</span></span></code></pre></div><ol start=5><li>开发健康检查器类 <code>MyHealthIndicator</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.lsx.component;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @author lsx */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Component</span>(<span style=color:#e6db74>&#34;我的硬盘空间&#34;</span>)  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyDiskIndicator</span> <span style=color:#66d9ef>implements</span> HealthIndicator {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Health <span style=color:#a6e22e>health</span>() {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 定义盘符总容量和空闲容量  </span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>long</span> totalDiskSpace <span style=color:#f92672>=</span> 0L, freeDiskSpace <span style=color:#f92672>=</span> 0L;  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 展示所有盘符名，如 [C:\, D:\, F:\]        </span>
</span></span><span style=display:flex><span>        File<span style=color:#f92672>[]</span> rootFiles <span style=color:#f92672>=</span> File.<span style=color:#a6e22e>listRoots</span>();  
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (rootFiles <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> rootFiles.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&gt;</span> 0) {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 计算计算机中所有盘符的总空间和可用空间  </span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> (File file : rootFiles) {  
</span></span><span style=display:flex><span>                totalDiskSpace <span style=color:#f92672>+=</span> file.<span style=color:#a6e22e>getTotalSpace</span>();  
</span></span><span style=display:flex><span>                freeDiskSpace <span style=color:#f92672>+=</span> file.<span style=color:#a6e22e>getUsableSpace</span>();  
</span></span><span style=display:flex><span>            }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 返回UP健康信息  </span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> Health.<span style=color:#a6e22e>up</span>()  
</span></span><span style=display:flex><span>                    .<span style=color:#a6e22e>withDetail</span>(<span style=color:#e6db74>&#34;总计容量&#34;</span>, totalDiskSpace <span style=color:#f92672>/</span> 1024 <span style=color:#f92672>/</span> 1024 <span style=color:#f92672>/</span> 1024 <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;GB&#34;</span>)  
</span></span><span style=display:flex><span>                    .<span style=color:#a6e22e>withDetail</span>(<span style=color:#e6db74>&#34;空闲容量&#34;</span>, freeDiskSpace <span style=color:#f92672>/</span> 1024 <span style=color:#f92672>/</span> 1024 <span style=color:#f92672>/</span> 1024 <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;GB&#34;</span>)  
</span></span><span style=display:flex><span>                    .<span style=color:#a6e22e>build</span>();  
</span></span><span style=display:flex><span>        }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 返回DOWN健康信息  </span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Health.<span style=color:#a6e22e>down</span>().<span style=color:#a6e22e>build</span>();  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=6><li>启动用户后台服务和监控服务，<a href=http://localhost:8060>访问监控管控台</a>:<ul><li>在应用墙中查看监控的项目，在监控界面的 <code>Insights -> 细节</code> 右侧查看。</li></ul></li></ol></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div></main><footer class=footer><span>&copy; 2024 The Marauders</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>